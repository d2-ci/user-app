(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[135],{1674:function(e,t,a){},2174:function(e,t,a){},2178:function(e,t,a){"use strict";a.r(t);var r={};a.r(r),a.d(r,"code",(function(){return dr})),a.d(r,"date",(function(){return pr})),a.d(r,"email",(function(){return hr})),a.d(r,"integer",(function(){return mr})),a.d(r,"negativeInteger",(function(){return gr})),a.d(r,"number",(function(){return yr})),a.d(r,"password",(function(){return br})),a.d(r,"positiveInteger",(function(){return fr})),a.d(r,"repeatPassword",(function(){return Er})),a.d(r,"required",(function(){return Ar})),a.d(r,"requiredArray",(function(){return Tr})),a.d(r,"username",(function(){return vr})),a.d(r,"whatsApp",(function(){return Sr}));var n=a(2175),s=a(328),i=a(0),o=a.n(i),l=a(302),c=a(4),u=a(744),d=a.n(u),p=a(1177),h=a.n(p),m=a(1178),g=a.n(m);var y=(()=>{let e=null;return()=>(e||(e=new Map([["ALL",c.a.t("All (Full authority)")],["F_ANALYTICSTABLEHOOK",c.a.t("Analytics Table Hook")],["F_ATTRIBUTE",c.a.t("Attribute")],["F_CATEGORY_COMBO",c.a.t("Category Combo")],["F_CATEGORY",c.a.t("Category")],["F_CATEGORY_OPTION",c.a.t("Category Option")],["F_CATEGORY_OPTION_GROUP",c.a.t("Category Option Group")],["F_CATEGORY_OPTION_GROUP_SET",c.a.t("Category Option Group Set")],["F_COLOR_SET",c.a.t("Color Set")],["F_CONSTANT",c.a.t("Constant")],["F_DASHBOARD",c.a.t("Dashboard")],["F_DATAELEMENTGROUPSET",c.a.t("Data Element Group Sets")],["F_DATAELEMENTGROUP",c.a.t("Data Element Groups")],["F_DATAELEMENT",c.a.t("Data Element")],["F_DATAELEMENT_MINMAX",c.a.t("Min/max rule")],["F_DATASET",c.a.t("Data Set")],["F_DATAVALUE",c.a.t("Data Value")],["F_DOCUMENT",c.a.t("Document")],["F_EVENTCHART",c.a.t("Event Chart")],["F_EVENTREPORT",c.a.t("Event Report")],["F_EXTERNAL_MAP_LAYER",c.a.t("External Map Layer")],["F_INDICATORGROUPSET",c.a.t("Indicator Group Sets")],["F_INDICATORGROUP",c.a.t("Indicator Group")],["F_INDICATORTYPE",c.a.t("Indicator Type")],["F_INDICATOR",c.a.t("Indicator")],["F_LEGEND_SET",c.a.t("Legend Set")],["F_MAP",c.a.t("Map")],["F_MINMAX_DATAELEMENT",c.a.t("Min-Max Data Element")],["F_OPTIONGROUPSET",c.a.t("Option Group Set")],["F_OPTIONGROUP",c.a.t("Option Group")],["F_OPTIONSET",c.a.t("Option Set")],["F_ORGANISATIONUNIT",c.a.t("Organisation Unit")],["F_ORGUNITGROUPSET",c.a.t("Organisation Unit Group Set")],["F_ORGUNITGROUP",c.a.t("Organisation Unit Group")],["F_PREDICTOR",c.a.t("Predictor")],["F_PROGRAMSTAGE",c.a.t("Program Stage")],["F_PROGRAM",c.a.t("Program")],["F_PROGRAM_INDICATOR",c.a.t("Program Indicator")],["F_PROGRAM_INDICATOR_GROUP",c.a.t("Program Indicator Group")],["F_PROGRAM_RULE",c.a.t("Program Rule")],["F_PROGRAM_TRACKED_ENTITY_ATTRIBUTE_GROUP",c.a.t("Program Tracked Entity Attribute Group")],["F_PUSH_ANALYSIS",c.a.t("Push Analysis")],["F_RELATIONSHIPTYPE",c.a.t("Relationship Type")],["F_REPORT",c.a.t("Report")],["F_SECTION",c.a.t("Section")],["F_SQLVIEW",c.a.t("SQL View")],["F_TRACKED_ENTITY",c.a.t("Tracked Entity")],["F_TRACKED_ENTITY_ATTRIBUTE",c.a.t("Tracked Entity Attribute")],["F_TRACKED_ENTITY_DATAVALUE",c.a.t("Tracked Entity Data Value")],["F_TRACKED_ENTITY_INSTANCE",c.a.t("Tracked Entity Instance")],["F_USERGROUP",c.a.t("User Group")],["F_USERROLE",c.a.t("User Role")],["F_USER",c.a.t("User")],["F_VALIDATIONRULEGROUP",c.a.t("Validation Rule Group")],["F_VALIDATIONRULE",c.a.t("Validation Rule")],["F_PREDICTORGROUP",c.a.t("Data predictor group")],["F_SKIP_DATA_IMPORT_AUDIT",c.a.t("Skip data import audit")],["F_VISUALIZATION",c.a.t("Visualization")]])),e)})();const b=(()=>{let e=null;return()=>(e||(e={metadata:{name:"Metadata",items:null,headers:["Name","Add/Update Public","Add/Update Private","Delete","External access"]},apps:{name:c.a.t("Apps"),items:null,headers:["Name"]},tracker:{name:c.a.t("Tracker"),items:null,headers:["Name"]},importExport:{name:c.a.t("Import-Export"),items:null,headers:["Name"]},system:{name:c.a.t("System"),items:null,headers:["Name"]}}),e)})(),f="_PUBLIC_ADD",E="_PRIVATE_ADD",A="_ADD",T="_DELETE",v="_EXTERNAL",S=[f,E,A,T,v],C={id:null,empty:!0},_={implicit:!0},R=new Set(["F_DASHBOARD_PUBLIC_ADD","F_EVENTCHART_PUBLIC_ADD","F_EVENTREPORT_PUBLIC_ADD","F_MAP_PUBLIC_ADD","F_VISUALIZATION_PUBLIC_ADD"]),I={tracker:new Set(["F_PROGRAM_DASHBOARD_CONFIG_ADMIN","F_PROGRAM_ENROLLMENT","F_PROGRAM_ENROLLMENT_READ","F_PROGRAM_UNENROLLMENT","F_TEI_CASCADE_DELETE","F_TRACKED_ENTITY_DATAVALUE_READ","F_TRACKED_ENTITY_INSTANCE_SEARCH","F_TRACKED_ENTITY_INSTANCE_SEARCH_IN_ALL_ORGUNITS","F_TRACKED_ENTITY_UPDATE","F_UNCOMPLETE_EVENT","F_VIEW_EVENT_ANALYTICS","F_PROGRAM_RULE_MANAGEMENT","F_ENROLLMENT_CASCADE_DELETE"]),importExport:new Set(["F_EXPORT_DATA","F_EXPORT_EVENTS","F_IMPORT_DATA","F_IMPORT_EVENTS","F_IMPORT_GML","F_METADATA_EXPORT","F_METADATA_IMPORT","F_METADATA_MANAGE","F_SKIP_DATA_IMPORT_AUDIT"]),system:new Set(["ALL","F_APPROVE_DATA","F_APPROVE_DATA_LOWER_LEVELS","F_ACCEPT_DATA_LOWER_LEVELS","F_VIEW_UNAPPROVED_DATA","F_ORGANISATIONUNIT_MOVE","F_ORGANISATIONUNITLEVEL_UPDATE","F_RUN_VALIDATION","F_REPLICATE_USER","F_USER_VIEW","F_USERGROUP_MANAGING_RELATIONSHIPS_ADD","F_USERGROUP_MANAGING_RELATIONSHIPS_VIEW","F_PERFORM_MAINTENANCE","F_SCHEDULING_ADMIN","F_GENERATE_MIN_MAX_VALUES","F_PREDICTOR_RUN","F_INSERT_CUSTOM_JS_CSS","F_SYSTEM_SETTING","F_SEND_EMAIL","F_MOBILE_SETTINGS","F_MOBILE_SENDSMS","F_OAUTH2_CLIENT_MANAGE"])},w=e=>(Object.keys(e).forEach((t=>{const a=e[t];a.items=h()(a.items,"name")})),e),O=e=>!S.some((t=>d()(e.id,t))),U=(e,t)=>{if(!t.get(e.id))return null;const a=S.find((t=>d()(e.id,t))),r=e.id.replace(a,""),n=t.get(r+A),s=t.get(r+v),i=R.has(r+f),o=n||t.get(r+f),l=n?C:i?_:t.get(r+E),c=i?_:t.get(r+T),u=s||C;return o&&l&&c?(S.forEach((e=>t.delete(r+e))),{name:y().get(r)||r,items:[o,l,c,u]}):null},N=(e,t,a)=>{const r=Object.keys(I).find((t=>I[t].has(e.id)))||"system";"ALL"===e.id&&(e.name=y().get(e.id)),t[r].items.push(e),a.delete(e.id)};var x=e=>{const t=e.reduce(((e,t)=>(e.set(t.id,t),e)),new Map),a=Object.keys(b()).reduce(((e,t)=>(e[t]={...b()[t],items:[]},e)),{}),r=e.reduce(((e,a)=>{if(g()(a.id,"M_"))e.apps.items.push(a),t.delete(a.id);else if(O(a))N(a,e,t);else{const r=U(a,t);r?e.metadata.items.push(r):t.get(a.id)&&N(a,e,t)}return e}),a);return w(r)};const F=["displayName","id","access","user[displayName,id]","publicAccess","userGroupAccesses"],P=[...F,"description"],D={fields:["organisationUnits[id,path,displayName,children::isNotEmpty]","dataViewOrganisationUnits[id,path,displayName,children::isNotEmpty]","teiSearchOrganisationUnits[id,path,displayName,children::isNotEmpty]"]},L={paging:!1,fields:["id","path","displayName","children::isNotEmpty","ancestors"]};var k={USER_LIST:["displayName","id","access","userCredentials[username,disabled,lastLogin,twoFA]","teiSearchOrganisationUnits[id,path]"],USER_GROUP_LIST:F,USER_ROLE_LIST:P,USER_DETAILS:[":owner","access","displayName","userGroups","organisationUnits[id,displayName,path]","dataViewOrganisationUnits[id,displayName,path]","userCredentials[id,username,accountExpiry,lastLogin,externalAuth,userRoles[id,displayName],cogsDimensionConstraints[id,displayName,dimensionType],catDimensionConstraints[id,displayName,dimensionType],openId,ldapId,disabled]","teiSearchOrganisationUnits[id,path]","whatsApp","facebookMessenger","skype","telegram","twitter"],USER_GROUP_DETAILS:[":owner","access","displayName","!users"],USER_ROLE_DETAILS:[":owner","access","authorities","displayName"]},M=a(332),G=a(745),j=a.n(G),B=a(1179),V=a.n(B);var H=e=>e?"function"===typeof e.toArray?e.toArray():e:[],q=a(709),W=a.n(q),Y=a(339),z=a.n(Y),Q=a(731),K=a.n(Q),X=a(408),J=a.n(X),Z=a(304),$=a(1),ee=a.n($),te=(a(1674),a(490)),ae=a.n(te);var re=({message:e,messages:t,httpStatusCode:a},r)=>{const n=r||c.a.t("Something went wrong when processing your request."),s=a&&a>=400&&a<500||!a&&t&&t.length>0;return!e&&t&&t.length>0&&(e=t.map((({message:e})=>e)).join(", ")),s?e:n};function ne(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class se extends i.Component{constructor(e){super(e),ne(this,"onSelectedOnlyChange",((e,t)=>{this.setState({selectedOnly:t}),this.props.onFilterChange(this.state.searchStr,t)})),ne(this,"onSearchStrChange",(e=>{const t=e.target.value;this.setState({searchStr:t}),this.props.onFilterChange(t,this.state.selectedOnly)})),this.state={searchStr:"",selectedOnly:!1}}render(){return o.a.createElement("div",{className:"authority-editor__filterbar"},o.a.createElement(s.TextField,{className:"authority-editor__filter-text-input search-input",floatingLabelText:c.a.t("Search"),onChange:this.onSearchStrChange,type:"search"}),o.a.createElement(s.Checkbox,{className:"authority-editor__filter-checkbox",label:c.a.t("Selected authorities only"),checked:this.state.selectedOnly,onCheck:this.onSelectedOnlyChange,style:{width:"300px"}}))}}var ie=se,oe=a(621),le=a.n(oe),ce=a(1675),ue=a.n(ce);var de=({text:e,searchChunks:t})=>t?o.a.createElement(ue.a,{highlightClassName:"authority-editor__search-highlight",searchWords:t,autoEscape:!0,textToHighlight:e}):e;class pe extends i.Component{constructor(...e){var t,a,r;super(...e),r=(e,t)=>{const{authSubject:{id:a},onCheckedCallBack:r}=this.props;r([a],t)},(a="onChecked")in(t=this)?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r}render(){const{authSubject:e,withLabel:t,disabled:a}=this.props,{searchChunks:r}=this.context,{name:n,empty:i,implicit:l}=e,c="authority-editor__auth-checkbox",u=t?c:"".concat(c,"--without-label"),d=t?o.a.createElement(de,{text:n,searchChunks:r}):"";return o.a.createElement("td",null,i?o.a.createElement("div",{className:"authority-editor__empty-cell"}):o.a.createElement(s.Checkbox,{onCheck:this.onChecked,label:d,className:u,checked:this.props.selected||Boolean(l),disabled:l||a}))}}pe.contextTypes={searchChunks:ee.a.array};var he=pe;class me extends i.Component{constructor(...e){var t,a,r;super(...e),r=(e,t)=>{this.context.onAuthChange(e,t),this.isPublicAdd(e)&&this.forceUpdate()},(a="onAuthGroupChanged")in(t=this)?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r}isPublicAdd(e){return d()(e,f)}isPrivateAdd(e){return d()(e,E)}render(){const{name:e,items:t}=this.props,{shouldSelect:a,searchChunks:r}=this.context;let n;return t.reduce(((e,t,r)=>{const s=this.isPublicAdd(t.id),i=this.isPrivateAdd(t.id),l=Boolean(n&&i),c=a(t.id)||l;return s&&(n=c),e.push(o.a.createElement(he,{key:"authitem-".concat(r),authSubject:t,withLabel:!1,selected:c,disabled:l,onCheckedCallBack:this.onAuthGroupChanged})),e}),[o.a.createElement("td",{key:"group-label"},o.a.createElement(de,{text:e,searchChunks:r}))])}}me.contextTypes={shouldSelect:ee.a.func.isRequired,onAuthChange:ee.a.func.isRequired,searchChunks:ee.a.array};var ge=me;function ye(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class be extends i.Component{constructor(...e){super(...e),ye(this,"onTableHeadCheck",((e,t)=>{const a=this.props.authSection.items.map((({id:e})=>e));this.context.onAuthChange(a,t)})),ye(this,"renderAuthRow",((e,t)=>{const{shouldSelect:a,onAuthChange:r}=this.context;return o.a.createElement("tr",{key:"row-".concat(t)},e.items?o.a.createElement(ge,{items:e.items,name:e.name}):o.a.createElement(he,{authSubject:e,withLabel:!0,selected:a(e.id),onCheckedCallBack:r}))}))}renderLoaderRow(){return o.a.createElement("tr",null,o.a.createElement("td",{className:"authority-editor__placeholder-cell"},o.a.createElement(s.CircularProgress,{size:24})))}renderInfoRow(e){let t="authority-editor__placeholder-cell",a=c.a.t("No matches found");return e&&(t+="--error",a=e),o.a.createElement("tr",null,o.a.createElement("td",{className:t},a))}renderContent(e){return e.items?"string"===typeof e.items?this.renderInfoRow(e.items):0===e.items.length?this.renderInfoRow():e.items.map(this.renderAuthRow):this.renderLoaderRow()}renderTableHead({headers:e,name:t,items:a}){const r="Metadata"!==t&&Array.isArray(a)&&a.length>0&&a.every((({id:e})=>this.context.shouldSelect(e)));return o.a.createElement("thead",null,o.a.createElement("tr",null,e.map(((e,a)=>o.a.createElement("th",{key:"header-".concat(a)},"Metadata"!==t&&0===a?o.a.createElement(s.Checkbox,{className:"authority-editor__auth-checkbox",label:e,onCheck:this.onTableHeadCheck,checked:r}):e)))))}render(){const{sectionKey:e,authSection:t}=this.props;let a="authority-editor__auth-group ".concat(e);t.items&&t.items.length>11&&(a+=" scrollable");let r="authority-editor__auth-group-table";return r+=" columns-".concat(t.headers.length),o.a.createElement(s.Paper,{className:a},o.a.createElement(Z.Heading,{level:6,className:"authority-editor__auth-group-header"},t.name),o.a.createElement("table",{className:r},this.renderTableHead(t),o.a.createElement("tbody",null,this.renderContent(t))))}}be.contextTypes={shouldSelect:ee.a.func.isRequired,onAuthChange:ee.a.func.isRequired};var fe=be;var Ee=(e,t,a,r)=>a||r?Object.keys(e).reduce(((n,s)=>{const i=e[s],o=i.items.filter((e=>{const n=((e,t)=>{if(!t)return!0;const a=e.name.toLowerCase();return t.some((e=>!(e.length<=1&&t.length>1)&&a.indexOf(e)>-1))})(e,a),s=((e,t,a)=>!t||(e.items&&e.items.length?e.items.some((e=>a.get(e.id))):Boolean(a.get(e.id))))(e,r,t);return n&&s}));return n[s]={...i,items:o},n}),{}):e;class Ae extends i.Component{constructor(e){super(e),this.state={filteredAuthorities:e.allGroupedAuthorities,searchChunks:null},this.updateFilter=le()(this.updateFilter,375)}getChildContext(){return{searchChunks:this.state.searchChunks}}componentWillReceiveProps(e){this.updateFilteredAuthorities(e.allGroupedAuthorities,null,null)}updateFilter(e,t){const{allGroupedAuthorities:a}=this.props;this.updateFilteredAuthorities(a,e,t)}updateFilteredAuthorities(e,t,a){const{selectedItemsLookup:r}=this.context,n=t?t.toLowerCase().split(" "):null;this.setState({filteredAuthorities:Ee(e,r,n,a),searchChunks:n})}render(){const{filteredAuthorities:e}=this.state;return o.a.createElement("div",{className:"authority-editor__auth-group-wrap"},Object.keys(e).map((t=>o.a.createElement(fe,{key:t,sectionKey:t,authSection:e[t]}))))}}Ae.contextTypes={shouldSelect:ee.a.func.isRequired,onAuthChange:ee.a.func.isRequired,selectedItemsLookup:ee.a.object.isRequired},Ae.childContextTypes={searchChunks:ee.a.array};var Te=Ae;function ve(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Se extends i.Component{constructor(e){super(e),ve(this,"onFilterChange",((e,t)=>{this.filteredAuthSections.updateFilter(e,t)})),ve(this,"onAuthChange",((e,t)=>{const{reduxFormOnChange:a}=this.props,r=[];e.forEach((e=>{this.selectedItemsLookup.set(e,t)})),this.selectedItemsLookup.forEach(((e,t)=>{e&&r.push(t)})),a&&a(r)})),ve(this,"shouldSelect",(e=>Boolean(this.selectedItemsLookup.get(e)))),this.state={allGroupedAuthorities:b()},this.selectedItemsLookup=e.initiallySelected.reduce(((e,t)=>e.set(t,!0)),new Map),this.groupedAuthoritiesPromise=null}getChildContext(){return{shouldSelect:this.shouldSelect,onAuthChange:this.onAuthChange,selectedItemsLookup:this.selectedItemsLookup}}async componentDidMount(){this.groupedAuthoritiesPromise=ae()(Gr.getGroupedAuthorities());try{const e=await this.groupedAuthoritiesPromise;this.setState({allGroupedAuthorities:e})}catch(e){this.handleAuthorityFetchError(e)}}componentWillUnmount(){this.groupedAuthoritiesPromise.trash()}handleAuthorityFetchError(e){const t=re(e,c.a.t("There was a problem retreiving the available authorities.")),a=Object.keys(b()).reduce(((e,a)=>(e[a]={...b()[a],items:t},e)),{});this.setState({allGroupedAuthorities:a})}render(){const{allGroupedAuthorities:e}=this.state;return o.a.createElement("div",{className:"authority-editor"},o.a.createElement(Z.Heading,{level:4,className:"authority-editor__header"},c.a.t("Authorities")),o.a.createElement(ie,{onFilterChange:this.onFilterChange}),o.a.createElement(Te,{ref:e=>{this.filteredAuthSections=e},allGroupedAuthorities:e}))}}Se.defaultProps={initiallySelected:[]},Se.childContextTypes={shouldSelect:ee.a.func.isRequired,onAuthChange:ee.a.func.isRequired,selectedItemsLookup:ee.a.object.isRequired};var Ce=Se,_e=a(1676);const Re={clear:"both",color:"#c33017",backgroundColor:"#ffe3de",padding:"1.5rem 1.5rem 1rem",fontSize:"1rem",width:"100%"};var Ie=({introText:e,errorMessage:t})=>o.a.createElement("div",{style:Re},e,o.a.createElement("pre",null,t));function we(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Oe={outerWrap:{paddingTop:0,paddingBottom:"2.5rem"},headerWrap:{display:"flex"},headerSpacer:{flex:"0 0 120px"},header:{flex:"1 0 120px",paddingBottom:0,fontSize:"1.2rem"},error:{color:M.red500},errorText:{fontSize:"0.8rem",marginLeft:"0.8rem"}};class Ue extends i.Component{constructor(e){super(e),we(this,"availableItemsReceivedHandler",(e=>{const{initiallyAssignedItems:t,returnModelsOnUpdate:a}=this.props,{itemStore:r,assignedItemStore:n}=this.state;a&&(this.modelLookup=new Map);const s=H(t).map((({id:e})=>e)),i=H(e).map((e=>{a&&this.modelLookup.set(e.id,e);const t=e.displayName||e.name;return{value:e.id,text:t}}));r.setState(i),n.setState(s)})),we(this,"onAssignItems",(e=>{const{assignedItemStore:t}=this.state,a=t.state.concat(e);return this.update(a)})),we(this,"onRemoveItems",(e=>{const{assignedItemStore:t}=this.state,a=t.state.filter((t=>-1===e.indexOf(t)));return this.update(a)})),we(this,"updateFilterText",(e=>{this.setState({filterText:e.target.value})})),this.state={itemStore:Z.Store.create(),assignedItemStore:Z.Store.create(),filterText:"",fetchErrorMsg:null}}async componentDidMount(){try{const e=await this.props.availableItemsQuery();this.availableItemsReceivedHandler(e)}catch(e){const t=re(e,c.a.t("Could not load available items"));this.setState({fetchErrorMsg:t})}}update(e){const{onChange:t,returnModelsOnUpdate:a,onBlur:r}=this.props,{assignedItemStore:n}=this.state,s=a?e.map((e=>this.modelLookup.get(e))):e;return n.setState(e),t(s),r&&r(),Promise.resolve()}renderHeader(){const{availableItemsHeader:e,assignedItemsHeader:t,errorText:a}=this.props,r=a?{...Oe.header,...Oe.error}:Oe.header;return o.a.createElement("div",{style:Oe.headerWrap},o.a.createElement(Z.Heading,{level:4,style:Oe.header},e),o.a.createElement("div",{style:Oe.headerSpacer}),o.a.createElement(Z.Heading,{level:4,style:r},t,a?o.a.createElement("span",{style:Oe.errorText},a):null))}renderSearchInput(){return o.a.createElement(J.a,{fullWidth:!0,type:"search",onChange:this.updateFilterText,value:this.state.filterText,floatingLabelText:c.a.t("Filter"),hintText:c.a.t("Filter available and selected items"),style:{marginTop:"-16px"}})}renderGroupEditor(){const{itemStore:e,assignedItemStore:t,filterText:a,fetchErrorMsg:r}=this.state;if(r){const e=c.a.t("There was a problem displaying the GroupEditor");return o.a.createElement(Ie,{introText:e,errorMessage:r})}return o.a.createElement(_e.GroupEditor,{itemStore:e,assignedItemStore:t,onAssignItems:this.onAssignItems,onRemoveItems:this.onRemoveItems,height:250,filterText:a})}render(){return o.a.createElement("div",{style:Oe.outerWrap},this.renderHeader(),this.renderSearchInput(),this.renderGroupEditor())}}var Ne=Ue,xe=a(1817),Fe=a(1913),Pe=a.n(Fe),De=a(367),Le=a.n(De),ke=a(307),Me=a.n(ke),Ge=a(354),je=a.n(Ge),Be=a(541),Ve=a.n(Be);function He(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const qe={error:{info:{color:M.blue500},warning:{color:M.orange500},error:{color:M.red500}}},We=[{text:"loading...",value:o.a.createElement(z.a,{style:{textAlign:"center"}},o.a.createElement(Le.a,{style:{marginTop:"12px"}}))}],Ye={filteredItems:[],searchWarning:null,errorStyle:qe.error.info};class ze extends i.Component{constructor(e){super(e),He(this,"onAutoCompleteChange",(e=>{this.setState({autoCompleteText:e}),this.getItems(e)})),He(this,"getItems",(async e=>{const{minCharLength:t,query:a,queryParam:r}=this.props;if(!e||e.length<t){const a=e?c.a.t("Please enter at least {{ minCharCount }} characters",{minCharCount:t}):null;this.setState({...Ye,searchWarning:a})}else{this.setState({...Ye,filteredItems:We}),this.trashableQuery=ae()(a(e,r));try{let e=await this.trashableQuery;if(e=H(e),e.length>0){const t=e.map((e=>({text:e.displayName,value:e})));this.setState({...Ye,filteredItems:t})}else this.setState({...Ye,errorStyle:qe.error.warning,searchWarning:c.a.t("No matches found")})}catch(n){this.setState({...Ye,errorStyle:qe.error.warning,searchWarning:re(n,c.a.t("There was a problem retreiving your search results"))})}}})),He(this,"onItemSelect",(e=>{const{selectHandler:t}=this.props;this.setState({autoCompleteText:""}),t(e)}));const t=e.queryDebounceTime||375;this.state={...Ye},this.getItems=le()(this.getItems,t),this.trashableQuery=null}componentWillUnmount(){this.trashableQuery&&this.trashableQuery.trash()}render(){const{autoCompleteProps:e}=this.props,t={floatingLabelText:c.a.t("Search"),hintText:c.a.t("Enter search term"),fullWidth:!0,type:"search",filter:()=>!0,...e},{filteredItems:a,searchWarning:r,errorStyle:n,autoCompleteText:s}=this.state,i=r?0:28,l={...t,onUpdateInput:this.onAutoCompleteChange,onNewRequest:this.onItemSelect,searchText:s,dataSource:a,errorText:r,errorStyle:n,floatingLabelShrinkStyle:n,style:{marginBottom:i},menuStyle:{maxHeight:"600px"}};return o.a.createElement(Ve.a,l)}}ze.defaultProps={queryDebounceTime:375,minCharLength:3};var Qe=ze;function Ke(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Xe={wrapper:{minHeight:"300px",maxHeight:"60vh",position:"relative"},scrollBox:{position:"relative",marginTop:"-12px",maxHeight:"calc(60vh - 154px)",minHeight:"calc(300px - 154px)",overflowY:"auto",paddingTop:"8px",paddingBottom:"8px",borderRadius:"2px"},loader:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},buttonStrip:{paddingTop:"16px",height:"36px"},buttonMargin:{marginRight:"8px"},header:{paddingBottom:0,fontSize:"1.2rem",marginBottom:"-16px"},headerError:{color:M.red500},errorText:{fontSize:"0.8rem",marginLeft:"0.8rem"}};class Je extends i.Component{constructor(e){super(e),Ke(this,"toggleSelectedOrgUnits",((e,t)=>{const{selectedOrgUnits:a}=this.state,r=this.getIndexOfOrgUnit(t),n=-1===r?[...a,t]:[...a.slice(0,r),...a.slice(r+1)];this.update(n,[])})),Ke(this,"selectAndShowFilteredOrgUnit",(e=>{const t=e.value,{selectedOrgUnits:a}=this.state,r=[this.removeLastPathSegment(t)],n=[...a,t];this.update(n,r)})),Ke(this,"clearSelection",(()=>{this.update([]),Pe()(this.applySelection)})),Ke(this,"applySelection",(()=>{const{selectedOrgUnits:e}=this.state,{confirmSelection:t}=this.props;t(e)})),this.state={roots:null,selectedOrgUnits:[...e.selectedOrgUnits],orgUnitFilter:null,initiallyExpanded:this.getInitiallyExpandedItems(e.selectedOrgUnits)}}getInitiallyExpandedItems(e){return e.reduce(((e,t)=>{const a=this.removeLastPathSegment(t);return a&&e.push(a),e}),[])}getIndexOfOrgUnit(e){const{selectedOrgUnits:t}=this.state,a=t.find((t=>t.path===e.path));return t.indexOf(a)}removeLastPathSegment({path:e}){return e.substr(0,e.lastIndexOf("/"))}update(e,t){const{onChange:a,onBlur:r}=this.props,n=t?{selectedOrgUnits:e,initiallyExpanded:t}:{selectedOrgUnits:e};a&&a(e.map((e=>e.id))),this.setState(n),r&&r()}render(){const{selectedOrgUnits:e,initiallyExpanded:t,orgUnitFilter:a}=this.state,{roots:r,confirmSelection:n,cancel:s,orgUnitType:i,headerText:l,wrapperStyle:u,errorText:d}=this.props,p=e.map((e=>e.path)),h={floatingLabelText:c.a.t("Search"),hintText:c.a.t("Enter search term"),fullWidth:!0},m=d?{...Xe.header,...Xe.headerError}:Xe.header;return o.a.createElement("div",{style:{...Xe.wrapper,...u}},l?o.a.createElement(Z.Heading,{level:4,style:m},l,d&&o.a.createElement("span",{style:Xe.errorText},d)):null,o.a.createElement(Qe,{autoCompleteProps:h,query:Gr.queryOrgUnits,queryParam:i,minCharLength:2,queryDebounceTime:375,selectHandler:this.selectAndShowFilteredOrgUnit}),o.a.createElement(Me.a,{style:Xe.scrollBox},r?o.a.createElement(xe.OrgUnitTreeMultipleRoots,{roots:r,onSelectClick:this.toggleSelectedOrgUnits,selected:p,initiallyExpanded:t,orgUnitsPathsToInclude:a}):o.a.createElement(Le.a,{style:Xe.loader})),n?o.a.createElement("div",{style:Xe.buttonStrip},o.a.createElement(je.a,{label:c.a.t("Apply"),primary:!0,style:Xe.buttonMargin,onClick:this.applySelection,disabled:!r}),o.a.createElement(je.a,{label:c.a.t("Clear all"),secondary:!0,style:Xe.buttonMargin,onClick:this.clearSelection,disabled:!r}),o.a.createElement(je.a,{onClick:s,label:c.a.t("Cancel")})):null)}}var Ze=Object(l.b)(((e,t)=>({roots:_t(t.orgUnitType,e.currentUser)})))(Je);function $e(){return($e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const et={checkbox:{marginTop:"32px",fontSize:"16px"},warning:{color:M.orange500}},tt=({input:e,meta:t,label:a,...r})=>{const{asyncValidating:n,touched:s,error:i}=t,l=n?c.a.t("Validating..."):s&&i;return n&&(r.errorStyle=et.warning),o.a.createElement("div",{style:{marginTop:20}},o.a.createElement("label",{htmlFor:e.name,style:{display:"block",color:"rgba(0, 0, 0, 0.3)",fontSize:12,lineHeight:"".concat(16.5,"px")}},a),o.a.createElement("div",{style:{marginTop:-10}},o.a.createElement(J.a,$e({},e,r,{type:"date",inputWidth:"200px",errorText:l}))))},at=({input:e,label:t,meta:{touched:a,error:r,asyncValidating:n},...s})=>{const i=n?c.a.t("Validating..."):a&&r;return n&&(s.errorStyle=et.warning),o.a.createElement(J.a,$e({floatingLabelText:t,hintText:t,fullWidth:!0,errorText:i},s,e))},rt=({input:e})=>{const t=""===e.value?[]:e.value;return o.a.createElement(Ce,{initiallySelected:t,reduxFormOnChange:e.onChange,reduxFormOnBlur:e.onBlur})},nt=({input:e,label:t})=>o.a.createElement(W.a,$e({checked:Boolean(e.value),onCheck:e.onChange,label:t},e,{style:et.checkbox})),st=({input:e,label:t,meta:{touched:a,error:r,asyncValidating:n},options:s,style:i})=>{const l=n?c.a.t("Validating..."):a&&r,u=n?et.warning:void 0;return o.a.createElement(K.a,{floatingLabelText:t,fullWidth:!0,value:e.value,name:e.name,onChange:(t,a,r)=>{e.onChange(r),setTimeout((()=>e.onBlur(r)),1)},style:i,errorText:l,errorStyle:u},s.map((({id:e,label:t},a)=>o.a.createElement(z.a,{key:"option_".concat(a),value:e,primaryText:t}))))},it=({input:e,meta:{touched:t,error:a},availableItemsQuery:r,availableItemsLabel:n,assignedItemsLabel:s,initialValues:i,...l})=>o.a.createElement(Ne,$e({initiallyAssignedItems:i,onChange:e.onChange,onBlur:e.onBlur,availableItemsQuery:r,availableItemsHeader:n,assignedItemsHeader:s,errorText:t&&a},l)),ot=({input:e,meta:{touched:t,error:a},label:r,wrapperStyle:n,initialValues:s,orgUnitType:i})=>o.a.createElement(Ze,{selectedOrgUnits:s,onChange:e.onChange,wrapperStyle:n,headerText:r,orgUnitType:i,errorText:t&&a,onBlur:e.onBlur}),lt=({name:e,label:t,style:a})=>o.a.createElement("p",{key:e,style:a},t),ct="groupForm",ut="name",dt="code",pt="managedGroups",ht={loaderWrap:{paddingTop:"2rem",textAlign:"center"}},mt=()=>[{name:ut,label:c.a.t("Name"),fieldRenderer:at,isRequiredField:!0},{name:dt,label:c.a.t("Code"),fieldRenderer:at},{name:"manage_users_info",fieldRenderer:lt,label:c.a.t("To add a user to this group, go to the User section and edit the user group settings for a specific user."),style:{border:"1px solid #bdbdbd",backgroundColor:"#e5e5e5",padding:12}},{name:pt,fieldRenderer:it,initialItemsSelector:e=>H(e.managedGroups),availableItemsQuery:"getAvailableUserGroups",availableItemsLabel:c.a.t("Available user groups"),assignedItemsLabel:c.a.t("Managed user groups")}];var gt=(e,t)=>e.split(".").reduce(((e,t)=>e&&e[t]?e[t]:null),t);const yt=V()((e=>{if(null===e)return e;const{total:t,pageCount:a,page:r,query:{pageSize:n}}=e,s=t-(t-(a-(a-r))*n),i=1+s-n,o=s;return e.currentlyShown="".concat(i," - ").concat(o>t?t:o),e})),bt=(e,t)=>{if(!e||"string"===typeof e)return e;const a=e.modelDefinition.name;return e.toArray().map((e=>ft[a](e,t)))},ft={user:e=>(e.userName=e.userCredentials.username,e.disabled=e.userCredentials.disabled,e.accountExpiry=e.userCredentials.accountExpiry,e.lastLogin=e.userCredentials.lastLogin,e),userRole:e=>e,userGroup:(e,t)=>(e.currentUserIsMember=t.includes(e.id),e)},Et=V()((e=>e.length<3?e.map((e=>e.displayName)).join(", "):c.a.t("{{count}} selected",{count:e.length}))),At=(e,t,a)=>{if(a===Nt){const n=new Date(e[a]),s="".concat((r=n).getFullYear().toString(),"-").concat((r.getMonth()+1).toString().padStart(2,0),"-").concat(r.getDate().toString().padStart(2,0));t[a]=s}else a===Kt?t[a]=[...e.catDimensionConstraints,...e.cogsDimensionConstraints]:e[a]&&!j()(e[a].size)||Array.isArray(e[a])?t[a]=H(e[a]).map((({id:e})=>e)):t[a]=e[a];var r},Tt=V()(((e,t,a)=>{const r={[Ft]:oa};return e.id&&(ta.forEach((t=>{At(e,r,t)})),aa.forEach((t=>{At(e.userCredentials,r,t)})),a.forEach((e=>r[e.name]=e.value))),r[Vt]=t.ui.selected||"en",r[Ht]=t.db.selected,r})),vt=V()(((e,t)=>{const a={};return mt().forEach((t=>{At(e,a,t.name)})),t.forEach((e=>a[e.name]=e.value)),a})),St=V()((e=>[...H(gt("userCredentials.catDimensionConstraints",e)),...H(gt("userCredentials.cogsDimensionConstraints",e))])),Ct=V()(((e,t)=>t&&e?t.get(e):null)),_t=(e,t)=>{const a=t.systemOrganisationUnitRoots,r=t[e],n=t[Wt];let s=null;return t.authorities.has("ALL")?s=a:(0===r.size||n.size>0)&&(s=n.toArray()),s},Rt=e=>{const t=e&&e.registeredFields,a=e&&e.values;return(Boolean(t&&t[Ft])&&a&&a[Ft])===la},It={loaderWrap:{paddingTop:"2rem",textAlign:"center"},toggler:{color:M.blue600},orgUnitTree:{width:"calc(50% - 60px)",float:"left",minHeight:"100px",maxHeight:"1200px"},togglerWrap:{clear:"both",paddingTop:"1.2rem",marginBottom:"1.5rem"},additionalFieldsWrap:{clear:"both",paddingTop:"1.5rem"}},wt="userForm",Ot="username",Ut="email",Nt="accountExpiry",xt="disabled",Ft="inviteUser",Pt="externalAuth",Dt="password",Lt="repeatPassword",kt="surname",Mt="firstName",Gt="openId",jt="ldapId",Bt="phoneNumber",Vt="interfaceLanguage",Ht="databaseLanguage",qt="userRoles",Wt="organisationUnits",Yt="dataViewOrganisationUnits",zt="teiSearchOrganisationUnits",Qt="userGroups",Kt="catCogsDimensionConstraints",Xt="whatsApp",Jt="facebookMessenger",Zt="skype",$t="telegram",ea="twitter",ta=[kt,Mt,Ut,Bt,Xt,Jt,Zt,$t,ea,Wt,Yt,Qt,zt],aa=[Ot,xt,Nt,Pt,Dt,Gt,jt,qt,Kt],ra="ALWAYS_REQUIRED",na="INVITE_REQUIRED",sa="CREATE_REQUIRED",ia="use_db_locale",oa="SET_PASSWORD",la="INVITE_USER",ca=()=>({label:c.a.t("Selecting an organisation unit provides access to all units in the sub-hierarchy"),fieldRenderer:lt,style:{clear:"both",paddingTop:"0.8rem",fontStyle:"italic",fontSize:"0.9rem"}});var ua=a(1914),da=a.n(ua);const pa={query:"",inactiveMonths:null,selfRegistered:!1,invitationStatus:null,organisationUnits:[]},ha={show:!1,props:{message:""}},ma={show:!1,props:{},content:null},ga={show:!1,id:null,type:null},ya="user",ba="userRole",fa="userGroup";var Ea=a(466),Aa=a(2181),Ta=(a(1915),a(1916));const va="LIST_REQUESTED",Sa="LIST_RECEIVED",Ca="LIST_ERRORED",_a="CLEAR_ITEM",Ra="INIT_NEW_ITEM",Ia="ITEM_REQUESTED",wa="ITEM_RECEIVED",Oa="ITEM_ERRORED",Ua="SHOW_SNACKBAR",Na="HIDE_SNACKBAR",xa="SHOW_DIALOG",Fa="HIDE_DIALOG",Pa="SHOW_SHARING_DIALOG",Da="HIDE_SHARING_DIALOG",La="PAGER_RESET",ka="FILTER_UPDATED",Ma="FILTER_RESET",Ga="CURRENT_USER_REQUESTED",ja="CURRENT_USER_RECEIVED",Ba="CURRENT_USER_ERRORED";var Va=(e=null,{type:t,payload:a})=>{switch(t){case _a:case Ia:return null;case Ra:case wa:case Oa:return a;default:return e}};var Ha=(e=null,{type:t,payload:a})=>{switch(t){case Ga:return null;case ja:case Ba:return a;default:return e}};var qa=(e=pa,{type:t,payload:a})=>{switch(t){case ka:return{...e,[a.updateKey]:a.updateValue};case Ma:return{...pa};default:return e}};const Wa={type:null,items:null};var Ya=(e=Wa,{type:t,payload:a})=>{switch(t){case va:return{type:a,items:null};case Sa:return e.type===a.type?{type:a.type,items:a.items}:e;case Ca:return{type:null,items:a.message};default:return e}};var za=(e=null,{type:t,payload:a})=>{switch(t){case La:return null;case Sa:return a.items.pager;default:return e}};var Qa=(e=ma,{type:t,payload:a})=>{switch(t){case xa:return{show:!0,...a};case Fa:return{...ma};default:return e}};var Ka=(e=ga,{type:t,payload:a})=>{switch(t){case Pa:return{show:!0,...a};case Da:return{...ga};default:return e}};var Xa=(e=ha,{type:t,payload:a})=>{switch(t){case Ua:return{show:!0,props:a};case Na:return{...ha};default:return e}};var Ja=Object(Ea.c)({snackbar:Xa,dialog:Qa,sharing:Ka});const Za=[Ta.a];const $a=Object(Ea.c)({list:Ya,filter:qa,pager:za,currentItem:Va,currentUser:Ha,popups:Ja,form:Aa.a});var er=Object(Ea.d)($a,Object(Ea.a)(...Za));const tr="not-a-date";let ar;function rr(){if("undefined"!==typeof ar)return ar;let e=document.createElement("input");return e.setAttribute("type","date"),e.setAttribute("value",tr),ar=e.value!==tr,e=null,ar}const nr=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/i,sr=/^\+(?:[0-9].?){4,14}[0-9]$/,ir=/[0-9]{4}-[0-9]{2}-[0-9]{2}/,or=/^(?=.*[a-z]).+$/,lr=/^(?=.*[A-Z]).+$/,cr=/^(?=.*[0-9]).+$/,ur=/[^a-zA-Z0-9]/;function dr(e){if(_r(e)&&e.length>50)return c.a.t("Exceeds maximum character limit of 50")}function pr(e){if(_r(e)&&!ir.test(e))return c.a.t("Please enter a valid date with the following format yyyy-mm-dd")}function hr(e){if(_r(e)&&!nr.test(e.toLowerCase()))return c.a.t("Please provide a valid email address")}function mr(e){if(_r(e)&&!Cr(e))return c.a.t("Value should be an integer")}function gr(e){if(_r(e)&&(!Cr(e)||parseInt(e,10)>=0))return c.a.t("Value should be a nagative integer")}function yr(e){if(_r(e)&&isNaN(e))return c.a.t("Value should be a number")}function br(e,t,a){if(!function(e,t){if(t.inviteUser)return!1;const a=Boolean(t.user.id);return!(a&&!e.password&&!e.repeatPassword)}(t,a))return;const r=function(e){if(!_r(e))return c.a.t("This field is required");if(e.length<8)return c.a.t("Password should be at least 8 characters long");if(e.length>35)return c.a.t("Password should be no longer than 34 characters");if(!or.test(e))return c.a.t("Password should contain at least one lowercase letter");if(!lr.test(e))return c.a.t("Password should contain at least one UPPERCASE letter");if(!cr.test(e))return c.a.t("Password should contain at least one number");if(!ur.test(e))return c.a.t("Password should have at least one special character");return null}(t.password);return r||void 0}function fr(e){if(_r(e)&&(!Cr(e)||parseInt(e,10)<=0))return c.a.t("Value should be a positive integer")}function Er(e,t){if(t.repeatPassword!==t.password)return c.a.t("Passwords do not match")}function Ar(e){return _r(e)?void 0:c.a.t("This field is required")}function Tr(e){if(!(Array.isArray(e)&&e.length>0))return c.a.t("This field is required. Please select at least one")}function vr(e){return _r(e)&&e.length<2?c.a.t("A username should be at least 2 characters long"):_r(e)&&e.length>140?c.a.t("Username may not exceed 140 characters"):void 0}function Sr(e){if(_r(e)&&!sr.test(e))return c.a.t("Please provide a valid international phone number (+0123456789)")}function Cr(e){if(isNaN(e))return!1;const t=parseFloat(e);return(0|t)===t}function _r(e){return"undefined"!==typeof e&&null!==e&&""!==e}const Rr="userAttibute_",Ir="no_value";function wr(e,t){return e.map((e=>function({id:e,valueType:t,displayName:a,mandatory:r,unique:n,optionSet:s},i){const o=i&&i.find((t=>t.attribute.id===e)),l=function(e,t,a){const r=Nr(),n=t?{...r.OPTION_SET,props:{options:t.options.map((e=>({id:e.id,label:e.displayName})))}}:r[e]||r.TEXT;n.fieldRenderer!==st||a||n.props.options[0].id===Ir||(n.props.options=[{id:Ir,label:c.a.t("<No value>")},...n.props.options]);return n}(t,s,r);return{name:Rr+e,isAttributeField:!0,label:a,isRequiredField:r,shouldBeUnique:n,attributeId:e,value:o&&o.value||null,valueType:t,...l}}(e,t)))}function Or(e,t){e.forEach((({shouldBeUnique:e,name:a})=>{e&&t.push(a)}))}function Ur(e,t){const a=t.reduce(((e,{attributeId:t,valueType:a})=>(e[t]=a,e)),{});return Object.keys(e).reduce(((t,r)=>{if(-1!==r.indexOf(Rr)){const n=r.replace(Rr,""),s=e[r],i="TRUE_ONLY"===a[n]&&!s,o=s===Ir;i||o||t.push({value:s,attribute:{id:n}})}return t}),[])}const Nr=(()=>{let e=null;return()=>(e||(e={OPTION_SET:{fieldRenderer:st},TEXT:{fieldRenderer:at},LONG_TEXT:{fieldRenderer:at,props:{multiLine:!0,rows:3,rowsMax:6}},DATE:{fieldRenderer:at,props:{type:"date",floatingLabelFixed:rr(),hintText:null},fieldValidators:[pr]},BOOLEAN:{fieldRenderer:st,props:{options:[{id:"true",label:c.a.t("Yes")},{id:"false",label:c.a.t("No")}]}},TRUE_ONLY:{fieldRenderer:nt},NUMBER:{fieldRenderer:at,fieldValidators:[yr]},INTEGER:{fieldRenderer:at,fieldValidators:[mr]},INTEGER_POSITIVE:{fieldRenderer:at,fieldValidators:[fr]},INTEGER_NEGATIVE:{fieldRenderer:at,fieldValidators:[gr]}}),e)})();const xr=(e,t)=>{const a=da()(e).toUpperCase(),r="".concat(a,t?"_DETAILS":"_LIST");return k[r]},Fr=({authorities:e})=>e.has("ALL"),Pr=(e,t,a)=>{j()(t)||(e[a]=Array.isArray(t)?t.map((e=>({id:e}))):t)},Dr=(e,t,a)=>"/userSettings/key".concat(e,"Locale?user=").concat(t,"&value=").concat(a),Lr=({locale:e,name:t})=>({id:e,label:t}),kr=e=>e.toArray().map((e=>{const t=e.userCredentials.username,a=e.toJSON();return a.displayName+=" (".concat(t,")"),a}));function Mr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Gr=new class{constructor(){Mr(this,"getD2",(()=>this.d2)),Mr(this,"getContextPath",(()=>this.d2.system.systemInfo.contextPath)),Mr(this,"getList",((e,t,a)=>{const r=((e=1,t,a,r,n)=>{const{query:s,inactiveMonths:i,selfRegistered:o,invitationStatus:l,organisationUnits:c}=t,u={pageSize:50,fields:a,page:e,order:r===ya?["firstName:asc","surname:asc"]:"name:asc"};if(r!==ya||Fr(n)||(u.userOrgUnits=!0,u.includeChildren=!0),s&&(u.query=s),i&&(u.inactiveMonths=i),o&&(u.selfRegistered=o),l&&(u.invitationStatus=l),c.length){const e=c.map((e=>e.id)).join();u.filter="organisationUnits.id:in:[".concat(e,"]")}return u})(t,a,xr(e),e,this.getCurrentUser());return this.d2.models[e].list(r)})),Mr(this,"getItem",((e,t)=>{const a={fields:xr(e,!0)};return this.d2.models[e].get(t,a)})),Mr(this,"genericFind",((e,t,a)=>this.d2.models[e].filter().on(t).equals(a).list({fields:["id"]}))),Mr(this,"replicateUser",((e,t,a)=>{const r="/users/".concat(e,"/replica"),n={username:t,password:a};return this.d2Api.post(r,n)})),Mr(this,"queryOrgUnits",((e,t)=>{const a={...L,query:e};return this.d2.models.organisationUnits.list(a).then((e=>((e,t)=>{const{currentUser:a}=er.getState();if(a.authorities.has("ALL"))return e.toArray();const r=a[t].size>0?a[t]:a[Wt];return e.toArray().filter((e=>{const t=Boolean(r.get(e.id)),a=!t&&e.ancestors.toArray().some((e=>Boolean(r.get(e.id))));return t||a}))})(e,t)))})),Mr(this,"getAvailableUserRoles",(()=>this.d2.models.userRoles.list({canIssue:!0,fields:["id","displayName"],paging:!1}))),Mr(this,"getAvailableDataAnalyticsDimensionRestrictions",(()=>this.d2Api.get("/dimensions/constraints",{fields:["id","name","dimensionType"],paging:!1}).then((({dimensions:e})=>e)))),Mr(this,"updateDisabledState",((e,t)=>{const a="/users/".concat(e),r={userCredentials:{disabled:t}};return this.d2Api.patch(a,r)})),Mr(this,"disable2FA",(e=>{const t="/users/".concat(e);return this.d2Api.patch(t,{userCredentials:{twoFA:!1}})})),Mr(this,"getSelectedAndAvailableLocales",(e=>{e=e?encodeURIComponent(e):null;const t={id:ia,label:c.a.t("Use database locale / no translation")},a=this.d2Api.get("/locales/db"),r=this.d2Api.get("/locales/ui"),n=e?this.d2Api.get("/userSettings/keyUiLocale?user=".concat(e)):this.d2.system.settings.get("keyUiLocale"),s=e?this.d2Api.get("/userSettings/keyDbLocale?user=".concat(e)):Promise.resolve(ia);return Promise.all([a,r,s,n]).then((([e,a,r,n])=>({db:{available:[t,...e.map(Lr)],selected:r||ia},ui:{available:a.map(Lr),selected:n}})))})),Mr(this,"saveOrInviteUser",((e,t,a,r,n,s)=>{const i=((e,t,a,r)=>{const n=!t.id,s=t.modelDefinition.getOwnedPropertyNames(),i=n?{userCredentials:{cogsDimensionConstraints:[],catDimensionConstraints:[]}}:{id:t.id,userCredentials:{id:t.userCredentials&&t.userCredentials.id,userInfo:{id:t.id},cogsDimensionConstraints:[],catDimensionConstraints:[]}},o=i.userCredentials;if(Array.isArray(e.catCogsDimensionConstraints)&&e.catCogsDimensionConstraints.forEach((e=>{"CATEGORY_OPTION_GROUP_SET"===e.dimensionType?o.cogsDimensionConstraints.push({id:e.id}):o.catDimensionConstraints.push({id:e.id})})),ta.forEach((t=>Pr(i,e[t],t))),aa.forEach((t=>Pr(o,e[t],t))),o[Nt]||"undefined"===typeof o[Nt]||delete o[Nt],i.attributeValues=Ur(e,r),delete o[Kt],(a||e[Pt])&&(delete o.password,delete o.repeatPassword),!n)for(const l of s)t[l]&&!(l in i)&&(i[l]=t[l]);return i})(e,t,a,s),o=a?"/users/invite":"/users";return(t.id?this.d2Api.update("/users/".concat(t.id),i):this.d2Api.post(o,i)).then((t=>{if("ERROR"===t.status)return Promise.reject((e=>{const t=[];for(const a of e.typeReports)for(const e of a.objectReports)for(const a of e.errorReports)t.push({message:a.message});return{messages:t}})(t));const a=[],s=encodeURIComponent(e.username),i=e[Vt];i!==r&&a.push(this.d2Api.post(Dr("Ui",s,i)));const o=e[Ht];if(o!==n){const e=o===ia?this.d2Api.delete("/userSettings/keyDbLocale?user=".concat(s)):this.d2Api.post(Dr("Db",s,o));a.push(e)}return 0===a.length&&a.push(Promise.resolve("No locale changes detected")),Promise.all(a)}))})),Mr(this,"getManagedUsers",(()=>this.d2.models.user.list({fields:["id","displayName","userCredentials[username]"],paging:!1}).then(kr))),Mr(this,"getAvailableUserGroups",(()=>this.d2.models.userGroups.list({fields:["id","displayName"],paging:!1}))),Mr(this,"getGroupedAuthorities",(()=>{if(this.groupedAuths)return Promise.resolve(this.groupedAuths);const e="".concat(this.getContextPath(),"/dhis-web-commons/security/getSystemAuthorities.action");return this.d2Api.request("GET",e).then((({systemAuthorities:e})=>this.groupedAuths=x(e)))})),Mr(this,"getCurrentUser",(()=>this.d2.currentUser)),Mr(this,"getCurrentUserGroupsAndRoles",(()=>this.d2Api.get("me",{fields:"userGroups[id],userCredentials[userRoles[id]]"}).then((e=>({userGroupIds:e.userGroups.map((({id:e})=>e)),userRoleIds:e.userCredentials.userRoles.map((({id:e})=>e))}))))),Mr(this,"initCurrentUser",(()=>Promise.all([this.getCurrentUserGroupsAndRoles(),this.getCurrentUserOrgUnits(),this.getSystemOrgUnitRoots()]).then((([{userGroupIds:e,userRoleIds:t},{organisationUnits:a,dataViewOrganisationUnits:r,teiSearchOrganisationUnits:n},s])=>Object.assign(this.d2.currentUser,{userGroupIds:e,userRoleIds:t,organisationUnits:a,dataViewOrganisationUnits:r,teiSearchOrganisationUnits:n,systemOrganisationUnitRoots:s}))))),Mr(this,"refreshCurrentUser",(()=>{const e=Object.getPrototypeOf(this.d2.currentUser).constructor,t=this.d2.models;return Promise.all([this.d2Api.get("me",{fields:[":all","!userGroups","!organisationUnits","userCredentials[:all,!user,!userRoles]"]}),this.d2Api.get("me/authorization"),this.d2Api.get("userSettings")]).then((([a,r,n])=>(this.d2.currentUser=e.create(a,r,t,n),this.initCurrentUser())))})),Mr(this,"getCurrentUserOrgUnits",(()=>this.d2.models.users.get(this.d2.currentUser.id,D))),Mr(this,"getSystemOrgUnitRoots",(()=>this.d2.models.organisationUnits.list({paging:!1,level:1,fields:"id,path,displayName,children::isNotEmpty"}).then((e=>e.toArray())))),Mr(this,"updateCurrentUserGroupMembership",((e,t)=>{const a=t?"delete":"post",r="/users/".concat(this.d2.currentUser.id,"/userGroups/").concat(e);return this.d2Api[a](r)}))}init(e){this.d2=e,this.d2Api=e.Api.getApi()}getAttributes(e){return this.d2Api.get("attributes",{fields:["id","displayName","mandatory","unique","valueType","optionSet[options[id,displayName]]"],filter:"".concat(e,"Attribute:eq:true"),paging:!1}).then((e=>e.attributes))}isAttributeUnique(e,t,a,r){return this.d2.models[e].filter().on("id").notEqual(t).filter().on("attributeValues.attribute.id").equals(a).filter().on("attributeValues.value").equals(r).list({paging:!1,fields:["id","attributeValues[value, attribute[id]]"]}).then((e=>{if(0===e.size)return!0;return 0===((e,t,a)=>e.toArray().reduce(((e,r)=>e.concat(r.attributeValues.filter((e=>t===e.value&&a===e.attribute.id)))),[]))(e,r,a).length}))}saveUserGroup(e){return e.id?this.d2Api.update("/userGroups/".concat(e.id,"?mergeMode=MERGE"),e):this.d2Api.post("/userGroups",e)}saveRole(e){return e.id?this.d2Api.update("/userRoles/".concat(e.id),e):this.d2Api.post("/userRoles/",e)}},jr=a(512),Br=a(412),Vr=a.n(Br);function Hr(){return(Hr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var qr=Object(l.b)((e=>({open:e.popups.dialog.show,dialogProps:e.popups.dialog.props,content:e.popups.dialog.content})))((({open:e,dialogProps:t,content:a})=>o.a.createElement(Vr.a,Hr({key:"dialog",open:e},t),a)));const Wr=(e,t)=>({type:e,payload:t}),Yr=async(e,t,a,r)=>{r||e(Wr(va,a));try{const r=await t;e(Wr(Sa,{type:a,items:r}))}catch(n){e(Wr(Ca,{type:a,error:n}))}},zr=(e,t)=>(a,r)=>{const{filter:n,pager:s}=r(),i=s?s.page:1,o=Gr.getList(e,i,n);Yr(a,o,e,t)},Qr=async(e,t,a)=>{a(Wr(e.requested));try{const r=await t;a(Wr(e.received,r))}catch(r){a(Wr(e.errored,r))}},Kr=(e,t)=>a=>{Qr({requested:Ia,received:wa,errored:Oa},Gr.getItem(e,t),a)},Xr={requested:Ga,received:ja,errored:Ba},Jr=()=>e=>{Qr(Xr,Gr.refreshCurrentUser(),e)},Zr=()=>Wr(_a),$r=(e,t)=>Wr(ka,{updateKey:e,updateValue:t}),en=e=>Wr(Ua,e),tn=()=>Wr(Na),an=(e,t)=>Wr(xa,{content:e,props:t}),rn=()=>Wr(Fa);var nn=a(705),sn=a.n(nn),on=a(457),ln=a.n(on),cn=a(455),un=a.n(cn),dn=a(456),pn=a.n(dn),hn=a(537),mn=a.n(hn),gn=a(673),yn=Object(gn.b)();var bn=e=>{yn.push(e)};const fn={padding:"0",margin:".5rem",marginTop:"1rem",float:"left",width:"230px"},En={padding:"1rem",height:"auto",borderBottom:"1px solid #ddd",cursor:"pointer",fontWeight:"bold"},An={height:"85px",padding:".5rem 1rem"},Tn={textAlign:"right"};class vn extends i.Component{constructor(...e){var t,a,r;super(...e),r=(e,t)=>{const{currentUser:a,models:r}=this.context.d2,n=a.canCreate(r[e.entityType]),s=a.canDelete(r[e.entityType]),i=n||s;return i?o.a.createElement(sn.a,{key:"card-".concat(t),style:fn},o.a.createElement(un.a,{onClick:()=>bn(e.path),style:En,title:e.label}),o.a.createElement(pn.a,{style:An},e.description),o.a.createElement(ln.a,{style:Tn},this.renderActionButtons(e,i,n))):null},(a="renderCard")in(t=this)?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r}renderActionButtons(e,t,a){const r=[],n="".concat(e.path,"/new");return a&&r.push(o.a.createElement(mn.a,{key:"add",iconClassName:"material-icons",tooltip:c.a.t("Add"),tooltipPosition:"top-center",onClick:()=>bn(n)},"\ue145")),t&&r.push(o.a.createElement(mn.a,{key:"list",iconClassName:"material-icons",tooltip:c.a.t("list"),tooltipPosition:"top-center",onClick:()=>bn(e.path)},"\ue8ef")),r}render(){const e=so().map(this.renderCard);return 0===e.length?o.a.createElement("div",null,c.a.t("You do not have access to any section of the DHIS 2 User Management App")):e}}vn.contextTypes={d2:ee.a.object};var Sn=vn,Cn=a(651),_n=a.n(Cn),Rn=a(966),In=a.n(Rn),wn=a(2180),On=a(2179);const Un=()=>{er.dispatch(Jr())},Nn=()=>{const e=Gr.getContextPath()+"/dhis-web-commons-security/logout.action";window.location.assign(e)};var xn=(e,t)=>{const{currentUser:a}=er.getState(),r=e.modelDefinition.name;r===ya&&e.id===a.id&&(t?Nn():Un()),r===ba&&a.userRoleIds.includes(e.id)&&Un(),r===fa&&a.userGroupIds.includes(e.id)&&Un()};function Fn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Pn="replicateUserForm";class Dn extends i.Component{constructor(...e){super(...e),Fn(this,"replicateUser",(async e=>{const{user:t,hideDialog:a}=this.props,{username:r,password:n}=e;try{await Gr.replicateUser(t.id,r,n),this.replicateSuccesHandler(t.displayName)}catch(s){this.replicateErrorHandler(s)}a()})),Fn(this,"replicateSuccesHandler",(e=>{const{getList:t,showSnackbar:a}=this.props;a({message:c.a.t('User "{{displayName}}" replicated successfuly',{displayName:e})}),t(ya,!0)})),Fn(this,"replicateErrorHandler",(e=>{const{showSnackbar:t}=this.props;t({message:re(e,c.a.t("There was a problem replicating the user"))})}))}render(){const{submitting:e,pristine:t,valid:a,handleSubmit:r,hideDialog:n,asyncValidating:i}=this.props,l=Boolean(e||i||t||!a);return o.a.createElement("form",{autoComplete:"off",onSubmit:r(this.replicateUser)},o.a.createElement(wn.a,{name:Ot,component:at,label:c.a.t("Username"),hintText:c.a.t("Username for new user"),validate:[vr],autoComplete:"new-password"}),o.a.createElement(wn.a,{name:Dt,component:at,label:c.a.t("Password"),hintText:c.a.t("Password for new user"),validate:[br],type:"password",autoComplete:"new-password"}),o.a.createElement("div",{style:{marginTop:16}},o.a.createElement(s.RaisedButton,{label:c.a.t("Replicate"),type:"submit",disabled:l,primary:!0}),o.a.createElement(s.RaisedButton,{label:c.a.t("Cancel"),onClick:n,style:{marginLeft:8}})))}}const Ln=Object(On.a)({form:Pn,asyncValidate:async function(e,t,a,r){return Gn(e,a,r,jn)},asyncBlurFields:[Ot]})(Dn);var kn=Object(l.b)((e=>({formState:e.form.replicateUserForm})),{getList:zr,hideDialog:rn,showSnackbar:en,hideSnackbar:tn})(Ln);async function Mn(e,t,a,r){const n=a.asyncErrors;if(!r&&!n)return Promise.resolve();let s;s=a.form===wt&&r===Ot?await jn(e,a):a.form!==ct||r!==dt&&r!==ut?await async function(e,t,a){const r=e[a];if(!r)return Promise.resolve();const n=t.form===wt?ya:fa,s=n===ya?t.user.id||"_":t.group.id||"_",i=a.replace(Rr,"");try{if(!await Gr.isAttributeUnique(n,s,i,r))return{[a]:c.a.t("Attribute value needs to be unique, value already taken.")}}catch(o){return{[a]:c.a.t("There was a problem checking if this attribute value is unique")}}}(e,a,r):await Bn(e,a,r);const i=n||s?{...n,...s}:void 0;if(i)throw i;return Promise.resolve()}async function Gn(e,t,a,r){if(!a)return Promise.resolve();const n=await r(e,t,a);if(n)throw n;return Promise.resolve()}async function jn(e,t){const a=e.username,r=t.form!==Pn&&t.user&&t.user.id;if(!a||r)return Promise.resolve();try{if((await Gr.genericFind("users","userCredentials.username",a)).size>0)return{[Ot]:c.a.t("Username already taken")}}catch(n){return{[Ot]:c.a.t("There was a problem whilst checking the availability of this username")}}}async function Bn(e,t,a){const{group:r,role:n}=t,s=n||r,i=s.modelDefinition.name,o=e[a],l=_n()(a);if(!o)return Promise.resolve();try{const e=await Gr.genericFind(i,a,o);if(e.size>0){if(e.values().next().value.id!==s.id)return{[a]:c.a.t("{{fieldDisplayName}} is already taken",{fieldDisplayName:l})}}}catch(u){const e=c.a.t("Could not verify if this {{fieldDisplayName}} is unique",{fieldDisplayName:l});return{[a]:re(u,e)}}}function Vn(){return(Vn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Hn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class qn extends i.Component{constructor(e){super(e),Hn(this,"saveGroup",(async(e,t,a)=>{const{group:r,showSnackbar:n,clearItem:s,getList:i}=a;r.name=e.name,r.code=e.code,r.managedGroups=e.managedGroups.map(this.createIdValueObject),r.attributeValues=Ur(e,this.state.attributeFields);try{await Gr.saveUserGroup(r.toJSON());n({message:c.a.t('User group "{{displayName}}" saved successfully',{displayName:r.name})}),s(),i(fa),this.backToList(),xn(r)}catch(o){n({message:re(o,c.a.t("There was a problem saving the user group."))})}})),Hn(this,"backToList",(()=>{bn("/user-groups")})),this.state={attributeFields:null},this.trashableAttributesPromise=null,this.fields=mt()}async componentDidMount(){const{group:e,showSnackbar:t,initialize:a}=this.props;this.trashableAttributesPromise=ae()(Gr.getAttributes(fa));try{const t=wr(await this.trashableAttributesPromise,e.attributeValues);Or(t,this.props.asyncBlurFields),this.setState({attributeFields:t}),a(vt(e,t))}catch(r){console.error(r),t({message:re(r,c.a.t("Could not load the user group data. Please refresh the page."))})}}createIdValueObject(e){return{id:"string"===typeof e?e:e.id}}renderFields(e){const{group:t}=this.props;return e.map((e=>{const{name:a,fieldRenderer:r,label:n,isRequiredField:s,isAttributeField:i,fieldValidators:l,...c}=e,u=n+(s?" *":"");return r===lt?lt(e):(r===it&&(c.availableItemsQuery=Gr[c.availableItemsQuery],s&&(c.assignedItemsLabel+=" *"),c.initialValues=e.initialItemsSelector(t)),c.validate=function(e,t,a,r,n){const s=[],i=r&&a;return t===ut&&s.push(Ar),t===dt&&s.push(dr),i&&s.push(Ar),r&&n&&s.push(...n),s}(this.props,a,s,i,l),o.a.createElement(wn.a,Vn({name:a,key:a,component:r,label:u,validate:[]},c)))}))}render(){const{handleSubmit:e,submitting:t,asyncValidating:a,pristine:r,valid:n}=this.props,{attributeFields:s}=this.state,i=Boolean(t||a||r||!n);return s?o.a.createElement("main",null,o.a.createElement("form",{autoComplete:"off",onSubmit:e(this.saveGroup)},this.renderFields(this.fields),this.renderFields(s),o.a.createElement("div",{style:{marginTop:"2rem"}},o.a.createElement(je.a,{label:c.a.t("Save"),type:"submit",primary:!0,disabled:i,style:{marginRight:"8px"}}),o.a.createElement(je.a,{label:c.a.t("Cancel"),onClick:this.backToList})))):o.a.createElement("div",{style:ht.loaderWrap},o.a.createElement(Le.a,null))}}const Wn=Object(On.a)({form:ct,asyncValidate:Mn,asyncBlurFields:[ut,dt]})(qn);var Yn=Object(l.b)((e=>({group:e.currentItem})),{clearItem:Zr,showSnackbar:en,getList:zr})(Wn);const zn="name",Qn="description",Kn="authorities";function Xn(){return(Xn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function Jn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Zn extends i.Component{constructor(...e){super(...e),Jn(this,"fields",[{name:zn,label:c.a.t("Name"),fieldRenderer:at,isRequiredField:!0},{name:Qn,label:c.a.t("Description"),fieldRenderer:at},{name:Kn,label:c.a.t("Authorities"),fieldRenderer:rt}]),Jn(this,"saveRole",(async(e,t,a)=>{const{role:r,showSnackbar:n,clearItem:s,getList:i}=a,o={...r.toJSON(),[zn]:e.name,[Qn]:e.description,[Kn]:e.authorities};try{await Gr.saveRole(o);n({message:c.a.t('User role "{{displayName}}" saved successfully',{displayName:o.name})}),s(),i(ba),this.backToList(),xn(r)}catch(l){n({message:re(l,c.a.t("There was a problem saving the user role."))})}})),Jn(this,"backToList",(()=>{bn("/user-roles")})),Jn(this,"render",(()=>{const{handleSubmit:e,submitting:t,asyncValidating:a,pristine:r,valid:n}=this.props,s=Boolean(t||a||r||!n);return o.a.createElement("main",null,o.a.createElement("form",{autoComplete:"off",onSubmit:e(this.saveRole)},this.renderFields(),o.a.createElement("div",{style:{marginTop:"2rem"}},o.a.createElement(je.a,{label:c.a.t("Save"),type:"submit",primary:!0,disabled:s,style:{marginRight:"8px"}}),o.a.createElement(je.a,{label:c.a.t("Cancel"),onClick:this.backToList}))))}))}renderFields(){return this.fields.map((e=>{const{name:t,fieldRenderer:a,label:r,isRequiredField:n,...s}=e,i=r+(n?" *":""),l=t===zn?[Ar]:[];return o.a.createElement(wn.a,Xn({name:t,key:t,component:a,label:i,validate:l},s))}))}}const $n=Object(On.a)({form:"roleForm",asyncValidate:async function(e,t,a,r){return Gn(e,a,r,Bn)},asyncBlurFields:[zn]})(Zn);var es=Object(l.b)((e=>({role:e.currentItem,initialValues:{[zn]:e.currentItem.name,[Qn]:e.currentItem.description,[Kn]:e.currentItem.authorities||[]}})),{clearItem:Zr,showSnackbar:en,getList:zr})($n),ts=a(368),as=a.n(ts),rs=a(708),ns=a.n(rs),ss=a(707),is=a.n(ss),os=a(2182);const ls={...r,userRoles:Tr,organisationUnits:Tr},cs=new Set([Ot,Dt,Lt,kt,Mt]),us=new Set([Ut,kt,Mt]),ds=new Set([kt,Mt]);function ps(){return(ps=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function hs(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ms extends i.Component{constructor(e){super(e),hs(this,"toggleShowMore",(()=>{this.setState({showMore:!this.state.showMore})})),hs(this,"handleSubmit",(async(e,t,a)=>{const{user:r,inviteUser:n,showSnackbar:s,clearItem:i,getList:o}=a,l=this.state.locales.ui.selected,u=this.state.locales.db.selected;try{await Gr.saveOrInviteUser(e,r,n,l,u,this.state.attributeFields);s({message:c.a.t('User "{{displayName}}" saved successfully',{displayName:"".concat(e.firstName," ").concat(e.surname)})}),i(),o(ya),this.backToList(),xn(r)}catch(d){console.error(d),s({message:re(d,c.a.t("There was a problem saving the user."))})}})),hs(this,"backToList",(()=>{bn("/users")})),this.state={showMore:!1,locales:null,attributeFields:null},this.trashableAttributesPromise=null,this.trashableLocalePromise=null,this.inviteFields=[{name:Ft,label:c.a.t("Create account or email invitation"),fieldRenderer:st,options:[{id:oa,label:c.a.t("Create account with user details")},{id:la,label:c.a.t("Email invitation to create account")}],props:{style:{}}}],this.baseFields=[{name:Ot,label:c.a.t("Username"),fieldRenderer:at,isRequiredField:sa},{name:Ut,label:c.a.t("E-mail"),fieldRenderer:at,isRequiredField:na},{name:Pt,label:c.a.t("External authentication only (OpenID or LDAP)"),fieldRenderer:nt},{name:Nt,label:c.a.t("Account expiration date"),fieldRenderer:tt},{name:xt,label:c.a.t("Disabled"),fieldRenderer:nt},{name:Dt,label:c.a.t("Password"),fieldRenderer:at,isRequiredField:sa,props:{type:"password",autoComplete:"new-password"}},{name:Lt,label:c.a.t("Retype password"),fieldRenderer:at,isRequiredField:sa,props:{type:"password",autoComplete:"new-password"}},{name:kt,label:c.a.t("Surname"),isRequiredField:ra,fieldRenderer:at},{name:Mt,label:c.a.t("First name"),isRequiredField:ra,fieldRenderer:at},{name:Gt,label:c.a.t("OIDC mapping value"),fieldRenderer:at},{name:jt,label:c.a.t("LDAP identifier"),fieldRenderer:at},{name:Bt,label:c.a.t("Mobile phone number"),fieldRenderer:at},{name:Xt,label:c.a.t("WhatsApp"),fieldRenderer:at},{name:Jt,label:c.a.t("Facebook Messenger"),fieldRenderer:at},{name:Zt,label:c.a.t("Skype"),fieldRenderer:at},{name:$t,label:c.a.t("Telegram"),fieldRenderer:at},{name:ea,label:c.a.t("Twitter"),fieldRenderer:at},{name:Vt,label:c.a.t("Interface language"),fieldRenderer:st,optionsSelector:"locales.ui.available",isRequiredField:ra},{name:Ht,label:c.a.t("Database language"),fieldRenderer:st,optionsSelector:"locales.db.available",isRequiredField:ra},{name:qt,fieldRenderer:it,isRequiredField:ra,initialItemsSelector:e=>H(gt("userCredentials.userRoles",e)||[]),availableItemsQuery:"getAvailableUserRoles",availableItemsLabel:c.a.t("Available roles"),assignedItemsLabel:c.a.t("Selected roles")},{name:Wt,label:c.a.t("Data capture and maintenance organisation units"),isRequiredField:ra,orgUnitType:Wt,fieldRenderer:ot,wrapperStyle:{...It.orgUnitTree,paddingRight:"60px"}},{name:Yt,label:c.a.t("Data output and analytic organisation units"),orgUnitType:Yt,fieldRenderer:ot,wrapperStyle:{...It.orgUnitTree,paddingLeft:"60px"}},{...ca(),name:"org_unit_info_1"}],this.additionalFields=[{name:zt,label:c.a.t("Search Organisation Units"),orgUnitType:zt,fieldRenderer:ot,wrapperStyle:{...It.orgUnitTree,paddingRight:"60px"}},{...ca(),name:"org_unit_info_2"},{name:Qt,fieldRenderer:it,initialItemsSelector:e=>H(e.userGroups)||[],availableItemsQuery:"getAvailableUserGroups",availableItemsLabel:c.a.t("Available user groups"),assignedItemsLabel:c.a.t("Selected user groups")},{name:Kt,fieldRenderer:it,initialItemsSelector:e=>St(e),availableItemsQuery:"getAvailableDataAnalyticsDimensionRestrictions",availableItemsLabel:c.a.t("Available dimension restrictions for data analytics"),assignedItemsLabel:c.a.t("Selected dimension restrictions for data analytics"),returnModelsOnUpdate:!0}]}async componentDidMount(){const{user:e,showSnackbar:t,initialize:a}=this.props,r=e.id?e.userCredentials.username:null;this.trashableLocalePromise=ae()(Gr.getSelectedAndAvailableLocales(r)),this.trashableAttributesPromise=ae()(Gr.getAttributes(ya));try{const t=await this.trashableLocalePromise,r=wr(await this.trashableAttributesPromise,e.attributeValues);Or(r,this.props.asyncBlurFields),this.setState({locales:t,attributeFields:r}),a(Tt(e,t,r))}catch(n){console.error(n),t({message:re(n,c.a.t("Could not load the user data. Please refresh the page."))})}}componentWillUnmount(){this.trashableLocalePromise.trash(),this.trashableAttributesPromise.trash()}getLabelText(e,t,a){const{inviteUser:r}=this.props;return a===ra||r&&a===na||a===sa&&!t.id&&!r||"boolean"===typeof a&&a?"".concat(e," *"):e}prepareGroupEditor(e,t,a,r){e.assignedItemsLabel=this.getLabelText(e.assignedItemsLabel,a,r),e.availableItemsQuery=Gr[e.availableItemsQuery],e.initialValues=t.initialItemsSelector(a)}exludeField(e){const{user:t,inviteUser:a,externalAuthOnly:r}=this.props;return!(this.context.d2.system.systemInfo.emailConfigured&&!t.id||e!==Ft)||(!(!a&&!r||e!==Dt&&e!==Lt)||!(!a||![Pt,Gt,jt].includes(e)))}renderFields(e){const{user:t}=this.props;return e.reduce(((e,a)=>{const{name:r,fieldRenderer:n,label:s,isRequiredField:i,isAttributeField:l,fieldValidators:c,...u}=a,d=this.getLabelText(s,t,i);if(this.exludeField(r))return e;if(n===lt)return e.push(lt(a)),e;switch(n){case at:u.hintText||(u.hintText=s),u.disabled=Boolean(r===Ot&&t.id);break;case ot:u.initialValues=H(t[a.name]);break;case it:this.prepareGroupEditor(u,a,t,i);break;case st:u.options=a.optionsSelector?gt(a.optionsSelector,this.state):a.options}return u.validate=function(e,t,a,r,n){const s=[],i=Boolean(e.user.id),o=r&&a,l=ls[t],c=!r&&i?ds.has(t):e.inviteUser?us.has(t):cs.has(t);return l&&s.push(l),(o||c)&&s.push(Ar),r&&n&&s.push(...n),s}(this.props,r,i,l,c),e.push(o.a.createElement(wn.a,ps({name:r,key:r,component:n,label:d},u))),e}),[])}renderCreateOrInviteField(){return this.renderFields(this.inviteFields)}renderAttributeFields(){return this.renderFields(this.state.attributeFields)}renderBaseFields(){return this.renderFields(this.baseFields)}renderAdditionalFields(e){return e?o.a.createElement("div",{style:It.additionalFieldsWrap},this.renderFields(this.additionalFields)):null}renderToggler(e){const t=e?c.a.t("Show fewer options"):c.a.t("Show more options"),a=e?o.a.createElement(is.a,null):o.a.createElement(ns.a,null);return o.a.createElement("div",{style:It.togglerWrap},o.a.createElement(as.a,{onClick:this.toggleShowMore,label:t,style:It.toggler,icon:a}))}render(){const{handleSubmit:e,submitting:t,asyncValidating:a,pristine:r,valid:n,inviteUser:s}=this.props,{showMore:i,locales:l}=this.state,u=Boolean(t||a||r||!n),d=!0===s?c.a.t("Send invite"):c.a.t("Save");return l?o.a.createElement("main",null,o.a.createElement("form",{autoComplete:"off",onSubmit:e(this.handleSubmit)},this.renderCreateOrInviteField(),this.renderBaseFields(),this.renderAttributeFields(),this.renderAdditionalFields(i),this.renderToggler(i),o.a.createElement("div",null,o.a.createElement(je.a,{label:d,type:"submit",primary:!0,disabled:u,style:{marginRight:"8px"}}),o.a.createElement(je.a,{label:c.a.t("Cancel"),onClick:this.backToList})))):o.a.createElement("div",{style:It.loaderWrap},o.a.createElement(Le.a,null))}}ms.contextTypes={d2:ee.a.object.isRequired};const gs=Object(os.a)(wt),ys=Object(On.a)({form:wt,asyncValidate:Mn,asyncBlurFields:[Ot]})(ms);var bs=Object(l.b)((e=>({user:e.currentItem,fallbackOrgUnits:e.currentUser[Wt],inviteUser:Rt(e.form.userForm),externalAuthOnly:Boolean(gs(e,Pt))})),{clearItem:Zr,showSnackbar:en,getList:zr})(ys),fs=a(349),Es=a.n(fs),As=a(443);var Ts=({to:e,tooltip:t,icon:a})=>{const r=o.a.createElement(Es.a,{iconClassName:"material-icons",tooltip:t},a);return e?o.a.createElement(As.a,{to:e},r):r};const vs={main:{width:"100%",paddingLeft:"2rem"},heading:{paddingBottom:"1rem"},paper:{padding:"2rem 5rem 4rem"}};class Ss extends i.Component{componentDidMount(){const{match:{params:{id:e}},item:t,getItem:a,initNewItem:r,entityType:n}=this.props;!e||t&&t.id===e?e||r(n):a(n,e),this.formNotFoundErrorMsg=c.a.t("There was an error getting the form:")}renderForm(){const{entityType:e}=this.props;switch(e){case ya:return o.a.createElement(bs,null);case ba:return o.a.createElement(es,null);case fa:return o.a.createElement(Yn,null);default:return o.a.createElement(Ie,{introText:this.formNotFoundErrorMsg,errorMessage:""})}}renderHeader(){const{match:{params:{id:e}},item:t,shortItem:a,entityType:r}=this.props,n=t&&t.id===e?t:a,s=n?n.modelDefinition.displayName:_n()(r),i=n?n.displayName:"",l="".concat(c.a.t("Update")," ").concat(s,": ").concat(i),u="".concat(c.a.t("Create new")," ").concat(s),d=e?l:u,p=n?"/".concat(In()(n.modelDefinition.plural)):null,h="".concat(c.a.t("Back to")," ").concat(s,"s");return o.a.createElement(Z.Heading,{style:vs.heading},o.a.createElement(Ts,{to:p,tooltip:h,disabled:Boolean(p),icon:"arrow_back"}),d)}renderContent(){const{match:{params:{id:e}},item:t}=this.props;return"string"===typeof t?o.a.createElement(Ie,{introText:this.formNotFoundErrorMsg,errorMessage:t}):!t||t&&t.id!==e?o.a.createElement("div",{style:{textAlign:"center",paddingTop:"2rem"}},o.a.createElement(s.CircularProgress,null)):this.renderForm()}render(){return o.a.createElement("main",{style:vs.main},this.renderHeader(),o.a.createElement(s.Paper,{style:vs.paper},this.renderContent()))}}var Cs=Object(l.b)(((e,t)=>({item:e.currentItem,shortItem:Ct(t.match.params.id,e.list.items)})),{getItem:Kr,initNewItem:e=>{const t=Gr.getD2().models[e].create();return Wr(Ra,t)}})(Ss);const _s={width:"100%",textAlign:"center",padding:"1.5rem 1.5rem 1rem"};var Rs=({location:e})=>o.a.createElement("div",{style:_s},o.a.createElement("h1",null,c.a.t("Page not found.")),o.a.createElement("h3",null,c.a.t("No match for"),o.a.createElement("code",null," ",e.pathname)),o.a.createElement(As.a,{to:"/"}," ",c.a.t("Go back home"))),Is=a(1930),ws=a.n(Is),Os=a(1931),Us=a.n(Os);var Ns=(e,t)=>{const a=Gr.getD2().currentUser.userSettings.settings.keyUiLocale,r=new Date(e),n={day:"numeric",month:"long",year:"numeric"},s=t?{...n,hour:"2-digit",minute:"2-digit"}:n;return new Intl.DateTimeFormat(a,s).format(r)};const xs={main:{width:"100%",paddingLeft:"2rem"},heading:{paddingBottom:"1rem"},raisedButton:{height:"36px",transform:"translateY(10px)",float:"right",marginLeft:"1rem"},paper:{padding:"1.4rem"},cell:{fontSize:"1rem",padding:"0.8rem",verticalAlign:"top"},valueCell:{textAlign:"right",color:"#757575"}};class Fs extends i.Component{componentDidMount(){const{baseName:e,routeId:t,getItem:a}=this.props;a(e,t)}getLabelForEntity(e){switch(e){case ya:return c.a.t("Edit user");case fa:return c.a.t("Edit user group");case ba:return c.a.t("Edit user role");default:return""}}renderSendMessageBtn(e){const t="".concat(Gr.getContextPath(),"/dhis-web-messaging/#/PRIVATE/create/").concat(e);return o.a.createElement(je.a,{style:xs.raisedButton,label:c.a.t("Send message"),secondary:!0,containerElement:o.a.createElement("a",{href:t}," "),icon:o.a.createElement(ws.a,null)})}renderPropertyFields(){const{summaryObject:e,config:t}=this.props,a={...xs.cell,...xs.valueCell};return t.map(((t,r)=>{const{key:n,removeText:s,parseDate:i,parseDateTime:l,nestedPropselector:u,parseArrayAsCommaDelimitedString:d,count:p}=t;let{label:h}=t;h=c.a.t(h);let m=e[n];return"undefined"===typeof m?m="":(u&&u.forEach((e=>{m=m[e]})),d&&("function"===typeof m.toArray&&(m=m.toArray()),m=m.map((e=>e[d])).join(", ")),s&&(m=_n()(m.replace(s,""))),(i||l)&&"string"===typeof m&&(m=Ns(m,l)),p&&("number"===typeof m.size?m=m.size:"number"===typeof m.length&&(m=m.length))),o.a.createElement("tr",{key:r},o.a.createElement("td",{style:a},h),o.a.createElement("td",{style:xs.cell},m))}))}render(){const{summaryObject:e,baseName:t}=this.props;if(null===e)return o.a.createElement(Z.LoadingMask,null);if("string"===typeof e){const a=c.a.t("There was an error fetching the ".concat(t));return o.a.createElement(Ie,{introText:a,errorMessage:e})}const{id:a,displayName:r,access:n}=e,i="".concat(t,"s"),l="/".concat(In()(i)),u=c.a.t("Back to ".concat(i)),d="".concat(l,"/edit/").concat(a),p=this.getLabelForEntity(t);return o.a.createElement("main",{style:xs.main},o.a.createElement(Z.Heading,{style:xs.heading},o.a.createElement(Ts,{to:l,tooltip:u,icon:"arrow_back"}),r,n.update?o.a.createElement(je.a,{style:xs.raisedButton,label:p,primary:!0,containerElement:o.a.createElement(As.a,{to:d}),icon:o.a.createElement(Us.a,null)}):null,t===ya?this.renderSendMessageBtn(a):null),o.a.createElement(s.Paper,{style:xs.paper},o.a.createElement("table",null,o.a.createElement("tbody",null,this.renderPropertyFields()))))}}var Ps=Object(l.b)((e=>({summaryObject:e.currentItem})),{getItem:Kr})(Fs);const Ds=()=>[{key:"displayName",label:c.a.t("Display name")},{key:"id",label:c.a.t("ID")}];var Ls=({match:{params:{id:e}}})=>o.a.createElement(Ps,{routeId:e,config:[...Ds(),{key:"users",label:c.a.t("Number of users"),count:!0}],baseName:fa}),ks=a(1932),Ms=a.n(ks),Gs=a(458),js=a.n(Gs),Bs=a(906),Vs=a.n(Bs),Hs=a(971),qs=a(701),Ws=a.n(qs);Object(Hs.addValueRenderer)((({value:e})=>"boolean"===typeof e),(({value:e})=>e?o.a.createElement("div",{style:{width:"40px"}},o.a.createElement(Ws.a,null)):null));a(1962),a(1963);const Ys={dataTableWrap:{flex:1,marginBottom:"4rem"},clearBoth:{clear:"both"},filterBar:{display:"table",marginBottom:"1rem",width:"100%"},headerBarPagination:{float:"right",marginTop:"14px"},headerBarFilterWrap:{display:"table",marginRight:"230px"},pagination:{userSelect:"none"}};class zs extends i.Component{constructor(...e){var t,a,r;super(...e),r=e=>{const{isContextActionAllowed:t,primaryAction:a,showSnackbar:r,hideSnackbar:n}=this.props;t(e,"edit")?a(e):r({message:"".concat(c.a.t("You are not allowed to edit")," ").concat(e.displayName),action:c.a.t("Confirm"),autoHideDuration:null,onActionClick:n})},(a="executeEditIfAllowed")in(t=this)?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r}componentDidMount(){const{items:e,getList:t,resetFilter:a,resetPager:r,entityType:n,listType:s}=this.props;null!==e&&s===n||(s!==n&&(a(),r()),t(n))}getPagerConfig(e){return e||{page:null,pageCount:null,total:null,currentlyShown:null}}renderPagination(){const{pager:e,items:t,incrementPage:a,decrementPage:r}=this.props,{page:n,pageCount:s,total:i,currentlyShown:l}=this.getPagerConfig(e),c=!t||0===t.length||"string"===typeof t?{...Ys.pagination,visibility:"hidden"}:Ys.pagination,u={hasNextPage:()=>n&&t&&t.length&&n<s,hasPreviousPage:()=>n&&t&&t.length&&n>1,onNextPageClick:()=>{a(e)},onPreviousPageClick:()=>{r(e)},total:i,currentlyShown:l,style:c};return o.a.createElement("div",{style:c},o.a.createElement(Z.Pagination,u))}renderHeaderBar(){const{filterComponent:e,entityType:t}=this.props;return o.a.createElement("div",{className:"data-table__filter-bar",style:Ys.filterBar},o.a.createElement("div",{style:Ys.headerBarPagination},this.renderPagination()),o.a.createElement("div",{style:Ys.headerBarFilterWrap},o.a.createElement(e,{entityType:t})))}renderDataTable(){const{items:e,columns:t,contextMenuActions:a,contextMenuIcons:r,isContextActionAllowed:n}=this.props;if("string"===typeof e){const t=c.a.t("There was an error fetching the list");return o.a.createElement(Ie,{introText:t,errorMessage:e})}return null===e?o.a.createElement(Z.LoadingMask,null):0===e.length?o.a.createElement("div",{style:Ys.clearBoth},"No results found."):o.a.createElement(Ms.a,{rows:e,columns:t,primaryAction:this.executeEditIfAllowed,contextMenuActions:a,contextMenuIcons:r,isContextActionAllowed:n})}render(){const{sectionName:e,newItemPath:t,className:a}=this.props;return o.a.createElement("div",{style:Ys.dataTableWrap,className:a},o.a.createElement(Z.Heading,null,e),this.renderHeaderBar(),this.renderDataTable(),this.renderPagination(),o.a.createElement(js.a,{className:"entity-list__add-new-entity",onClick:()=>bn(t)},o.a.createElement(Vs.a,null)))}}zs.defaultProps={className:"paged-filterable-data-table"};var Qs=Object(l.b)((e=>({listType:e.list.type,items:bt(e.list.items,e.currentUser.userGroupIds),pager:yt(e.pager)})),{getList:zr,resetFilter:()=>Wr(Ma),resetPager:()=>Wr(La),incrementPage:e=>(t,a)=>{const{list:{type:r}}=a();Yr(t,e.getNextPage(),r)},decrementPage:e=>(t,a)=>{const{list:{type:r}}=a();Yr(t,e.getPreviousPage(),r)},showSnackbar:en,hideSnackbar:tn})(zs);function Ks(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Xs={float:"left",marginRight:"1rem",width:"236px"};class Js extends i.Component{constructor(e){super(e),Ks(this,"updateSearchFilter",(e=>{const{getList:t,entityType:a,updateFilter:r}=this.props;r("query",e),t(a)})),Ks(this,"onQueryStrChange",(e=>{const t=e.target.value;this.setState({localQueryStr:t}),this.updateSearchFilter(t)})),this.state={localQueryStr:e.filter.query},this.updateSearchFilter=le()(this.updateSearchFilter,375)}render(){const{localQueryStr:e}=this.state;return o.a.createElement(J.a,{className:"search-input",floatingLabelText:c.a.t("Search by name"),style:Xs,hintText:"",value:e,type:"search",onChange:this.onQueryStrChange})}}var Zs=Object(l.b)((e=>({filter:e.filter})),{getList:zr,updateFilter:$r})(Js);const $s=({model:e,entityType:t})=>{const a={type:e.modelDefinition.displayName,displayName:e.displayName},r=c.a.t('Are you sure you want to remove the {{type}} "{{displayName}}"?',a),n=c.a.t('{{type}} "{{displayName}}" removed successfully',a),s=c.a.t('There was a problem removing {{type}} "{{displayName}}"?',a),i={message:r,action:c.a.t("Confirm"),autoHideDuration:null,onActionClick:()=>ei(e,n,s,t)};er.dispatch(en(i))},ei=async(e,t,a,r)=>{er.dispatch(tn());try{await e.delete(),er.dispatch(en({message:t})),er.dispatch(zr(r)),xn(e)}catch(n){const e=re(n,a);er.dispatch(en({message:e}))}},ti=({data:e})=>{var t,a;er.dispatch((t=e.id,a=e.modelDefinition.name,Wr(Pa,{id:t,type:a})))},ai="show_details",ri="sharing_settings",ni="edit",si="join_group",ii="leave_group",oi="remove",li=(e,t)=>{if(!e)return!1;const{access:a}=e;switch(t){case ai:return a.read;case ri:return a.manage;case ni:return a.update;case si:return a.update&&!e.currentUserIsMember;case ii:return a.update&&e.currentUserIsMember;case oi:return a.delete;default:return!0}},ci={[ai]:"info",[ri]:"share",[ni]:"edit",[si]:"group_add",[ii]:"exit_to_app",[oi]:"delete"},ui=Z.Action.createActionsFromNames([ai,ri,ni,si,ii,oi]),di=async({displayName:e,id:t},a)=>{try{await Gr.updateCurrentUserGroupMembership(t,a);const r=a?c.a.t("You left group"):c.a.t("You joined group");er.dispatch(en({message:"".concat(r," ").concat(e)})),er.dispatch(Jr())}catch(r){er.dispatch(en({message:re(r,c.a.t("There was a problem updating your group membership"))}))}};ui.show_details.subscribe((({data:{id:e}})=>{bn("/user-groups/view/".concat(e))})),ui.sharing_settings.subscribe(ti),ui.edit.subscribe((({data:{id:e}})=>{bn("/user-groups/edit/".concat(e))})),ui.join_group.subscribe((({data:e})=>{di(e,!1)})),ui.leave_group.subscribe((({data:e})=>{di(e,!0)})),ui.remove.subscribe((({data:e})=>{$s({model:e,entityType:fa})}));class pi extends i.Component{render(){return o.a.createElement(Qs,{entityType:fa,filterComponent:Zs,columns:["displayName","currentUserIsMember"],primaryAction:ui.edit,contextMenuActions:ui,contextMenuIcons:ci,isContextActionAllowed:li,sectionName:c.a.t("User Group Management"),newItemPath:"/user-groups/new",className:"group-list"})}}var hi=pi;var mi=({match:{params:{id:e}}})=>o.a.createElement(Ps,{routeId:e,config:[...Ds(),{key:"users",label:c.a.t("Members"),count:!0}],baseName:ba});const gi="show_details",yi="sharing_settings",bi="edit",fi="remove",Ei=(e,t)=>{if(!e)return!1;const{access:a}=e;switch(t){case gi:return a.read;case yi:return a.manage;case bi:return a.update;case fi:return a.delete;default:return!0}},Ai={[gi]:"info",[yi]:"share",[bi]:"edit",[fi]:"delete"},Ti=Z.Action.createActionsFromNames([[gi],[yi],[bi],[fi]]);Ti.show_details.subscribe((({data:{id:e}})=>{bn("/user-roles/view/".concat(e))})),Ti.sharing_settings.subscribe(ti),Ti.edit.subscribe((({data:{id:e}})=>{bn("/user-roles/edit/".concat(e))})),Ti.remove.subscribe((({data:e})=>{$s({model:e,entityType:ba})}));var vi=()=>o.a.createElement(Qs,{entityType:ba,filterComponent:Zs,columns:["displayName","description"],primaryAction:Ti.edit,contextMenuActions:Ti,contextMenuIcons:Ai,isContextActionAllowed:Ei,sectionName:c.a.t("User Role Management"),newItemPath:"/user-roles/new",className:"role-list"});const Si="profile",Ci="edit",_i="remove",Ri="replicate",Ii="disable",wi="enable",Oi="disable_2fa",Ui=(e,t)=>{const{currentUser:a}=er.getState();if(!e)return!1;const{access:r,userCredentials:{disabled:n,twoFA:s}}=e;switch(t){case Si:return r.read;case Ci:return r.update;case _i:return a.id!==e.id&&r.delete;case Ri:return r.update&&a.authorities.has("F_REPLICATE_USER");case Ii:return r.update&&!n;case wi:return r.update&&n;case Oi:return r.update&&s;default:return!0}},Ni={[Si]:"account_circle",[Ci]:"edit",[_i]:"delete",[Ri]:"content_copy",[Ii]:"block",[wi]:"playlist_add_check",[Oi]:"phonelink_erase"},xi=Z.Action.createActionsFromNames([Si,Ci,_i,Ri,Ii,wi,Oi]);xi.profile.subscribe((({data:{id:e}})=>{bn("/users/view/".concat(e))})),xi.edit.subscribe((({data:{id:e}})=>{bn("/users/edit/".concat(e))})),xi.remove.subscribe((({data:e})=>{$s({model:e,entityType:ya})})),xi.replicate.subscribe((({data:e})=>{const t=o.a.createElement(kn,{user:e}),a={onRequestClose:()=>er.dispatch(rn()),title:c.a.t("Replicate user")};er.dispatch(an(t,a))})),xi.disable.subscribe((({data:e})=>{Di(e,!0)})),xi.enable.subscribe((({data:e})=>{Di(e,!1)})),xi.disable_2fa.subscribe((({data:e})=>{Fi(e)}));const Fi=e=>{const t=c.a.t("Are you sure you want to disable two factor authentication for"),a={message:"".concat(t," ").concat(e.displayName),action:c.a.t("Confirm"),autoHideDuration:null,onActionClick:()=>Pi(e)};er.dispatch(en(a))},Pi=async e=>{er.dispatch(tn());const{displayName:t,id:a}=e;try{await Gr.disable2FA(a);const e=c.a.t("Succesfully disabled two factor authentication for");er.dispatch(en({message:"".concat(e," ").concat(t)})),er.dispatch(zr(ya))}catch(r){er.dispatch(en({message:re(r,c.a.t("There was a problem updating two factor authentication"))}))}},Di=(e,t)=>{const a=t?c.a.t("Are you sure you want to disable"):c.a.t("Are you sure you want to enable"),r={message:"".concat(a," ").concat(e.displayName),action:c.a.t("Confirm"),autoHideDuration:null,onActionClick:()=>Li(e,t)};er.dispatch(en(r))},Li=async(e,t)=>{er.dispatch(tn());const{displayName:a,id:r}=e;try{await Gr.updateDisabledState(r,t);const n=t?c.a.t("sucessfully disabled"):c.a.t("successfully enabled");er.dispatch(en({message:"".concat(a," ").concat(n)})),er.dispatch(zr(ya)),t&&xn(e,!0)}catch(n){er.dispatch(en({message:re(n,c.a.t("There was a problem updating the enabled state"))}))}};var ki=a(1964),Mi=a.n(ki),Gi=a(338),ji=a.n(Gi),Bi=a(1965),Vi=a.n(Bi);class Hi extends i.Component{constructor(...e){var t,a,r;super(...e),r=e=>{const{updateFilter:t,hideDialog:a,getList:r,selectedOrgUnits:n}=this.props;Vi()(e,n)||(t("organisationUnits",e),r(ya)),a()},(a="applyFilter")in(t=this)?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r}render(){const{selectedOrgUnits:e,hideDialog:t}=this.props;return o.a.createElement(Ze,{orgUnitType:zt,selectedOrgUnits:e,confirmSelection:this.applyFilter,cancel:t})}}var qi=Object(l.b)((e=>({selectedOrgUnits:e.filter.organisationUnits})),{updateFilter:$r,hideDialog:rn,getList:zr})(Hi);function Wi(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Yi={wrap:{position:"relative",lineHeight:"24px",height:"72px",cursor:"pointer",float:"left",marginRight:"1rem"},icon:{position:"absolute",right:0,top:38,width:20,height:20,color:"rgba(0, 0, 0, 0.3)",cursor:"pointer"},textField:{cursor:"pointer",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",width:"152px"},input:{width:"calc(100% - 20px)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}};class zi extends i.Component{constructor(...e){super(...e),Wi(this,"inputRef",o.a.createRef()),Wi(this,"focusOrgUnitInput",(()=>{this.inputRef.current.orgUnitInput.focus()})),Wi(this,"showOrgTreeInDialog",(()=>{const{showDialog:e,hideDialog:t}=this.props;e(o.a.createElement(qi,null),{onRequestClose:t,title:c.a.t("Select an organisation unit"),contentStyle:{minHeight:"100vh"}})}))}render(){const{organisationUnits:e}=this.props;return o.a.createElement("div",{style:Yi.wrap,onClick:this.focusOrgUnitInput},o.a.createElement(Mi.a,{style:Yi.icon}),o.a.createElement(ji.a,{ref:this.inputRef,style:Yi.textField,floatingLabelText:c.a.t("Organisation unit"),onFocus:this.showOrgTreeInDialog,value:e,inputStyle:Yi.input}))}}var Qi=Object(l.b)((e=>({organisationUnits:Et(e.filter.organisationUnits)})),{showDialog:an,hideDialog:rn})(zi);const Ki={float:"left",marginRight:"1rem"},Xi={...Ki,display:"inline-block",float:"left",width:"182px",paddingTop:"37px",height:"35px"};class Ji extends i.Component{constructor(...e){var t,a,r;super(...e),r=(e,t)=>{const{getList:a,entityType:r,updateFilter:n,filter:s}=this.props;s[e]!==t&&(n(e,t),a(r))},(a="onFilterChange")in(t=this)?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r}createInactiveMonthsOptions(){const e=c.a.t("month"),t=c.a.t("months");return Array(12).fill().map(((a,r)=>{const n=r+1;return{id:n,displayName:1===n?"".concat(n," ").concat(e):"".concat(n," ").concat(t)}}))}renderDropDown(e){const t={...e,includeEmpty:!0,emptyLabel:c.a.t("<No value>")};return o.a.createElement(Z.DropDown,t)}renderInactiveMonthsFilter(){const e={menuItems:this.createInactiveMonthsOptions(),floatingLabelText:c.a.t("Inactivity"),value:this.props.filter.inactiveMonths,onChange:e=>this.onFilterChange("inactiveMonths",e.target.value),style:{...Ki,width:"132px"}};return this.renderDropDown(e)}renderInvitationStatusFilter(){const e={menuItems:[{id:"all",displayName:c.a.t("All invitations")},{id:"expired",displayName:c.a.t("Expired invitations")}],floatingLabelText:c.a.t("Invitations"),value:this.props.filter.invitationStatus,onChange:e=>this.onFilterChange("invitationStatus",e.target.value),style:{...Ki,width:"172px"}};return this.renderDropDown(e)}renderSelfRegisteredFilter(){const e=this.props.filter.selfRegistered,t="data-table__filter-bar__checkbox",a="".concat(t,"--checked");return o.a.createElement(s.Checkbox,{value:e,onCheck:(e,t)=>this.onFilterChange("selfRegistered",t),label:c.a.t("Self registrations"),className:e?a:t,style:Xi})}render(){const{entityType:e}=this.props;return o.a.createElement("div",null,o.a.createElement(Zs,{entityType:e}),o.a.createElement(Qi,null),this.renderInactiveMonthsFilter(),this.renderInvitationStatusFilter(),this.renderSelfRegisteredFilter())}}var Zi=Object(l.b)((e=>({filter:e.filter})),{updateFilter:$r,getList:zr})(Ji);var $i=()=>o.a.createElement(Qs,{entityType:ya,columns:["displayName","userName","lastLogin","disabled"],filterComponent:Zi,primaryAction:xi.edit,contextMenuActions:xi,contextMenuIcons:Ni,isContextActionAllowed:Ui,sectionName:c.a.t("User Management"),newItemPath:"/users/new",className:"user-list"});var eo=({match:{params:{id:e}}})=>o.a.createElement(Ps,{routeId:e,config:[...Ds(),{key:"userCredentials",nestedPropselector:["lastLogin"],label:c.a.t("Last login"),parseDateTime:!0},{key:"created",label:c.a.t("Created"),parseDate:!0},{key:"surname",label:c.a.t("Surname")},{key:"firstName",label:c.a.t("First name")},{key:"introduction",label:c.a.t("Introduction")},{key:"jobTitle",label:c.a.t("Job title")},{key:"employer",label:c.a.t("Works at")},{key:"education",label:c.a.t("Education")},{key:"interests",label:c.a.t("Interests")},{key:"nationality",label:c.a.t("Nationality")},{key:"birthday",label:c.a.t("Birthday"),parseDate:!0},{key:"gender",label:c.a.t("Gender"),removeText:"gender_"},{key:"languages",label:c.a.t("Speaks")},{key:"email",label:c.a.t("E-mail")},{key:"phoneNumber",label:c.a.t("Mobile phone number")},{key:"organisationUnits",label:c.a.t("Organisations units"),parseArrayAsCommaDelimitedString:"displayName"},{key:"userCredentials",label:c.a.t("User roles"),nestedPropselector:["userRoles"],parseArrayAsCommaDelimitedString:"displayName"}],baseName:ya});function to(){return(to=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const ao=()=>({key:"user_section",label:c.a.t("User"),icon:"person",path:"/users",description:c.a.t("Create, modify, view and delete Users"),component:$i,entityType:ya}),ro=()=>({key:"user_role_section",label:c.a.t("User role"),icon:"folder_shared",path:"/user-roles",description:c.a.t("Create, modify, view and delete User Roles"),component:vi,entityType:ba}),no=()=>({key:"user_group_section",label:c.a.t("User group"),icon:"group",path:"/user-groups",description:c.a.t("Create, modify, view and delete User Groups"),component:hi,entityType:fa}),so=(()=>{let e=null;return()=>(e||(e=[ao(),ro(),no()]),e)})();var io=(()=>{let e=null;return()=>(e||(e=[{key:"user_new_view",path:"/users/new",render:e=>o.a.createElement(Cs,to({entityType:ya},e)),entityType:ya},{key:"user_edit_view",path:"/users/edit/:id",render:e=>o.a.createElement(Cs,to({entityType:ya},e)),entityType:ya},{key:"user_profile_view",path:"/users/view/:id",component:eo,entityType:ya},ao(),{key:"user_role_new_view",path:"/user-roles/new",render:e=>o.a.createElement(Cs,to({entityType:ba},e)),entityType:ba},{key:"user_role_edit_view",path:"/user-roles/edit/:id",render:e=>o.a.createElement(Cs,to({entityType:ba},e)),entityType:ba},{key:"user_role_details_view",path:"/user-roles/view/:id",component:mi,entityType:ba},ro(),{key:"user_group_new_view",path:"/user-groups/new",render:e=>o.a.createElement(Cs,to({entityType:fa},e)),entityType:fa},{key:"user_group_edit_view",path:"/user-groups/edit/:id",render:e=>o.a.createElement(Cs,to({entityType:fa},e)),entityType:fa},{key:"user_group_details_view",path:"/user-groups/view/:id",component:Ls,entityType:fa},no(),{key:"landing_page",path:"/",component:Sn},{key:"not_found",component:Rs}]),e)})();const oo={display:"flex",flex:"0 0 320px"};class lo extends i.Component{constructor(...e){var t,a,r;super(...e),r=e=>{const{sections:t,history:a}=this.props,r=t.find((t=>t.key===e));a.push(r.path)},(a="changeSectionHandler")in(t=this)?Object.defineProperty(t,a,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[a]=r}render(){const{sections:e,location:{pathname:t}}=this.props,a=e.find((e=>e.path===t)),r="/"===t,n=a?a.key:null;return a||r?o.a.createElement("div",{style:oo},o.a.createElement(Z.Sidebar,{sections:e,onChangeSection:this.changeSectionHandler,currentSection:n})):null}}var co=Object(jr.e)(lo);function uo(){return(uo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}const po={display:"flex",flex:"1 1 0%",paddingRight:"2rem",paddingTop:"1rem"};class ho extends i.Component{componentDidMount(){const{initCurrentUser:e,currentUser:t}=this.props;t?this.setRouteConfig(t):e()}componentWillReceiveProps({currentUser:e,location:{pathname:t}}){this.setRouteConfig(e),e&&e!==this.props.currentUser&&"/"!==t&&!this.pathHasAvailableSection(t)&&bn("/")}pathHasAvailableSection(e){if(!this.routeConfig)return!1;const{sections:t}=this.routeConfig;return Boolean(t&&t.find((t=>e.includes(t.path.split(":")[0]))))}setRouteConfig(e){this.routeConfig=e?io().reduce(((t,a)=>{const{routes:r,sections:n}=t;return this.userHasAuthorities(a,e)&&(r.push(a),a.label&&n.push(a)),t}),{routes:[],sections:[]}):null}userHasAuthorities({entityType:e},t){if(!e)return!0;const{models:a}=this.context.d2,r=t.canCreate(a[e]),n=t.canDelete(a[e]);return r||n}renderRoutes(e){return e.map((e=>o.a.createElement(jr.a,uo({key:e.key,exact:!0,strict:!0},e))))}renderContent(){const{currentUser:e}=this.props;if(!e)return o.a.createElement(Z.LoadingMask,null);if("string"===typeof e){const t=c.a.t("There was an error loading the current user");return o.a.createElement(Ie,{introText:t,errorMessage:e})}const{routes:t,sections:a}=this.routeConfig;if(a&&0===a.length){const e=c.a.t("You do not have authorities to see users, user roles or user groups");return o.a.createElement(Ie,{introText:e,errorMessage:""})}return[o.a.createElement(co,{key:"sidenav",sections:a}),o.a.createElement(jr.c,{key:"routeswitch"},this.renderRoutes(t))]}render(){return o.a.createElement("main",{style:po},this.renderContent())}}ho.contextTypes={d2:ee.a.object};var mo=Object(jr.e)(Object(l.b)((({currentUser:e})=>({currentUser:e})),{initCurrentUser:()=>e=>{Qr(Xr,Gr.initCurrentUser(),e)}})(ho)),go=a(1966),yo=a.n(go);var bo=Object(l.b)((e=>({open:e.popups.sharing.show,id:e.popups.sharing.id,type:e.popups.sharing.type})),{hideSharingDialog:()=>Wr(Da)})((({open:e,id:t,type:a,hideSharingDialog:r})=>o.a.createElement(yo.a,{open:e,id:t,type:a,onRequestClose:r,d2:Gr.getD2()}))),fo=a(562),Eo=a.n(fo);function Ao(){return(Ao=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var To=Object(l.b)((e=>({open:e.popups.snackbar.show,snackbarProps:e.popups.snackbar.props})),{hideSnackbar:tn})((({open:e,snackbarProps:t,hideSnackbar:a})=>{const r={...{autoHideDuration:6e3,onRequestClose:a,style:{whiteSpace:"nowrap"},bodyStyle:{maxWidth:"100%"},contentStyle:{display:"flex"}},...t};return o.a.createElement(Eo.a,Ao({open:e},r))}));var vo=()=>o.a.createElement("div",null,o.a.createElement(jr.b,{history:yn,hashType:"noslash"},o.a.createElement(mo,null)),o.a.createElement(To,null),o.a.createElement(qr,null),o.a.createElement(bo,null)),So=a(460),Co=a.n(So),_o=a(461),Ro=a.n(_o),Io=a(557),wo=a.n(Io),Oo=a(340);const Uo={spacing:wo.a,fontFamily:"Roboto, sans-serif",palette:{primary1Color:M.blue500,primary2Color:M.blue700,primary3Color:M.blue100,accent1Color:M.orange500,accent2Color:M.grey100,accent3Color:M.orangeA200,textColor:M.darkBlack,alternateTextColor:M.white,canvasColor:M.white,borderColor:M.grey400,disabledColor:Object(Oo.fade)(M.darkBlack,.3)}},No=Ro()(Uo);var xo=Object.assign({},No,{forms:{minWidth:350,maxWidth:750},formInput:{fontWeight:100}});function Fo(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Po extends i.Component{constructor(...e){super(...e),Fo(this,"getChildContext",(()=>({d2:this.props.d2}))),Fo(this,"render",(()=>o.a.createElement(Co.a,{muiTheme:xo},this.props.children)))}}Po.childContextTypes={d2:ee.a.object};var Do=Po;a(2173),a(2174);t.default=()=>{const{d2:e}=Object(n.a)({d2Config:{schemas:["userRole","user","userGroup","userCredentials","organisationUnit"]},i18nRoot:"./d2i18n",onInitialized:e=>{Gr.init(e)}});return e?o.a.createElement(l.a,{store:er},o.a.createElement(Do,{d2:e},o.a.createElement(vo,null))):o.a.createElement(Do,null,o.a.createElement("div",{className:"page-loader-wrap"},o.a.createElement(s.CircularProgress,{size:48})))}}}]);
//# sourceMappingURL=app.60793483.chunk.js.map