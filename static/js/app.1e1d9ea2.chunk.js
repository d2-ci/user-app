(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[127],{1629:function(e,t,a){},1670:function(e,t,a){e.exports={container:"UserList_container__hyfpI",addition:"UserList_addition__1DR2Q",tablebody:"UserList_tablebody__3o0lC",noCheckBox:"UserList_noCheckBox__1l3OR"}},1671:function(e,t,a){e.exports={toolbar:"GroupUserManagement_toolbar__1zhz4",left:"GroupUserManagement_left__1Jv8C",right:"GroupUserManagement_right__nDdsZ"}},1672:function(e,t,a){e.exports={tabbar:"GroupFormRouter_tabbar__1Fsiu",tab:"GroupFormRouter_tab__1mkzZ",content:"GroupFormRouter_content__1XrVq"}},1778:function(e,t,a){},1784:function(e,t,a){"use strict";a.r(t);var r={};a.r(r),a.d(r,"code",(function(){return ra})),a.d(r,"date",(function(){return sa})),a.d(r,"email",(function(){return na})),a.d(r,"integer",(function(){return ia})),a.d(r,"negativeInteger",(function(){return oa})),a.d(r,"number",(function(){return la})),a.d(r,"password",(function(){return ca})),a.d(r,"positiveInteger",(function(){return da})),a.d(r,"repeatPassword",(function(){return ua})),a.d(r,"required",(function(){return pa})),a.d(r,"requiredArray",(function(){return ma})),a.d(r,"username",(function(){return ha})),a.d(r,"whatsApp",(function(){return ga}));var s=a(1),n=a.n(s),i=a(1779),o=a(194),l=a(5),c=a.n(l),d=a(831),u=a.n(d),p=a(526),m=a.n(p),h=a(327),g=a(832),y=(a(833),a(1787));const E={type:null,items:null};var b=(e=E,{type:t,payload:a})=>{switch(t){case"LIST_REQUESTED":return{type:a,items:null};case"LIST_RECEIVED":return e.type===a.type?{type:a.type,items:a.items}:e;case"LIST_ERRORED":return{type:null,items:a.message};default:return e}};const f={query:"",inactiveMonths:null,selfRegistered:!1,invitationStatus:null,organisationUnits:[]},_={show:!1,props:{message:""}},T={show:!1,props:{},content:null},A={show:!1,id:null,type:null};var R=(e=f,{type:t,payload:a})=>{switch(t){case"FILTER_UPDATED":return{...e,[a.updateKey]:a.updateValue};case"FILTER_RESET":return{...f};default:return e}};var S=(e=null,{type:t,payload:a})=>{switch(t){case"PAGER_RESET":return null;case"LIST_RECEIVED":return a.items.pager;default:return e}};var C=(e=null,{type:t,payload:a})=>{switch(t){case"CLEAR_ITEM":case"ITEM_REQUESTED":return null;case"INIT_NEW_ITEM":case"ITEM_RECEIVED":case"ITEM_ERRORED":return a;default:return e}};var I=(e=null,{type:t,payload:a})=>{switch(t){case"CURRENT_USER_REQUESTED":return null;case"CURRENT_USER_RECEIVED":case"CURRENT_USER_ERRORED":return a;default:return e}};var v=(e=_,{type:t,payload:a})=>{switch(t){case"SHOW_SNACKBAR":return{show:!0,props:a};case"HIDE_SNACKBAR":return{..._};default:return e}};var U=(e=T,{type:t,payload:a})=>{switch(t){case"SHOW_DIALOG":return{show:!0,...a};case"HIDE_DIALOG":return{...T};default:return e}};var w=(e=A,{type:t,payload:a})=>{switch(t){case"SHOW_SHARING_DIALOG":return{show:!0,...a};case"HIDE_SHARING_DIALOG":return{...A};default:return e}};var O=Object(h.c)({snackbar:v,dialog:U,sharing:w});const N=[g.a];const x=Object(h.c)({list:b,filter:R,pager:S,currentItem:C,currentUser:I,popups:O,form:y.a});var F=Object(h.d)(x,Object(h.a)(...N));const D=["displayName","id","access","user[displayName,id]","publicAccess","userGroupAccesses"],L=[...D,"description"],k={fields:["organisationUnits[id,path,displayName,children::isNotEmpty]","dataViewOrganisationUnits[id,path,displayName,children::isNotEmpty]","teiSearchOrganisationUnits[id,path,displayName,children::isNotEmpty]"]},P={paging:!1,fields:["id","path","displayName","children::isNotEmpty","ancestors"]};var M={USER_LIST:["displayName","id","access","userCredentials[username,disabled,lastLogin,twoFA]","teiSearchOrganisationUnits[id,path]"],USER_GROUP_LIST:D,USER_ROLE_LIST:L,USER_DETAILS:[":owner","access","displayName","userGroups","organisationUnits[id,displayName,path]","dataViewOrganisationUnits[id,displayName,path]","userCredentials[id,username,lastLogin,externalAuth,userRoles[id,displayName],cogsDimensionConstraints[id,displayName,dimensionType],catDimensionConstraints[id,displayName,dimensionType],openId,ldapId,disabled]","teiSearchOrganisationUnits[id,path]","whatsApp","facebookMessenger","skype","telegram","twitter"],USER_GROUP_DETAILS:[":owner","access","displayName","!users"],USER_ROLE_DETAILS:[":owner","access","authorities","displayName"]},G=a(218);var B=e=>e?"function"===typeof e.toArray?e.toArray():e:[];var V=(e,t)=>e.split(".").reduce((e,t)=>e&&e[t]?e[t]:null,t),j=a(836),H=a.n(j),q=a(284),W=a.n(q),Q=a(546),z=a.n(Q),Y=a(555),K=a.n(Y),X=a(222),J=a.n(X),Z=a(898),$=a(196);const ee={clear:"both",color:"#c33017",backgroundColor:"#ffe3de",padding:"1.5rem 1.5rem 1rem",fontSize:"1rem",width:"100%"};var te=({introText:e,errorMessage:t})=>n.a.createElement("div",{style:ee},e,n.a.createElement("pre",null,t));var ae=({message:e,messages:t,httpStatusCode:a},r)=>{const s=r||c.a.t("Something went wrong when processing your request."),n=a&&a>=400&&a<500||!a&&t&&t.length>0;return!e&&t&&t.length>0&&(e=t.map(({message:e})=>e).join(", ")),n?e:s};const re={outerWrap:{paddingTop:0,paddingBottom:"2.5rem"},headerWrap:{display:"flex"},headerSpacer:{flex:"0 0 120px"},header:{flex:"1 0 120px",paddingBottom:0,fontSize:"1.2rem"},error:{color:G.red500},errorText:{fontSize:"0.8rem",marginLeft:"0.8rem"}};class se extends s.Component{constructor(e){super(e),this.availableItemsReceivedHandler=e=>{const{initiallyAssignedItems:t,returnModelsOnUpdate:a}=this.props,{itemStore:r,assignedItemStore:s}=this.state;a&&(this.modelLookup=new Map);const n=B(t).map(({id:e})=>e),i=B(e).map(e=>{a&&this.modelLookup.set(e.id,e);const t=e.displayName||e.name;return{value:e.id,text:t}});r.setState(i),s.setState(n)},this.onAssignItems=e=>{const{assignedItemStore:t}=this.state,a=t.state.concat(e);return this.update(a)},this.onRemoveItems=e=>{const{assignedItemStore:t}=this.state,a=t.state.filter(t=>-1===e.indexOf(t));return this.update(a)},this.updateFilterText=e=>{this.setState({filterText:e.target.value})},this.state={itemStore:$.Store.create(),assignedItemStore:$.Store.create(),filterText:"",fetchErrorMsg:null}}async componentDidMount(){try{const e=await this.props.availableItemsQuery();this.availableItemsReceivedHandler(e)}catch(e){const t=ae(e,c.a.t("Could not load available items"));this.setState({fetchErrorMsg:t})}}update(e){const{onChange:t,returnModelsOnUpdate:a,onBlur:r}=this.props,{assignedItemStore:s}=this.state,n=a?e.map(e=>this.modelLookup.get(e)):e;return s.setState(e),t(n),r&&r(),Promise.resolve()}renderHeader(){const{availableItemsHeader:e,assignedItemsHeader:t,errorText:a}=this.props,r=a?{...re.header,...re.error}:re.header;return n.a.createElement("div",{style:re.headerWrap},n.a.createElement($.Heading,{level:4,style:re.header},e),n.a.createElement("div",{style:re.headerSpacer}),n.a.createElement($.Heading,{level:4,style:r},t,a?n.a.createElement("span",{style:re.errorText},a):null))}renderSearchInput(){return n.a.createElement(W.a,{fullWidth:!0,type:"search",onChange:this.updateFilterText,value:this.state.filterText,floatingLabelText:c.a.t("Filter"),hintText:c.a.t("Filter available and selected items"),style:{marginTop:"-16px"}})}renderGroupEditor(){const{itemStore:e,assignedItemStore:t,filterText:a,fetchErrorMsg:r}=this.state;if(r){const e=c.a.t("There was a problem displaying the GroupEditor");return n.a.createElement(te,{introText:e,errorMessage:r})}return n.a.createElement(Z.GroupEditor,{itemStore:e,assignedItemStore:t,onAssignItems:this.onAssignItems,onRemoveItems:this.onRemoveItems,height:250,filterText:a})}render(){return n.a.createElement("div",{style:re.outerWrap},this.renderHeader(),this.renderSearchInput(),this.renderGroupEditor())}}var ne=se,ie=a(1532),oe=a(201),le=a.n(oe),ce=a(246),de=a.n(ce),ue=a(476),pe=a.n(ue),me=a(383),he=a.n(me),ge=a(384),ye=a.n(ge);const Ee={error:{info:{color:G.blue500},warning:{color:G.orange500},error:{color:G.red500}}},be=[{text:"loading...",value:n.a.createElement(J.a,{style:{textAlign:"center"}},n.a.createElement(de.a,{style:{marginTop:"12px"}}))}],fe={filteredItems:[],searchWarning:null,errorStyle:Ee.error.info};class _e extends s.Component{constructor(e){super(e),this.onAutoCompleteChange=e=>{this.setState({autoCompleteText:e}),this.getItems(e)},this.getItems=async e=>{const{minCharLength:t,query:a,queryParam:r}=this.props;if(!e||e.length<t){const a=e?c.a.t("Please enter at least {{ minCharCount }} characters",{minCharCount:t}):null;this.setState({...fe,searchWarning:a})}else{this.setState({...fe,filteredItems:be}),this.trashableQuery=he()(a(e,r));try{let e=await this.trashableQuery;if(e=B(e),e.length>0){const t=e.map(e=>({text:e.displayName,value:e}));this.setState({...fe,filteredItems:t})}else this.setState({...fe,errorStyle:Ee.error.warning,searchWarning:c.a.t("No matches found")})}catch(s){this.setState({...fe,errorStyle:Ee.error.warning,searchWarning:ae(s,c.a.t("There was a problem retreiving your search results"))})}}},this.onItemSelect=e=>{const{selectHandler:t}=this.props;this.setState({autoCompleteText:""}),t(e)};const t=e.queryDebounceTime||375;this.state={...fe},this.getItems=ye()(this.getItems,t),this.trashableQuery=null}componentWillUnmount(){this.trashableQuery&&this.trashableQuery.trash()}render(){const{autoCompleteProps:e}=this.props,t={floatingLabelText:c.a.t("Search"),hintText:c.a.t("Enter search term"),fullWidth:!0,type:"search",filter:()=>!0,...e},{filteredItems:a,searchWarning:r,errorStyle:s,autoCompleteText:i}=this.state,o=r?0:28,l={...t,onUpdateInput:this.onAutoCompleteChange,onNewRequest:this.onItemSelect,searchText:i,dataSource:a,errorText:r,errorStyle:s,floatingLabelShrinkStyle:s,style:{marginBottom:o},menuStyle:{maxHeight:"600px"}};return n.a.createElement(pe.a,l)}}_e.defaultProps={queryDebounceTime:375,minCharLength:3};var Te=_e,Ae=a(238),Re=a.n(Ae),Se=a(1628),Ce=a.n(Se);const Ie={wrapper:{minHeight:"300px",maxHeight:"60vh",position:"relative"},scrollBox:{position:"relative",marginTop:"-12px",maxHeight:"calc(60vh - 154px)",minHeight:"calc(300px - 154px)",overflowY:"auto",paddingTop:"8px",paddingBottom:"8px",borderRadius:"2px"},loader:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},buttonStrip:{paddingTop:"16px",height:"36px"},buttonMargin:{marginRight:"8px"},header:{paddingBottom:0,fontSize:"1.2rem",marginBottom:"-16px"},headerError:{color:G.red500},errorText:{fontSize:"0.8rem",marginLeft:"0.8rem"}};class ve extends s.Component{constructor(e){super(e),this.toggleSelectedOrgUnits=(e,t)=>{const{selectedOrgUnits:a}=this.state,r=this.getIndexOfOrgUnit(t),s=-1===r?[...a,t]:[...a.slice(0,r),...a.slice(r+1)];this.update(s,[])},this.selectAndShowFilteredOrgUnit=e=>{const t=e.value,{selectedOrgUnits:a}=this.state,r=[this.removeLastPathSegment(t)],s=[...a,t];this.update(s,r)},this.clearSelection=()=>{this.update([]),Ce()(this.applySelection)},this.applySelection=()=>{const{selectedOrgUnits:e}=this.state,{confirmSelection:t}=this.props;t(e)},this.state={roots:null,selectedOrgUnits:[...e.selectedOrgUnits],orgUnitFilter:null,initiallyExpanded:this.getInitiallyExpandedItems(e.selectedOrgUnits)}}getInitiallyExpandedItems(e){return e.reduce((e,t)=>{const a=this.removeLastPathSegment(t);return a&&e.push(a),e},[])}getIndexOfOrgUnit(e){const{selectedOrgUnits:t}=this.state,a=t.find(t=>t.path===e.path);return t.indexOf(a)}removeLastPathSegment({path:e}){return e.substr(0,e.lastIndexOf("/"))}update(e,t){const{onChange:a,onBlur:r}=this.props,s=t?{selectedOrgUnits:e,initiallyExpanded:t}:{selectedOrgUnits:e};a&&a(e.map(e=>e.id)),this.setState(s),r&&r()}render(){const{selectedOrgUnits:e,initiallyExpanded:t,orgUnitFilter:a}=this.state,{roots:r,confirmSelection:s,cancel:i,orgUnitType:o,headerText:l,wrapperStyle:d,errorText:u}=this.props,p=e.map(e=>e.path),m={floatingLabelText:c.a.t("Search"),hintText:c.a.t("Enter search term"),fullWidth:!0},h=u?{...Ie.header,...Ie.headerError}:Ie.header;return n.a.createElement("div",{style:{...Ie.wrapper,...d}},l?n.a.createElement($.Heading,{level:4,style:h},l,u&&n.a.createElement("span",{style:Ie.errorText},u)):null,n.a.createElement(Te,{autoCompleteProps:m,query:wa.queryOrgUnits,queryParam:o,minCharLength:2,queryDebounceTime:375,selectHandler:this.selectAndShowFilteredOrgUnit}),n.a.createElement(le.a,{style:Ie.scrollBox},r?n.a.createElement(ie.OrgUnitTreeMultipleRoots,{roots:r,onSelectClick:this.toggleSelectedOrgUnits,selected:p,initiallyExpanded:t,orgUnitsPathsToInclude:a}):n.a.createElement(de.a,{style:Ie.loader})),s?n.a.createElement("div",{style:Ie.buttonStrip},n.a.createElement(Re.a,{label:c.a.t("Apply"),primary:!0,style:Ie.buttonMargin,onClick:this.applySelection,disabled:!r}),n.a.createElement(Re.a,{label:c.a.t("Clear all"),secondary:!0,style:Ie.buttonMargin,onClick:this.clearSelection,disabled:!r}),n.a.createElement(Re.a,{onClick:i,label:c.a.t("Cancel")})):null)}}var Ue=Object(o.b)((e,t)=>({roots:xt(t.orgUnitType,e.currentUser)}))(ve),we=a(3),Oe=a.n(we),Ne=(a(1629),a(216));class xe extends s.Component{constructor(e){super(e),this.onSelectedOnlyChange=(e,t)=>{this.setState({selectedOnly:t}),this.props.onFilterChange(this.state.searchStr,t)},this.onSearchStrChange=e=>{const t=e.target.value;this.setState({searchStr:t}),this.props.onFilterChange(t,this.state.selectedOnly)},this.state={searchStr:"",selectedOnly:!1}}render(){return n.a.createElement("div",{className:"authority-editor__filterbar"},n.a.createElement(Ne.TextField,{className:"authority-editor__filter-text-input search-input",floatingLabelText:c.a.t("Search"),onChange:this.onSearchStrChange,type:"search"}),n.a.createElement(Ne.Checkbox,{className:"authority-editor__filter-checkbox",label:c.a.t("Selected authorities only"),checked:this.state.selectedOnly,onCheck:this.onSelectedOnlyChange,style:{width:"300px"}}))}}var Fe=xe;var De=(e,t,a,r)=>a||r?Object.keys(e).reduce((s,n)=>{const i=e[n],o=i.items.filter(e=>{const s=((e,t)=>{if(!t)return!0;const a=e.name.toLowerCase();return t.some(e=>!(e.length<=1&&t.length>1)&&a.indexOf(e)>-1)})(e,a),n=((e,t,a)=>!t||(e.items&&e.items.length?e.items.some(e=>a.get(e.id)):Boolean(a.get(e.id))))(e,r,t);return s&&n});return s[n]={...i,items:o},s},{}):e,Le=a(797),ke=a.n(Le),Pe=a(1630),Me=a.n(Pe);var Ge=({text:e,searchChunks:t})=>t?n.a.createElement(Me.a,{highlightClassName:"authority-editor__search-highlight",searchWords:t,autoEscape:!0,textToHighlight:e}):e;class Be extends s.Component{constructor(...e){super(...e),this.onChecked=(e,t)=>{const{authSubject:{id:a},onCheckedCallBack:r}=this.props;r([a],t)}}render(){const{authSubject:e,withLabel:t,disabled:a}=this.props,{searchChunks:r}=this.context,{name:s,empty:i,implicit:o}=e,l=t?"authority-editor__auth-checkbox":"".concat("authority-editor__auth-checkbox","--without-label"),c=t?n.a.createElement(Ge,{text:s,searchChunks:r}):"";return n.a.createElement("td",null,i?n.a.createElement("div",{className:"authority-editor__empty-cell"}):n.a.createElement(Ne.Checkbox,{onCheck:this.onChecked,label:c,className:l,checked:this.props.selected||Boolean(o),disabled:o||a}))}}Be.contextTypes={searchChunks:Oe.a.array};var Ve=Be,je=a(1631),He=a.n(je),qe=a(1632),We=a.n(qe);var Qe=(()=>{let e=null;return()=>(e||(e=new Map([["ALL",c.a.t("All (Full authority)")],["F_ANALYTICSTABLEHOOK",c.a.t("Analytics Table Hook")],["F_ATTRIBUTE",c.a.t("Attribute")],["F_CATEGORY_COMBO",c.a.t("Category Combo")],["F_CATEGORY",c.a.t("Category")],["F_CATEGORY_OPTION",c.a.t("Category Option")],["F_CATEGORY_OPTION_GROUP",c.a.t("Category Option Group")],["F_CATEGORY_OPTION_GROUP_SET",c.a.t("Category Option Group Set")],["F_COLOR_SET",c.a.t("Color Set")],["F_CONSTANT",c.a.t("Constant")],["F_DASHBOARD",c.a.t("Dashboard")],["F_DATAELEMENTGROUPSET",c.a.t("Data Element Group Sets")],["F_DATAELEMENTGROUP",c.a.t("Data Element Groups")],["F_DATAELEMENT",c.a.t("Data Element")],["F_DATAELEMENT_MINMAX",c.a.t("Min/max rule")],["F_DATASET",c.a.t("Data Set")],["F_DATAVALUE",c.a.t("Data Value")],["F_DOCUMENT",c.a.t("Document")],["F_EVENTCHART",c.a.t("Event Chart")],["F_EVENTREPORT",c.a.t("Event Report")],["F_EXTERNAL_MAP_LAYER",c.a.t("External Map Layer")],["F_INDICATORGROUPSET",c.a.t("Indicator Group Sets")],["F_INDICATORGROUP",c.a.t("Indicator Group")],["F_INDICATORTYPE",c.a.t("Indicator Type")],["F_INDICATOR",c.a.t("Indicator")],["F_LEGEND_SET",c.a.t("Legend Set")],["F_MAP",c.a.t("Map")],["F_MINMAX_DATAELEMENT",c.a.t("Min-Max Data Element")],["F_OPTIONGROUPSET",c.a.t("Option Group Set")],["F_OPTIONGROUP",c.a.t("Option Group")],["F_OPTIONSET",c.a.t("Option Set")],["F_ORGANISATIONUNIT",c.a.t("Organisation Unit")],["F_ORGUNITGROUPSET",c.a.t("Organisation Unit Group Set")],["F_ORGUNITGROUP",c.a.t("Organisation Unit Group")],["F_PREDICTOR",c.a.t("Predictor")],["F_PROGRAMSTAGE",c.a.t("Program Stage")],["F_PROGRAM",c.a.t("Program")],["F_PROGRAM_INDICATOR",c.a.t("Program Indicator")],["F_PROGRAM_INDICATOR_GROUP",c.a.t("Program Indicator Group")],["F_PROGRAM_RULE",c.a.t("Program Rule")],["F_PROGRAM_TRACKED_ENTITY_ATTRIBUTE_GROUP",c.a.t("Program Tracked Entity Attribute Group")],["F_PUSH_ANALYSIS",c.a.t("Push Analysis")],["F_RELATIONSHIPTYPE",c.a.t("Relationship Type")],["F_REPORT",c.a.t("Report")],["F_SECTION",c.a.t("Section")],["F_SQLVIEW",c.a.t("SQL View")],["F_TRACKED_ENTITY",c.a.t("Tracked Entity")],["F_TRACKED_ENTITY_ATTRIBUTE",c.a.t("Tracked Entity Attribute")],["F_TRACKED_ENTITY_DATAVALUE",c.a.t("Tracked Entity Data Value")],["F_TRACKED_ENTITY_INSTANCE",c.a.t("Tracked Entity Instance")],["F_USERGROUP",c.a.t("User Group")],["F_USERROLE",c.a.t("User Role")],["F_USER",c.a.t("User")],["F_VALIDATIONRULEGROUP",c.a.t("Validation Rule Group")],["F_VALIDATIONRULE",c.a.t("Validation Rule")],["F_PREDICTORGROUP",c.a.t("Data predictor group")],["F_SKIP_DATA_IMPORT_AUDIT",c.a.t("Skip data import audit")],["F_VISUALIZATION",c.a.t("Visualization")]])),e)})();const ze=(()=>{let e=null;return()=>(e||(e={metadata:{name:"Metadata",items:null,headers:["Name","Add/Update Public","Add/Update Private","Delete","External access"]},apps:{name:c.a.t("Apps"),items:null,headers:["Name"]},tracker:{name:c.a.t("Tracker"),items:null,headers:["Name"]},importExport:{name:c.a.t("Import-Export"),items:null,headers:["Name"]},system:{name:c.a.t("System"),items:null,headers:["Name"]}}),e)})(),Ye=["_PUBLIC_ADD","_PRIVATE_ADD","_ADD","_DELETE","_EXTERNAL"],Ke={id:null,empty:!0},Xe={implicit:!0},Je=new Set(["F_DASHBOARD_PUBLIC_ADD","F_EVENTCHART_PUBLIC_ADD","F_EVENTREPORT_PUBLIC_ADD","F_MAP_PUBLIC_ADD","F_VISUALIZATION_PUBLIC_ADD"]),Ze={tracker:new Set(["F_PROGRAM_DASHBOARD_CONFIG_ADMIN","F_PROGRAM_ENROLLMENT","F_PROGRAM_ENROLLMENT_READ","F_PROGRAM_UNENROLLMENT","F_TEI_CASCADE_DELETE","F_TRACKED_ENTITY_DATAVALUE_READ","F_TRACKED_ENTITY_INSTANCE_SEARCH","F_TRACKED_ENTITY_INSTANCE_SEARCH_IN_ALL_ORGUNITS","F_TRACKED_ENTITY_UPDATE","F_UNCOMPLETE_EVENT","F_VIEW_EVENT_ANALYTICS","F_PROGRAM_RULE_MANAGEMENT","F_ENROLLMENT_CASCADE_DELETE"]),importExport:new Set(["F_EXPORT_DATA","F_EXPORT_EVENTS","F_IMPORT_DATA","F_IMPORT_EVENTS","F_IMPORT_GML","F_METADATA_EXPORT","F_METADATA_IMPORT","F_METADATA_MANAGE","F_SKIP_DATA_IMPORT_AUDIT"]),system:new Set(["ALL","F_APPROVE_DATA","F_APPROVE_DATA_LOWER_LEVELS","F_ACCEPT_DATA_LOWER_LEVELS","F_VIEW_UNAPPROVED_DATA","F_ORGANISATIONUNIT_MOVE","F_ORGANISATIONUNITLEVEL_UPDATE","F_RUN_VALIDATION","F_REPLICATE_USER","F_USER_VIEW","F_USERGROUP_MANAGING_RELATIONSHIPS_ADD","F_USERGROUP_MANAGING_RELATIONSHIPS_VIEW","F_PERFORM_MAINTENANCE","F_SCHEDULING_ADMIN","F_GENERATE_MIN_MAX_VALUES","F_PREDICTOR_RUN","F_INSERT_CUSTOM_JS_CSS","F_SYSTEM_SETTING","F_SEND_EMAIL","F_MOBILE_SETTINGS","F_MOBILE_SENDSMS","F_OAUTH2_CLIENT_MANAGE"])},$e=e=>(Object.keys(e).forEach(t=>{const a=e[t];a.items=We()(a.items,"name")}),e),et=e=>!Ye.some(t=>ke()(e.id,t)),tt=(e,t)=>{if(!t.get(e.id))return null;const a=Ye.find(t=>ke()(e.id,t)),r=e.id.replace(a,""),s=t.get(r+"_ADD"),n=t.get(r+"_EXTERNAL"),i=Je.has(r+"_PUBLIC_ADD"),o=s||t.get(r+"_PUBLIC_ADD"),l=s?Ke:i?Xe:t.get(r+"_PRIVATE_ADD"),c=i?Xe:t.get(r+"_DELETE"),d=n||Ke;return o&&l&&c?(Ye.forEach(e=>t.delete(r+e)),{name:Qe().get(r)||r,items:[o,l,c,d]}):null},at=(e,t,a)=>{const r=Object.keys(Ze).find(t=>Ze[t].has(e.id))||"system";"ALL"===e.id&&(e.name=Qe().get(e.id)),t[r].items.push(e),a.delete(e.id)};var rt=e=>{const t=e.reduce((e,t)=>(e.set(t.id,t),e),new Map),a=Object.keys(ze()).reduce((e,t)=>(e[t]={...ze()[t],items:[]},e),{}),r=e.reduce((e,a)=>{if(He()(a.id,"M_"))e.apps.items.push(a),t.delete(a.id);else if(et(a))at(a,e,t);else{const r=tt(a,t);r?e.metadata.items.push(r):t.get(a.id)&&at(a,e,t)}return e},a);return $e(r)};class st extends s.Component{constructor(...e){super(...e),this.onAuthGroupChanged=(e,t)=>{this.context.onAuthChange(e,t),this.isPublicAdd(e)&&this.forceUpdate()}}isPublicAdd(e){return ke()(e,"_PUBLIC_ADD")}isPrivateAdd(e){return ke()(e,"_PRIVATE_ADD")}render(){const{name:e,items:t}=this.props,{shouldSelect:a,searchChunks:r}=this.context;let s;return t.reduce((e,t,r)=>{const i=this.isPublicAdd(t.id),o=this.isPrivateAdd(t.id),l=Boolean(s&&o),c=a(t.id)||l;return i&&(s=c),e.push(n.a.createElement(Ve,{key:"authitem-".concat(r),authSubject:t,withLabel:!1,selected:c,disabled:l,onCheckedCallBack:this.onAuthGroupChanged})),e},[n.a.createElement("td",{key:"group-label"},n.a.createElement(Ge,{text:e,searchChunks:r}))])}}st.contextTypes={shouldSelect:Oe.a.func.isRequired,onAuthChange:Oe.a.func.isRequired,searchChunks:Oe.a.array};var nt=st;class it extends s.Component{constructor(...e){super(...e),this.onTableHeadCheck=(e,t)=>{const a=this.props.authSection.items.map(({id:e})=>e);this.context.onAuthChange(a,t)},this.renderAuthRow=(e,t)=>{const{shouldSelect:a,onAuthChange:r}=this.context;return n.a.createElement("tr",{key:"row-".concat(t)},e.items?n.a.createElement(nt,{items:e.items,name:e.name}):n.a.createElement(Ve,{authSubject:e,withLabel:!0,selected:a(e.id),onCheckedCallBack:r}))}}renderLoaderRow(){return n.a.createElement("tr",null,n.a.createElement("td",{className:"authority-editor__placeholder-cell"},n.a.createElement(Ne.CircularProgress,{size:24})))}renderInfoRow(e){let t="authority-editor__placeholder-cell",a=c.a.t("No matches found");return e&&(t+="--error",a=e),n.a.createElement("tr",null,n.a.createElement("td",{className:t},a))}renderContent(e){return e.items?"string"===typeof e.items?this.renderInfoRow(e.items):0===e.items.length?this.renderInfoRow():e.items.map(this.renderAuthRow):this.renderLoaderRow()}renderTableHead({headers:e,name:t,items:a}){const r="Metadata"!==t&&Array.isArray(a)&&a.length>0&&a.every(({id:e})=>this.context.shouldSelect(e));return n.a.createElement("thead",null,n.a.createElement("tr",null,e.map((e,a)=>n.a.createElement("th",{key:"header-".concat(a)},"Metadata"!==t&&0===a?n.a.createElement(Ne.Checkbox,{className:"authority-editor__auth-checkbox",label:e,onCheck:this.onTableHeadCheck,checked:r}):e))))}render(){const{sectionKey:e,authSection:t}=this.props;let a="authority-editor__auth-group ".concat(e);t.items&&t.items.length>11&&(a+=" scrollable");let r="authority-editor__auth-group-table";return r+=" columns-".concat(t.headers.length),n.a.createElement(Ne.Paper,{className:a},n.a.createElement($.Heading,{level:6,className:"authority-editor__auth-group-header"},t.name),n.a.createElement("table",{className:r},this.renderTableHead(t),n.a.createElement("tbody",null,this.renderContent(t))))}}it.contextTypes={shouldSelect:Oe.a.func.isRequired,onAuthChange:Oe.a.func.isRequired};var ot=it;class lt extends s.Component{constructor(e){super(e),this.state={filteredAuthorities:e.allGroupedAuthorities,searchChunks:null},this.updateFilter=ye()(this.updateFilter,375)}getChildContext(){return{searchChunks:this.state.searchChunks}}componentWillReceiveProps(e){this.updateFilteredAuthorities(e.allGroupedAuthorities,null,null)}updateFilter(e,t){const{allGroupedAuthorities:a}=this.props;this.updateFilteredAuthorities(a,e,t)}updateFilteredAuthorities(e,t,a){const{selectedItemsLookup:r}=this.context,s=t?t.toLowerCase().split(" "):null;this.setState({filteredAuthorities:De(e,r,s,a),searchChunks:s})}render(){const{filteredAuthorities:e}=this.state;return n.a.createElement("div",{className:"authority-editor__auth-group-wrap"},Object.keys(e).map(t=>n.a.createElement(ot,{key:t,sectionKey:t,authSection:e[t]})))}}lt.contextTypes={shouldSelect:Oe.a.func.isRequired,onAuthChange:Oe.a.func.isRequired,selectedItemsLookup:Oe.a.object.isRequired},lt.childContextTypes={searchChunks:Oe.a.array};var ct=lt;class dt extends s.Component{constructor(e){super(e),this.onFilterChange=(e,t)=>{this.filteredAuthSections.updateFilter(e,t)},this.onAuthChange=(e,t)=>{const{reduxFormOnChange:a}=this.props,r=[];e.forEach(e=>{this.selectedItemsLookup.set(e,t)}),this.selectedItemsLookup.forEach((e,t)=>{e&&r.push(t)}),a&&a(r)},this.shouldSelect=e=>Boolean(this.selectedItemsLookup.get(e)),this.state={allGroupedAuthorities:ze()},this.selectedItemsLookup=e.initiallySelected.reduce((e,t)=>e.set(t,!0),new Map),this.groupedAuthoritiesPromise=null}getChildContext(){return{shouldSelect:this.shouldSelect,onAuthChange:this.onAuthChange,selectedItemsLookup:this.selectedItemsLookup}}async componentDidMount(){this.groupedAuthoritiesPromise=he()(wa.getGroupedAuthorities());try{const e=await this.groupedAuthoritiesPromise;this.setState({allGroupedAuthorities:e})}catch(e){this.handleAuthorityFetchError(e)}}componentWillUnmount(){this.groupedAuthoritiesPromise.trash()}handleAuthorityFetchError(e){const t=ae(e,c.a.t("There was a problem retreiving the available authorities.")),a=Object.keys(ze()).reduce((e,a)=>(e[a]={...ze()[a],items:t},e),{});this.setState({allGroupedAuthorities:a})}render(){const{allGroupedAuthorities:e}=this.state;return n.a.createElement("div",{className:"authority-editor"},n.a.createElement($.Heading,{level:4,className:"authority-editor__header"},c.a.t("Authorities")),n.a.createElement(Fe,{onFilterChange:this.onFilterChange}),n.a.createElement(ct,{ref:e=>{this.filteredAuthSections=e},allGroupedAuthorities:e}))}}dt.defaultProps={initiallySelected:[]},dt.childContextTypes={shouldSelect:Oe.a.func.isRequired,onAuthChange:Oe.a.func.isRequired,selectedItemsLookup:Oe.a.object.isRequired};var ut=dt;const pt={checkbox:{marginTop:"32px",fontSize:"16px"},warning:{color:G.orange500}},mt=({input:e,label:t,meta:{touched:a,error:r,asyncValidating:s},...i})=>{const o=s?c.a.t("Validating..."):a&&r;return s&&(i.errorStyle=pt.warning),n.a.createElement(W.a,Object.assign({floatingLabelText:t,hintText:t,fullWidth:!0,errorText:o},i,e))},ht=({input:e})=>{const t=""===e.value?[]:e.value;return n.a.createElement(ut,{initiallySelected:t,reduxFormOnChange:e.onChange,reduxFormOnBlur:e.onBlur})},gt=({input:e,label:t})=>n.a.createElement(z.a,Object.assign({checked:Boolean(e.value),onCheck:e.onChange,label:t},e,{style:pt.checkbox})),yt=({input:e,label:t,meta:{touched:a,error:r,asyncValidating:s},options:i,style:o})=>{const l=s?c.a.t("Validating..."):a&&r,d=s?pt.warning:void 0;return n.a.createElement(K.a,{floatingLabelText:t,fullWidth:!0,value:e.value,name:e.name,onChange:(t,a,r)=>{e.onChange(r),setTimeout(()=>e.onBlur(r),1)},style:o,errorText:l,errorStyle:d},i.map(({id:e,label:t},a)=>n.a.createElement(J.a,{key:"option_".concat(a),value:e,primaryText:t})))},Et=({input:e,meta:{touched:t,error:a},availableItemsQuery:r,availableItemsLabel:s,assignedItemsLabel:i,initialValues:o,...l})=>n.a.createElement(ne,Object.assign({initiallyAssignedItems:o,onChange:e.onChange,onBlur:e.onBlur,availableItemsQuery:r,availableItemsHeader:s,assignedItemsHeader:i,errorText:t&&a},l)),bt=({input:e,meta:{touched:t,error:a},label:r,wrapperStyle:s,initialValues:i,orgUnitType:o})=>n.a.createElement(Ue,{selectedOrgUnits:i,onChange:e.onChange,wrapperStyle:s,headerText:r,orgUnitType:o,errorText:t&&a,onBlur:e.onBlur}),ft=({name:e,label:t,style:a})=>n.a.createElement("p",{key:e,style:a},t),_t="name",Tt="code",At={loaderWrap:{paddingTop:"2rem",textAlign:"center"}},Rt=()=>[{name:_t,label:c.a.t("Name"),fieldRenderer:mt,isRequiredField:!0},{name:Tt,label:c.a.t("Code"),fieldRenderer:mt},{name:"manage_users_info",fieldRenderer:ft,label:c.a.t("To add a user to this group, go to the User section and edit the user group settings for a specific user."),style:{border:"1px solid #bdbdbd",backgroundColor:"#e5e5e5",padding:12}},{name:"managedGroups",fieldRenderer:Et,initialItemsSelector:e=>B(e.managedGroups),availableItemsQuery:"getAvailableUserGroups",availableItemsLabel:c.a.t("Available user groups"),assignedItemsLabel:c.a.t("Managed user groups")}],St=(e,t)=>{if(!e||"string"===typeof e)return e;const a=e.modelDefinition.name;return e.toArray().map(e=>Ct[a](e,t))},Ct={user:e=>(e.userName=e.userCredentials.username,e.disabled=e.userCredentials.disabled,e.lastLogin=e.userCredentials.lastLogin,e),userRole:e=>e,userGroup:(e,t)=>(e.currentUserIsMember=t.includes(e.id),e)},It=H()(e=>e.length<3?e.map(e=>e.displayName).join(", "):c.a.t("{{count}} selected",{count:e.length})),vt=(e,t,a)=>{a===Ht?t[a]=[...e.catDimensionConstraints,...e.cogsDimensionConstraints]:e[a]&&!m()(e[a].size)||Array.isArray(e[a])?t[a]=B(e[a]).map(({id:e})=>e):t[a]=e[a]},Ut=H()((e,t,a)=>{const r={[kt]:Qt};return e.id&&(qt.forEach(t=>{vt(e,r,t)}),Wt.forEach(t=>{vt(e.userCredentials,r,t)}),a.forEach(e=>r[e.name]=e.value)),r[Bt]=t.ui.selected||"en",r[Vt]=t.db.selected,r}),wt=H()((e,t)=>{const a={};return Rt().forEach(t=>{vt(e,a,t.name)}),t.forEach(e=>a[e.name]=e.value),a}),Ot=H()(e=>[...B(V("userCredentials.catDimensionConstraints",e)),...B(V("userCredentials.cogsDimensionConstraints",e))]),Nt=H()((e,t)=>t&&e?t.get(e):null),xt=(e,t)=>{const a=t.systemOrganisationUnitRoots,r=t[e],s=t[jt];let n=null;return t.authorities.has("ALL")?n=a:(0===r.size||s.size>0)&&(n=s.toArray()),n},Ft=e=>{const t=e&&e.registeredFields,a=e&&e.values;return(Boolean(t&&t[kt])&&a&&a[kt])===zt},Dt={loaderWrap:{paddingTop:"2rem",textAlign:"center"},toggler:{color:G.blue600},orgUnitTree:{width:"calc(50% - 60px)",float:"left",minHeight:"100px",maxHeight:"1200px"},togglerWrap:{clear:"both",paddingTop:"1.2rem",marginBottom:"1.5rem"},additionalFieldsWrap:{clear:"both",paddingTop:"1.5rem"}},Lt="username",kt="inviteUser",Pt="externalAuth",Mt="openId",Gt="ldapId",Bt="interfaceLanguage",Vt="databaseLanguage",jt="organisationUnits",Ht="catCogsDimensionConstraints",qt=["surname","firstName","email","phoneNumber","whatsApp","facebookMessenger","skype","telegram","twitter",jt,"dataViewOrganisationUnits","userGroups","teiSearchOrganisationUnits"],Wt=[Lt,"disabled",Pt,"password",Mt,Gt,"userRoles",Ht],Qt="SET_PASSWORD",zt="INVITE_USER",Yt=()=>({label:c.a.t("Selecting an organisation unit provides access to all units in the sub-hierarchy"),fieldRenderer:ft,style:{clear:"both",paddingTop:"0.8rem",fontStyle:"italic",fontSize:"0.9rem"}}),Kt="user",Xt=/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/,Jt=/^\+(?:[0-9].?){4,14}[0-9]$/,Zt=/[0-9]{4}-[0-9]{2}-[0-9]{2}/,$t=/^(?=.*[a-z]).+$/,ea=/^(?=.*[A-Z]).+$/,ta=/^(?=.*[0-9]).+$/,aa=/[^a-zA-Z0-9]/;function ra(e){if(Ea(e)&&e.length>50)return c.a.t("Exceeds maximum character limit of 50")}function sa(e){if(Ea(e)&&!Zt.test(e))return c.a.t("Please enter a valid date with the following format yyyy-mm-dd")}function na(e){if(Ea(e)&&!Xt.test(e.toLowerCase()))return c.a.t("Please provide a valid email address")}function ia(e){if(Ea(e)&&!ya(e))return c.a.t("Value should be an integer")}function oa(e){if(Ea(e)&&(!ya(e)||parseInt(e,10)>=0))return c.a.t("Value should be a nagative integer")}function la(e){if(Ea(e)&&isNaN(e))return c.a.t("Value should be a number")}function ca(e,t,a){if(!function(e,t){if(t.inviteUser)return!1;const a=Boolean(t.user.id);return!(a&&!e.password&&!e.repeatPassword)}(t,a))return;const r=function(e){if(!Ea(e))return c.a.t("This field is required");if(e.length<8)return c.a.t("Password should be at least 8 characters long");if(e.length>35)return c.a.t("Password should be no longer than 34 characters");if(!$t.test(e))return c.a.t("Password should contain at least one lowercase letter");if(!ea.test(e))return c.a.t("Password should contain at least one UPPERCASE letter");if(!ta.test(e))return c.a.t("Password should contain at least one number");if(!aa.test(e))return c.a.t("Password should have at least one special character");return null}(t.password);return r||void 0}function da(e){if(Ea(e)&&(!ya(e)||parseInt(e,10)<=0))return c.a.t("Value should be a positive integer")}function ua(e,t){if(t.repeatPassword!==t.password)return c.a.t("Passwords do not match")}function pa(e){return Ea(e)?void 0:c.a.t("This field is required")}function ma(e){if(!(Array.isArray(e)&&e.length>0))return c.a.t("This field is required. Please select at least one")}function ha(e){return Ea(e)&&e.length<2?c.a.t("A username should be at least 2 characters long"):Ea(e)&&e.length>140?c.a.t("Username may not exceed 140 characters"):void 0}function ga(e){if(Ea(e)&&!Jt.test(e))return c.a.t("Please provide a valid international phone number (+0123456789)")}function ya(e){if(isNaN(e))return!1;const t=parseFloat(e);return(0|t)===t}function Ea(e){return"undefined"!==typeof e&&null!==e&&""!==e}let ba;function fa(){if("undefined"!==typeof ba)return ba;let e=document.createElement("input");return e.setAttribute("type","date"),e.setAttribute("value","not-a-date"),ba="not-a-date"!==e.value,e=null,ba}function _a(e,t){return e.map(e=>function({id:e,valueType:t,displayName:a,mandatory:r,unique:s,optionSet:n},i){const o=i&&i.find(t=>t.attribute.id===e),l=function(e,t,a){const r=Ra(),s=t?{...r.OPTION_SET,props:{options:t.options.map(e=>({id:e.id,label:e.displayName}))}}:r[e]||r.TEXT;s.fieldRenderer!==yt||a||"no_value"===s.props.options[0].id||(s.props.options=[{id:"no_value",label:c.a.t("<No value>")},...s.props.options]);return s}(t,n,r);return{name:"userAttibute_"+e,isAttributeField:!0,label:a,isRequiredField:r,shouldBeUnique:s,attributeId:e,value:o&&o.value||null,valueType:t,...l}}(e,t))}function Ta(e,t){e.forEach(({shouldBeUnique:e,name:a})=>{e&&t.push(a)})}function Aa(e,t){const a=t.reduce((e,{attributeId:t,valueType:a})=>(e[t]=a,e),{});return Object.keys(e).reduce((t,r)=>{if(-1!==r.indexOf("userAttibute_")){const s=r.replace("userAttibute_",""),n=e[r],i="no_value"===n;"TRUE_ONLY"===a[s]&&!n||i||t.push({value:n,attribute:{id:s}})}return t},[])}const Ra=(()=>{let e=null;return()=>(e||(e={OPTION_SET:{fieldRenderer:yt},TEXT:{fieldRenderer:mt},LONG_TEXT:{fieldRenderer:mt,props:{multiLine:!0,rows:3,rowsMax:6}},DATE:{fieldRenderer:mt,props:{type:"date",floatingLabelFixed:fa(),hintText:null},fieldValidators:[sa]},BOOLEAN:{fieldRenderer:yt,props:{options:[{id:"true",label:c.a.t("Yes")},{id:"false",label:c.a.t("No")}]}},TRUE_ONLY:{fieldRenderer:gt},NUMBER:{fieldRenderer:mt,fieldValidators:[la]},INTEGER:{fieldRenderer:mt,fieldValidators:[ia]},INTEGER_POSITIVE:{fieldRenderer:mt,fieldValidators:[da]},INTEGER_NEGATIVE:{fieldRenderer:mt,fieldValidators:[oa]}}),e)})();const Sa=(e,t)=>{const a=u()(e).toUpperCase(),r="".concat(a,t?"_DETAILS":"_LIST");return M[r]},Ca=({authorities:e})=>e.has("ALL"),Ia=(e,t,a)=>{m()(t)||(e[a]=Array.isArray(t)?t.map(e=>({id:e})):t)},va=(e,t,a)=>"/userSettings/key".concat(e,"Locale?user=").concat(t,"&value=").concat(a),Ua=({locale:e,name:t})=>({id:e,label:t});var wa=new class{constructor(){this.getD2=()=>this.d2,this.getContextPath=()=>this.d2.system.systemInfo.contextPath,this.getList=(e,t,a)=>{const r=((e=1,t,a,r,s)=>{const{query:n,inactiveMonths:i,selfRegistered:o,invitationStatus:l,organisationUnits:c}=t,d={pageSize:50,fields:a,page:e,order:r===Kt?["firstName:asc","surname:asc"]:"name:asc"};if(r!==Kt||Ca(s)||(d.userOrgUnits=!0,d.includeChildren=!0),n&&(d.query=n),i&&(d.inactiveMonths=i),o&&(d.selfRegistered=o),l&&(d.invitationStatus=l),c.length){const e=c.map(e=>e.id).join();d.filter="organisationUnits.id:in:[".concat(e,"]")}return d})(t,a,Sa(e),e,this.getCurrentUser());return this.d2.models[e].list(r)},this.getItem=(e,t)=>{const a={fields:Sa(e,!0)};return this.d2.models[e].get(t,a)},this.genericFind=(e,t,a)=>this.d2.models[e].filter().on(t).equals(a).list({fields:["id"]}),this.replicateUser=(e,t,a)=>{const r="/users/".concat(e,"/replica"),s={username:t,password:a};return this.d2Api.post(r,s)},this.queryOrgUnits=(e,t)=>{const a={...P,query:e};return this.d2.models.organisationUnits.list(a).then(e=>((e,t)=>{const{currentUser:a}=F.getState();if(a.authorities.has("ALL"))return e.toArray();const r=a[t].size>0?a[t]:a[jt];return e.toArray().filter(e=>{const t=Boolean(r.get(e.id)),a=!t&&e.ancestors.toArray().some(e=>Boolean(r.get(e.id)));return t||a})})(e,t))},this.getAvailableUserRoles=()=>this.d2.models.userRoles.list({canIssue:!0,fields:["id","displayName"],paging:!1}),this.getAvailableDataAnalyticsDimensionRestrictions=()=>this.d2Api.get("/dimensions/constraints",{fields:["id","name","dimensionType"],paging:!1}).then(({dimensions:e})=>e),this.updateDisabledState=(e,t)=>{const a="/users/".concat(e),r={userCredentials:{disabled:t}};return this.d2Api.patch(a,r)},this.disable2FA=e=>{const t="/users/".concat(e);return this.d2Api.patch(t,{userCredentials:{twoFA:!1}})},this.getSelectedAndAvailableLocales=e=>{e=e?encodeURIComponent(e):null;const t={id:"use_db_locale",label:c.a.t("Use database locale / no translation")},a=this.d2Api.get("/locales/db"),r=this.d2Api.get("/locales/ui"),s=e?this.d2Api.get("/userSettings/keyUiLocale?user=".concat(e)):this.d2.system.settings.get("keyUiLocale"),n=e?this.d2Api.get("/userSettings/keyDbLocale?user=".concat(e)):Promise.resolve("use_db_locale");return Promise.all([a,r,n,s]).then(([e,a,r,s])=>({db:{available:[t,...e.map(Ua)],selected:r||"use_db_locale"},ui:{available:a.map(Ua),selected:s}}))},this.saveOrInviteUser=(e,t,a,r,s,n)=>{const i=((e,t,a,r)=>{const s=!t.id,n=t.modelDefinition.getOwnedPropertyNames(),i=s?{userCredentials:{cogsDimensionConstraints:[],catDimensionConstraints:[]}}:{id:t.id,userCredentials:{id:t.userCredentials&&t.userCredentials.id,userInfo:{id:t.id},cogsDimensionConstraints:[],catDimensionConstraints:[]}},o=i.userCredentials;if(Array.isArray(e.catCogsDimensionConstraints)&&e.catCogsDimensionConstraints.forEach(e=>{"CATEGORY_OPTION_GROUP_SET"===e.dimensionType?o.cogsDimensionConstraints.push({id:e.id}):o.catDimensionConstraints.push({id:e.id})}),qt.forEach(t=>Ia(i,e[t],t)),Wt.forEach(t=>Ia(o,e[t],t)),i.attributeValues=Aa(e,r),delete o[Ht],(a||e[Pt])&&(delete o.password,delete o.repeatPassword),!s)for(const l of n)t[l]&&!(l in i)&&(i[l]=t[l]);return i})(e,t,a,n),o=a?"/users/invite":"/users";return(t.id?this.d2Api.update("/users/".concat(t.id),i):this.d2Api.post(o,i)).then(t=>{if("ERROR"===t.status)return Promise.reject((e=>{const t=[];for(const a of e.typeReports)for(const e of a.objectReports)for(const a of e.errorReports)t.push({message:a.message});return{messages:t}})(t));const a=[],n=encodeURIComponent(e.username),i=e[Bt];i!==r&&a.push(this.d2Api.post(va("Ui",n,i)));const o=e[Vt];if(o!==s){const e="use_db_locale"===o?this.d2Api.delete("/userSettings/keyDbLocale?user=".concat(n)):this.d2Api.post(va("Db",n,o));a.push(e)}return 0===a.length&&a.push(Promise.resolve("No locale changes detected")),Promise.all(a)})},this.getUserGroupUsers=(e,t)=>{const a={paging:!0,page:e,pageSize:50,fields:["id","displayName","userCredentials[username]"]};return Array.isArray(t)&&t.length>0&&(a.filter=t),this.d2Api.get("users",a)},this.updateUserGroupMembership=(e,t,a)=>{const r=a?"deletions":"additions";return this.d2Api.post("userGroups/".concat(e,"/users"),{[r]:t.map(e=>({id:e}))})},this.getAvailableUserGroups=()=>this.d2.models.userGroups.list({fields:["id","displayName"],paging:!1}),this.getGroupedAuthorities=()=>{if(this.groupedAuths)return Promise.resolve(this.groupedAuths);const e="".concat(this.getContextPath(),"/dhis-web-commons/security/getSystemAuthorities.action");return this.d2Api.request("GET",e).then(({systemAuthorities:e})=>this.groupedAuths=rt(e))},this.getCurrentUser=()=>this.d2.currentUser,this.getCurrentUserGroupsAndRoles=()=>this.d2Api.get("me",{fields:"userGroups[id],userCredentials[userRoles[id]]"}).then(e=>({userGroupIds:e.userGroups.map(({id:e})=>e),userRoleIds:e.userCredentials.userRoles.map(({id:e})=>e)})),this.initCurrentUser=()=>Promise.all([this.getCurrentUserGroupsAndRoles(),this.getCurrentUserOrgUnits(),this.getSystemOrgUnitRoots()]).then(([{userGroupIds:e,userRoleIds:t},{organisationUnits:a,dataViewOrganisationUnits:r,teiSearchOrganisationUnits:s},n])=>Object.assign(this.d2.currentUser,{userGroupIds:e,userRoleIds:t,organisationUnits:a,dataViewOrganisationUnits:r,teiSearchOrganisationUnits:s,systemOrganisationUnitRoots:n})),this.refreshCurrentUser=()=>{const e=Object.getPrototypeOf(this.d2.currentUser).constructor,t=this.d2.models;return Promise.all([this.d2Api.get("me",{fields:[":all","!userGroups","!organisationUnits","userCredentials[:all,!user,!userRoles]"]}),this.d2Api.get("me/authorization"),this.d2Api.get("userSettings")]).then(([a,r,s])=>(this.d2.currentUser=e.create(a,r,t,s),this.initCurrentUser()))},this.getCurrentUserOrgUnits=()=>this.d2.models.users.get(this.d2.currentUser.id,k),this.getSystemOrgUnitRoots=()=>this.d2.models.organisationUnits.list({paging:!1,level:1,fields:"id,path,displayName,children::isNotEmpty"}).then(e=>e.toArray()),this.updateCurrentUserGroupMembership=(e,t)=>{const a=t?"delete":"post",r="/users/".concat(this.d2.currentUser.id,"/userGroups/").concat(e);return this.d2Api[a](r)}}init(e){this.d2=e,this.d2Api=e.Api.getApi()}getAttributes(e){return this.d2Api.get("attributes",{fields:["id","displayName","mandatory","unique","valueType","optionSet[options[id,displayName]]"],filter:"".concat(e,"Attribute:eq:true"),paging:!1}).then(e=>e.attributes)}isAttributeUnique(e,t,a,r){return this.d2.models[e].filter().on("id").notEqual(t).filter().on("attributeValues.attribute.id").equals(a).filter().on("attributeValues.value").equals(r).list({paging:!1,fields:["id","attributeValues[value, attribute[id]]"]}).then(e=>{if(0===e.size)return!0;return 0===((e,t,a)=>e.toArray().reduce((e,r)=>e.concat(r.attributeValues.filter(e=>t===e.value&&a===e.attribute.id)),[]))(e,r,a).length})}saveUserGroup(e){return e.id?this.d2Api.update("/userGroups/".concat(e.id,"?mergeMode=MERGE"),e):this.d2Api.post("/userGroups",e)}saveRole(e){return e.id?this.d2Api.update("/userRoles/".concat(e.id),e):this.d2Api.post("/userRoles/",e)}},Oa=a(199),Na=a(304),xa=a.n(Na),Fa=a(520),Da=Object(Fa.b)();const La=(e,t)=>({type:e,payload:t}),ka=async(e,t,a,r)=>{r||e(La("LIST_REQUESTED",a));try{const r=await t;e(La("LIST_RECEIVED",{type:a,items:r}))}catch(s){e(La("LIST_ERRORED",{type:a,error:s}))}},Pa=(e,t)=>(a,r)=>{const{filter:s,pager:n}=r(),i=n?n.page:1,o=wa.getList(e,i,s);ka(a,o,e,t)},Ma=async(e,t,a)=>{a(La(e.requested));try{const r=await t;a(La(e.received,r))}catch(r){a(La(e.errored,r))}},Ga=(e,t)=>a=>{Ma({requested:"ITEM_REQUESTED",received:"ITEM_RECEIVED",errored:"ITEM_ERRORED"},wa.getItem(e,t),a)},Ba={requested:"CURRENT_USER_REQUESTED",received:"CURRENT_USER_RECEIVED",errored:"CURRENT_USER_ERRORED"},Va=()=>e=>{Ma(Ba,wa.refreshCurrentUser(),e)},ja=()=>La("CLEAR_ITEM"),Ha=(e,t)=>La("FILTER_UPDATED",{updateKey:e,updateValue:t}),qa=e=>La("SHOW_SNACKBAR",e),Wa=()=>La("HIDE_SNACKBAR"),Qa=(e,t)=>La("SHOW_DIALOG",{content:e,props:t}),za=()=>La("HIDE_DIALOG");var Ya=a(366),Ka=a.n(Ya),Xa=a(773),Ja=a.n(Xa),Za=a(1633),$a=a.n(Za);var er=e=>{Da.push(e)},tr=a(559),ar=a.n(tr),rr=a(801);Object(rr.addValueRenderer)(({value:e})=>"boolean"===typeof e,({value:e})=>e?n.a.createElement("div",{style:{width:"40px"}},n.a.createElement(ar.a,null)):null);a(1660),a(803);const sr={pagination:{userSelect:"none"}};function nr({pager:e,incrementPage:t,decrementPage:a}){const{page:r,pageCount:s,total:i}=e,o=(e=>{if(!e)return null;const{total:t,pageCount:a,page:r}=e,s=e.query?e.query.pageSize:e.pageSize,n=t-(t-(a-(a-r))*s),i=n;return"".concat(1+n-s," - ").concat(i>t?t:i)})(e),l=0===i?{...sr.pagination,visibility:"hidden"}:sr.pagination;return n.a.createElement("div",{style:l},n.a.createElement($.Pagination,{hasNextPage:()=>r&&i&&r<s,hasPreviousPage:()=>r&&i&&r>1,onNextPageClick:()=>{t(e)},onPreviousPageClick:()=>{a(e)},total:i,currentlyShown:o,style:l}))}nr.defaultProps={pager:{page:1,pageCount:1,total:0}};const ir={dataTableWrap:{flex:1,marginBottom:"4rem"},clearBoth:{clear:"both"},filterBar:{display:"table",marginBottom:"1rem",width:"100%"},headerBarPagination:{float:"right",marginTop:"14px"},headerBarFilterWrap:{display:"table",marginRight:"230px"}};class or extends s.Component{constructor(...e){super(...e),this.executeEditIfAllowed=e=>{const{isContextActionAllowed:t,primaryAction:a,showSnackbar:r,hideSnackbar:s}=this.props;t(e,"edit")?a(e):r({message:"".concat(c.a.t("You are not allowed to edit")," ").concat(e.displayName),action:c.a.t("Confirm"),autoHideDuration:null,onActionClick:s})}}componentDidMount(){const{items:e,getList:t,resetFilter:a,resetPager:r,entityType:s,listType:n}=this.props;null!==e&&n===s||(n!==s&&(a(),r()),t(s))}renderHeaderBar(e){const{filterComponent:t,entityType:a}=this.props;return n.a.createElement("div",{className:"data-table__filter-bar",style:ir.filterBar},n.a.createElement("div",{style:ir.headerBarPagination},e),n.a.createElement("div",{style:ir.headerBarFilterWrap},n.a.createElement(t,{entityType:a})))}renderDataTable(){const{items:e,columns:t,contextMenuActions:a,contextMenuIcons:r,isContextActionAllowed:s}=this.props;if("string"===typeof e){const t=c.a.t("There was an error fetching the list");return n.a.createElement(te,{introText:t,errorMessage:e})}return null===e?n.a.createElement($.LoadingMask,null):0===e.length?n.a.createElement("div",{style:ir.clearBoth},"No results found."):n.a.createElement($a.a,{rows:e,columns:t,primaryAction:this.executeEditIfAllowed,contextMenuActions:a,contextMenuIcons:r,isContextActionAllowed:s})}render(){const{sectionName:e,newItemPath:t,className:a,pager:r,incrementPage:s,decrementPage:i}=this.props,o=n.a.createElement(nr,{decrementPage:i,incrementPage:s,pager:r||void 0});return n.a.createElement("div",{style:ir.dataTableWrap,className:a},n.a.createElement($.Heading,null,e),this.renderHeaderBar(o),this.renderDataTable(),o,n.a.createElement(Ka.a,{className:"entity-list__add-new-entity",onClick:()=>er(t)},n.a.createElement(Ja.a,null)))}}or.defaultProps={className:"paged-filterable-data-table"};var lr=Object(o.b)(e=>({listType:e.list.type,items:St(e.list.items,e.currentUser.userGroupIds),pager:e.pager}),{getList:Pa,resetFilter:()=>La("FILTER_RESET"),resetPager:()=>La("PAGER_RESET"),incrementPage:e=>(t,a)=>{const{list:{type:r}}=a();ka(t,e.getNextPage(),r)},decrementPage:e=>(t,a)=>{const{list:{type:r}}=a();ka(t,e.getPreviousPage(),r)},showSnackbar:qa,hideSnackbar:Wa})(or);const cr=()=>{F.dispatch(Va())},dr=()=>{const e=wa.getContextPath()+"/dhis-web-commons-security/logout.action";window.location.assign(e)};var ur=(e,t)=>{const{currentUser:a}=F.getState(),r=e.modelDefinition.name;r===Kt&&e.id===a.id&&(t?dr():cr()),"userRole"===r&&a.userRoleIds.includes(e.id)&&cr(),"userGroup"===r&&a.userGroupIds.includes(e.id)&&cr()};const pr=({model:e,entityType:t})=>{const a={type:e.modelDefinition.displayName,displayName:e.displayName},r=c.a.t('Are you sure you want to remove the {{type}} "{{displayName}}"?',a),s=c.a.t('{{type}} "{{displayName}}" removed successfully',a),n=c.a.t('There was a problem removing {{type}} "{{displayName}}"?',a),i={message:r,action:c.a.t("Confirm"),autoHideDuration:null,onActionClick:()=>mr(e,s,n,t)};F.dispatch(qa(i))},mr=async(e,t,a,r)=>{F.dispatch(Wa());try{await e.delete(),F.dispatch(qa({message:t})),F.dispatch(Pa(r)),ur(e)}catch(s){const e=ae(s,a);F.dispatch(qa({message:e}))}},hr=({data:e})=>{var t,a;F.dispatch((t=e.id,a=e.modelDefinition.name,La("SHOW_SHARING_DIALOG",{id:t,type:a})))};var gr=a(1786),yr=a(1785),Er=a(509),br=a.n(Er);async function fr(e,t,a,r){const s=a.asyncErrors;if(!r&&!s)return Promise.resolve();let n;n="userForm"===a.form&&r===Lt?await Tr(e,a):"groupForm"!==a.form||r!==Tt&&r!==_t?await async function(e,t,a){const r=e[a];if(!r)return Promise.resolve();const s="userForm"===t.form?Kt:"userGroup",n=s===Kt?t.user.id||"_":t.group.id||"_",i=a.replace("userAttibute_","");try{if(!await wa.isAttributeUnique(s,n,i,r))return{[a]:c.a.t("Attribute value needs to be unique, value already taken.")}}catch(o){return{[a]:c.a.t("There was a problem checking if this attribute value is unique")}}}(e,a,r):await Ar(e,a,r);const i=s||n?{...s,...n}:void 0;if(i)throw i;return Promise.resolve()}async function _r(e,t,a,r){if(!a)return Promise.resolve();const s=await r(e,t,a);if(s)throw s;return Promise.resolve()}async function Tr(e,t){const a=e[Lt],r=t.form!==Rr&&t.user&&t.user.id;if(!a||r)return Promise.resolve();try{if((await wa.genericFind("users","userCredentials.username",a)).size>0)return{[Lt]:c.a.t("Username already taken")}}catch(s){return{[Lt]:c.a.t("There was a problem whilst checking the availability of this username")}}}async function Ar(e,t,a){const{group:r,role:s}=t,n=s||r,i=n.modelDefinition.name,o=e[a],l=br()(a);if(!o)return Promise.resolve();try{const e=await wa.genericFind(i,a,o);if(e.size>0){if(e.values().next().value.id!==n.id)return{[a]:c.a.t("{{fieldDisplayName}} is already taken",{fieldDisplayName:l})}}}catch(d){const e=c.a.t("Could not verify if this {{fieldDisplayName}} is unique",{fieldDisplayName:l});return{[a]:ae(d,e)}}}const Rr="replicateUserForm";class Sr extends s.Component{constructor(...e){super(...e),this.replicateUser=async e=>{const{user:t,hideDialog:a}=this.props,{username:r,password:s}=e;try{await wa.replicateUser(t.id,r,s),this.replicateSuccesHandler(t.displayName)}catch(n){this.replicateErrorHandler(n)}a()},this.replicateSuccesHandler=e=>{const{getList:t,showSnackbar:a}=this.props;a({message:c.a.t('User "{{displayName}}" replicated successfuly',{displayName:e})}),t(Kt,!0)},this.replicateErrorHandler=e=>{const{showSnackbar:t}=this.props;t({message:ae(e,c.a.t("There was a problem replicating the user"))})}}render(){const{submitting:e,pristine:t,valid:a,handleSubmit:r,hideDialog:s,asyncValidating:i}=this.props,o=Boolean(e||i||t||!a);return n.a.createElement("form",{autoComplete:"off",onSubmit:r(this.replicateUser)},n.a.createElement(gr.a,{name:Lt,component:mt,label:c.a.t("Username"),hintText:c.a.t("Username for new user"),validate:[ha],autoComplete:"new-password"}),n.a.createElement(gr.a,{name:"password",component:mt,label:c.a.t("Password"),hintText:c.a.t("Password for new user"),validate:[ca],type:"password",autoComplete:"new-password"}),n.a.createElement("div",{style:{marginTop:16}},n.a.createElement(Ne.RaisedButton,{label:c.a.t("Replicate"),type:"submit",disabled:o,primary:!0}),n.a.createElement(Ne.RaisedButton,{label:c.a.t("Cancel"),onClick:s,style:{marginLeft:8}})))}}const Cr=Object(yr.a)({form:Rr,asyncValidate:async function(e,t,a,r){return _r(e,a,r,Tr)},asyncBlurFields:[Lt]})(Sr);var Ir=Object(o.b)(e=>({formState:e.form[Rr]}),{getList:Pa,hideDialog:za,showSnackbar:qa,hideSnackbar:Wa})(Cr);const vr=(e,t)=>{const{currentUser:a}=F.getState();if(!e)return!1;const{access:r,userCredentials:{disabled:s,twoFA:n}}=e;switch(t){case"profile":return r.read;case"edit":return r.update;case"remove":return a.id!==e.id&&r.delete;case"replicate":return r.update&&a.authorities.has("F_REPLICATE_USER");case"disable":return r.update&&!s;case"enable":return r.update&&s;case"disable_2fa":return r.update&&n;default:return!0}},Ur={profile:"account_circle",edit:"edit",remove:"delete",replicate:"content_copy",disable:"block",enable:"playlist_add_check",disable_2fa:"phonelink_erase"},wr=$.Action.createActionsFromNames(["profile","edit","remove","replicate","disable","enable","disable_2fa"]);wr.profile.subscribe(({data:{id:e}})=>{er("/users/view/".concat(e))}),wr.edit.subscribe(({data:{id:e}})=>{er("/users/edit/".concat(e))}),wr.remove.subscribe(({data:e})=>{pr({model:e,entityType:Kt})}),wr.replicate.subscribe(({data:e})=>{const t=n.a.createElement(Ir,{user:e}),a={onRequestClose:()=>F.dispatch(za()),title:c.a.t("Replicate user")};F.dispatch(Qa(t,a))}),wr.disable.subscribe(({data:e})=>{xr(e,!0)}),wr.enable.subscribe(({data:e})=>{xr(e,!1)}),wr.disable_2fa.subscribe(({data:e})=>{Or(e)});const Or=e=>{const t=c.a.t("Are you sure you want to disable two factor authentication for"),a={message:"".concat(t," ").concat(e.displayName),action:c.a.t("Confirm"),autoHideDuration:null,onActionClick:()=>Nr(e)};F.dispatch(qa(a))},Nr=async e=>{F.dispatch(Wa());const{displayName:t,id:a}=e;try{await wa.disable2FA(a);const e=c.a.t("Succesfully disabled two factor authentication for");F.dispatch(qa({message:"".concat(e," ").concat(t)})),F.dispatch(Pa(Kt))}catch(r){F.dispatch(qa({message:ae(r,c.a.t("There was a problem updating two factor authentication"))}))}},xr=(e,t)=>{const a=t?c.a.t("Are you sure you want to disable"):c.a.t("Are you sure you want to enable"),r={message:"".concat(a," ").concat(e.displayName),action:c.a.t("Confirm"),autoHideDuration:null,onActionClick:()=>Fr(e,t)};F.dispatch(qa(r))},Fr=async(e,t)=>{F.dispatch(Wa());const{displayName:a,id:r}=e;try{await wa.updateDisabledState(r,t);const s=t?c.a.t("sucessfully disabled"):c.a.t("successfully enabled");F.dispatch(qa({message:"".concat(a," ").concat(s)})),F.dispatch(Pa(Kt)),t&&ur(e,!0)}catch(s){F.dispatch(qa({message:ae(s,c.a.t("There was a problem updating the enabled state"))}))}};var Dr=a(229),Lr=a.n(Dr),kr=a(1664),Pr=a.n(kr),Mr=a(1665),Gr=a.n(Mr);class Br extends s.Component{constructor(...e){super(...e),this.applyFilter=e=>{const{updateFilter:t,hideDialog:a,getList:r,selectedOrgUnits:s}=this.props;Gr()(e,s)||(t("organisationUnits",e),r(Kt)),a()}}render(){const{selectedOrgUnits:e,hideDialog:t}=this.props;return n.a.createElement(Ue,{orgUnitType:"teiSearchOrganisationUnits",selectedOrgUnits:e,confirmSelection:this.applyFilter,cancel:t})}}var Vr=Object(o.b)(e=>({selectedOrgUnits:e.filter.organisationUnits}),{updateFilter:Ha,hideDialog:za,getList:Pa})(Br);const jr={wrap:{position:"relative",lineHeight:"24px",height:"72px",cursor:"pointer",float:"left",marginRight:"1rem"},icon:{position:"absolute",right:0,top:38,width:20,height:20,color:"rgba(0, 0, 0, 0.3)",cursor:"pointer"},textField:{cursor:"pointer",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",width:"152px"},input:{width:"calc(100% - 20px)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}};class Hr extends s.Component{constructor(...e){super(...e),this.inputRef=n.a.createRef(),this.focusOrgUnitInput=()=>{this.inputRef.current.orgUnitInput.focus()},this.showOrgTreeInDialog=()=>{const{showDialog:e,hideDialog:t}=this.props;e(n.a.createElement(Vr,null),{onRequestClose:t,title:c.a.t("Select an organisation unit"),contentStyle:{minHeight:"100vh"}})}}render(){const{organisationUnits:e}=this.props;return n.a.createElement("div",{style:jr.wrap,onClick:this.focusOrgUnitInput},n.a.createElement(Pr.a,{style:jr.icon}),n.a.createElement(Lr.a,{ref:this.inputRef,style:jr.textField,floatingLabelText:c.a.t("Organisation unit"),onFocus:this.showOrgTreeInDialog,value:e,inputStyle:jr.input}))}}var qr=Object(o.b)(e=>({organisationUnits:It(e.filter.organisationUnits)}),{showDialog:Qa,hideDialog:za})(Hr);const Wr={float:"left",marginRight:"1rem",width:"236px"};class Qr extends s.Component{constructor(e){super(e),this.updateSearchFilter=e=>{const{getList:t,entityType:a,updateFilter:r}=this.props;r("query",e),t(a)},this.onQueryStrChange=e=>{const t=e.target.value;this.setState({localQueryStr:t}),this.updateSearchFilter(t)},this.state={localQueryStr:e.filter.query},this.updateSearchFilter=ye()(this.updateSearchFilter,375)}render(){const{localQueryStr:e}=this.state;return n.a.createElement(W.a,{className:"search-input",floatingLabelText:c.a.t("Search by name"),style:Wr,hintText:"",value:e,type:"search",onChange:this.onQueryStrChange})}}var zr=Object(o.b)(e=>({filter:e.filter}),{getList:Pa,updateFilter:Ha})(Qr);const Yr={float:"left",marginRight:"1rem"},Kr={...Yr,display:"inline-block",float:"left",width:"182px",paddingTop:"37px",height:"35px"};class Xr extends s.Component{constructor(...e){super(...e),this.onFilterChange=(e,t)=>{const{getList:a,entityType:r,updateFilter:s,filter:n}=this.props;n[e]!==t&&(s(e,t),a(r))}}createInactiveMonthsOptions(){const e=c.a.t("month"),t=c.a.t("months");return Array(12).fill().map((a,r)=>{const s=r+1;return{id:s,displayName:1===s?"".concat(s," ").concat(e):"".concat(s," ").concat(t)}})}renderDropDown(e){const t={...e,includeEmpty:!0,emptyLabel:c.a.t("<No value>")};return n.a.createElement($.DropDown,t)}renderInactiveMonthsFilter(){const e={menuItems:this.createInactiveMonthsOptions(),floatingLabelText:c.a.t("Inactivity"),value:this.props.filter.inactiveMonths,onChange:e=>this.onFilterChange("inactiveMonths",e.target.value),style:{...Yr,width:"132px"}};return this.renderDropDown(e)}renderInvitationStatusFilter(){const e={menuItems:[{id:"all",displayName:c.a.t("All invitations")},{id:"expired",displayName:c.a.t("Expired invitations")}],floatingLabelText:c.a.t("Invitations"),value:this.props.filter.invitationStatus,onChange:e=>this.onFilterChange("invitationStatus",e.target.value),style:{...Yr,width:"172px"}};return this.renderDropDown(e)}renderSelfRegisteredFilter(){const e=this.props.filter.selfRegistered,t="".concat("data-table__filter-bar__checkbox","--checked");return n.a.createElement(Ne.Checkbox,{value:e,onCheck:(e,t)=>this.onFilterChange("selfRegistered",t),label:c.a.t("Self registrations"),className:e?t:"data-table__filter-bar__checkbox",style:Kr})}render(){const{entityType:e}=this.props;return n.a.createElement("div",null,n.a.createElement(zr,{entityType:e}),n.a.createElement(qr,null),this.renderInactiveMonthsFilter(),this.renderInvitationStatusFilter(),this.renderSelfRegisteredFilter())}}var Jr=Object(o.b)(e=>({filter:e.filter}),{updateFilter:Ha,getList:Pa})(Xr);var Zr=()=>n.a.createElement(lr,{entityType:Kt,columns:["displayName","userName","lastLogin","disabled"],filterComponent:Jr,primaryAction:wr.edit,contextMenuActions:wr,contextMenuIcons:Ur,isContextActionAllowed:vr,sectionName:c.a.t("User Management"),newItemPath:"/users/new",className:"user-list"}),$r=a(277),es=a(235),ts=a.n(es);var as=({to:e,tooltip:t,icon:a})=>{const r=n.a.createElement(ts.a,{iconClassName:"material-icons",tooltip:t},a);return e?n.a.createElement($r.a,{to:e},r):r},rs=a(805),ss=a.n(rs);class ns extends s.Component{constructor(...e){super(...e),this.fields=[{name:"name",label:c.a.t("Name"),fieldRenderer:mt,isRequiredField:!0},{name:"description",label:c.a.t("Description"),fieldRenderer:mt},{name:"authorities",label:c.a.t("Authorities"),fieldRenderer:ht}],this.saveRole=async(e,t,a)=>{const{role:r,showSnackbar:s,clearItem:n,getList:i}=a,o={...r.toJSON(),name:e.name,description:e.description,authorities:e.authorities};try{await wa.saveRole(o);s({message:c.a.t('User role "{{displayName}}" saved successfully',{displayName:o.name})}),n(),i("userRole"),this.backToList(),ur(r)}catch(l){s({message:ae(l,c.a.t("There was a problem saving the user role."))})}},this.backToList=()=>{er("/user-roles")},this.render=()=>{const{handleSubmit:e,submitting:t,asyncValidating:a,pristine:r,valid:s}=this.props,i=Boolean(t||a||r||!s);return n.a.createElement("main",null,n.a.createElement("form",{autoComplete:"off",onSubmit:e(this.saveRole)},this.renderFields(),n.a.createElement("div",{style:{marginTop:"2rem"}},n.a.createElement(Re.a,{label:c.a.t("Save"),type:"submit",primary:!0,disabled:i,style:{marginRight:"8px"}}),n.a.createElement(Re.a,{label:c.a.t("Cancel"),onClick:this.backToList}))))}}renderFields(){return this.fields.map(e=>{const{name:t,fieldRenderer:a,label:r,isRequiredField:s,...i}=e,o=r+(s?" *":""),l="name"===t?[pa]:[];return n.a.createElement(gr.a,Object.assign({name:t,key:t,component:a,label:o,validate:l},i))})}}const is=Object(yr.a)({form:"roleForm",asyncValidate:async function(e,t,a,r){return _r(e,a,r,Ar)},asyncBlurFields:["name"]})(ns);var os=Object(o.b)(e=>({role:e.currentItem,initialValues:{name:e.currentItem.name,description:e.currentItem.description,authorities:e.currentItem.authorities||[]}}),{clearItem:ja,showSnackbar:qa,getList:Pa})(is);class ls extends s.Component{constructor(e){super(e),this.saveGroup=async(e,t,a)=>{const{group:r,showSnackbar:s,clearItem:n,getList:i}=a,o=!r.id;r[_t]=e[_t],r[Tt]=e[Tt],r.managedGroups=e.managedGroups.map(this.createIdValueObject),r.attributeValues=Aa(e,this.state.attributeFields);try{const e=await wa.saveUserGroup(r.toJSON());if(s({message:c.a.t('User group "{{displayName}}" saved successfully',{displayName:r.name})}),o){const t=e.response.uid;er("/user-groups/edit/".concat(t,"/users"))}else n(),i("userGroup"),this.backToList();ur(r)}catch(l){s({message:ae(l,c.a.t("There was a problem saving the user group."))})}},this.backToList=()=>{er("/user-groups")},this.state={attributeFields:null},this.trashableAttributesPromise=null,this.fields=Rt()}async componentDidMount(){const{group:e,showSnackbar:t,initialize:a}=this.props;this.trashableAttributesPromise=he()(wa.getAttributes("userGroup"));try{const t=_a(await this.trashableAttributesPromise,e.attributeValues);Ta(t,this.props.asyncBlurFields),this.setState({attributeFields:t}),a(wt(e,t))}catch(r){console.error(r),t({message:ae(r,c.a.t("Could not load the user group data. Please refresh the page."))})}}createIdValueObject(e){return{id:"string"===typeof e?e:e.id}}renderFields(e){const{group:t}=this.props;return e.map(e=>{const{name:a,fieldRenderer:r,label:s,isRequiredField:i,isAttributeField:o,fieldValidators:l,...c}=e,d=s+(i?" *":"");return r===ft?ft(e):(r===Et&&(c.availableItemsQuery=wa[c.availableItemsQuery],i&&(c.assignedItemsLabel+=" *"),c.initialValues=e.initialItemsSelector(t)),c.validate=function(e,t,a,r,s){const n=[],i=r&&a;return t===_t&&n.push(pa),t===Tt&&n.push(ra),i&&n.push(pa),r&&s&&n.push(...s),n}(this.props,a,i,o,l),n.a.createElement(gr.a,Object.assign({name:a,key:a,component:r,label:d,validate:[]},c)))})}render(){const{handleSubmit:e,submitting:t,asyncValidating:a,pristine:r,valid:s}=this.props,{attributeFields:i}=this.state,o=Boolean(t||a||r||!s);return i?n.a.createElement("main",null,n.a.createElement("form",{autoComplete:"off",onSubmit:e(this.saveGroup)},this.renderFields(this.fields),this.renderFields(i),n.a.createElement("div",{style:{marginTop:"2rem"}},n.a.createElement(Re.a,{label:c.a.t("Save"),type:"submit",primary:!0,disabled:o,style:{marginRight:"8px"}}),n.a.createElement(Re.a,{label:c.a.t("Cancel"),onClick:this.backToList})))):n.a.createElement("div",{style:At.loaderWrap},n.a.createElement(de.a,null))}}const cs=Object(yr.a)({form:"groupForm",asyncValidate:fr,asyncBlurFields:[_t,Tt]})(ls);var ds=Object(o.b)(e=>({group:e.currentItem}),{clearItem:ja,showSnackbar:qa,getList:Pa})(cs),us=a(237),ps=a.n(us),ms=a(273),hs=a.n(ms);var gs=Object(o.b)(e=>({group:e.currentItem}),{clearItem:ja,showSnackbar:qa,getList:Pa})(({group:e,isMemberMode:t,selectedUsers:a,...r})=>{const[i,o]=Object(s.useState)(!1),l=()=>o(!1),d=c.a.t("{{action}} {{count}} users",{action:t?c.a.t("Remove"):c.a.t("Add"),count:a.length}),u=c.a.t("Please confirm {{action}} of {{count}} users",{action:t?"removal":"addition",count:a.length}),p=[n.a.createElement(ps.a,{key:"cancel",label:c.a.t("Cancel"),onClick:l}),n.a.createElement(ps.a,{key:"confirm",keyboardFocused:!0,label:c.a.t("Confirm"),primary:!0,onClick:async()=>{l();try{await wa.updateUserGroupMembership(e.id,a,t);const s=c.a.t('Successfully {{action}} {{count}} users form user group "{{displayName}}"',{action:t?c.a.t("removed"):c.a.t("added"),count:a.length,displayName:e.name});r.showSnackbar({message:s}),r.clearItem(),r.getList("userGroup"),er("/user-groups"),ur(e)}catch(s){qa({message:ae(s,c.a.t("There was a problem updating the user group memberships."))})}}})];return n.a.createElement(n.a.Fragment,null,n.a.createElement(Re.a,{label:d,primary:!0,onClick:()=>o(!0)}),n.a.createElement(hs.a,{title:c.a.t("Confirmation"),actions:p,open:i,onRequestClose:l},u))});function ys({callback:e}){const[t,a]=Object(s.useState)(""),r=Object(s.useRef)(ye()(t=>e(t),400));return Object(s.useEffect)(()=>r.current(t),[t]),n.a.createElement(Ne.TextField,{value:t,onChange:e=>a(e.target.value),floatingLabelText:c.a.t("Search users"),type:"search",style:{marginRight:16}})}var Es=a(274),bs=a.n(Es);function fs({onChange:e,value:t}){return n.a.createElement(bs.a,{value:t,onChange:(t,a,r)=>{e(r)},floatingLabelText:c.a.t("Membership")},n.a.createElement(J.a,{key:"ALL",value:"ALL",primaryText:c.a.t("All users")}),n.a.createElement(J.a,{key:"MEMBER",value:"MEMBER",primaryText:c.a.t("Group members")}),n.a.createElement(J.a,{key:"NON_MEMBER",value:"NON_MEMBER",primaryText:c.a.t("Non members")}))}var _s=a(490),Ts=a(1670),As=a.n(Ts);function Rs({users:e,loading:t,error:a,selectable:r,selectedUsers:s,setSelectedUsers:i}){const o=new Set(s),l=!r||e&&0===e.length?As.a.noCheckBox:void 0,d=e&&e.length===s.length;return n.a.createElement("div",{className:As.a.container},n.a.createElement(_s.Table,{selectable:r,multiSelectable:r,onRowSelection:t=>{let a;a="all"===t?e.map(({id:e})=>e):"none"===t||d?[]:t.map(t=>e[t].id),i(a)}},n.a.createElement(_s.TableHeader,null,n.a.createElement(_s.TableRow,{className:l},n.a.createElement(_s.TableHeaderColumn,null,c.a.t("Name")),n.a.createElement(_s.TableHeaderColumn,null,c.a.t("Username")),n.a.createElement(_s.TableHeaderColumn,null))),e&&n.a.createElement(_s.TableBody,{deselectOnClickaway:!1,className:As.a.tablebody,displayRowCheckbox:r},e.map(e=>n.a.createElement(_s.TableRow,{selected:o.has(e.id),key:e.id},n.a.createElement(_s.TableRowColumn,null,e.displayName),n.a.createElement(_s.TableRowColumn,null,e.username),n.a.createElement(_s.TableRowColumn,null,n.a.createElement(ps.a,{label:c.a.t("Edit"),onClick:()=>er("/users/edit/".concat(e.id))})))))),a&&n.a.createElement(te,{introText:c.a.t("There was a problem retrieving the user list"),errorMessage:a.message}),t&&n.a.createElement("div",{className:As.a.addition},n.a.createElement(de.a,null)),e&&0===e.length&&n.a.createElement("div",{className:As.a.addition},c.a.t("No results found")))}function Ss(e,{type:t,payload:a}){switch(t){case"SET_FILTER_STATUS":return{...e,page:1,filterStatus:a};case"SET_FILTER_STRING":return{...e,page:1,filterStr:a};case"SET_SELECTED_USERS":return{...e,selectedUsers:a};case"SET_PAGE":return{...e,page:a};case"LOADING":return{...e,data:{},error:null,loading:!0,selectedUsers:[]};case"USERS_RECEIVED":return{...e,data:a,error:null,loading:!1};case"USER_ERRORED":return{...e,data:{},error:a,loading:!1};default:return e}}function Cs(e){return{setFilterStatus:t=>{e({type:"SET_FILTER_STATUS",payload:t})},setFilterString:t=>{e({type:"SET_FILTER_STRING",payload:t})},setSelectedUsers:t=>{e({type:"SET_SELECTED_USERS",payload:t})},setPage:t=>{e({type:"SET_PAGE",payload:t})}}}function Is(e){const{params:{id:t}}=Object(Oa.f)(),[a,r]=Object(s.useReducer)(Ss,e),{page:n,filterStr:i,filterStatus:o}=a;return function({id:e,dispatch:t,page:a,filterStr:r,filterStatus:n}){Object(s.useEffect)(()=>{t({type:"LOADING"});const s=[];r&&s.push("identifiable:token:".concat(r)),"MEMBER"===n?s.push("userGroups.id:in:[".concat(e,"]")):"NON_MEMBER"===n&&s.push("userGroups.id:!in:[".concat(e,"]")),wa.getUserGroupUsers(a,s).then(({pager:e,users:a})=>{t({type:"USERS_RECEIVED",payload:{pager:e,users:a.map(e=>({displayName:e.displayName,id:e.id,username:e.userCredentials.username}))}})}).catch(e=>{t({type:"USER_ERRORED",payload:e})})},[a,r,n])}({dispatch:r,page:n,filterStr:i,filterStatus:o,id:t}),{state:a,actions:Cs(r)}}var vs=a(1671),Us=a.n(vs);const ws={data:{},page:1,error:null,loading:!0,filterStr:"",filterStatus:"MEMBER",selectedUsers:[]};function Os(){const{state:e,actions:t}=Is(ws),a="ALL"!==e.filterStatus,r=n.a.createElement(nr,{decrementPage:()=>t.setPage(e.page-1),incrementPage:()=>t.setPage(e.page+1),pager:e.data.pager});return n.a.createElement("div",null,n.a.createElement("div",{className:Us.a.toolbar},n.a.createElement("div",{className:Us.a.left},n.a.createElement(ys,{callback:t.setFilterString}),n.a.createElement(fs,{value:e.filterStatus,onChange:t.setFilterStatus})),n.a.createElement("div",{className:Us.a.right},a&&e.selectedUsers.length>0&&n.a.createElement(gs,{isMemberMode:"MEMBER"===e.filterStatus,selectedUsers:e.selectedUsers}),r)),n.a.createElement(Rs,{users:e.data&&e.data.users,selectedUsers:e.selectedUsers,selectable:a,loading:e.loading,error:e.error,setSelectedUsers:t.setSelectedUsers}),r)}var Ns=a(1672),xs=a.n(Ns);var Fs=function(){const{path:e,url:t,params:{id:a}}=Object(Oa.f)();return!a?n.a.createElement(ds,null):n.a.createElement(n.a.Fragment,null,n.a.createElement("nav",{className:xs.a.tabbar},n.a.createElement($r.b,{exact:!0,className:xs.a.tab,to:t},c.a.t("Group settings")),n.a.createElement($r.b,{exact:!0,className:xs.a.tab,to:"".concat(t,"/users")},c.a.t("Users"))),n.a.createElement("div",{className:xs.a.content},n.a.createElement(Oa.c,null,n.a.createElement(Oa.a,{exact:!0,path:e},n.a.createElement(ds,null)),n.a.createElement(Oa.a,{exact:!0,path:"".concat(e,"/users")},n.a.createElement(Os,null)))))},Ds=a(1788),Ls=a(744),ks=a.n(Ls),Ps=a(745),Ms=a.n(Ps);const Gs={...r,userRoles:ma,organisationUnits:ma},Bs=new Set([Lt,"password","repeatPassword","surname","firstName"]),Vs=new Set(["email","surname","firstName"]),js=new Set(["surname","firstName"]);class Hs extends s.Component{constructor(e){super(e),this.toggleShowMore=()=>{this.setState({showMore:!this.state.showMore})},this.handleSubmit=async(e,t,a)=>{const{user:r,inviteUser:s,showSnackbar:n,clearItem:i,getList:o}=a,l=this.state.locales.ui.selected,d=this.state.locales.db.selected;try{await wa.saveOrInviteUser(e,r,s,l,d,this.state.attributeFields);n({message:c.a.t('User "{{displayName}}" saved successfully',{displayName:"".concat(e.firstName," ").concat(e.surname)})}),i(),o(Kt),this.backToList(),ur(r)}catch(u){console.error(u),n({message:ae(u,c.a.t("There was a problem saving the user."))})}},this.backToList=()=>{er("/users")},this.state={showMore:!1,locales:null,attributeFields:null},this.trashableAttributesPromise=null,this.trashableLocalePromise=null,this.inviteFields=[{name:kt,label:c.a.t("Create account or email invitation"),fieldRenderer:yt,options:[{id:Qt,label:c.a.t("Create account with user details")},{id:zt,label:c.a.t("Email invitation to create account")}],props:{style:{}}}],this.baseFields=[{name:Lt,label:c.a.t("Username"),fieldRenderer:mt,isRequiredField:"CREATE_REQUIRED"},{name:"email",label:c.a.t("E-mail"),fieldRenderer:mt,isRequiredField:"INVITE_REQUIRED"},{name:Pt,label:c.a.t("External authentication only (OpenID or LDAP)"),fieldRenderer:gt},{name:"disabled",label:c.a.t("Disabled"),fieldRenderer:gt},{name:"password",label:c.a.t("Password"),fieldRenderer:mt,isRequiredField:"CREATE_REQUIRED",props:{type:"password",autoComplete:"new-password"}},{name:"repeatPassword",label:c.a.t("Retype password"),fieldRenderer:mt,isRequiredField:"CREATE_REQUIRED",props:{type:"password",autoComplete:"new-password"}},{name:"surname",label:c.a.t("Surname"),isRequiredField:"ALWAYS_REQUIRED",fieldRenderer:mt},{name:"firstName",label:c.a.t("First name"),isRequiredField:"ALWAYS_REQUIRED",fieldRenderer:mt},{name:Mt,label:c.a.t("OpenID"),fieldRenderer:mt},{name:Gt,label:c.a.t("LDAP identifier"),fieldRenderer:mt},{name:"phoneNumber",label:c.a.t("Mobile phone number"),fieldRenderer:mt},{name:"whatsApp",label:c.a.t("WhatsApp"),fieldRenderer:mt},{name:"facebookMessenger",label:c.a.t("Facebook Messenger"),fieldRenderer:mt},{name:"skype",label:c.a.t("Skype"),fieldRenderer:mt},{name:"telegram",label:c.a.t("Telegram"),fieldRenderer:mt},{name:"twitter",label:c.a.t("Twitter"),fieldRenderer:mt},{name:Bt,label:c.a.t("Interface language"),fieldRenderer:yt,optionsSelector:"locales.ui.available",isRequiredField:"ALWAYS_REQUIRED"},{name:Vt,label:c.a.t("Database language"),fieldRenderer:yt,optionsSelector:"locales.db.available",isRequiredField:"ALWAYS_REQUIRED"},{name:"userRoles",fieldRenderer:Et,isRequiredField:"ALWAYS_REQUIRED",initialItemsSelector:e=>B(V("userCredentials.userRoles",e)||[]),availableItemsQuery:"getAvailableUserRoles",availableItemsLabel:c.a.t("Available roles"),assignedItemsLabel:c.a.t("Selected roles")},{name:jt,label:c.a.t("Data capture and maintenance organisation units"),isRequiredField:"ALWAYS_REQUIRED",orgUnitType:jt,fieldRenderer:bt,wrapperStyle:{...Dt.orgUnitTree,paddingRight:"60px"}},{name:"dataViewOrganisationUnits",label:c.a.t("Data output and analytic organisation units"),orgUnitType:"dataViewOrganisationUnits",fieldRenderer:bt,wrapperStyle:{...Dt.orgUnitTree,paddingLeft:"60px"}},{...Yt(),name:"org_unit_info_1"}],this.additionalFields=[{name:"teiSearchOrganisationUnits",label:c.a.t("Search Organisation Units"),orgUnitType:"teiSearchOrganisationUnits",fieldRenderer:bt,wrapperStyle:{...Dt.orgUnitTree,paddingRight:"60px"}},{...Yt(),name:"org_unit_info_2"},{name:"userGroups",fieldRenderer:Et,initialItemsSelector:e=>B(e.userGroups)||[],availableItemsQuery:"getAvailableUserGroups",availableItemsLabel:c.a.t("Available user groups"),assignedItemsLabel:c.a.t("Selected user groups")},{name:Ht,fieldRenderer:Et,initialItemsSelector:e=>Ot(e),availableItemsQuery:"getAvailableDataAnalyticsDimensionRestrictions",availableItemsLabel:c.a.t("Available dimension restrictions for data analytics"),assignedItemsLabel:c.a.t("Selected dimension restrictions for data analytics"),returnModelsOnUpdate:!0}]}async componentDidMount(){const{user:e,showSnackbar:t,initialize:a}=this.props,r=e.id?e.userCredentials.username:null;this.trashableLocalePromise=he()(wa.getSelectedAndAvailableLocales(r)),this.trashableAttributesPromise=he()(wa.getAttributes(Kt));try{const t=await this.trashableLocalePromise,r=_a(await this.trashableAttributesPromise,e.attributeValues);Ta(r,this.props.asyncBlurFields),this.setState({locales:t,attributeFields:r}),a(Ut(e,t,r))}catch(s){console.error(s),t({message:ae(s,c.a.t("Could not load the user data. Please refresh the page."))})}}componentWillUnmount(){this.trashableLocalePromise.trash(),this.trashableAttributesPromise.trash()}getLabelText(e,t,a){const{inviteUser:r}=this.props;return"ALWAYS_REQUIRED"===a||r&&"INVITE_REQUIRED"===a||"CREATE_REQUIRED"===a&&!t.id&&!r||"boolean"===typeof a&&a?"".concat(e," *"):e}prepareGroupEditor(e,t,a,r){e.assignedItemsLabel=this.getLabelText(e.assignedItemsLabel,a,r),e.availableItemsQuery=wa[e.availableItemsQuery],e.initialValues=t.initialItemsSelector(a)}exludeField(e){const{user:t,inviteUser:a,externalAuthOnly:r}=this.props;return!(this.context.d2.system.systemInfo.emailConfigured&&!t.id||e!==kt)||(!(!a&&!r||"password"!==e&&"repeatPassword"!==e)||!(!a||![Pt,Mt,Gt].includes(e)))}renderFields(e){const{user:t}=this.props;return e.reduce((e,a)=>{const{name:r,fieldRenderer:s,label:i,isRequiredField:o,isAttributeField:l,fieldValidators:c,...d}=a,u=this.getLabelText(i,t,o);if(this.exludeField(r))return e;if(s===ft)return e.push(ft(a)),e;switch(s){case mt:d.hintText||(d.hintText=i),d.disabled=Boolean(r===Lt&&t.id);break;case bt:d.initialValues=B(t[a.name]);break;case Et:this.prepareGroupEditor(d,a,t,o);break;case yt:d.options=a.optionsSelector?V(a.optionsSelector,this.state):a.options}return d.validate=function(e,t,a,r,s){const n=[],i=Boolean(e.user.id),o=r&&a,l=Gs[t],c=!r&&i?js.has(t):e.inviteUser?Vs.has(t):Bs.has(t);return l&&n.push(l),(o||c)&&n.push(pa),r&&s&&n.push(...s),n}(this.props,r,o,l,c),e.push(n.a.createElement(gr.a,Object.assign({name:r,key:r,component:s,label:u},d))),e},[])}renderCreateOrInviteField(){return this.renderFields(this.inviteFields)}renderAttributeFields(){return this.renderFields(this.state.attributeFields)}renderBaseFields(){return this.renderFields(this.baseFields)}renderAdditionalFields(e){return e?n.a.createElement("div",{style:Dt.additionalFieldsWrap},this.renderFields(this.additionalFields)):null}renderToggler(e){const t=e?c.a.t("Show fewer options"):c.a.t("Show more options"),a=e?n.a.createElement(ks.a,null):n.a.createElement(Ms.a,null);return n.a.createElement("div",{style:Dt.togglerWrap},n.a.createElement(ps.a,{onClick:this.toggleShowMore,label:t,style:Dt.toggler,icon:a}))}render(){const{handleSubmit:e,submitting:t,asyncValidating:a,pristine:r,valid:s,inviteUser:i}=this.props,{showMore:o,locales:l}=this.state,d=Boolean(t||a||r||!s),u=!0===i?c.a.t("Send invite"):c.a.t("Save");return l?n.a.createElement("main",null,n.a.createElement("form",{autoComplete:"off",onSubmit:e(this.handleSubmit)},this.renderCreateOrInviteField(),this.renderBaseFields(),this.renderAttributeFields(),this.renderAdditionalFields(o),this.renderToggler(o),n.a.createElement("div",null,n.a.createElement(Re.a,{label:u,type:"submit",primary:!0,disabled:d,style:{marginRight:"8px"}}),n.a.createElement(Re.a,{label:c.a.t("Cancel"),onClick:this.backToList})))):n.a.createElement("div",{style:Dt.loaderWrap},n.a.createElement(de.a,null))}}Hs.contextTypes={d2:Oe.a.object.isRequired};const qs=Object(Ds.a)("userForm"),Ws=Object(yr.a)({form:"userForm",asyncValidate:fr,asyncBlurFields:[Lt]})(Hs);var Qs=Object(o.b)(e=>({user:e.currentItem,fallbackOrgUnits:e.currentUser[jt],inviteUser:Ft(e.form.userForm),externalAuthOnly:Boolean(qs(e,Pt))}),{clearItem:ja,showSnackbar:qa,getList:Pa})(Ws);const zs={main:{width:"100%",paddingLeft:"2rem"},heading:{paddingBottom:"1rem"},paper:{padding:"2rem 5rem 4rem"}};class Ys extends s.Component{componentDidMount(){const{match:{params:{id:e}},item:t,getItem:a,initNewItem:r,entityType:s}=this.props;!e||t&&t.id===e?e||r(s):a(s,e),this.formNotFoundErrorMsg=c.a.t("There was an error getting the form:")}renderForm(){const{entityType:e}=this.props;switch(e){case Kt:return n.a.createElement(Qs,null);case"userRole":return n.a.createElement(os,null);case"userGroup":return n.a.createElement(Fs,null);default:return n.a.createElement(te,{introText:this.formNotFoundErrorMsg,errorMessage:""})}}renderHeader(){const{match:{params:{id:e}},item:t,shortItem:a,entityType:r}=this.props,s=t&&t.id===e?t:a,i=s?s.modelDefinition.displayName:br()(r),o=s?s.displayName:"",l="".concat(c.a.t("Update")," ").concat(i,": ").concat(o),d="".concat(c.a.t("Create new")," ").concat(i),u=e?l:d,p=s?"/".concat(ss()(s.modelDefinition.plural)):null,m="".concat(c.a.t("Back to")," ").concat(i,"s");return n.a.createElement($.Heading,{style:zs.heading},n.a.createElement(as,{to:p,tooltip:m,disabled:Boolean(p),icon:"arrow_back"}),u)}renderContent(){const{match:{params:{id:e}},item:t}=this.props;return"string"===typeof t?n.a.createElement(te,{introText:this.formNotFoundErrorMsg,errorMessage:t}):!t||t&&t.id!==e?n.a.createElement("div",{style:{textAlign:"center",paddingTop:"2rem"}},n.a.createElement(Ne.CircularProgress,null)):this.renderForm()}render(){return n.a.createElement("main",{style:zs.main},this.renderHeader(),n.a.createElement(Ne.Paper,{style:this.props.unPadded?null:zs.paper},this.renderContent()))}}var Ks=Object(o.b)((e,t)=>({item:e.currentItem,shortItem:Nt(t.match.params.id,e.list.items)}),{getItem:Ga,initNewItem:e=>{const t=wa.getD2().models[e].create();return La("INIT_NEW_ITEM",t)}})(Ys);var Xs=(e,t)=>{const a=wa.getD2().currentUser.userSettings.settings.keyUiLocale,r=new Date(e),s={day:"numeric",month:"long",year:"numeric"},n=t?{...s,hour:"2-digit",minute:"2-digit"}:s;return new Intl.DateTimeFormat(a,n).format(r)},Js=a(1673),Zs=a.n(Js),$s=a(1674),en=a.n($s);const tn={main:{width:"100%",paddingLeft:"2rem"},heading:{paddingBottom:"1rem"},raisedButton:{height:"36px",transform:"translateY(10px)",float:"right",marginLeft:"1rem"},paper:{padding:"1.4rem"},cell:{fontSize:"1rem",padding:"0.8rem",verticalAlign:"top"},valueCell:{textAlign:"right",color:"#757575"}};class an extends s.Component{componentDidMount(){const{baseName:e,routeId:t,getItem:a}=this.props;a(e,t)}getLabelForEntity(e){switch(e){case Kt:return c.a.t("Edit user");case"userGroup":return c.a.t("Edit user group");case"userRole":return c.a.t("Edit user role");default:return""}}renderSendMessageBtn(e){const t="".concat(wa.getContextPath(),"/dhis-web-messaging/#/PRIVATE/create/").concat(e);return n.a.createElement(Re.a,{style:tn.raisedButton,label:c.a.t("Send message"),secondary:!0,containerElement:n.a.createElement("a",{href:t}," "),icon:n.a.createElement(en.a,null)})}renderPropertyFields(){const{summaryObject:e,config:t}=this.props,a={...tn.cell,...tn.valueCell};return t.map((t,r)=>{const{key:s,removeText:i,parseDate:o,parseDateTime:l,nestedPropselector:d,parseArrayAsCommaDelimitedString:u,count:p}=t;let{label:m}=t;m=c.a.t(m);let h=e[s];return"undefined"===typeof h?h="":(d&&d.forEach(e=>{h=h[e]}),u&&("function"===typeof h.toArray&&(h=h.toArray()),h=h.map(e=>e[u]).join(", ")),i&&(h=br()(h.replace(i,""))),(o||l)&&"string"===typeof h&&(h=Xs(h,l)),p&&("number"===typeof h.size?h=h.size:"number"===typeof h.length&&(h=h.length))),n.a.createElement("tr",{key:r},n.a.createElement("td",{style:a},m),n.a.createElement("td",{style:tn.cell},h))})}render(){const{summaryObject:e,baseName:t}=this.props;if(null===e)return n.a.createElement($.LoadingMask,null);if("string"===typeof e){const a=c.a.t("There was an error fetching the ".concat(t));return n.a.createElement(te,{introText:a,errorMessage:e})}const{id:a,displayName:r,access:s}=e,i="".concat(t,"s"),o="/".concat(ss()(i)),l=c.a.t("Back to ".concat(i)),d="".concat(o,"/edit/").concat(a),u=this.getLabelForEntity(t);return n.a.createElement("main",{style:tn.main},n.a.createElement($.Heading,{style:tn.heading},n.a.createElement(as,{to:o,tooltip:l,icon:"arrow_back"}),r,s.update?n.a.createElement(Re.a,{style:tn.raisedButton,label:u,primary:!0,containerElement:n.a.createElement($r.a,{to:d}),icon:n.a.createElement(Zs.a,null)}):null,t===Kt?this.renderSendMessageBtn(a):null),n.a.createElement(Ne.Paper,{style:tn.paper},n.a.createElement("table",null,n.a.createElement("tbody",null,this.renderPropertyFields()))))}}var rn=Object(o.b)(e=>({summaryObject:e.currentItem}),{getItem:Ga})(an);const sn=()=>[{key:"displayName",label:c.a.t("Display name")},{key:"id",label:c.a.t("ID")}];var nn=({match:{params:{id:e}}})=>n.a.createElement(rn,{routeId:e,config:[...sn(),{key:"userCredentials",nestedPropselector:["lastLogin"],label:c.a.t("Last login"),parseDateTime:!0},{key:"created",label:c.a.t("Created"),parseDate:!0},{key:"surname",label:c.a.t("Surname")},{key:"firstName",label:c.a.t("First name")},{key:"introduction",label:c.a.t("Introduction")},{key:"jobTitle",label:c.a.t("Job title")},{key:"employer",label:c.a.t("Works at")},{key:"education",label:c.a.t("Education")},{key:"interests",label:c.a.t("Interests")},{key:"nationality",label:c.a.t("Nationality")},{key:"birthday",label:c.a.t("Birthday"),parseDate:!0},{key:"gender",label:c.a.t("Gender"),removeText:"gender_"},{key:"languages",label:c.a.t("Speaks")},{key:"email",label:c.a.t("E-mail")},{key:"phoneNumber",label:c.a.t("Mobile phone number")},{key:"organisationUnits",label:c.a.t("Organisations units"),parseArrayAsCommaDelimitedString:"displayName"},{key:"userCredentials",label:c.a.t("User roles"),nestedPropselector:["userRoles"],parseArrayAsCommaDelimitedString:"displayName"}],baseName:Kt});const on={width:"100%",textAlign:"center",padding:"1.5rem 1.5rem 1rem"};var ln=({location:e})=>n.a.createElement("div",{style:on},n.a.createElement("h1",null,c.a.t("Page not found.")),n.a.createElement("h3",null,c.a.t("No match for"),n.a.createElement("code",null," ",e.pathname)),n.a.createElement($r.a,{to:"/"}," ",c.a.t("Go back home"))),cn=a(742),dn=a.n(cn),un=a(369),pn=a.n(un),mn=a(370),hn=a.n(mn),gn=a(371),yn=a.n(gn),En=a(418),bn=a.n(En);const fn={padding:"0",margin:".5rem",marginTop:"1rem",float:"left",width:"230px"},_n={padding:"1rem",height:"auto",borderBottom:"1px solid #ddd",cursor:"pointer",fontWeight:"bold"},Tn={height:"85px",padding:".5rem 1rem"},An={textAlign:"right"};class Rn extends s.Component{constructor(...e){super(...e),this.renderCard=(e,t)=>{const{currentUser:a,models:r}=this.context.d2,s=a.canCreate(r[e.entityType]),i=a.canDelete(r[e.entityType]),o=s||i;return o?n.a.createElement(dn.a,{key:"card-".concat(t),style:fn},n.a.createElement(pn.a,{onClick:()=>er(e.path),style:_n,title:e.label}),n.a.createElement(hn.a,{style:Tn},e.description),n.a.createElement(yn.a,{style:An},this.renderActionButtons(e,o,s))):null}}renderActionButtons(e,t,a){const r=[],s="".concat(e.path,"/new");return a&&r.push(n.a.createElement(bn.a,{key:"add",iconClassName:"material-icons",tooltip:c.a.t("Add"),tooltipPosition:"top-center",onClick:()=>er(s)},"\ue145")),t&&r.push(n.a.createElement(bn.a,{key:"list",iconClassName:"material-icons",tooltip:c.a.t("list"),tooltipPosition:"top-center",onClick:()=>er(e.path)},"\ue8ef")),r}render(){const e=Bn().map(this.renderCard);return 0===e.length?n.a.createElement("div",null,c.a.t("You do not have access to any section of the DHIS 2 User Management App")):e}}Rn.contextTypes={d2:Oe.a.object};var Sn=Rn;const Cn=(e,t)=>{if(!e)return!1;const{access:a}=e;switch(t){case"show_details":return a.read;case"sharing_settings":return a.manage;case"edit":return a.update;case"remove":return a.delete;default:return!0}},In={show_details:"info",sharing_settings:"share",edit:"edit",remove:"delete"},vn=$.Action.createActionsFromNames([["show_details"],["sharing_settings"],["edit"],["remove"]]);vn.show_details.subscribe(({data:{id:e}})=>{er("/user-roles/view/".concat(e))}),vn.sharing_settings.subscribe(hr),vn.edit.subscribe(({data:{id:e}})=>{er("/user-roles/edit/".concat(e))}),vn.remove.subscribe(({data:e})=>{pr({model:e,entityType:"userRole"})});var Un=()=>n.a.createElement(lr,{entityType:"userRole",filterComponent:zr,columns:["displayName","description"],primaryAction:vn.edit,contextMenuActions:vn,contextMenuIcons:In,isContextActionAllowed:Cn,sectionName:c.a.t("User Role Management"),newItemPath:"/user-roles/new",className:"role-list"});var wn=({match:{params:{id:e}}})=>n.a.createElement(rn,{routeId:e,config:[...sn(),{key:"users",label:c.a.t("Members"),count:!0}],baseName:"userRole"});const On=(e,t)=>{if(!e)return!1;const{access:a}=e;switch(t){case"show_details":return a.read;case"sharing_settings":return a.manage;case"edit":return a.update;case"join_group":return a.update&&!e.currentUserIsMember;case"leave_group":return a.update&&e.currentUserIsMember;case"remove":return a.delete;default:return!0}},Nn={show_details:"info",sharing_settings:"share",edit:"edit",join_group:"group_add",leave_group:"exit_to_app",remove:"delete"},xn=$.Action.createActionsFromNames(["show_details","sharing_settings","edit","join_group","leave_group","remove"]),Fn=async({displayName:e,id:t},a)=>{try{await wa.updateCurrentUserGroupMembership(t,a);const r=a?c.a.t("You left group"):c.a.t("You joined group");F.dispatch(qa({message:"".concat(r," ").concat(e)})),F.dispatch(Va())}catch(r){F.dispatch(qa({message:ae(r,c.a.t("There was a problem updating your group membership"))}))}};xn.show_details.subscribe(({data:{id:e}})=>{er("/user-groups/view/".concat(e))}),xn.sharing_settings.subscribe(hr),xn.edit.subscribe(({data:{id:e}})=>{er("/user-groups/edit/".concat(e))}),xn.join_group.subscribe(({data:e})=>{Fn(e,!1)}),xn.leave_group.subscribe(({data:e})=>{Fn(e,!0)}),xn.remove.subscribe(({data:e})=>{pr({model:e,entityType:"userGroup"})});class Dn extends s.Component{render(){return n.a.createElement(lr,{entityType:"userGroup",filterComponent:zr,columns:["displayName","currentUserIsMember"],primaryAction:xn.edit,contextMenuActions:xn,contextMenuIcons:Nn,isContextActionAllowed:On,sectionName:c.a.t("User Group Management"),newItemPath:"/user-groups/new",className:"group-list"})}}var Ln=Dn;var kn=({match:{params:{id:e}}})=>n.a.createElement(rn,{routeId:e,config:[...sn(),{key:"users",label:c.a.t("Number of users"),count:!0}],baseName:"userGroup"});const Pn=()=>({key:"user_section",label:c.a.t("User"),icon:"person",path:"/users",description:c.a.t("Create, modify, view and delete Users"),component:Zr,entityType:Kt}),Mn=()=>({key:"user_role_section",label:c.a.t("User role"),icon:"folder_shared",path:"/user-roles",description:c.a.t("Create, modify, view and delete User Roles"),component:Un,entityType:"userRole"}),Gn=()=>({key:"user_group_section",label:c.a.t("User group"),icon:"group",path:"/user-groups",description:c.a.t("Create, modify, view and delete User Groups"),component:Ln,entityType:"userGroup"}),Bn=(()=>{let e=null;return()=>(e||(e=[Pn(),Mn(),Gn()]),e)})();var Vn=(()=>{let e=null;return()=>(e||(e=[{key:"user_new_view",path:"/users/new",render:e=>n.a.createElement(Ks,Object.assign({entityType:Kt},e)),entityType:Kt},{key:"user_edit_view",path:"/users/edit/:id",render:e=>n.a.createElement(Ks,Object.assign({entityType:Kt},e)),entityType:Kt},{key:"user_profile_view",path:"/users/view/:id",component:nn,entityType:Kt},Pn(),{key:"user_role_new_view",path:"/user-roles/new",render:e=>n.a.createElement(Ks,Object.assign({entityType:"userRole"},e)),entityType:"userRole"},{key:"user_role_edit_view",path:"/user-roles/edit/:id",render:e=>n.a.createElement(Ks,Object.assign({entityType:"userRole"},e)),entityType:"userRole"},{key:"user_role_details_view",path:"/user-roles/view/:id",component:wn,entityType:"userRole"},Mn(),{key:"user_group_new_view",path:"/user-groups/new",render:e=>n.a.createElement(Ks,Object.assign({entityType:"userGroup"},e)),entityType:"userGroup"},{key:"user_group_edit_view",path:"/user-groups/edit/:id",render:e=>n.a.createElement(Ks,Object.assign({unPadded:!0,entityType:"userGroup"},e)),entityType:"userGroup",hasNestedRoutes:!0},{key:"user_group_details_view",path:"/user-groups/view/:id",component:kn,entityType:"userGroup"},Gn(),{key:"landing_page",path:"/",component:Sn},{key:"not_found",component:ln}]),e)})();const jn={display:"flex",flex:"0 0 320px"};class Hn extends s.Component{constructor(...e){super(...e),this.changeSectionHandler=e=>{const{sections:t,history:a}=this.props,r=t.find(t=>t.key===e);a.push(r.path)}}render(){const{sections:e,location:{pathname:t}}=this.props,a=e.find(e=>e.path===t),r="/"===t,s=a?a.key:null;return a||r?n.a.createElement("div",{style:jn},n.a.createElement($.Sidebar,{sections:e,onChangeSection:this.changeSectionHandler,currentSection:s})):null}}var qn=Object(Oa.g)(Hn);const Wn={display:"flex",flex:"1 1 0%",paddingRight:"2rem",paddingTop:"1rem"};class Qn extends s.Component{componentDidMount(){const{initCurrentUser:e,currentUser:t}=this.props;t?this.setRouteConfig(t):e()}componentWillReceiveProps({currentUser:e,location:{pathname:t}}){this.setRouteConfig(e),e&&e!==this.props.currentUser&&"/"!==t&&!this.pathHasAvailableSection(t)&&er("/")}pathHasAvailableSection(e){if(!this.routeConfig)return!1;const{sections:t}=this.routeConfig;return Boolean(t&&t.find(t=>e.includes(t.path.split(":")[0])))}setRouteConfig(e){this.routeConfig=e?Vn().reduce((t,a)=>{const{routes:r,sections:s}=t;return this.userHasAuthorities(a,e)&&(r.push(a),a.label&&s.push(a)),t},{routes:[],sections:[]}):null}userHasAuthorities({entityType:e},t){if(!e)return!0;const{models:a}=this.context.d2,r=t.canCreate(a[e]),s=t.canDelete(a[e]);return r||s}renderRoutes(e){return e.map(e=>n.a.createElement(Oa.a,Object.assign({key:e.key,exact:!e.hasNestedRoutes,strict:!0},e)))}renderContent(){const{currentUser:e}=this.props;if(!e)return n.a.createElement($.LoadingMask,null);if("string"===typeof e){const t=c.a.t("There was an error loading the current user");return n.a.createElement(te,{introText:t,errorMessage:e})}const{routes:t,sections:a}=this.routeConfig;if(a&&0===a.length){const e=c.a.t("You do not have authorities to see users, user roles or user groups");return n.a.createElement(te,{introText:e,errorMessage:""})}return[n.a.createElement(qn,{key:"sidenav",sections:a}),n.a.createElement(Oa.c,{key:"routeswitch"},this.renderRoutes(t))]}render(){return n.a.createElement("main",{style:Wn},this.renderContent())}}Qn.contextTypes={d2:Oe.a.object};var zn=Object(Oa.g)(Object(o.b)(({currentUser:e})=>({currentUser:e}),{initCurrentUser:()=>e=>{Ma(Ba,wa.initCurrentUser(),e)}})(Qn)),Yn=a(487),Kn=a.n(Yn);var Xn=Object(o.b)(e=>({open:e.popups.snackbar.show,snackbarProps:e.popups.snackbar.props}),{hideSnackbar:Wa})(({open:e,snackbarProps:t,hideSnackbar:a})=>{const r={...{autoHideDuration:6e3,onRequestClose:a,style:{whiteSpace:"nowrap"},bodyStyle:{maxWidth:"100%"},contentStyle:{display:"flex"}},...t};return n.a.createElement(Kn.a,Object.assign({open:e},r))});var Jn=Object(o.b)(e=>({open:e.popups.dialog.show,dialogProps:e.popups.dialog.props,content:e.popups.dialog.content}))(({open:e,dialogProps:t,content:a})=>n.a.createElement(hs.a,Object.assign({key:"dialog",open:e},t),a)),Zn=a(1675),$n=a.n(Zn);var ei=Object(o.b)(e=>({open:e.popups.sharing.show,id:e.popups.sharing.id,type:e.popups.sharing.type}),{hideSharingDialog:()=>La("HIDE_SHARING_DIALOG")})(({open:e,id:t,type:a,hideSharingDialog:r})=>n.a.createElement($n.a,{open:e,id:t,type:a,onRequestClose:r,d2:wa.getD2()})),ti=a(442),ai=a.n(ti);var ri=()=>n.a.createElement(xa.a,{muiTheme:ai.a},n.a.createElement("div",null,n.a.createElement(Oa.b,{history:Da,hashType:"noslash"},n.a.createElement(zn,null)),n.a.createElement(Xn,null),n.a.createElement(Jn,null),n.a.createElement(ei,null))),si=a(439),ni=a.n(si),ii=a(347),oi=a.n(ii),li=a(230);const ci={spacing:ni.a,fontFamily:"Roboto, sans-serif",palette:{primary1Color:G.blue500,primary2Color:G.blue700,primary3Color:G.blue100,accent1Color:G.orange500,accent2Color:G.grey100,accent3Color:G.orangeA200,textColor:G.darkBlack,alternateTextColor:G.white,canvasColor:G.white,borderColor:G.grey400,disabledColor:Object(li.fade)(G.darkBlack,.3)}},di=oi()(ci);var ui=Object.assign({},di,{forms:{minWidth:350,maxWidth:750},formInput:{fontWeight:100}});class pi extends s.Component{constructor(...e){super(...e),this.getChildContext=()=>({d2:this.props.d2}),this.render=()=>n.a.createElement(xa.a,{muiTheme:ui},this.props.children)}}pi.childContextTypes={d2:Oe.a.object};var mi=pi;a(1777),a(1778);t.default=()=>{const{d2:e}=Object(i.a)({d2Config:{schemas:["userRole","user","userGroup","userCredentials","organisationUnit"]},i18nRoot:"./d2i18n",onInitialized:e=>{wa.init(e)}});return e?n.a.createElement(o.a,{store:F},n.a.createElement(mi,{d2:e},n.a.createElement(ri,null))):n.a.createElement(mi,null,n.a.createElement("div",{className:"page-loader-wrap"},n.a.createElement(Ne.CircularProgress,{size:48})))}}}]);
//# sourceMappingURL=app.1e1d9ea2.chunk.js.map