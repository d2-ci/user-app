(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[127],{1628:function(e,t,a){},1779:function(e,t,a){},1783:function(e,t,a){"use strict";a.r(t);var r={};a.r(r),a.d(r,"code",(function(){return sa})),a.d(r,"date",(function(){return na})),a.d(r,"email",(function(){return ia})),a.d(r,"integer",(function(){return oa})),a.d(r,"negativeInteger",(function(){return la})),a.d(r,"number",(function(){return ca})),a.d(r,"password",(function(){return da})),a.d(r,"positiveInteger",(function(){return ua})),a.d(r,"repeatPassword",(function(){return pa})),a.d(r,"required",(function(){return ha})),a.d(r,"requiredArray",(function(){return ma})),a.d(r,"username",(function(){return ga})),a.d(r,"whatsApp",(function(){return ya}));var s=a(1),n=a.n(s),i=a(1780),o=a(195),l=a(5),c=a.n(l),d=a(830),u=a.n(d),p=a(524),h=a.n(p),m=a(325),g=a(831),y=(a(832),a(1786));const E={type:null,items:null};var b=(e=E,{type:t,payload:a})=>{switch(t){case"LIST_REQUESTED":return{type:a,items:null};case"LIST_RECEIVED":return e.type===a.type?{type:a.type,items:a.items}:e;case"LIST_ERRORED":return{type:null,items:a.message};default:return e}};const f={query:"",inactiveMonths:null,selfRegistered:!1,invitationStatus:null,organisationUnits:[]},A={show:!1,props:{message:""}},T={show:!1,props:{},content:null},_={show:!1,id:null,type:null};var R=(e=f,{type:t,payload:a})=>{switch(t){case"FILTER_UPDATED":return{...e,[a.updateKey]:a.updateValue};case"FILTER_RESET":return{...f};default:return e}};var S=(e=null,{type:t,payload:a})=>{switch(t){case"PAGER_RESET":return null;case"LIST_RECEIVED":return a.items.pager;default:return e}};var C=(e=null,{type:t,payload:a})=>{switch(t){case"CLEAR_ITEM":case"ITEM_REQUESTED":return null;case"INIT_NEW_ITEM":case"ITEM_RECEIVED":case"ITEM_ERRORED":return a;default:return e}};var I=(e=null,{type:t,payload:a})=>{switch(t){case"CURRENT_USER_REQUESTED":return null;case"CURRENT_USER_RECEIVED":case"CURRENT_USER_ERRORED":return a;default:return e}};var v=(e=A,{type:t,payload:a})=>{switch(t){case"SHOW_SNACKBAR":return{show:!0,props:a};case"HIDE_SNACKBAR":return{...A};default:return e}};var w=(e=T,{type:t,payload:a})=>{switch(t){case"SHOW_DIALOG":return{show:!0,...a};case"HIDE_DIALOG":return{...T};default:return e}};var O=(e=_,{type:t,payload:a})=>{switch(t){case"SHOW_SHARING_DIALOG":return{show:!0,...a};case"HIDE_SHARING_DIALOG":return{..._};default:return e}};var U=Object(m.c)({snackbar:v,dialog:w,sharing:O});const N=[g.a];const x=Object(m.c)({list:b,filter:R,pager:S,currentItem:C,currentUser:I,popups:U,form:y.a});var D=Object(m.d)(x,Object(m.a)(...N));const F=["displayName","id","access","user[displayName,id]","publicAccess","userGroupAccesses"],L=[...F,"description"],P={fields:["organisationUnits[id,path,displayName,children::isNotEmpty]","dataViewOrganisationUnits[id,path,displayName,children::isNotEmpty]","teiSearchOrganisationUnits[id,path,displayName,children::isNotEmpty]"]},k={paging:!1,fields:["id","path","displayName","children::isNotEmpty","ancestors"]};var M={USER_LIST:["displayName","id","access","userCredentials[username,disabled,lastLogin,twoFA]","teiSearchOrganisationUnits[id,path]"],USER_GROUP_LIST:F,USER_ROLE_LIST:L,USER_DETAILS:[":owner","access","displayName","userGroups","organisationUnits[id,displayName,path]","dataViewOrganisationUnits[id,displayName,path]","userCredentials[id,username,lastLogin,externalAuth,userRoles[id,displayName],cogsDimensionConstraints[id,displayName,dimensionType],catDimensionConstraints[id,displayName,dimensionType],openId,ldapId,disabled]","teiSearchOrganisationUnits[id,path]","whatsApp","facebookMessenger","skype","telegram","twitter"],USER_GROUP_DETAILS:[":owner","access","displayName"],USER_ROLE_DETAILS:[":owner","access","authorities","displayName"]},G=a(216);var B=e=>e?"function"===typeof e.toArray?e.toArray():e:[];var V=(e,t)=>e.split(".").reduce((e,t)=>e&&e[t]?e[t]:null,t),j=a(835),H=a.n(j),q=a(280),W=a.n(q),Q=a(544),Y=a.n(Q),z=a(553),K=a.n(z),X=a(229),J=a.n(X),$=a(897),Z=a(198);const ee={clear:"both",color:"#c33017",backgroundColor:"#ffe3de",padding:"1.5rem 1.5rem 1rem",fontSize:"1rem",width:"100%"};var te=({introText:e,errorMessage:t})=>n.a.createElement("div",{style:ee},e,n.a.createElement("pre",null,t));var ae=({message:e,messages:t,httpStatusCode:a},r)=>{const s=r||c.a.t("Something went wrong when processing your request."),n=a&&a>=400&&a<500||!a&&t&&t.length>0;return!e&&t&&t.length>0&&(e=t.map(({message:e})=>e).join(", ")),n?e:s};const re={outerWrap:{paddingTop:0,paddingBottom:"2.5rem"},headerWrap:{display:"flex"},headerSpacer:{flex:"0 0 120px"},header:{flex:"1 0 120px",paddingBottom:0,fontSize:"1.2rem"},error:{color:G.red500},errorText:{fontSize:"0.8rem",marginLeft:"0.8rem"}};class se extends s.Component{constructor(e){super(e),this.availableItemsReceivedHandler=e=>{const{initiallyAssignedItems:t,returnModelsOnUpdate:a}=this.props,{itemStore:r,assignedItemStore:s}=this.state;a&&(this.modelLookup=new Map);const n=B(t).map(({id:e})=>e),i=B(e).map(e=>{a&&this.modelLookup.set(e.id,e);const t=e.displayName||e.name;return{value:e.id,text:t}});r.setState(i),s.setState(n)},this.onAssignItems=e=>{const{assignedItemStore:t}=this.state,a=t.state.concat(e);return this.update(a)},this.onRemoveItems=e=>{const{assignedItemStore:t}=this.state,a=t.state.filter(t=>-1===e.indexOf(t));return this.update(a)},this.updateFilterText=e=>{this.setState({filterText:e.target.value})},this.state={itemStore:Z.Store.create(),assignedItemStore:Z.Store.create(),filterText:"",fetchErrorMsg:null}}async componentDidMount(){try{const e=await this.props.availableItemsQuery();this.availableItemsReceivedHandler(e)}catch(e){const t=ae(e,c.a.t("Could not load available items"));this.setState({fetchErrorMsg:t})}}update(e){const{onChange:t,returnModelsOnUpdate:a,onBlur:r}=this.props,{assignedItemStore:s}=this.state,n=a?e.map(e=>this.modelLookup.get(e)):e;return s.setState(e),t(n),r&&r(),Promise.resolve()}renderHeader(){const{availableItemsHeader:e,assignedItemsHeader:t,errorText:a}=this.props,r=a?{...re.header,...re.error}:re.header;return n.a.createElement("div",{style:re.headerWrap},n.a.createElement(Z.Heading,{level:4,style:re.header},e),n.a.createElement("div",{style:re.headerSpacer}),n.a.createElement(Z.Heading,{level:4,style:r},t,a?n.a.createElement("span",{style:re.errorText},a):null))}renderSearchInput(){return n.a.createElement(W.a,{fullWidth:!0,type:"search",onChange:this.updateFilterText,value:this.state.filterText,floatingLabelText:c.a.t("Filter"),hintText:c.a.t("Filter available and selected items"),style:{marginTop:"-16px"}})}renderGroupEditor(){const{itemStore:e,assignedItemStore:t,filterText:a,fetchErrorMsg:r}=this.state;if(r){const e=c.a.t("There was a problem displaying the GroupEditor");return n.a.createElement(te,{introText:e,errorMessage:r})}return n.a.createElement($.GroupEditor,{itemStore:e,assignedItemStore:t,onAssignItems:this.onAssignItems,onRemoveItems:this.onRemoveItems,height:250,filterText:a})}render(){return n.a.createElement("div",{style:re.outerWrap},this.renderHeader(),this.renderSearchInput(),this.renderGroupEditor())}}var ne=se,ie=a(1531),oe=a(200),le=a.n(oe),ce=a(254),de=a.n(ce),ue=a(474),pe=a.n(ue),he=a(382),me=a.n(he),ge=a(505),ye=a.n(ge);const Ee={error:{info:{color:G.blue500},warning:{color:G.orange500},error:{color:G.red500}}},be=[{text:"loading...",value:n.a.createElement(J.a,{style:{textAlign:"center"}},n.a.createElement(de.a,{style:{marginTop:"12px"}}))}],fe={filteredItems:[],searchWarning:null,errorStyle:Ee.error.info};class Ae extends s.Component{constructor(e){super(e),this.onAutoCompleteChange=e=>{this.setState({autoCompleteText:e}),this.getItems(e)},this.getItems=async e=>{const{minCharLength:t,query:a,queryParam:r}=this.props;if(!e||e.length<t){const a=e?c.a.t("Please enter at least {{ minCharCount }} characters",{minCharCount:t}):null;this.setState({...fe,searchWarning:a})}else{this.setState({...fe,filteredItems:be}),this.trashableQuery=me()(a(e,r));try{let e=await this.trashableQuery;if(e=B(e),e.length>0){const t=e.map(e=>({text:e.displayName,value:e}));this.setState({...fe,filteredItems:t})}else this.setState({...fe,errorStyle:Ee.error.warning,searchWarning:c.a.t("No matches found")})}catch(s){this.setState({...fe,errorStyle:Ee.error.warning,searchWarning:ae(s,c.a.t("There was a problem retreiving your search results"))})}}},this.onItemSelect=e=>{const{selectHandler:t}=this.props;this.setState({autoCompleteText:""}),t(e)};const t=e.queryDebounceTime||375;this.state={...fe},this.getItems=ye()(this.getItems,t),this.trashableQuery=null}componentWillUnmount(){this.trashableQuery&&this.trashableQuery.trash()}render(){const{autoCompleteProps:e}=this.props,t={floatingLabelText:c.a.t("Search"),hintText:c.a.t("Enter search term"),fullWidth:!0,type:"search",filter:()=>!0,...e},{filteredItems:a,searchWarning:r,errorStyle:s,autoCompleteText:i}=this.state,o=r?0:28,l={...t,onUpdateInput:this.onAutoCompleteChange,onNewRequest:this.onItemSelect,searchText:i,dataSource:a,errorText:r,errorStyle:s,floatingLabelShrinkStyle:s,style:{marginBottom:o},menuStyle:{maxHeight:"600px"}};return n.a.createElement(pe.a,l)}}Ae.defaultProps={queryDebounceTime:375,minCharLength:3};var Te=Ae,_e=a(243),Re=a.n(_e),Se=a(1627),Ce=a.n(Se);const Ie={wrapper:{minHeight:"300px",maxHeight:"60vh",position:"relative"},scrollBox:{position:"relative",marginTop:"-12px",maxHeight:"calc(60vh - 154px)",minHeight:"calc(300px - 154px)",overflowY:"auto",paddingTop:"8px",paddingBottom:"8px",borderRadius:"2px"},loader:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},buttonStrip:{paddingTop:"16px",height:"36px"},buttonMargin:{marginRight:"8px"},header:{paddingBottom:0,fontSize:"1.2rem",marginBottom:"-16px"},headerError:{color:G.red500},errorText:{fontSize:"0.8rem",marginLeft:"0.8rem"}};class ve extends s.Component{constructor(e){super(e),this.toggleSelectedOrgUnits=(e,t)=>{const{selectedOrgUnits:a}=this.state,r=this.getIndexOfOrgUnit(t),s=-1===r?[...a,t]:[...a.slice(0,r),...a.slice(r+1)];this.update(s,[])},this.selectAndShowFilteredOrgUnit=e=>{const t=e.value,{selectedOrgUnits:a}=this.state,r=[this.removeLastPathSegment(t)],s=[...a,t];this.update(s,r)},this.clearSelection=()=>{this.update([]),Ce()(this.applySelection)},this.applySelection=()=>{const{selectedOrgUnits:e}=this.state,{confirmSelection:t}=this.props;t(e)},this.state={roots:null,selectedOrgUnits:[...e.selectedOrgUnits],orgUnitFilter:null,initiallyExpanded:this.getInitiallyExpandedItems(e.selectedOrgUnits)}}getInitiallyExpandedItems(e){return e.reduce((e,t)=>{const a=this.removeLastPathSegment(t);return a&&e.push(a),e},[])}getIndexOfOrgUnit(e){const{selectedOrgUnits:t}=this.state,a=t.find(t=>t.path===e.path);return t.indexOf(a)}removeLastPathSegment({path:e}){return e.substr(0,e.lastIndexOf("/"))}update(e,t){const{onChange:a,onBlur:r}=this.props,s=t?{selectedOrgUnits:e,initiallyExpanded:t}:{selectedOrgUnits:e};a&&a(e.map(e=>e.id)),this.setState(s),r&&r()}render(){const{selectedOrgUnits:e,initiallyExpanded:t,orgUnitFilter:a}=this.state,{roots:r,confirmSelection:s,cancel:i,orgUnitType:o,headerText:l,wrapperStyle:d,errorText:u}=this.props,p=e.map(e=>e.path),h={floatingLabelText:c.a.t("Search"),hintText:c.a.t("Enter search term"),fullWidth:!0},m=u?{...Ie.header,...Ie.headerError}:Ie.header;return n.a.createElement("div",{style:{...Ie.wrapper,...d}},l?n.a.createElement(Z.Heading,{level:4,style:m},l,u&&n.a.createElement("span",{style:Ie.errorText},u)):null,n.a.createElement(Te,{autoCompleteProps:h,query:Na.queryOrgUnits,queryParam:o,minCharLength:2,queryDebounceTime:375,selectHandler:this.selectAndShowFilteredOrgUnit}),n.a.createElement(le.a,{style:Ie.scrollBox},r?n.a.createElement(ie.OrgUnitTreeMultipleRoots,{roots:r,onSelectClick:this.toggleSelectedOrgUnits,selected:p,initiallyExpanded:t,orgUnitsPathsToInclude:a}):n.a.createElement(de.a,{style:Ie.loader})),s?n.a.createElement("div",{style:Ie.buttonStrip},n.a.createElement(Re.a,{label:c.a.t("Apply"),primary:!0,style:Ie.buttonMargin,onClick:this.applySelection,disabled:!r}),n.a.createElement(Re.a,{label:c.a.t("Clear all"),secondary:!0,style:Ie.buttonMargin,onClick:this.clearSelection,disabled:!r}),n.a.createElement(Re.a,{onClick:i,label:c.a.t("Cancel")})):null)}}var we=Object(o.b)((e,t)=>({roots:Dt(t.orgUnitType,e.currentUser)}))(ve),Oe=a(3),Ue=a.n(Oe),Ne=(a(1628),a(222));class xe extends s.Component{constructor(e){super(e),this.onSelectedOnlyChange=(e,t)=>{this.setState({selectedOnly:t}),this.props.onFilterChange(this.state.searchStr,t)},this.onSearchStrChange=e=>{const t=e.target.value;this.setState({searchStr:t}),this.props.onFilterChange(t,this.state.selectedOnly)},this.state={searchStr:"",selectedOnly:!1}}render(){return n.a.createElement("div",{className:"authority-editor__filterbar"},n.a.createElement(Ne.TextField,{className:"authority-editor__filter-text-input search-input",floatingLabelText:c.a.t("Search"),onChange:this.onSearchStrChange,type:"search"}),n.a.createElement(Ne.Checkbox,{className:"authority-editor__filter-checkbox",label:c.a.t("Selected authorities only"),checked:this.state.selectedOnly,onCheck:this.onSelectedOnlyChange,style:{width:"300px"}}))}}var De=xe;var Fe=(e,t,a,r)=>a||r?Object.keys(e).reduce((s,n)=>{const i=e[n],o=i.items.filter(e=>{const s=((e,t)=>{if(!t)return!0;const a=e.name.toLowerCase();return t.some(e=>!(e.length<=1&&t.length>1)&&a.indexOf(e)>-1)})(e,a),n=((e,t,a)=>!t||(e.items&&e.items.length?e.items.some(e=>a.get(e.id)):Boolean(a.get(e.id))))(e,r,t);return s&&n});return s[n]={...i,items:o},s},{}):e,Le=a(797),Pe=a.n(Le),ke=a(1629),Me=a.n(ke);var Ge=({text:e,searchChunks:t})=>t?n.a.createElement(Me.a,{highlightClassName:"authority-editor__search-highlight",searchWords:t,autoEscape:!0,textToHighlight:e}):e;class Be extends s.Component{constructor(...e){super(...e),this.onChecked=(e,t)=>{const{authSubject:{id:a},onCheckedCallBack:r}=this.props;r([a],t)}}render(){const{authSubject:e,withLabel:t,disabled:a}=this.props,{searchChunks:r}=this.context,{name:s,empty:i,implicit:o}=e,l=t?"authority-editor__auth-checkbox":"".concat("authority-editor__auth-checkbox","--without-label"),c=t?n.a.createElement(Ge,{text:s,searchChunks:r}):"";return n.a.createElement("td",null,i?n.a.createElement("div",{className:"authority-editor__empty-cell"}):n.a.createElement(Ne.Checkbox,{onCheck:this.onChecked,label:c,className:l,checked:this.props.selected||Boolean(o),disabled:o||a}))}}Be.contextTypes={searchChunks:Ue.a.array};var Ve=Be,je=a(1630),He=a.n(je),qe=a(1631),We=a.n(qe);var Qe=(()=>{let e=null;return()=>(e||(e=new Map([["ALL",c.a.t("All (Full authority)")],["F_ANALYTICSTABLEHOOK",c.a.t("Analytics Table Hook")],["F_ATTRIBUTE",c.a.t("Attribute")],["F_CATEGORY_COMBO",c.a.t("Category Combo")],["F_CATEGORY",c.a.t("Category")],["F_CATEGORY_OPTION",c.a.t("Category Option")],["F_CATEGORY_OPTION_GROUP",c.a.t("Category Option Group")],["F_CATEGORY_OPTION_GROUP_SET",c.a.t("Category Option Group Set")],["F_COLOR_SET",c.a.t("Color Set")],["F_CONSTANT",c.a.t("Constant")],["F_DASHBOARD",c.a.t("Dashboard")],["F_DATAELEMENTGROUPSET",c.a.t("Data Element Group Sets")],["F_DATAELEMENTGROUP",c.a.t("Data Element Groups")],["F_DATAELEMENT",c.a.t("Data Element")],["F_DATAELEMENT_MINMAX",c.a.t("Min/max rule")],["F_DATASET",c.a.t("Data Set")],["F_DATAVALUE",c.a.t("Data Value")],["F_DOCUMENT",c.a.t("Document")],["F_EVENTCHART",c.a.t("Event Chart")],["F_EVENTREPORT",c.a.t("Event Report")],["F_EXTERNAL_MAP_LAYER",c.a.t("External Map Layer")],["F_INDICATORGROUPSET",c.a.t("Indicator Group Sets")],["F_INDICATORGROUP",c.a.t("Indicator Group")],["F_INDICATORTYPE",c.a.t("Indicator Type")],["F_INDICATOR",c.a.t("Indicator")],["F_LEGEND_SET",c.a.t("Legend Set")],["F_MAP",c.a.t("Map")],["F_MINMAX_DATAELEMENT",c.a.t("Min-Max Data Element")],["F_OPTIONGROUPSET",c.a.t("Option Group Set")],["F_OPTIONGROUP",c.a.t("Option Group")],["F_OPTIONSET",c.a.t("Option Set")],["F_ORGANISATIONUNIT",c.a.t("Organisation Unit")],["F_ORGUNITGROUPSET",c.a.t("Organisation Unit Group Set")],["F_ORGUNITGROUP",c.a.t("Organisation Unit Group")],["F_PREDICTOR",c.a.t("Predictor")],["F_PROGRAMSTAGE",c.a.t("Program Stage")],["F_PROGRAM",c.a.t("Program")],["F_PROGRAM_INDICATOR",c.a.t("Program Indicator")],["F_PROGRAM_INDICATOR_GROUP",c.a.t("Program Indicator Group")],["F_PROGRAM_RULE",c.a.t("Program Rule")],["F_PROGRAM_TRACKED_ENTITY_ATTRIBUTE_GROUP",c.a.t("Program Tracked Entity Attribute Group")],["F_PUSH_ANALYSIS",c.a.t("Push Analysis")],["F_RELATIONSHIPTYPE",c.a.t("Relationship Type")],["F_REPORT",c.a.t("Report")],["F_SECTION",c.a.t("Section")],["F_SQLVIEW",c.a.t("SQL View")],["F_TRACKED_ENTITY",c.a.t("Tracked Entity")],["F_TRACKED_ENTITY_ATTRIBUTE",c.a.t("Tracked Entity Attribute")],["F_TRACKED_ENTITY_DATAVALUE",c.a.t("Tracked Entity Data Value")],["F_TRACKED_ENTITY_INSTANCE",c.a.t("Tracked Entity Instance")],["F_USERGROUP",c.a.t("User Group")],["F_USERROLE",c.a.t("User Role")],["F_USER",c.a.t("User")],["F_VALIDATIONRULEGROUP",c.a.t("Validation Rule Group")],["F_VALIDATIONRULE",c.a.t("Validation Rule")],["F_PREDICTORGROUP",c.a.t("Data predictor group")],["F_SKIP_DATA_IMPORT_AUDIT",c.a.t("Skip data import audit")],["F_VISUALIZATION",c.a.t("Visualization")]])),e)})();const Ye=(()=>{let e=null;return()=>(e||(e={metadata:{name:"Metadata",items:null,headers:["Name","Add/Update Public","Add/Update Private","Delete","External access"]},apps:{name:c.a.t("Apps"),items:null,headers:["Name"]},tracker:{name:c.a.t("Tracker"),items:null,headers:["Name"]},importExport:{name:c.a.t("Import-Export"),items:null,headers:["Name"]},system:{name:c.a.t("System"),items:null,headers:["Name"]}}),e)})(),ze=["_PUBLIC_ADD","_PRIVATE_ADD","_ADD","_DELETE","_EXTERNAL"],Ke={id:null,empty:!0},Xe={implicit:!0},Je=new Set(["F_DASHBOARD_PUBLIC_ADD","F_EVENTCHART_PUBLIC_ADD","F_EVENTREPORT_PUBLIC_ADD","F_MAP_PUBLIC_ADD","F_VISUALIZATION_PUBLIC_ADD"]),$e={tracker:new Set(["F_PROGRAM_DASHBOARD_CONFIG_ADMIN","F_PROGRAM_ENROLLMENT","F_PROGRAM_ENROLLMENT_READ","F_PROGRAM_UNENROLLMENT","F_TEI_CASCADE_DELETE","F_TRACKED_ENTITY_DATAVALUE_READ","F_TRACKED_ENTITY_INSTANCE_SEARCH","F_TRACKED_ENTITY_INSTANCE_SEARCH_IN_ALL_ORGUNITS","F_TRACKED_ENTITY_UPDATE","F_UNCOMPLETE_EVENT","F_VIEW_EVENT_ANALYTICS","F_PROGRAM_RULE_MANAGEMENT","F_ENROLLMENT_CASCADE_DELETE"]),importExport:new Set(["F_EXPORT_DATA","F_EXPORT_EVENTS","F_IMPORT_DATA","F_IMPORT_EVENTS","F_IMPORT_GML","F_METADATA_EXPORT","F_METADATA_IMPORT","F_METADATA_MANAGE","F_SKIP_DATA_IMPORT_AUDIT"]),system:new Set(["ALL","F_APPROVE_DATA","F_APPROVE_DATA_LOWER_LEVELS","F_ACCEPT_DATA_LOWER_LEVELS","F_VIEW_UNAPPROVED_DATA","F_ORGANISATIONUNIT_MOVE","F_ORGANISATIONUNITLEVEL_UPDATE","F_RUN_VALIDATION","F_REPLICATE_USER","F_USER_VIEW","F_USERGROUP_MANAGING_RELATIONSHIPS_ADD","F_USERGROUP_MANAGING_RELATIONSHIPS_VIEW","F_PERFORM_MAINTENANCE","F_SCHEDULING_ADMIN","F_GENERATE_MIN_MAX_VALUES","F_PREDICTOR_RUN","F_INSERT_CUSTOM_JS_CSS","F_SYSTEM_SETTING","F_SEND_EMAIL","F_MOBILE_SETTINGS","F_MOBILE_SENDSMS","F_OAUTH2_CLIENT_MANAGE"])},Ze=e=>(Object.keys(e).forEach(t=>{const a=e[t];a.items=We()(a.items,"name")}),e),et=e=>!ze.some(t=>Pe()(e.id,t)),tt=(e,t)=>{if(!t.get(e.id))return null;const a=ze.find(t=>Pe()(e.id,t)),r=e.id.replace(a,""),s=t.get(r+"_ADD"),n=t.get(r+"_EXTERNAL"),i=Je.has(r+"_PUBLIC_ADD"),o=s||t.get(r+"_PUBLIC_ADD"),l=s?Ke:i?Xe:t.get(r+"_PRIVATE_ADD"),c=i?Xe:t.get(r+"_DELETE"),d=n||Ke;return o&&l&&c?(ze.forEach(e=>t.delete(r+e)),{name:Qe().get(r)||r,items:[o,l,c,d]}):null},at=(e,t,a)=>{const r=Object.keys($e).find(t=>$e[t].has(e.id))||"system";"ALL"===e.id&&(e.name=Qe().get(e.id)),t[r].items.push(e),a.delete(e.id)};var rt=e=>{const t=e.reduce((e,t)=>(e.set(t.id,t),e),new Map),a=Object.keys(Ye()).reduce((e,t)=>(e[t]={...Ye()[t],items:[]},e),{}),r=e.reduce((e,a)=>{if(He()(a.id,"M_"))e.apps.items.push(a),t.delete(a.id);else if(et(a))at(a,e,t);else{const r=tt(a,t);r?e.metadata.items.push(r):t.get(a.id)&&at(a,e,t)}return e},a);return Ze(r)};class st extends s.Component{constructor(...e){super(...e),this.onAuthGroupChanged=(e,t)=>{this.context.onAuthChange(e,t),this.isPublicAdd(e)&&this.forceUpdate()}}isPublicAdd(e){return Pe()(e,"_PUBLIC_ADD")}isPrivateAdd(e){return Pe()(e,"_PRIVATE_ADD")}render(){const{name:e,items:t}=this.props,{shouldSelect:a,searchChunks:r}=this.context;let s;return t.reduce((e,t,r)=>{const i=this.isPublicAdd(t.id),o=this.isPrivateAdd(t.id),l=Boolean(s&&o),c=a(t.id)||l;return i&&(s=c),e.push(n.a.createElement(Ve,{key:"authitem-".concat(r),authSubject:t,withLabel:!1,selected:c,disabled:l,onCheckedCallBack:this.onAuthGroupChanged})),e},[n.a.createElement("td",{key:"group-label"},n.a.createElement(Ge,{text:e,searchChunks:r}))])}}st.contextTypes={shouldSelect:Ue.a.func.isRequired,onAuthChange:Ue.a.func.isRequired,searchChunks:Ue.a.array};var nt=st;class it extends s.Component{constructor(...e){super(...e),this.onTableHeadCheck=(e,t)=>{const a=this.props.authSection.items.map(({id:e})=>e);this.context.onAuthChange(a,t)},this.renderAuthRow=(e,t)=>{const{shouldSelect:a,onAuthChange:r}=this.context;return n.a.createElement("tr",{key:"row-".concat(t)},e.items?n.a.createElement(nt,{items:e.items,name:e.name}):n.a.createElement(Ve,{authSubject:e,withLabel:!0,selected:a(e.id),onCheckedCallBack:r}))}}renderLoaderRow(){return n.a.createElement("tr",null,n.a.createElement("td",{className:"authority-editor__placeholder-cell"},n.a.createElement(Ne.CircularProgress,{size:24})))}renderInfoRow(e){let t="authority-editor__placeholder-cell",a=c.a.t("No matches found");return e&&(t+="--error",a=e),n.a.createElement("tr",null,n.a.createElement("td",{className:t},a))}renderContent(e){return e.items?"string"===typeof e.items?this.renderInfoRow(e.items):0===e.items.length?this.renderInfoRow():e.items.map(this.renderAuthRow):this.renderLoaderRow()}renderTableHead({headers:e,name:t,items:a}){const r="Metadata"!==t&&Array.isArray(a)&&a.length>0&&a.every(({id:e})=>this.context.shouldSelect(e));return n.a.createElement("thead",null,n.a.createElement("tr",null,e.map((e,a)=>n.a.createElement("th",{key:"header-".concat(a)},"Metadata"!==t&&0===a?n.a.createElement(Ne.Checkbox,{className:"authority-editor__auth-checkbox",label:e,onCheck:this.onTableHeadCheck,checked:r}):e))))}render(){const{sectionKey:e,authSection:t}=this.props;let a="authority-editor__auth-group ".concat(e);t.items&&t.items.length>11&&(a+=" scrollable");let r="authority-editor__auth-group-table";return r+=" columns-".concat(t.headers.length),n.a.createElement(Ne.Paper,{className:a},n.a.createElement(Z.Heading,{level:6,className:"authority-editor__auth-group-header"},t.name),n.a.createElement("table",{className:r},this.renderTableHead(t),n.a.createElement("tbody",null,this.renderContent(t))))}}it.contextTypes={shouldSelect:Ue.a.func.isRequired,onAuthChange:Ue.a.func.isRequired};var ot=it;class lt extends s.Component{constructor(e){super(e),this.state={filteredAuthorities:e.allGroupedAuthorities,searchChunks:null},this.updateFilter=ye()(this.updateFilter,375)}getChildContext(){return{searchChunks:this.state.searchChunks}}componentWillReceiveProps(e){this.updateFilteredAuthorities(e.allGroupedAuthorities,null,null)}updateFilter(e,t){const{allGroupedAuthorities:a}=this.props;this.updateFilteredAuthorities(a,e,t)}updateFilteredAuthorities(e,t,a){const{selectedItemsLookup:r}=this.context,s=t?t.toLowerCase().split(" "):null;this.setState({filteredAuthorities:Fe(e,r,s,a),searchChunks:s})}render(){const{filteredAuthorities:e}=this.state;return n.a.createElement("div",{className:"authority-editor__auth-group-wrap"},Object.keys(e).map(t=>n.a.createElement(ot,{key:t,sectionKey:t,authSection:e[t]})))}}lt.contextTypes={shouldSelect:Ue.a.func.isRequired,onAuthChange:Ue.a.func.isRequired,selectedItemsLookup:Ue.a.object.isRequired},lt.childContextTypes={searchChunks:Ue.a.array};var ct=lt;class dt extends s.Component{constructor(e){super(e),this.onFilterChange=(e,t)=>{this.filteredAuthSections.updateFilter(e,t)},this.onAuthChange=(e,t)=>{const{reduxFormOnChange:a}=this.props,r=[];e.forEach(e=>{this.selectedItemsLookup.set(e,t)}),this.selectedItemsLookup.forEach((e,t)=>{e&&r.push(t)}),a&&a(r)},this.shouldSelect=e=>Boolean(this.selectedItemsLookup.get(e)),this.state={allGroupedAuthorities:Ye()},this.selectedItemsLookup=e.initiallySelected.reduce((e,t)=>e.set(t,!0),new Map),this.groupedAuthoritiesPromise=null}getChildContext(){return{shouldSelect:this.shouldSelect,onAuthChange:this.onAuthChange,selectedItemsLookup:this.selectedItemsLookup}}async componentDidMount(){this.groupedAuthoritiesPromise=me()(Na.getGroupedAuthorities());try{const e=await this.groupedAuthoritiesPromise;this.setState({allGroupedAuthorities:e})}catch(e){this.handleAuthorityFetchError(e)}}componentWillUnmount(){this.groupedAuthoritiesPromise.trash()}handleAuthorityFetchError(e){const t=ae(e,c.a.t("There was a problem retreiving the available authorities.")),a=Object.keys(Ye()).reduce((e,a)=>(e[a]={...Ye()[a],items:t},e),{});this.setState({allGroupedAuthorities:a})}render(){const{allGroupedAuthorities:e}=this.state;return n.a.createElement("div",{className:"authority-editor"},n.a.createElement(Z.Heading,{level:4,className:"authority-editor__header"},c.a.t("Authorities")),n.a.createElement(De,{onFilterChange:this.onFilterChange}),n.a.createElement(ct,{ref:e=>{this.filteredAuthSections=e},allGroupedAuthorities:e}))}}dt.defaultProps={initiallySelected:[]},dt.childContextTypes={shouldSelect:Ue.a.func.isRequired,onAuthChange:Ue.a.func.isRequired,selectedItemsLookup:Ue.a.object.isRequired};var ut=dt;const pt={checkbox:{marginTop:"32px",fontSize:"16px"},warning:{color:G.orange500}},ht=({input:e,label:t,meta:{touched:a,error:r,asyncValidating:s},...i})=>{const o=s?c.a.t("Validating..."):a&&r;return s&&(i.errorStyle=pt.warning),n.a.createElement(W.a,Object.assign({floatingLabelText:t,hintText:t,fullWidth:!0,errorText:o},i,e))},mt=({input:e})=>{const t=""===e.value?[]:e.value;return n.a.createElement(ut,{initiallySelected:t,reduxFormOnChange:e.onChange,reduxFormOnBlur:e.onBlur})},gt=({input:e,label:t})=>n.a.createElement(Y.a,Object.assign({checked:Boolean(e.value),onCheck:e.onChange,label:t},e,{style:pt.checkbox})),yt=({input:e,label:t,meta:{touched:a,error:r,asyncValidating:s},options:i,style:o})=>{const l=s?c.a.t("Validating..."):a&&r,d=s?pt.warning:void 0;return n.a.createElement(K.a,{floatingLabelText:t,fullWidth:!0,value:e.value,name:e.name,onChange:(t,a,r)=>{e.onChange(r),setTimeout(()=>e.onBlur(r),1)},style:o,errorText:l,errorStyle:d},i.map(({id:e,label:t},a)=>n.a.createElement(J.a,{key:"option_".concat(a),value:e,primaryText:t})))},Et=({input:e,meta:{touched:t,error:a},availableItemsQuery:r,availableItemsLabel:s,assignedItemsLabel:i,initialValues:o,...l})=>n.a.createElement(ne,Object.assign({initiallyAssignedItems:o,onChange:e.onChange,onBlur:e.onBlur,availableItemsQuery:r,availableItemsHeader:s,assignedItemsHeader:i,errorText:t&&a},l)),bt=({input:e,meta:{touched:t,error:a},label:r,wrapperStyle:s,initialValues:i,orgUnitType:o})=>n.a.createElement(we,{selectedOrgUnits:i,onChange:e.onChange,wrapperStyle:s,headerText:r,orgUnitType:o,errorText:t&&a,onBlur:e.onBlur}),ft=({name:e,label:t,style:a})=>n.a.createElement("p",{key:e,style:a},t),At="name",Tt="code",_t={loaderWrap:{paddingTop:"2rem",textAlign:"center"}},Rt=()=>[{name:At,label:c.a.t("Name"),fieldRenderer:ht,isRequiredField:!0},{name:Tt,label:c.a.t("Code"),fieldRenderer:ht},{name:"users",fieldRenderer:Et,isRequiredField:!0,initialItemsSelector:e=>B(e.users),availableItemsQuery:"getManagedUsers",availableItemsLabel:c.a.t("Available users"),assignedItemsLabel:c.a.t("Group members")},{name:"managedGroups",fieldRenderer:Et,initialItemsSelector:e=>B(e.managedGroups),availableItemsQuery:"getAvailableUserGroups",availableItemsLabel:c.a.t("Available user groups"),assignedItemsLabel:c.a.t("Managed user groups")}],St=H()(e=>{if(null===e)return e;const{total:t,pageCount:a,page:r,query:{pageSize:s}}=e,n=t-(t-(a-(a-r))*s),i=1+n-s,o=n;return e.currentlyShown="".concat(i," - ").concat(o>t?t:o),e}),Ct=(e,t)=>{if(!e||"string"===typeof e)return e;const a=e.modelDefinition.name;return e.toArray().map(e=>It[a](e,t))},It={user:e=>(e.userName=e.userCredentials.username,e.disabled=e.userCredentials.disabled,e.lastLogin=e.userCredentials.lastLogin,e),userRole:e=>e,userGroup:(e,t)=>(e.currentUserIsMember=Boolean(t.includes(e.id)),e)},vt=H()(e=>e.length<3?e.map(e=>e.displayName).join(", "):c.a.t("{{count}} selected",{count:e.length})),wt=(e,t,a)=>{a===qt?t[a]=[...e.catDimensionConstraints,...e.cogsDimensionConstraints]:e[a]&&!h()(e[a].size)||Array.isArray(e[a])?t[a]=B(e[a]).map(({id:e})=>e):t[a]=e[a]},Ot=H()((e,t,a)=>{const r={[kt]:Yt};return e.id&&(Wt.forEach(t=>{wt(e,r,t)}),Qt.forEach(t=>{wt(e.userCredentials,r,t)}),a.forEach(e=>r[e.name]=e.value)),r[Vt]=t.ui.selected||"en",r[jt]=t.db.selected,r}),Ut=H()((e,t)=>{const a={};return Rt().forEach(t=>{wt(e,a,t.name)}),t.forEach(e=>a[e.name]=e.value),a}),Nt=H()(e=>[...B(V("userCredentials.catDimensionConstraints",e)),...B(V("userCredentials.cogsDimensionConstraints",e))]),xt=H()((e,t)=>t&&e?t.get(e):null),Dt=(e,t)=>{const a=t.systemOrganisationUnitRoots,r=t[e],s=t[Ht];let n=null;return t.authorities.has("ALL")?n=a:(0===r.size||s.size>0)&&(n=s.toArray()),n},Ft=e=>{const t=e&&e.registeredFields,a=e&&e.values;return(Boolean(t&&t[kt])&&a&&a[kt])===zt},Lt={loaderWrap:{paddingTop:"2rem",textAlign:"center"},toggler:{color:G.blue600},orgUnitTree:{width:"calc(50% - 60px)",float:"left",minHeight:"100px",maxHeight:"1200px"},togglerWrap:{clear:"both",paddingTop:"1.2rem",marginBottom:"1.5rem"},additionalFieldsWrap:{clear:"both",paddingTop:"1.5rem"}},Pt="username",kt="inviteUser",Mt="externalAuth",Gt="openId",Bt="ldapId",Vt="interfaceLanguage",jt="databaseLanguage",Ht="organisationUnits",qt="catCogsDimensionConstraints",Wt=["surname","firstName","email","phoneNumber","whatsApp","facebookMessenger","skype","telegram","twitter",Ht,"dataViewOrganisationUnits","userGroups","teiSearchOrganisationUnits"],Qt=[Pt,"disabled",Mt,"password",Gt,Bt,"userRoles",qt],Yt="SET_PASSWORD",zt="INVITE_USER",Kt=()=>({label:c.a.t("Selecting an organisation unit provides access to all units in the sub-hierarchy"),fieldRenderer:ft,style:{clear:"both",paddingTop:"0.8rem",fontStyle:"italic",fontSize:"0.9rem"}}),Xt="user",Jt=/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/,$t=/^\+(?:[0-9].?){4,14}[0-9]$/,Zt=/[0-9]{4}-[0-9]{2}-[0-9]{2}/,ea=/^(?=.*[a-z]).+$/,ta=/^(?=.*[A-Z]).+$/,aa=/^(?=.*[0-9]).+$/,ra=/[^a-zA-Z0-9]/;function sa(e){if(ba(e)&&e.length>50)return c.a.t("Exceeds maximum character limit of 50")}function na(e){if(ba(e)&&!Zt.test(e))return c.a.t("Please enter a valid date with the following format yyyy-mm-dd")}function ia(e){if(ba(e)&&!Jt.test(e.toLowerCase()))return c.a.t("Please provide a valid email address")}function oa(e){if(ba(e)&&!Ea(e))return c.a.t("Value should be an integer")}function la(e){if(ba(e)&&(!Ea(e)||parseInt(e,10)>=0))return c.a.t("Value should be a nagative integer")}function ca(e){if(ba(e)&&isNaN(e))return c.a.t("Value should be a number")}function da(e,t,a){if(!function(e,t){if(t.inviteUser)return!1;const a=Boolean(t.user.id);return!(a&&!e.password&&!e.repeatPassword)}(t,a))return;const r=function(e){if(!ba(e))return c.a.t("This field is required");if(e.length<8)return c.a.t("Password should be at least 8 characters long");if(e.length>35)return c.a.t("Password should be no longer than 34 characters");if(!ea.test(e))return c.a.t("Password should contain at least one lowercase letter");if(!ta.test(e))return c.a.t("Password should contain at least one UPPERCASE letter");if(!aa.test(e))return c.a.t("Password should contain at least one number");if(!ra.test(e))return c.a.t("Password should have at least one special character");return null}(t.password);return r||void 0}function ua(e){if(ba(e)&&(!Ea(e)||parseInt(e,10)<=0))return c.a.t("Value should be a positive integer")}function pa(e,t){if(t.repeatPassword!==t.password)return c.a.t("Passwords do not match")}function ha(e){return ba(e)?void 0:c.a.t("This field is required")}function ma(e){if(!(Array.isArray(e)&&e.length>0))return c.a.t("This field is required. Please select at least one")}function ga(e){return ba(e)&&e.length<2?c.a.t("A username should be at least 2 characters long"):ba(e)&&e.length>140?c.a.t("Username may not exceed 140 characters"):void 0}function ya(e){if(ba(e)&&!$t.test(e))return c.a.t("Please provide a valid international phone number (+0123456789)")}function Ea(e){if(isNaN(e))return!1;const t=parseFloat(e);return(0|t)===t}function ba(e){return"undefined"!==typeof e&&null!==e&&""!==e}let fa;function Aa(){if("undefined"!==typeof fa)return fa;let e=document.createElement("input");return e.setAttribute("type","date"),e.setAttribute("value","not-a-date"),fa="not-a-date"!==e.value,e=null,fa}function Ta(e,t){return e.map(e=>function({id:e,valueType:t,displayName:a,mandatory:r,unique:s,optionSet:n},i){const o=i&&i.find(t=>t.attribute.id===e),l=function(e,t,a){const r=Sa(),s=t?{...r.OPTION_SET,props:{options:t.options.map(e=>({id:e.id,label:e.displayName}))}}:r[e]||r.TEXT;s.fieldRenderer!==yt||a||"no_value"===s.props.options[0].id||(s.props.options=[{id:"no_value",label:c.a.t("<No value>")},...s.props.options]);return s}(t,n,r);return{name:"userAttibute_"+e,isAttributeField:!0,label:a,isRequiredField:r,shouldBeUnique:s,attributeId:e,value:o&&o.value||null,valueType:t,...l}}(e,t))}function _a(e,t){e.forEach(({shouldBeUnique:e,name:a})=>{e&&t.push(a)})}function Ra(e,t){const a=t.reduce((e,{attributeId:t,valueType:a})=>(e[t]=a,e),{});return Object.keys(e).reduce((t,r)=>{if(-1!==r.indexOf("userAttibute_")){const s=r.replace("userAttibute_",""),n=e[r],i="no_value"===n;"TRUE_ONLY"===a[s]&&!n||i||t.push({value:n,attribute:{id:s}})}return t},[])}const Sa=(()=>{let e=null;return()=>(e||(e={OPTION_SET:{fieldRenderer:yt},TEXT:{fieldRenderer:ht},LONG_TEXT:{fieldRenderer:ht,props:{multiLine:!0,rows:3,rowsMax:6}},DATE:{fieldRenderer:ht,props:{type:"date",floatingLabelFixed:Aa(),hintText:null},fieldValidators:[na]},BOOLEAN:{fieldRenderer:yt,props:{options:[{id:"true",label:c.a.t("Yes")},{id:"false",label:c.a.t("No")}]}},TRUE_ONLY:{fieldRenderer:gt},NUMBER:{fieldRenderer:ht,fieldValidators:[ca]},INTEGER:{fieldRenderer:ht,fieldValidators:[oa]},INTEGER_POSITIVE:{fieldRenderer:ht,fieldValidators:[ua]},INTEGER_NEGATIVE:{fieldRenderer:ht,fieldValidators:[la]}}),e)})();const Ca=(e,t)=>{const a=u()(e).toUpperCase(),r="".concat(a,t?"_DETAILS":"_LIST");return M[r]},Ia=({authorities:e})=>e.has("ALL"),va=(e,t,a)=>{h()(t)||(e[a]=Array.isArray(t)?t.map(e=>({id:e})):t)},wa=(e,t,a)=>"/userSettings/key".concat(e,"Locale?user=").concat(t,"&value=").concat(a),Oa=({locale:e,name:t})=>({id:e,label:t}),Ua=e=>e.toArray().map(e=>{const t=e.userCredentials.username,a=e.toJSON();return a.displayName+=" (".concat(t,")"),a});var Na=new class{constructor(){this.getD2=()=>this.d2,this.getContextPath=()=>this.d2.system.systemInfo.contextPath,this.getList=(e,t,a)=>{const r=((e=1,t,a,r,s)=>{const{query:n,inactiveMonths:i,selfRegistered:o,invitationStatus:l,organisationUnits:c}=t,d={pageSize:50,fields:a,page:e,order:r===Xt?["firstName:asc","surname:asc"]:"name:asc"};if(r!==Xt||Ia(s)||(d.userOrgUnits=!0,d.includeChildren=!0),n&&(d.query=n),i&&(d.inactiveMonths=i),o&&(d.selfRegistered=o),l&&(d.invitationStatus=l),c.length){const e=c.map(e=>e.id).join();d.filter="organisationUnits.id:in:[".concat(e,"]")}return d})(t,a,Ca(e),e,this.getCurrentUser());return this.d2.models[e].list(r)},this.getItem=(e,t)=>{const a={fields:Ca(e,!0)};return this.d2.models[e].get(t,a)},this.genericFind=(e,t,a)=>this.d2.models[e].filter().on(t).equals(a).list({fields:["id"]}),this.replicateUser=(e,t,a)=>{const r="/users/".concat(e,"/replica"),s={username:t,password:a};return this.d2Api.post(r,s)},this.queryOrgUnits=(e,t)=>{const a={...k,query:e};return this.d2.models.organisationUnits.list(a).then(e=>((e,t)=>{const{currentUser:a}=D.getState();if(a.authorities.has("ALL"))return e.toArray();const r=a[t].size>0?a[t]:a[Ht];return e.toArray().filter(e=>{const t=Boolean(r.get(e.id)),a=!t&&e.ancestors.toArray().some(e=>Boolean(r.get(e.id)));return t||a})})(e,t))},this.getAvailableUserRoles=()=>this.d2.models.userRoles.list({canIssue:!0,fields:["id","displayName"],paging:!1}),this.getAvailableDataAnalyticsDimensionRestrictions=()=>this.d2Api.get("/dimensions/constraints",{fields:["id","name","dimensionType"],paging:!1}).then(({dimensions:e})=>e),this.updateDisabledState=(e,t)=>{const a="/users/".concat(e),r={userCredentials:{disabled:t}};return this.d2Api.patch(a,r)},this.disable2FA=e=>{const t="/users/".concat(e);return this.d2Api.patch(t,{userCredentials:{twoFA:!1}})},this.getSelectedAndAvailableLocales=e=>{e=e?encodeURIComponent(e):null;const t={id:"use_db_locale",label:c.a.t("Use database locale / no translation")},a=this.d2Api.get("/locales/db"),r=this.d2Api.get("/locales/ui"),s=e?this.d2Api.get("/userSettings/keyUiLocale?user=".concat(e)):this.d2.system.settings.get("keyUiLocale"),n=e?this.d2Api.get("/userSettings/keyDbLocale?user=".concat(e)):Promise.resolve("use_db_locale");return Promise.all([a,r,n,s]).then(([e,a,r,s])=>({db:{available:[t,...e.map(Oa)],selected:r||"use_db_locale"},ui:{available:a.map(Oa),selected:s}}))},this.saveOrInviteUser=(e,t,a,r,s,n)=>{const i=((e,t,a,r)=>{const s=!t.id,n=t.modelDefinition.getOwnedPropertyNames(),i=s?{userCredentials:{cogsDimensionConstraints:[],catDimensionConstraints:[]}}:{id:t.id,userCredentials:{id:t.userCredentials&&t.userCredentials.id,userInfo:{id:t.id},cogsDimensionConstraints:[],catDimensionConstraints:[]}},o=i.userCredentials;if(Array.isArray(e.catCogsDimensionConstraints)&&e.catCogsDimensionConstraints.forEach(e=>{"CATEGORY_OPTION_GROUP_SET"===e.dimensionType?o.cogsDimensionConstraints.push({id:e.id}):o.catDimensionConstraints.push({id:e.id})}),Wt.forEach(t=>va(i,e[t],t)),Qt.forEach(t=>va(o,e[t],t)),i.attributeValues=Ra(e,r),delete o[qt],(a||e[Mt])&&(delete o.password,delete o.repeatPassword),!s)for(const l of n)t[l]&&!(l in i)&&(i[l]=t[l]);return i})(e,t,a,n),o=a?"/users/invite":"/users";return(t.id?this.d2Api.update("/users/".concat(t.id),i):this.d2Api.post(o,i)).then(t=>{if("ERROR"===t.status)return Promise.reject((e=>{const t=[];for(const a of e.typeReports)for(const e of a.objectReports)for(const a of e.errorReports)t.push({message:a.message});return{messages:t}})(t));const a=[],n=encodeURIComponent(e.username),i=e[Vt];i!==r&&a.push(this.d2Api.post(wa("Ui",n,i)));const o=e[jt];if(o!==s){const e="use_db_locale"===o?this.d2Api.delete("/userSettings/keyDbLocale?user=".concat(n)):this.d2Api.post(wa("Db",n,o));a.push(e)}return 0===a.length&&a.push(Promise.resolve("No locale changes detected")),Promise.all(a)})},this.getManagedUsers=()=>this.d2.models.user.list({fields:["id","displayName","userCredentials[username]"],paging:!1}).then(Ua),this.getAvailableUserGroups=()=>this.d2.models.userGroups.list({fields:["id","displayName"],paging:!1}),this.getGroupedAuthorities=()=>{if(this.groupedAuths)return Promise.resolve(this.groupedAuths);const e="".concat(this.getContextPath(),"/dhis-web-commons/security/getSystemAuthorities.action");return this.d2Api.request("GET",e).then(({systemAuthorities:e})=>this.groupedAuths=rt(e))},this.getCurrentUser=()=>this.d2.currentUser,this.getCurrentUserGroupsAndRoles=()=>this.d2Api.get("me",{fields:"userGroups[id],userCredentials[userRoles[id]]"}).then(e=>({userGroupIds:e.userGroups.map(({id:e})=>e),userRoleIds:e.userCredentials.userRoles.map(({id:e})=>e)})),this.initCurrentUser=()=>Promise.all([this.getCurrentUserGroupsAndRoles(),this.getCurrentUserOrgUnits(),this.getSystemOrgUnitRoots()]).then(([{userGroupIds:e,userRoleIds:t},{organisationUnits:a,dataViewOrganisationUnits:r,teiSearchOrganisationUnits:s},n])=>Object.assign(this.d2.currentUser,{userGroupIds:e,userRoleIds:t,organisationUnits:a,dataViewOrganisationUnits:r,teiSearchOrganisationUnits:s,systemOrganisationUnitRoots:n})),this.refreshCurrentUser=()=>{const e=Object.getPrototypeOf(this.d2.currentUser).constructor,t=this.d2.models;return Promise.all([this.d2Api.get("me",{fields:[":all","!userGroups","!organisationUnits","userCredentials[:all,!user,!userRoles]"]}),this.d2Api.get("me/authorization"),this.d2Api.get("userSettings")]).then(([a,r,s])=>(this.d2.currentUser=e.create(a,r,t,s),this.initCurrentUser()))},this.getCurrentUserOrgUnits=()=>this.d2.models.users.get(this.d2.currentUser.id,P),this.getSystemOrgUnitRoots=()=>this.d2.models.organisationUnits.list({paging:!1,level:1,fields:"id,path,displayName,children::isNotEmpty"}).then(e=>e.toArray()),this.updateCurrentUserGroupMembership=(e,t)=>{const a=t?"delete":"post",r="/users/".concat(this.d2.currentUser.id,"/userGroups/").concat(e);return this.d2Api[a](r)}}init(e){this.d2=e,this.d2Api=e.Api.getApi()}getAttributes(e){return this.d2Api.get("attributes",{fields:["id","displayName","mandatory","unique","valueType","optionSet[options[id,displayName]]"],filter:"".concat(e,"Attribute:eq:true"),paging:!1}).then(e=>e.attributes)}isAttributeUnique(e,t,a,r){return this.d2.models[e].filter().on("id").notEqual(t).filter().on("attributeValues.attribute.id").equals(a).filter().on("attributeValues.value").equals(r).list({paging:!1,fields:["id","attributeValues[value, attribute[id]]"]}).then(e=>{if(0===e.size)return!0;return 0===((e,t,a)=>e.toArray().reduce((e,r)=>e.concat(r.attributeValues.filter(e=>t===e.value&&a===e.attribute.id)),[]))(e,r,a).length})}saveRole(e){return e.id?this.d2Api.update("/userRoles/".concat(e.id),e):this.d2Api.post("/userRoles/",e)}},xa=a(383),Da=a(518),Fa=Object(Da.b)();const La=(e,t)=>({type:e,payload:t}),Pa=async(e,t,a,r)=>{r||e(La("LIST_REQUESTED",a));try{const r=await t;e(La("LIST_RECEIVED",{type:a,items:r}))}catch(s){e(La("LIST_ERRORED",{type:a,error:s}))}},ka=(e,t)=>(a,r)=>{const{filter:s,pager:n}=r(),i=n?n.page:1,o=Na.getList(e,i,s);Pa(a,o,e,t)},Ma=async(e,t,a)=>{a(La(e.requested));try{const r=await t;a(La(e.received,r))}catch(r){a(La(e.errored,r))}},Ga=(e,t)=>a=>{Ma({requested:"ITEM_REQUESTED",received:"ITEM_RECEIVED",errored:"ITEM_ERRORED"},Na.getItem(e,t),a)},Ba={requested:"CURRENT_USER_REQUESTED",received:"CURRENT_USER_RECEIVED",errored:"CURRENT_USER_ERRORED"},Va=()=>e=>{Ma(Ba,Na.refreshCurrentUser(),e)},ja=()=>La("CLEAR_ITEM"),Ha=(e,t)=>La("FILTER_UPDATED",{updateKey:e,updateValue:t}),qa=e=>La("SHOW_SNACKBAR",e),Wa=()=>La("HIDE_SNACKBAR"),Qa=(e,t)=>La("SHOW_DIALOG",{content:e,props:t}),Ya=()=>La("HIDE_DIALOG");var za=a(365),Ka=a.n(za),Xa=a(773),Ja=a.n(Xa),$a=a(1632),Za=a.n($a);var er=e=>{Fa.push(e)},tr=a(557),ar=a.n(tr),rr=a(801);Object(rr.addValueRenderer)(({value:e})=>"boolean"===typeof e,({value:e})=>e?n.a.createElement("div",{style:{width:"40px"}},n.a.createElement(ar.a,null)):null);a(1659),a(1660);const sr={dataTableWrap:{flex:1,marginBottom:"4rem"},clearBoth:{clear:"both"},filterBar:{display:"table",marginBottom:"1rem",width:"100%"},headerBarPagination:{float:"right",marginTop:"14px"},headerBarFilterWrap:{display:"table",marginRight:"230px"},pagination:{userSelect:"none"}};class nr extends s.Component{constructor(...e){super(...e),this.executeEditIfAllowed=e=>{const{isContextActionAllowed:t,primaryAction:a,showSnackbar:r,hideSnackbar:s}=this.props;t(e,"edit")?a(e):r({message:"".concat(c.a.t("You are not allowed to edit")," ").concat(e.displayName),action:c.a.t("Confirm"),autoHideDuration:null,onActionClick:s})}}componentDidMount(){const{items:e,getList:t,resetFilter:a,resetPager:r,entityType:s,listType:n}=this.props;null!==e&&n===s||(n!==s&&(a(),r()),t(s))}getPagerConfig(e){return e||{page:null,pageCount:null,total:null,currentlyShown:null}}renderPagination(){const{pager:e,items:t,incrementPage:a,decrementPage:r}=this.props,{page:s,pageCount:i,total:o,currentlyShown:l}=this.getPagerConfig(e),c=!t||0===t.length||"string"===typeof t?{...sr.pagination,visibility:"hidden"}:sr.pagination,d={hasNextPage:()=>s&&t&&t.length&&s<i,hasPreviousPage:()=>s&&t&&t.length&&s>1,onNextPageClick:()=>{a(e)},onPreviousPageClick:()=>{r(e)},total:o,currentlyShown:l,style:c};return n.a.createElement("div",{style:c},n.a.createElement(Z.Pagination,d))}renderHeaderBar(){const{filterComponent:e,entityType:t}=this.props;return n.a.createElement("div",{className:"data-table__filter-bar",style:sr.filterBar},n.a.createElement("div",{style:sr.headerBarPagination},this.renderPagination()),n.a.createElement("div",{style:sr.headerBarFilterWrap},n.a.createElement(e,{entityType:t})))}renderDataTable(){const{items:e,columns:t,contextMenuActions:a,contextMenuIcons:r,isContextActionAllowed:s}=this.props;if("string"===typeof e){const t=c.a.t("There was an error fetching the list");return n.a.createElement(te,{introText:t,errorMessage:e})}return null===e?n.a.createElement(Z.LoadingMask,null):0===e.length?n.a.createElement("div",{style:sr.clearBoth},"No results found."):n.a.createElement(Za.a,{rows:e,columns:t,primaryAction:this.executeEditIfAllowed,contextMenuActions:a,contextMenuIcons:r,isContextActionAllowed:s})}render(){const{sectionName:e,newItemPath:t,className:a}=this.props;return n.a.createElement("div",{style:sr.dataTableWrap,className:a},n.a.createElement(Z.Heading,null,e),this.renderHeaderBar(),this.renderDataTable(),this.renderPagination(),n.a.createElement(Ka.a,{className:"entity-list__add-new-entity",onClick:()=>er(t)},n.a.createElement(Ja.a,null)))}}nr.defaultProps={className:"paged-filterable-data-table"};var ir=Object(o.b)(e=>({listType:e.list.type,items:Ct(e.list.items,e.currentUser.userGroupIds),pager:St(e.pager)}),{getList:ka,resetFilter:()=>La("FILTER_RESET"),resetPager:()=>La("PAGER_RESET"),incrementPage:e=>(t,a)=>{const{list:{type:r}}=a();Pa(t,e.getNextPage(),r)},decrementPage:e=>(t,a)=>{const{list:{type:r}}=a();Pa(t,e.getPreviousPage(),r)},showSnackbar:qa,hideSnackbar:Wa})(nr);const or=()=>{D.dispatch(Va())},lr=()=>{const e=Na.getContextPath()+"/dhis-web-commons-security/logout.action";window.location.assign(e)};var cr=(e,t)=>{const{currentUser:a}=D.getState(),r=e.modelDefinition.name;r===Xt&&e.id===a.id&&(t?lr():or()),"userRole"===r&&a.userRoleIds.includes(e.id)&&or(),"userGroup"===r&&a.userGroupIds.includes(e.id)&&or()};const dr=({model:e,entityType:t})=>{const a={type:e.modelDefinition.displayName,displayName:e.displayName},r=c.a.t('Are you sure you want to remove the {{type}} "{{displayName}}"?',a),s=c.a.t('{{type}} "{{displayName}}" removed successfully',a),n=c.a.t('There was a problem removing {{type}} "{{displayName}}"?',a),i={message:r,action:c.a.t("Confirm"),autoHideDuration:null,onActionClick:()=>ur(e,s,n,t)};D.dispatch(qa(i))},ur=async(e,t,a,r)=>{D.dispatch(Wa());try{await e.delete(),D.dispatch(qa({message:t})),D.dispatch(ka(r)),cr(e)}catch(s){const e=ae(s,a);D.dispatch(qa({message:e}))}},pr=({data:e})=>{var t,a;D.dispatch((t=e.id,a=e.modelDefinition.name,La("SHOW_SHARING_DIALOG",{id:t,type:a})))};var hr=a(1785),mr=a(1784),gr=a(507),yr=a.n(gr);async function Er(e,t,a,r){const s=a.asyncErrors;if(!r&&!s)return Promise.resolve();let n;n="userForm"===a.form&&r===Pt?await fr(e,a):"groupForm"!==a.form||r!==Tt&&r!==At?await async function(e,t,a){const r=e[a];if(!r)return Promise.resolve();const s="userForm"===t.form?Xt:"userGroup",n=s===Xt?t.user.id||"_":t.group.id||"_",i=a.replace("userAttibute_","");try{if(!await Na.isAttributeUnique(s,n,i,r))return{[a]:c.a.t("Attribute value needs to be unique, value already taken.")}}catch(o){return{[a]:c.a.t("There was a problem checking if this attribute value is unique")}}}(e,a,r):await Ar(e,a,r);const i=s||n?{...s,...n}:void 0;if(i)throw i;return Promise.resolve()}async function br(e,t,a,r){if(!a)return Promise.resolve();const s=await r(e,t,a);if(s)throw s;return Promise.resolve()}async function fr(e,t){const a=e[Pt],r=t.form!==Tr&&t.user&&t.user.id;if(!a||r)return Promise.resolve();try{if((await Na.genericFind("users","userCredentials.username",a)).size>0)return{[Pt]:c.a.t("Username already taken")}}catch(s){return{[Pt]:c.a.t("There was a problem whilst checking the availability of this username")}}}async function Ar(e,t,a){const{group:r,role:s}=t,n=s||r,i=n.modelDefinition.name,o=e[a],l=yr()(a);if(!o)return Promise.resolve();try{const e=await Na.genericFind(i,a,o);if(e.size>0){if(e.values().next().value.id!==n.id)return{[a]:c.a.t("{{fieldDisplayName}} is already taken",{fieldDisplayName:l})}}}catch(d){const e=c.a.t("Could not verify if this {{fieldDisplayName}} is unique",{fieldDisplayName:l});return{[a]:ae(d,e)}}}const Tr="replicateUserForm";class _r extends s.Component{constructor(...e){super(...e),this.replicateUser=async e=>{const{user:t,hideDialog:a}=this.props,{username:r,password:s}=e;try{await Na.replicateUser(t.id,r,s),this.replicateSuccesHandler(t.displayName)}catch(n){this.replicateErrorHandler(n)}a()},this.replicateSuccesHandler=e=>{const{getList:t,showSnackbar:a}=this.props;a({message:c.a.t('User "{{displayName}}" replicated successfuly',{displayName:e})}),t(Xt,!0)},this.replicateErrorHandler=e=>{const{showSnackbar:t}=this.props;t({message:ae(e,c.a.t("There was a problem replicating the user"))})}}render(){const{submitting:e,pristine:t,valid:a,handleSubmit:r,hideDialog:s,asyncValidating:i}=this.props,o=Boolean(e||i||t||!a);return n.a.createElement("form",{autoComplete:"off",onSubmit:r(this.replicateUser)},n.a.createElement(hr.a,{name:Pt,component:ht,label:c.a.t("Username"),hintText:c.a.t("Username for new user"),validate:[ga],autoComplete:"new-password"}),n.a.createElement(hr.a,{name:"password",component:ht,label:c.a.t("Password"),hintText:c.a.t("Password for new user"),validate:[da],type:"password",autoComplete:"new-password"}),n.a.createElement("div",{style:{marginTop:16}},n.a.createElement(Ne.RaisedButton,{label:c.a.t("Replicate"),type:"submit",disabled:o,primary:!0}),n.a.createElement(Ne.RaisedButton,{label:c.a.t("Cancel"),onClick:s,style:{marginLeft:8}})))}}const Rr=Object(mr.a)({form:Tr,asyncValidate:async function(e,t,a,r){return br(e,a,r,fr)},asyncBlurFields:[Pt]})(_r);var Sr=Object(o.b)(e=>({formState:e.form[Tr]}),{getList:ka,hideDialog:Ya,showSnackbar:qa,hideSnackbar:Wa})(Rr);const Cr=(e,t)=>{const{currentUser:a}=D.getState();if(!e)return!1;const{access:r,userCredentials:{disabled:s,twoFA:n}}=e;switch(t){case"profile":return r.read;case"edit":return r.update;case"remove":return a.id!==e.id&&r.delete;case"replicate":return r.update&&a.authorities.has("F_REPLICATE_USER");case"disable":return r.update&&!s;case"enable":return r.update&&s;case"disable_2fa":return r.update&&n;default:return!0}},Ir={profile:"account_circle",edit:"edit",remove:"delete",replicate:"content_copy",disable:"block",enable:"playlist_add_check",disable_2fa:"phonelink_erase"},vr=Z.Action.createActionsFromNames(["profile","edit","remove","replicate","disable","enable","disable_2fa"]);vr.profile.subscribe(({data:{id:e}})=>{er("/users/view/".concat(e))}),vr.edit.subscribe(({data:{id:e}})=>{er("/users/edit/".concat(e))}),vr.remove.subscribe(({data:e})=>{dr({model:e,entityType:Xt})}),vr.replicate.subscribe(({data:e})=>{const t=n.a.createElement(Sr,{user:e}),a={onRequestClose:()=>D.dispatch(Ya()),title:c.a.t("Replicate user")};D.dispatch(Qa(t,a))}),vr.disable.subscribe(({data:e})=>{Ur(e,!0)}),vr.enable.subscribe(({data:e})=>{Ur(e,!1)}),vr.disable_2fa.subscribe(({data:e})=>{wr(e)});const wr=e=>{const t=c.a.t("Are you sure you want to disable two factor authentication for"),a={message:"".concat(t," ").concat(e.displayName),action:c.a.t("Confirm"),autoHideDuration:null,onActionClick:()=>Or(e)};D.dispatch(qa(a))},Or=async e=>{D.dispatch(Wa());const{displayName:t,id:a}=e;try{await Na.disable2FA(a);const e=c.a.t("Succesfully disabled two factor authentication for");D.dispatch(qa({message:"".concat(e," ").concat(t)})),D.dispatch(ka(Xt))}catch(r){D.dispatch(qa({message:ae(r,c.a.t("There was a problem updating two factor authentication"))}))}},Ur=(e,t)=>{const a=t?c.a.t("Are you sure you want to disable"):c.a.t("Are you sure you want to enable"),r={message:"".concat(a," ").concat(e.displayName),action:c.a.t("Confirm"),autoHideDuration:null,onActionClick:()=>Nr(e,t)};D.dispatch(qa(r))},Nr=async(e,t)=>{D.dispatch(Wa());const{displayName:a,id:r}=e;try{await Na.updateDisabledState(r,t);const s=t?c.a.t("sucessfully disabled"):c.a.t("successfully enabled");D.dispatch(qa({message:"".concat(a," ").concat(s)})),D.dispatch(ka(Xt)),t&&cr(e,!0)}catch(s){D.dispatch(qa({message:ae(s,c.a.t("There was a problem updating the enabled state"))}))}};var xr=a(227),Dr=a.n(xr),Fr=a(1664),Lr=a.n(Fr),Pr=a(1665),kr=a.n(Pr);class Mr extends s.Component{constructor(...e){super(...e),this.applyFilter=e=>{const{updateFilter:t,hideDialog:a,getList:r,selectedOrgUnits:s}=this.props;kr()(e,s)||(t("organisationUnits",e),r(Xt)),a()}}render(){const{selectedOrgUnits:e,hideDialog:t}=this.props;return n.a.createElement(we,{orgUnitType:"teiSearchOrganisationUnits",selectedOrgUnits:e,confirmSelection:this.applyFilter,cancel:t})}}var Gr=Object(o.b)(e=>({selectedOrgUnits:e.filter.organisationUnits}),{updateFilter:Ha,hideDialog:Ya,getList:ka})(Mr);const Br={wrap:{position:"relative",lineHeight:"24px",height:"72px",cursor:"pointer",float:"left",marginRight:"1rem"},icon:{position:"absolute",right:0,top:38,width:20,height:20,color:"rgba(0, 0, 0, 0.3)",cursor:"pointer"},textField:{cursor:"pointer",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",width:"152px"},input:{width:"calc(100% - 20px)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}};class Vr extends s.Component{constructor(...e){super(...e),this.inputRef=n.a.createRef(),this.focusOrgUnitInput=()=>{this.inputRef.current.orgUnitInput.focus()},this.showOrgTreeInDialog=()=>{const{showDialog:e,hideDialog:t}=this.props;e(n.a.createElement(Gr,null),{onRequestClose:t,title:c.a.t("Select an organisation unit"),contentStyle:{minHeight:"100vh"}})}}render(){const{organisationUnits:e}=this.props;return n.a.createElement("div",{style:Br.wrap,onClick:this.focusOrgUnitInput},n.a.createElement(Lr.a,{style:Br.icon}),n.a.createElement(Dr.a,{ref:this.inputRef,style:Br.textField,floatingLabelText:c.a.t("Organisation unit"),onFocus:this.showOrgTreeInDialog,value:e,inputStyle:Br.input}))}}var jr=Object(o.b)(e=>({organisationUnits:vt(e.filter.organisationUnits)}),{showDialog:Qa,hideDialog:Ya})(Vr);const Hr={float:"left",marginRight:"1rem",width:"236px"};class qr extends s.Component{constructor(e){super(e),this.updateSearchFilter=e=>{const{getList:t,entityType:a,updateFilter:r}=this.props;r("query",e),t(a)},this.onQueryStrChange=e=>{const t=e.target.value;this.setState({localQueryStr:t}),this.updateSearchFilter(t)},this.state={localQueryStr:e.filter.query},this.updateSearchFilter=ye()(this.updateSearchFilter,375)}render(){const{localQueryStr:e}=this.state;return n.a.createElement(W.a,{className:"search-input",floatingLabelText:c.a.t("Search by name"),style:Hr,hintText:"",value:e,type:"search",onChange:this.onQueryStrChange})}}var Wr=Object(o.b)(e=>({filter:e.filter}),{getList:ka,updateFilter:Ha})(qr);const Qr={float:"left",marginRight:"1rem"},Yr={...Qr,display:"inline-block",float:"left",width:"182px",paddingTop:"37px",height:"35px"};class zr extends s.Component{constructor(...e){super(...e),this.onFilterChange=(e,t)=>{const{getList:a,entityType:r,updateFilter:s,filter:n}=this.props;n[e]!==t&&(s(e,t),a(r))}}createInactiveMonthsOptions(){const e=c.a.t("month"),t=c.a.t("months");return Array(12).fill().map((a,r)=>{const s=r+1;return{id:s,displayName:1===s?"".concat(s," ").concat(e):"".concat(s," ").concat(t)}})}renderDropDown(e){const t={...e,includeEmpty:!0,emptyLabel:c.a.t("<No value>")};return n.a.createElement(Z.DropDown,t)}renderInactiveMonthsFilter(){const e={menuItems:this.createInactiveMonthsOptions(),floatingLabelText:c.a.t("Inactivity"),value:this.props.filter.inactiveMonths,onChange:e=>this.onFilterChange("inactiveMonths",e.target.value),style:{...Qr,width:"132px"}};return this.renderDropDown(e)}renderInvitationStatusFilter(){const e={menuItems:[{id:"all",displayName:c.a.t("All invitations")},{id:"expired",displayName:c.a.t("Expired invitations")}],floatingLabelText:c.a.t("Invitations"),value:this.props.filter.invitationStatus,onChange:e=>this.onFilterChange("invitationStatus",e.target.value),style:{...Qr,width:"172px"}};return this.renderDropDown(e)}renderSelfRegisteredFilter(){const e=this.props.filter.selfRegistered,t="".concat("data-table__filter-bar__checkbox","--checked");return n.a.createElement(Ne.Checkbox,{value:e,onCheck:(e,t)=>this.onFilterChange("selfRegistered",t),label:c.a.t("Self registrations"),className:e?t:"data-table__filter-bar__checkbox",style:Yr})}render(){const{entityType:e}=this.props;return n.a.createElement("div",null,n.a.createElement(Wr,{entityType:e}),n.a.createElement(jr,null),this.renderInactiveMonthsFilter(),this.renderInvitationStatusFilter(),this.renderSelfRegisteredFilter())}}var Kr=Object(o.b)(e=>({filter:e.filter}),{updateFilter:Ha,getList:ka})(zr);var Xr=()=>n.a.createElement(ir,{entityType:Xt,columns:["displayName","userName","lastLogin","disabled"],filterComponent:Kr,primaryAction:vr.edit,contextMenuActions:vr,contextMenuIcons:Ir,isContextActionAllowed:Cr,sectionName:c.a.t("User Management"),newItemPath:"/users/new",className:"user-list"}),Jr=a(321),$r=a(234),Zr=a.n($r);var es=({to:e,tooltip:t,icon:a})=>{const r=n.a.createElement(Zr.a,{iconClassName:"material-icons",tooltip:t},a);return e?n.a.createElement(Jr.a,{to:e},r):r},ts=a(804),as=a.n(ts);class rs extends s.Component{constructor(...e){super(...e),this.fields=[{name:"name",label:c.a.t("Name"),fieldRenderer:ht,isRequiredField:!0},{name:"description",label:c.a.t("Description"),fieldRenderer:ht},{name:"authorities",label:c.a.t("Authorities"),fieldRenderer:mt}],this.saveRole=async(e,t,a)=>{const{role:r,showSnackbar:s,clearItem:n,getList:i}=a,o={...r.toJSON(),name:e.name,description:e.description,authorities:e.authorities};try{await Na.saveRole(o);s({message:c.a.t('User role "{{displayName}}" saved successfully',{displayName:o.name})}),n(),i("userRole"),this.backToList(),cr(r)}catch(l){s({message:ae(l,c.a.t("There was a problem saving the user role."))})}},this.backToList=()=>{er("/user-roles")},this.render=()=>{const{handleSubmit:e,submitting:t,asyncValidating:a,pristine:r,valid:s}=this.props,i=Boolean(t||a||r||!s);return n.a.createElement("main",null,n.a.createElement("form",{autoComplete:"off",onSubmit:e(this.saveRole)},this.renderFields(),n.a.createElement("div",{style:{marginTop:"2rem"}},n.a.createElement(Re.a,{label:c.a.t("Save"),type:"submit",primary:!0,disabled:i,style:{marginRight:"8px"}}),n.a.createElement(Re.a,{label:c.a.t("Cancel"),onClick:this.backToList}))))}}renderFields(){return this.fields.map(e=>{const{name:t,fieldRenderer:a,label:r,isRequiredField:s,...i}=e,o=r+(s?" *":""),l="name"===t?[ha]:[];return n.a.createElement(hr.a,Object.assign({name:t,key:t,component:a,label:o,validate:l},i))})}}const ss=Object(mr.a)({form:"roleForm",asyncValidate:async function(e,t,a,r){return br(e,a,r,Ar)},asyncBlurFields:["name"]})(rs);var ns=Object(o.b)(e=>({role:e.currentItem,initialValues:{name:e.currentItem.name,description:e.currentItem.description,authorities:e.currentItem.authorities||[]}}),{clearItem:ja,showSnackbar:qa,getList:ka})(ss);class is extends s.Component{constructor(e){super(e),this.saveGroup=async(e,t,a)=>{const{group:r,showSnackbar:s,clearItem:n,getList:i}=a;r[At]=e[At],r[Tt]=e[Tt],r.users=e.users.map(this.createIdValueObject),r.managedGroups=e.managedGroups.map(this.createIdValueObject),r.attributeValues=Ra(e,this.state.attributeFields);try{await r.save();s({message:c.a.t('User group "{{displayName}}" saved successfully',{displayName:r.name})}),n(),i("userGroup"),this.backToList(),cr(r)}catch(o){s({message:ae(o,c.a.t("There was a problem saving the user group."))})}},this.backToList=()=>{er("/user-groups")},this.state={attributeFields:null},this.trashableAttributesPromise=null,this.fields=Rt()}async componentDidMount(){const{group:e,showSnackbar:t,initialize:a}=this.props;this.trashableAttributesPromise=me()(Na.getAttributes("userGroup"));try{const t=Ta(await this.trashableAttributesPromise,e.attributeValues);_a(t,this.props.asyncBlurFields),this.setState({attributeFields:t}),a(Ut(e,t))}catch(r){console.error(r),t({message:ae(r,c.a.t("Could not load the user group data. Please refresh the page."))})}}createIdValueObject(e){return{id:"string"===typeof e?e:e.id}}renderFields(e){const{group:t}=this.props;return e.map(e=>{const{name:a,fieldRenderer:r,label:s,isRequiredField:i,isAttributeField:o,fieldValidators:l,...c}=e,d=s+(i?" *":"");return r===Et&&(c.availableItemsQuery=Na[c.availableItemsQuery],i&&(c.assignedItemsLabel+=" *"),c.initialValues=e.initialItemsSelector(t)),c.validate=function(e,t,a,r,s){const n=[],i=r&&a;return t===At&&n.push(ha),"users"===t&&n.push(ma),t===Tt&&n.push(sa),i&&n.push(ha),r&&s&&n.push(...s),n}(this.props,a,i,o,l),n.a.createElement(hr.a,Object.assign({name:a,key:a,component:r,label:d,validate:[]},c))})}render(){const{handleSubmit:e,submitting:t,asyncValidating:a,pristine:r,valid:s}=this.props,{attributeFields:i}=this.state,o=Boolean(t||a||r||!s);return i?n.a.createElement("main",null,n.a.createElement("form",{autoComplete:"off",onSubmit:e(this.saveGroup)},this.renderFields(this.fields),this.renderFields(i),n.a.createElement("div",{style:{marginTop:"2rem"}},n.a.createElement(Re.a,{label:c.a.t("Save"),type:"submit",primary:!0,disabled:o,style:{marginRight:"8px"}}),n.a.createElement(Re.a,{label:c.a.t("Cancel"),onClick:this.backToList})))):n.a.createElement("div",{style:_t.loaderWrap},n.a.createElement(de.a,null))}}const os=Object(mr.a)({form:"groupForm",asyncValidate:Er,asyncBlurFields:[At,Tt]})(is);var ls=Object(o.b)(e=>({group:e.currentItem}),{clearItem:ja,showSnackbar:qa,getList:ka})(os),cs=a(1787),ds=a(253),us=a.n(ds),ps=a(743),hs=a.n(ps),ms=a(744),gs=a.n(ms);const ys={...r,userRoles:ma,organisationUnits:ma},Es=new Set([Pt,"password","repeatPassword","surname","firstName"]),bs=new Set(["email","surname","firstName"]),fs=new Set(["surname","firstName"]);class As extends s.Component{constructor(e){super(e),this.toggleShowMore=()=>{this.setState({showMore:!this.state.showMore})},this.handleSubmit=async(e,t,a)=>{const{user:r,inviteUser:s,showSnackbar:n,clearItem:i,getList:o}=a,l=this.state.locales.ui.selected,d=this.state.locales.db.selected;try{await Na.saveOrInviteUser(e,r,s,l,d,this.state.attributeFields);n({message:c.a.t('User "{{displayName}}" saved successfully',{displayName:"".concat(e.firstName," ").concat(e.surname)})}),i(),o(Xt),this.backToList(),cr(r)}catch(u){console.error(u),n({message:ae(u,c.a.t("There was a problem saving the user."))})}},this.backToList=()=>{er("/users")},this.state={showMore:!1,locales:null,attributeFields:null},this.trashableAttributesPromise=null,this.trashableLocalePromise=null,this.inviteFields=[{name:kt,label:c.a.t("Create account or email invitation"),fieldRenderer:yt,options:[{id:Yt,label:c.a.t("Create account with user details")},{id:zt,label:c.a.t("Email invitation to create account")}],props:{style:{}}}],this.baseFields=[{name:Pt,label:c.a.t("Username"),fieldRenderer:ht,isRequiredField:"CREATE_REQUIRED"},{name:"email",label:c.a.t("E-mail"),fieldRenderer:ht,isRequiredField:"INVITE_REQUIRED"},{name:Mt,label:c.a.t("External authentication only (OpenID or LDAP)"),fieldRenderer:gt},{name:"disabled",label:c.a.t("Disabled"),fieldRenderer:gt},{name:"password",label:c.a.t("Password"),fieldRenderer:ht,isRequiredField:"CREATE_REQUIRED",props:{type:"password",autoComplete:"new-password"}},{name:"repeatPassword",label:c.a.t("Retype password"),fieldRenderer:ht,isRequiredField:"CREATE_REQUIRED",props:{type:"password",autoComplete:"new-password"}},{name:"surname",label:c.a.t("Surname"),isRequiredField:"ALWAYS_REQUIRED",fieldRenderer:ht},{name:"firstName",label:c.a.t("First name"),isRequiredField:"ALWAYS_REQUIRED",fieldRenderer:ht},{name:Gt,label:c.a.t("OpenID"),fieldRenderer:ht},{name:Bt,label:c.a.t("LDAP identifier"),fieldRenderer:ht},{name:"phoneNumber",label:c.a.t("Mobile phone number"),fieldRenderer:ht},{name:"whatsApp",label:c.a.t("WhatsApp"),fieldRenderer:ht},{name:"facebookMessenger",label:c.a.t("Facebook Messenger"),fieldRenderer:ht},{name:"skype",label:c.a.t("Skype"),fieldRenderer:ht},{name:"telegram",label:c.a.t("Telegram"),fieldRenderer:ht},{name:"twitter",label:c.a.t("Twitter"),fieldRenderer:ht},{name:Vt,label:c.a.t("Interface language"),fieldRenderer:yt,optionsSelector:"locales.ui.available",isRequiredField:"ALWAYS_REQUIRED"},{name:jt,label:c.a.t("Database language"),fieldRenderer:yt,optionsSelector:"locales.db.available",isRequiredField:"ALWAYS_REQUIRED"},{name:"userRoles",fieldRenderer:Et,isRequiredField:"ALWAYS_REQUIRED",initialItemsSelector:e=>B(V("userCredentials.userRoles",e)||[]),availableItemsQuery:"getAvailableUserRoles",availableItemsLabel:c.a.t("Available roles"),assignedItemsLabel:c.a.t("Selected roles")},{name:Ht,label:c.a.t("Data capture and maintenance organisation units"),isRequiredField:"ALWAYS_REQUIRED",orgUnitType:Ht,fieldRenderer:bt,wrapperStyle:{...Lt.orgUnitTree,paddingRight:"60px"}},{name:"dataViewOrganisationUnits",label:c.a.t("Data output and analytic organisation units"),orgUnitType:"dataViewOrganisationUnits",fieldRenderer:bt,wrapperStyle:{...Lt.orgUnitTree,paddingLeft:"60px"}},{...Kt(),name:"org_unit_info_1"}],this.additionalFields=[{name:"teiSearchOrganisationUnits",label:c.a.t("Search Organisation Units"),orgUnitType:"teiSearchOrganisationUnits",fieldRenderer:bt,wrapperStyle:{...Lt.orgUnitTree,paddingRight:"60px"}},{...Kt(),name:"org_unit_info_2"},{name:"userGroups",fieldRenderer:Et,initialItemsSelector:e=>B(e.userGroups)||[],availableItemsQuery:"getAvailableUserGroups",availableItemsLabel:c.a.t("Available user groups"),assignedItemsLabel:c.a.t("Selected user groups")},{name:qt,fieldRenderer:Et,initialItemsSelector:e=>Nt(e),availableItemsQuery:"getAvailableDataAnalyticsDimensionRestrictions",availableItemsLabel:c.a.t("Available dimension restrictions for data analytics"),assignedItemsLabel:c.a.t("Selected dimension restrictions for data analytics"),returnModelsOnUpdate:!0}]}async componentDidMount(){const{user:e,showSnackbar:t,initialize:a}=this.props,r=e.id?e.userCredentials.username:null;this.trashableLocalePromise=me()(Na.getSelectedAndAvailableLocales(r)),this.trashableAttributesPromise=me()(Na.getAttributes(Xt));try{const t=await this.trashableLocalePromise,r=Ta(await this.trashableAttributesPromise,e.attributeValues);_a(r,this.props.asyncBlurFields),this.setState({locales:t,attributeFields:r}),a(Ot(e,t,r))}catch(s){console.error(s),t({message:ae(s,c.a.t("Could not load the user data. Please refresh the page."))})}}componentWillUnmount(){this.trashableLocalePromise.trash(),this.trashableAttributesPromise.trash()}getLabelText(e,t,a){const{inviteUser:r}=this.props;return"ALWAYS_REQUIRED"===a||r&&"INVITE_REQUIRED"===a||"CREATE_REQUIRED"===a&&!t.id&&!r||"boolean"===typeof a&&a?"".concat(e," *"):e}prepareGroupEditor(e,t,a,r){e.assignedItemsLabel=this.getLabelText(e.assignedItemsLabel,a,r),e.availableItemsQuery=Na[e.availableItemsQuery],e.initialValues=t.initialItemsSelector(a)}exludeField(e){const{user:t,inviteUser:a,externalAuthOnly:r}=this.props;return!(this.context.d2.system.systemInfo.emailConfigured&&!t.id||e!==kt)||(!(!a&&!r||"password"!==e&&"repeatPassword"!==e)||!(!a||![Mt,Gt,Bt].includes(e)))}renderFields(e){const{user:t}=this.props;return e.reduce((e,a)=>{const{name:r,fieldRenderer:s,label:i,isRequiredField:o,isAttributeField:l,fieldValidators:c,...d}=a,u=this.getLabelText(i,t,o);if(this.exludeField(r))return e;if(s===ft)return e.push(ft(a)),e;switch(s){case ht:d.hintText||(d.hintText=i),d.disabled=Boolean(r===Pt&&t.id);break;case bt:d.initialValues=B(t[a.name]);break;case Et:this.prepareGroupEditor(d,a,t,o);break;case yt:d.options=a.optionsSelector?V(a.optionsSelector,this.state):a.options}return d.validate=function(e,t,a,r,s){const n=[],i=Boolean(e.user.id),o=r&&a,l=ys[t],c=!r&&i?fs.has(t):e.inviteUser?bs.has(t):Es.has(t);return l&&n.push(l),(o||c)&&n.push(ha),r&&s&&n.push(...s),n}(this.props,r,o,l,c),e.push(n.a.createElement(hr.a,Object.assign({name:r,key:r,component:s,label:u},d))),e},[])}renderCreateOrInviteField(){return this.renderFields(this.inviteFields)}renderAttributeFields(){return this.renderFields(this.state.attributeFields)}renderBaseFields(){return this.renderFields(this.baseFields)}renderAdditionalFields(e){return e?n.a.createElement("div",{style:Lt.additionalFieldsWrap},this.renderFields(this.additionalFields)):null}renderToggler(e){const t=e?c.a.t("Show fewer options"):c.a.t("Show more options"),a=e?n.a.createElement(hs.a,null):n.a.createElement(gs.a,null);return n.a.createElement("div",{style:Lt.togglerWrap},n.a.createElement(us.a,{onClick:this.toggleShowMore,label:t,style:Lt.toggler,icon:a}))}render(){const{handleSubmit:e,submitting:t,asyncValidating:a,pristine:r,valid:s,inviteUser:i}=this.props,{showMore:o,locales:l}=this.state,d=Boolean(t||a||r||!s),u=!0===i?c.a.t("Send invite"):c.a.t("Save");return l?n.a.createElement("main",null,n.a.createElement("form",{autoComplete:"off",onSubmit:e(this.handleSubmit)},this.renderCreateOrInviteField(),this.renderBaseFields(),this.renderAttributeFields(),this.renderAdditionalFields(o),this.renderToggler(o),n.a.createElement("div",null,n.a.createElement(Re.a,{label:u,type:"submit",primary:!0,disabled:d,style:{marginRight:"8px"}}),n.a.createElement(Re.a,{label:c.a.t("Cancel"),onClick:this.backToList})))):n.a.createElement("div",{style:Lt.loaderWrap},n.a.createElement(de.a,null))}}As.contextTypes={d2:Ue.a.object.isRequired};const Ts=Object(cs.a)("userForm"),_s=Object(mr.a)({form:"userForm",asyncValidate:Er,asyncBlurFields:[Pt]})(As);var Rs=Object(o.b)(e=>({user:e.currentItem,fallbackOrgUnits:e.currentUser[Ht],inviteUser:Ft(e.form.userForm),externalAuthOnly:Boolean(Ts(e,Mt))}),{clearItem:ja,showSnackbar:qa,getList:ka})(_s);const Ss={main:{width:"100%",paddingLeft:"2rem"},heading:{paddingBottom:"1rem"},paper:{padding:"2rem 5rem 4rem"}};class Cs extends s.Component{componentDidMount(){const{match:{params:{id:e}},item:t,getItem:a,initNewItem:r,entityType:s}=this.props;!e||t&&t.id===e?e||r(s):a(s,e),this.formNotFoundErrorMsg=c.a.t("There was an error getting the form:")}renderForm(){const{entityType:e}=this.props;switch(e){case Xt:return n.a.createElement(Rs,null);case"userRole":return n.a.createElement(ns,null);case"userGroup":return n.a.createElement(ls,null);default:return n.a.createElement(te,{introText:this.formNotFoundErrorMsg,errorMessage:""})}}renderHeader(){const{match:{params:{id:e}},item:t,shortItem:a,entityType:r}=this.props,s=t&&t.id===e?t:a,i=s?s.modelDefinition.displayName:yr()(r),o=s?s.displayName:"",l="".concat(c.a.t("Update")," ").concat(i,": ").concat(o),d="".concat(c.a.t("Create new")," ").concat(i),u=e?l:d,p=s?"/".concat(as()(s.modelDefinition.plural)):null,h="".concat(c.a.t("Back to")," ").concat(i,"s");return n.a.createElement(Z.Heading,{style:Ss.heading},n.a.createElement(es,{to:p,tooltip:h,disabled:Boolean(p),icon:"arrow_back"}),u)}renderContent(){const{match:{params:{id:e}},item:t}=this.props;return"string"===typeof t?n.a.createElement(te,{introText:this.formNotFoundErrorMsg,errorMessage:t}):!t||t&&t.id!==e?n.a.createElement("div",{style:{textAlign:"center",paddingTop:"2rem"}},n.a.createElement(Ne.CircularProgress,null)):this.renderForm()}render(){return n.a.createElement("main",{style:Ss.main},this.renderHeader(),n.a.createElement(Ne.Paper,{style:Ss.paper},this.renderContent()))}}var Is=Object(o.b)((e,t)=>({item:e.currentItem,shortItem:xt(t.match.params.id,e.list.items)}),{getItem:Ga,initNewItem:e=>{const t=Na.getD2().models[e].create();return La("INIT_NEW_ITEM",t)}})(Cs);var vs=(e,t)=>{const a=Na.getD2().currentUser.userSettings.settings.keyUiLocale,r=new Date(e),s={day:"numeric",month:"long",year:"numeric"},n=t?{...s,hour:"2-digit",minute:"2-digit"}:s;return new Intl.DateTimeFormat(a,n).format(r)},ws=a(1674),Os=a.n(ws),Us=a(1675),Ns=a.n(Us);const xs={main:{width:"100%",paddingLeft:"2rem"},heading:{paddingBottom:"1rem"},raisedButton:{height:"36px",transform:"translateY(10px)",float:"right",marginLeft:"1rem"},paper:{padding:"1.4rem"},cell:{fontSize:"1rem",padding:"0.8rem",verticalAlign:"top"},valueCell:{textAlign:"right",color:"#757575"}};class Ds extends s.Component{componentDidMount(){const{baseName:e,routeId:t,getItem:a}=this.props;a(e,t)}getLabelForEntity(e){switch(e){case Xt:return c.a.t("Edit user");case"userGroup":return c.a.t("Edit user group");case"userRole":return c.a.t("Edit user role");default:return""}}renderSendMessageBtn(e){const t="".concat(Na.getContextPath(),"/dhis-web-messaging/#/PRIVATE/create/").concat(e);return n.a.createElement(Re.a,{style:xs.raisedButton,label:c.a.t("Send message"),secondary:!0,containerElement:n.a.createElement("a",{href:t}," "),icon:n.a.createElement(Ns.a,null)})}renderPropertyFields(){const{summaryObject:e,config:t}=this.props,a={...xs.cell,...xs.valueCell};return t.map((t,r)=>{const{key:s,removeText:i,parseDate:o,parseDateTime:l,nestedPropselector:d,parseArrayAsCommaDelimitedString:u,count:p}=t;let{label:h}=t;h=c.a.t(h);let m=e[s];return"undefined"===typeof m?m="":(d&&d.forEach(e=>{m=m[e]}),u&&("function"===typeof m.toArray&&(m=m.toArray()),m=m.map(e=>e[u]).join(", ")),i&&(m=yr()(m.replace(i,""))),(o||l)&&"string"===typeof m&&(m=vs(m,l)),p&&("number"===typeof m.size?m=m.size:"number"===typeof m.length&&(m=m.length))),n.a.createElement("tr",{key:r},n.a.createElement("td",{style:a},h),n.a.createElement("td",{style:xs.cell},m))})}render(){const{summaryObject:e,baseName:t}=this.props;if(null===e)return n.a.createElement(Z.LoadingMask,null);if("string"===typeof e){const a=c.a.t("There was an error fetching the ".concat(t));return n.a.createElement(te,{introText:a,errorMessage:e})}const{id:a,displayName:r,access:s}=e,i="".concat(t,"s"),o="/".concat(as()(i)),l=c.a.t("Back to ".concat(i)),d="".concat(o,"/edit/").concat(a),u=this.getLabelForEntity(t);return n.a.createElement("main",{style:xs.main},n.a.createElement(Z.Heading,{style:xs.heading},n.a.createElement(es,{to:o,tooltip:l,icon:"arrow_back"}),r,s.update?n.a.createElement(Re.a,{style:xs.raisedButton,label:u,primary:!0,containerElement:n.a.createElement(Jr.a,{to:d}),icon:n.a.createElement(Os.a,null)}):null,t===Xt?this.renderSendMessageBtn(a):null),n.a.createElement(Ne.Paper,{style:xs.paper},n.a.createElement("table",null,n.a.createElement("tbody",null,this.renderPropertyFields()))))}}var Fs=Object(o.b)(e=>({summaryObject:e.currentItem}),{getItem:Ga})(Ds);const Ls=()=>[{key:"displayName",label:c.a.t("Display name")},{key:"id",label:c.a.t("ID")}];var Ps=({match:{params:{id:e}}})=>n.a.createElement(Fs,{routeId:e,config:[...Ls(),{key:"userCredentials",nestedPropselector:["lastLogin"],label:c.a.t("Last login"),parseDateTime:!0},{key:"created",label:c.a.t("Created"),parseDate:!0},{key:"surname",label:c.a.t("Surname")},{key:"firstName",label:c.a.t("First name")},{key:"introduction",label:c.a.t("Introduction")},{key:"jobTitle",label:c.a.t("Job title")},{key:"employer",label:c.a.t("Works at")},{key:"education",label:c.a.t("Education")},{key:"interests",label:c.a.t("Interests")},{key:"nationality",label:c.a.t("Nationality")},{key:"birthday",label:c.a.t("Birthday"),parseDate:!0},{key:"gender",label:c.a.t("Gender"),removeText:"gender_"},{key:"languages",label:c.a.t("Speaks")},{key:"email",label:c.a.t("E-mail")},{key:"phoneNumber",label:c.a.t("Mobile phone number")},{key:"organisationUnits",label:c.a.t("Organisations units"),parseArrayAsCommaDelimitedString:"displayName"},{key:"userCredentials",label:c.a.t("User roles"),nestedPropselector:["userRoles"],parseArrayAsCommaDelimitedString:"displayName"}],baseName:Xt});const ks={width:"100%",textAlign:"center",padding:"1.5rem 1.5rem 1rem"};var Ms=({location:e})=>n.a.createElement("div",{style:ks},n.a.createElement("h1",null,c.a.t("Page not found.")),n.a.createElement("h3",null,c.a.t("No match for"),n.a.createElement("code",null," ",e.pathname)),n.a.createElement(Jr.a,{to:"/"}," ",c.a.t("Go back home"))),Gs=a(741),Bs=a.n(Gs),Vs=a(368),js=a.n(Vs),Hs=a(369),qs=a.n(Hs),Ws=a(370),Qs=a.n(Ws),Ys=a(417),zs=a.n(Ys);const Ks={padding:"0",margin:".5rem",marginTop:"1rem",float:"left",width:"230px"},Xs={padding:"1rem",height:"auto",borderBottom:"1px solid #ddd",cursor:"pointer",fontWeight:"bold"},Js={height:"85px",padding:".5rem 1rem"},$s={textAlign:"right"};class Zs extends s.Component{constructor(...e){super(...e),this.renderCard=(e,t)=>{const{currentUser:a,models:r}=this.context.d2,s=a.canCreate(r[e.entityType]),i=a.canDelete(r[e.entityType]),o=s||i;return o?n.a.createElement(Bs.a,{key:"card-".concat(t),style:Ks},n.a.createElement(js.a,{onClick:()=>er(e.path),style:Xs,title:e.label}),n.a.createElement(qs.a,{style:Js},e.description),n.a.createElement(Qs.a,{style:$s},this.renderActionButtons(e,o,s))):null}}renderActionButtons(e,t,a){const r=[],s="".concat(e.path,"/new");return a&&r.push(n.a.createElement(zs.a,{key:"add",iconClassName:"material-icons",tooltip:c.a.t("Add"),tooltipPosition:"top-center",onClick:()=>er(s)},"\ue145")),t&&r.push(n.a.createElement(zs.a,{key:"list",iconClassName:"material-icons",tooltip:c.a.t("list"),tooltipPosition:"top-center",onClick:()=>er(e.path)},"\ue8ef")),r}render(){const e=En().map(this.renderCard);return 0===e.length?n.a.createElement("div",null,c.a.t("You do not have access to any section of the DHIS 2 User Management App")):e}}Zs.contextTypes={d2:Ue.a.object};var en=Zs;const tn=(e,t)=>{if(!e)return!1;const{access:a}=e;switch(t){case"show_details":return a.read;case"sharing_settings":return a.manage;case"edit":return a.update;case"remove":return a.delete;default:return!0}},an={show_details:"info",sharing_settings:"share",edit:"edit",remove:"delete"},rn=Z.Action.createActionsFromNames([["show_details"],["sharing_settings"],["edit"],["remove"]]);rn.show_details.subscribe(({data:{id:e}})=>{er("/user-roles/view/".concat(e))}),rn.sharing_settings.subscribe(pr),rn.edit.subscribe(({data:{id:e}})=>{er("/user-roles/edit/".concat(e))}),rn.remove.subscribe(({data:e})=>{dr({model:e,entityType:"userRole"})});var sn=()=>n.a.createElement(ir,{entityType:"userRole",filterComponent:Wr,columns:["displayName","description"],primaryAction:rn.edit,contextMenuActions:rn,contextMenuIcons:an,isContextActionAllowed:tn,sectionName:c.a.t("User Role Management"),newItemPath:"/user-roles/new",className:"role-list"});var nn=({match:{params:{id:e}}})=>n.a.createElement(Fs,{routeId:e,config:[...Ls(),{key:"users",label:c.a.t("Members"),count:!0}],baseName:"userRole"});const on=(e,t)=>{if(!e)return!1;const{access:a}=e;switch(t){case"show_details":return a.read;case"sharing_settings":return a.manage;case"edit":return a.update;case"join_group":return a.update&&!e.currentUserIsMember;case"leave_group":return a.update&&e.currentUserIsMember;case"remove":return a.delete;default:return!0}},ln={show_details:"info",sharing_settings:"share",edit:"edit",join_group:"group_add",leave_group:"exit_to_app",remove:"delete"},cn=Z.Action.createActionsFromNames(["show_details","sharing_settings","edit","join_group","leave_group","remove"]),dn=async({displayName:e,id:t},a)=>{try{await Na.updateCurrentUserGroupMembership(t,a);const r=a?c.a.t("You left group"):c.a.t("You joined group");D.dispatch(qa({message:"".concat(r," ").concat(e)})),D.dispatch(Va())}catch(r){D.dispatch(qa({message:ae(r,c.a.t("There was a problem updating your group membership"))}))}};cn.show_details.subscribe(({data:{id:e}})=>{er("/user-groups/view/".concat(e))}),cn.sharing_settings.subscribe(pr),cn.edit.subscribe(({data:{id:e}})=>{er("/user-groups/edit/".concat(e))}),cn.join_group.subscribe(({data:e})=>{dn(e,!1)}),cn.leave_group.subscribe(({data:e})=>{dn(e,!0)}),cn.remove.subscribe(({data:e})=>{dr({model:e,entityType:"userGroup"})});class un extends s.Component{render(){return n.a.createElement(ir,{entityType:"userGroup",filterComponent:Wr,columns:["displayName","currentUserIsMember"],primaryAction:cn.edit,contextMenuActions:cn,contextMenuIcons:ln,isContextActionAllowed:on,sectionName:c.a.t("User Group Management"),newItemPath:"/user-groups/new",className:"group-list"})}}var pn=un;var hn=({match:{params:{id:e}}})=>n.a.createElement(Fs,{routeId:e,config:[...Ls(),{key:"users",label:c.a.t("Number of users"),count:!0}],baseName:"userGroup"});const mn=()=>({key:"user_section",label:c.a.t("User"),icon:"person",path:"/users",description:c.a.t("Create, modify, view and delete Users"),component:Xr,entityType:Xt}),gn=()=>({key:"user_role_section",label:c.a.t("User role"),icon:"folder_shared",path:"/user-roles",description:c.a.t("Create, modify, view and delete User Roles"),component:sn,entityType:"userRole"}),yn=()=>({key:"user_group_section",label:c.a.t("User group"),icon:"group",path:"/user-groups",description:c.a.t("Create, modify, view and delete User Groups"),component:pn,entityType:"userGroup"}),En=(()=>{let e=null;return()=>(e||(e=[mn(),gn(),yn()]),e)})();var bn=(()=>{let e=null;return()=>(e||(e=[{key:"user_new_view",path:"/users/new",render:e=>n.a.createElement(Is,Object.assign({entityType:Xt},e)),entityType:Xt},{key:"user_edit_view",path:"/users/edit/:id",render:e=>n.a.createElement(Is,Object.assign({entityType:Xt},e)),entityType:Xt},{key:"user_profile_view",path:"/users/view/:id",component:Ps,entityType:Xt},mn(),{key:"user_role_new_view",path:"/user-roles/new",render:e=>n.a.createElement(Is,Object.assign({entityType:"userRole"},e)),entityType:"userRole"},{key:"user_role_edit_view",path:"/user-roles/edit/:id",render:e=>n.a.createElement(Is,Object.assign({entityType:"userRole"},e)),entityType:"userRole"},{key:"user_role_details_view",path:"/user-roles/view/:id",component:nn,entityType:"userRole"},gn(),{key:"user_group_new_view",path:"/user-groups/new",render:e=>n.a.createElement(Is,Object.assign({entityType:"userGroup"},e)),entityType:"userGroup"},{key:"user_group_edit_view",path:"/user-groups/edit/:id",render:e=>n.a.createElement(Is,Object.assign({entityType:"userGroup"},e)),entityType:"userGroup"},{key:"user_group_details_view",path:"/user-groups/view/:id",component:hn,entityType:"userGroup"},yn(),{key:"landing_page",path:"/",component:en},{key:"not_found",component:Ms}]),e)})();const fn={display:"flex",flex:"0 0 320px"};class An extends s.Component{constructor(...e){super(...e),this.changeSectionHandler=e=>{const{sections:t,history:a}=this.props,r=t.find(t=>t.key===e);a.push(r.path)}}render(){const{sections:e,location:{pathname:t}}=this.props,a=e.find(e=>e.path===t),r="/"===t,s=a?a.key:null;return a||r?n.a.createElement("div",{style:fn},n.a.createElement(Z.Sidebar,{sections:e,onChangeSection:this.changeSectionHandler,currentSection:s})):null}}var Tn=Object(xa.e)(An);const _n={display:"flex",flex:"1 1 0%",paddingRight:"2rem",paddingTop:"1rem"};class Rn extends s.Component{componentDidMount(){const{initCurrentUser:e,currentUser:t}=this.props;t?this.setRouteConfig(t):e()}componentWillReceiveProps({currentUser:e,location:{pathname:t}}){this.setRouteConfig(e),e&&e!==this.props.currentUser&&"/"!==t&&!this.pathHasAvailableSection(t)&&er("/")}pathHasAvailableSection(e){if(!this.routeConfig)return!1;const{sections:t}=this.routeConfig;return Boolean(t&&t.find(t=>e.includes(t.path.split(":")[0])))}setRouteConfig(e){this.routeConfig=e?bn().reduce((t,a)=>{const{routes:r,sections:s}=t;return this.userHasAuthorities(a,e)&&(r.push(a),a.label&&s.push(a)),t},{routes:[],sections:[]}):null}userHasAuthorities({entityType:e},t){if(!e)return!0;const{models:a}=this.context.d2,r=t.canCreate(a[e]),s=t.canDelete(a[e]);return r||s}renderRoutes(e){return e.map(e=>n.a.createElement(xa.a,Object.assign({key:e.key,exact:!0,strict:!0},e)))}renderContent(){const{currentUser:e}=this.props;if(!e)return n.a.createElement(Z.LoadingMask,null);if("string"===typeof e){const t=c.a.t("There was an error loading the current user");return n.a.createElement(te,{introText:t,errorMessage:e})}const{routes:t,sections:a}=this.routeConfig;if(a&&0===a.length){const e=c.a.t("You do not have authorities to see users, user roles or user groups");return n.a.createElement(te,{introText:e,errorMessage:""})}return[n.a.createElement(Tn,{key:"sidenav",sections:a}),n.a.createElement(xa.c,{key:"routeswitch"},this.renderRoutes(t))]}render(){return n.a.createElement("main",{style:_n},this.renderContent())}}Rn.contextTypes={d2:Ue.a.object};var Sn=Object(xa.e)(Object(o.b)(({currentUser:e})=>({currentUser:e}),{initCurrentUser:()=>e=>{Ma(Ba,Na.initCurrentUser(),e)}})(Rn)),Cn=a(485),In=a.n(Cn);var vn=Object(o.b)(e=>({open:e.popups.snackbar.show,snackbarProps:e.popups.snackbar.props}),{hideSnackbar:Wa})(({open:e,snackbarProps:t,hideSnackbar:a})=>{const r={...{autoHideDuration:6e3,onRequestClose:a,style:{whiteSpace:"nowrap"},bodyStyle:{maxWidth:"100%"},contentStyle:{display:"flex"}},...t};return n.a.createElement(In.a,Object.assign({open:e},r))}),wn=a(312),On=a.n(wn);var Un=Object(o.b)(e=>({open:e.popups.dialog.show,dialogProps:e.popups.dialog.props,content:e.popups.dialog.content}))(({open:e,dialogProps:t,content:a})=>n.a.createElement(On.a,Object.assign({key:"dialog",open:e},t),a)),Nn=a(1676),xn=a.n(Nn);var Dn=Object(o.b)(e=>({open:e.popups.sharing.show,id:e.popups.sharing.id,type:e.popups.sharing.type}),{hideSharingDialog:()=>La("HIDE_SHARING_DIALOG")})(({open:e,id:t,type:a,hideSharingDialog:r})=>n.a.createElement(xn.a,{open:e,id:t,type:a,onRequestClose:r,d2:Na.getD2()}));var Fn=()=>n.a.createElement("div",null,n.a.createElement(xa.b,{history:Fa,hashType:"noslash"},n.a.createElement(Sn,null)),n.a.createElement(vn,null),n.a.createElement(Un,null),n.a.createElement(Dn,null)),Ln=a(346),Pn=a.n(Ln),kn=a(438),Mn=a.n(kn),Gn=a(345),Bn=a.n(Gn),Vn=a(228);const jn={spacing:Mn.a,fontFamily:"Roboto, sans-serif",palette:{primary1Color:G.blue500,primary2Color:G.blue700,primary3Color:G.blue100,accent1Color:G.orange500,accent2Color:G.grey100,accent3Color:G.orangeA200,textColor:G.darkBlack,alternateTextColor:G.white,canvasColor:G.white,borderColor:G.grey400,disabledColor:Object(Vn.fade)(G.darkBlack,.3)}},Hn=Bn()(jn);var qn=Object.assign({},Hn,{forms:{minWidth:350,maxWidth:750},formInput:{fontWeight:100}});class Wn extends s.Component{constructor(...e){super(...e),this.getChildContext=()=>({d2:this.props.d2}),this.render=()=>n.a.createElement(Pn.a,{muiTheme:qn},this.props.children)}}Wn.childContextTypes={d2:Ue.a.object};var Qn=Wn;a(1778),a(1779);t.default=()=>{const{d2:e}=Object(i.a)({d2Config:{schemas:["userRole","user","userGroup","userCredentials","organisationUnit"]},i18nRoot:"./d2i18n",onInitialized:e=>{Na.init(e)}});return e?n.a.createElement(o.a,{store:D},n.a.createElement(Qn,{d2:e},n.a.createElement(Fn,null))):n.a.createElement(Qn,null,n.a.createElement("div",{className:"page-loader-wrap"},n.a.createElement(Ne.CircularProgress,{size:48})))}}}]);
//# sourceMappingURL=app.095d9768.chunk.js.map