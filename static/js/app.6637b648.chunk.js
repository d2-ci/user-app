(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[127],{1628:function(e,t,a){},1779:function(e,t,a){},1783:function(e,t,a){"use strict";a.r(t);var r={};a.r(r),a.d(r,"code",(function(){return na})),a.d(r,"date",(function(){return ia})),a.d(r,"email",(function(){return oa})),a.d(r,"integer",(function(){return la})),a.d(r,"negativeInteger",(function(){return ca})),a.d(r,"number",(function(){return da})),a.d(r,"password",(function(){return ua})),a.d(r,"positiveInteger",(function(){return pa})),a.d(r,"repeatPassword",(function(){return ha})),a.d(r,"required",(function(){return ma})),a.d(r,"requiredArray",(function(){return ga})),a.d(r,"username",(function(){return ya})),a.d(r,"whatsApp",(function(){return Ea}));var s=a(1),n=a.n(s),i=a(1780),o=a(194),l=a(5),c=a.n(l),d=a(388),u=a(948),p=a.n(u),h=a(561),m=a.n(h),g=a(325),y=a(949),E=(a(950),a(1786));const b={type:null,items:null};var f=(e=b,{type:t,payload:a})=>{switch(t){case"LIST_REQUESTED":return{type:a,items:null};case"LIST_RECEIVED":return e.type===a.type?{type:a.type,items:a.items}:e;case"LIST_ERRORED":return{type:null,items:a.message};default:return e}};const A={query:"",inactiveMonths:null,selfRegistered:!1,invitationStatus:null,organisationUnits:[]},T={show:!1,props:{message:""}},_={show:!1,props:{},content:null},R={show:!1,id:null,type:null};var S=(e=A,{type:t,payload:a})=>{switch(t){case"FILTER_UPDATED":return{...e,[a.updateKey]:a.updateValue};case"FILTER_RESET":return{...A};default:return e}};var C=(e=null,{type:t,payload:a})=>{switch(t){case"PAGER_RESET":return null;case"LIST_RECEIVED":return a.items.pager;default:return e}};var I=(e=null,{type:t,payload:a})=>{switch(t){case"CLEAR_ITEM":case"ITEM_REQUESTED":return null;case"INIT_NEW_ITEM":case"ITEM_RECEIVED":case"ITEM_ERRORED":return a;default:return e}};var v=(e=null,{type:t,payload:a})=>{switch(t){case"CURRENT_USER_REQUESTED":return null;case"CURRENT_USER_RECEIVED":case"CURRENT_USER_ERRORED":return a;default:return e}};var w=(e=T,{type:t,payload:a})=>{switch(t){case"SHOW_SNACKBAR":return{show:!0,props:a};case"HIDE_SNACKBAR":return{...T};default:return e}};var O=(e=_,{type:t,payload:a})=>{switch(t){case"SHOW_DIALOG":return{show:!0,...a};case"HIDE_DIALOG":return{..._};default:return e}};var U=(e=R,{type:t,payload:a})=>{switch(t){case"SHOW_SHARING_DIALOG":return{show:!0,...a};case"HIDE_SHARING_DIALOG":return{...R};default:return e}};var N=Object(g.c)({snackbar:w,dialog:O,sharing:U});const x=[y.a];const F=Object(g.c)({list:f,filter:S,pager:C,currentItem:I,currentUser:v,popups:N,form:E.a});var D=Object(g.d)(F,Object(g.a)(...x));const L=["displayName","id","access","user[displayName,id]","publicAccess","userGroupAccesses"],P=[...L,"description"],k={fields:["organisationUnits[id,path,displayName,children::isNotEmpty]","dataViewOrganisationUnits[id,path,displayName,children::isNotEmpty]","teiSearchOrganisationUnits[id,path,displayName,children::isNotEmpty]"]},M={paging:!1,fields:["id","path","displayName","children::isNotEmpty","ancestors"]};var G={USER_LIST:["displayName","id","access","userCredentials[username,disabled,lastLogin,twoFA]","teiSearchOrganisationUnits[id,path]"],USER_GROUP_LIST:L,USER_ROLE_LIST:P,USER_DETAILS:[":owner","access","displayName","userGroups","organisationUnits[id,displayName,path]","dataViewOrganisationUnits[id,displayName,path]","userCredentials[id,username,lastLogin,externalAuth,userRoles[id,displayName],cogsDimensionConstraints[id,displayName,dimensionType],catDimensionConstraints[id,displayName,dimensionType],openId,ldapId]","teiSearchOrganisationUnits[id,path]","whatsApp","facebookMessenger","skype","telegram","twitter"],USER_GROUP_DETAILS:[":owner","access","displayName"],USER_ROLE_DETAILS:[":owner","access","authorities","displayName"]},B=a(217);var V=e=>e?"function"===typeof e.toArray?e.toArray():e:[];var j=(e,t)=>e.split(".").reduce((e,t)=>e&&e[t]?e[t]:null,t),H=a(953),q=a.n(H),W=a(286),Q=a.n(W),Y=a(581),z=a.n(Y),K=a(590),X=a.n(K),$=a(228),J=a.n($),Z=a(1015),ee=a(198);const te={clear:"both",color:"#c33017",backgroundColor:"#ffe3de",padding:"1.5rem 1.5rem 1rem",fontSize:"1rem",width:"100%"};var ae=({introText:e,errorMessage:t})=>n.a.createElement("div",{style:te},e,n.a.createElement("pre",null,t));var re=({message:e,messages:t,httpStatusCode:a},r)=>{const s=r||c.a.t("Something went wrong when processing your request."),n=a&&a>=400&&a<500||!a&&t&&t.length>0;return!e&&t&&t.length>0&&(e=t.map(({message:e})=>e).join(", ")),n?e:s};const se={outerWrap:{paddingTop:0,paddingBottom:"2.5rem"},headerWrap:{display:"flex"},headerSpacer:{flex:"0 0 120px"},header:{flex:"1 0 120px",paddingBottom:0,fontSize:"1.2rem"},error:{color:B.red500},errorText:{fontSize:"0.8rem",marginLeft:"0.8rem"}};class ne extends s.Component{constructor(e){super(e),this.availableItemsReceivedHandler=e=>{const{initiallyAssignedItems:t,returnModelsOnUpdate:a}=this.props,{itemStore:r,assignedItemStore:s}=this.state;a&&(this.modelLookup=new Map);const n=V(t).map(({id:e})=>e),i=V(e).map(e=>{a&&this.modelLookup.set(e.id,e);const t=e.displayName||e.name;return{value:e.id,text:t}});r.setState(i),s.setState(n)},this.onAssignItems=e=>{const{assignedItemStore:t}=this.state,a=t.state.concat(e);return this.update(a)},this.onRemoveItems=e=>{const{assignedItemStore:t}=this.state,a=t.state.filter(t=>-1===e.indexOf(t));return this.update(a)},this.updateFilterText=e=>{this.setState({filterText:e.target.value})},this.state={itemStore:ee.Store.create(),assignedItemStore:ee.Store.create(),filterText:"",fetchErrorMsg:null}}async componentDidMount(){try{const e=await this.props.availableItemsQuery();this.availableItemsReceivedHandler(e)}catch(e){const t=re(e,c.a.t("Could not load available items"));this.setState({fetchErrorMsg:t})}}update(e){const{onChange:t,returnModelsOnUpdate:a,onBlur:r}=this.props,{assignedItemStore:s}=this.state,n=a?e.map(e=>this.modelLookup.get(e)):e;return s.setState(e),t(n),r&&r(),Promise.resolve()}renderHeader(){const{availableItemsHeader:e,assignedItemsHeader:t,errorText:a}=this.props,r=a?{...se.header,...se.error}:se.header;return n.a.createElement("div",{style:se.headerWrap},n.a.createElement(ee.Heading,{level:4,style:se.header},e),n.a.createElement("div",{style:se.headerSpacer}),n.a.createElement(ee.Heading,{level:4,style:r},t,a?n.a.createElement("span",{style:se.errorText},a):null))}renderSearchInput(){return n.a.createElement(Q.a,{fullWidth:!0,type:"search",onChange:this.updateFilterText,value:this.state.filterText,floatingLabelText:c.a.t("Filter"),hintText:c.a.t("Filter available and selected items"),style:{marginTop:"-16px"}})}renderGroupEditor(){const{itemStore:e,assignedItemStore:t,filterText:a,fetchErrorMsg:r}=this.state;if(r){const e=c.a.t("There was a problem displaying the GroupEditor");return n.a.createElement(ae,{introText:e,errorMessage:r})}return n.a.createElement(Z.GroupEditor,{itemStore:e,assignedItemStore:t,onAssignItems:this.onAssignItems,onRemoveItems:this.onRemoveItems,height:250,filterText:a})}render(){return n.a.createElement("div",{style:se.outerWrap},this.renderHeader(),this.renderSearchInput(),this.renderGroupEditor())}}var ie=ne,oe=a(1531),le=a(201),ce=a.n(le),de=a(254),ue=a.n(de),pe=a(475),he=a.n(pe),me=a(382),ge=a.n(me),ye=a(506),Ee=a.n(ye);const be={error:{info:{color:B.blue500},warning:{color:B.orange500},error:{color:B.red500}}},fe=[{text:"loading...",value:n.a.createElement(J.a,{style:{textAlign:"center"}},n.a.createElement(ue.a,{style:{marginTop:"12px"}}))}],Ae={filteredItems:[],searchWarning:null,errorStyle:be.error.info};class Te extends s.Component{constructor(e){super(e),this.onAutoCompleteChange=e=>{this.setState({autoCompleteText:e}),this.getItems(e)},this.getItems=async e=>{const{minCharLength:t,query:a,queryParam:r}=this.props;if(!e||e.length<t){const a=e?c.a.t("Please enter at least {{ minCharCount }} characters",{minCharCount:t}):null;this.setState({...Ae,searchWarning:a})}else{this.setState({...Ae,filteredItems:fe}),this.trashableQuery=ge()(a(e,r));try{let e=await this.trashableQuery;if(e=V(e),e.length>0){const t=e.map(e=>({text:e.displayName,value:e}));this.setState({...Ae,filteredItems:t})}else this.setState({...Ae,errorStyle:be.error.warning,searchWarning:c.a.t("No matches found")})}catch(s){this.setState({...Ae,errorStyle:be.error.warning,searchWarning:re(s,c.a.t("There was a problem retreiving your search results"))})}}},this.onItemSelect=e=>{const{selectHandler:t}=this.props;this.setState({autoCompleteText:""}),t(e)};const t=e.queryDebounceTime||375;this.state={...Ae},this.getItems=Ee()(this.getItems,t),this.trashableQuery=null}componentWillUnmount(){this.trashableQuery&&this.trashableQuery.trash()}render(){const{autoCompleteProps:e}=this.props,t={floatingLabelText:c.a.t("Search"),hintText:c.a.t("Enter search term"),fullWidth:!0,type:"search",filter:()=>!0,...e},{filteredItems:a,searchWarning:r,errorStyle:s,autoCompleteText:i}=this.state,o=r?0:28,l={...t,onUpdateInput:this.onAutoCompleteChange,onNewRequest:this.onItemSelect,searchText:i,dataSource:a,errorText:r,errorStyle:s,floatingLabelShrinkStyle:s,style:{marginBottom:o},menuStyle:{maxHeight:"600px"}};return n.a.createElement(he.a,l)}}Te.defaultProps={queryDebounceTime:375,minCharLength:3};var _e=Te,Re=a(243),Se=a.n(Re),Ce=a(1627),Ie=a.n(Ce);const ve={wrapper:{minHeight:"300px",maxHeight:"60vh",position:"relative"},scrollBox:{position:"relative",marginTop:"-12px",maxHeight:"calc(60vh - 154px)",minHeight:"calc(300px - 154px)",overflowY:"auto",paddingTop:"8px",paddingBottom:"8px",borderRadius:"2px"},loader:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},buttonStrip:{paddingTop:"16px",height:"36px"},buttonMargin:{marginRight:"8px"},header:{paddingBottom:0,fontSize:"1.2rem",marginBottom:"-16px"},headerError:{color:B.red500},errorText:{fontSize:"0.8rem",marginLeft:"0.8rem"}};class we extends s.Component{constructor(e){super(e),this.toggleSelectedOrgUnits=(e,t)=>{const{selectedOrgUnits:a}=this.state,r=this.getIndexOfOrgUnit(t),s=-1===r?[...a,t]:[...a.slice(0,r),...a.slice(r+1)];this.update(s,[])},this.selectAndShowFilteredOrgUnit=e=>{const t=e.value,{selectedOrgUnits:a}=this.state,r=[this.removeLastPathSegment(t)],s=[...a,t];this.update(s,r)},this.clearSelection=()=>{this.update([]),Ie()(this.applySelection)},this.applySelection=()=>{const{selectedOrgUnits:e}=this.state,{confirmSelection:t}=this.props;t(e)},this.state={roots:null,selectedOrgUnits:[...e.selectedOrgUnits],orgUnitFilter:null,initiallyExpanded:this.getInitiallyExpandedItems(e.selectedOrgUnits)}}getInitiallyExpandedItems(e){return e.reduce((e,t)=>{const a=this.removeLastPathSegment(t);return a&&e.push(a),e},[])}getIndexOfOrgUnit(e){const{selectedOrgUnits:t}=this.state,a=t.find(t=>t.path===e.path);return t.indexOf(a)}removeLastPathSegment({path:e}){return e.substr(0,e.lastIndexOf("/"))}update(e,t){const{onChange:a,onBlur:r}=this.props,s=t?{selectedOrgUnits:e,initiallyExpanded:t}:{selectedOrgUnits:e};a&&a(e.map(e=>e.id)),this.setState(s),r&&r()}render(){const{selectedOrgUnits:e,initiallyExpanded:t,orgUnitFilter:a}=this.state,{roots:r,confirmSelection:s,cancel:i,orgUnitType:o,headerText:l,wrapperStyle:d,errorText:u}=this.props,p=e.map(e=>e.path),h={floatingLabelText:c.a.t("Search"),hintText:c.a.t("Enter search term"),fullWidth:!0},m=u?{...ve.header,...ve.headerError}:ve.header;return n.a.createElement("div",{style:{...ve.wrapper,...d}},l?n.a.createElement(ee.Heading,{level:4,style:m},l,u&&n.a.createElement("span",{style:ve.errorText},u)):null,n.a.createElement(_e,{autoCompleteProps:h,query:xa.queryOrgUnits,queryParam:o,minCharLength:2,queryDebounceTime:375,selectHandler:this.selectAndShowFilteredOrgUnit}),n.a.createElement(ce.a,{style:ve.scrollBox},r?n.a.createElement(oe.OrgUnitTreeMultipleRoots,{roots:r,onSelectClick:this.toggleSelectedOrgUnits,selected:p,initiallyExpanded:t,orgUnitsPathsToInclude:a}):n.a.createElement(ue.a,{style:ve.loader})),s?n.a.createElement("div",{style:ve.buttonStrip},n.a.createElement(Se.a,{label:c.a.t("Apply"),primary:!0,style:ve.buttonMargin,onClick:this.applySelection,disabled:!r}),n.a.createElement(Se.a,{label:c.a.t("Clear all"),secondary:!0,style:ve.buttonMargin,onClick:this.clearSelection,disabled:!r}),n.a.createElement(Se.a,{onClick:i,label:c.a.t("Cancel")})):null)}}var Oe=Object(o.b)((e,t)=>({roots:Dt(t.orgUnitType,e.currentUser)}))(we),Ue=a(3),Ne=a.n(Ue),xe=(a(1628),a(231));class Fe extends s.Component{constructor(e){super(e),this.onSelectedOnlyChange=(e,t)=>{this.setState({selectedOnly:t}),this.props.onFilterChange(this.state.searchStr,t)},this.onSearchStrChange=e=>{const t=e.target.value;this.setState({searchStr:t}),this.props.onFilterChange(t,this.state.selectedOnly)},this.state={searchStr:"",selectedOnly:!1}}render(){return n.a.createElement("div",{className:"authority-editor__filterbar"},n.a.createElement(xe.TextField,{className:"authority-editor__filter-text-input search-input",floatingLabelText:c.a.t("Search"),onChange:this.onSearchStrChange,type:"search"}),n.a.createElement(xe.Checkbox,{className:"authority-editor__filter-checkbox",label:c.a.t("Selected authorities only"),checked:this.state.selectedOnly,onCheck:this.onSelectedOnlyChange,style:{width:"300px"}}))}}var De=Fe;var Le=(e,t,a,r)=>a||r?Object.keys(e).reduce((s,n)=>{const i=e[n],o=i.items.filter(e=>{const s=((e,t)=>{if(!t)return!0;const a=e.name.toLowerCase();return t.some(e=>!(e.length<=1&&t.length>1)&&a.indexOf(e)>-1)})(e,a),n=((e,t,a)=>!t||(e.items&&e.items.length?e.items.some(e=>a.get(e.id)):Boolean(a.get(e.id))))(e,r,t);return s&&n});return s[n]={...i,items:o},s},{}):e,Pe=a(797),ke=a.n(Pe),Me=a(1629),Ge=a.n(Me);var Be=({text:e,searchChunks:t})=>t?n.a.createElement(Ge.a,{highlightClassName:"authority-editor__search-highlight",searchWords:t,autoEscape:!0,textToHighlight:e}):e;class Ve extends s.Component{constructor(...e){super(...e),this.onChecked=(e,t)=>{const{authSubject:{id:a},onCheckedCallBack:r}=this.props;r([a],t)}}render(){const{authSubject:e,withLabel:t,disabled:a}=this.props,{searchChunks:r}=this.context,{name:s,empty:i,implicit:o}=e,l=t?"authority-editor__auth-checkbox":"".concat("authority-editor__auth-checkbox","--without-label"),c=t?n.a.createElement(Be,{text:s,searchChunks:r}):"";return n.a.createElement("td",null,i?n.a.createElement("div",{className:"authority-editor__empty-cell"}):n.a.createElement(xe.Checkbox,{onCheck:this.onChecked,label:c,className:l,checked:this.props.selected||Boolean(o),disabled:o||a}))}}Ve.contextTypes={searchChunks:Ne.a.array};var je=Ve,He=a(1630),qe=a.n(He),We=a(1631),Qe=a.n(We);var Ye=(()=>{let e=null;return()=>(e||(e=new Map([["ALL",c.a.t("All (Full authority)")],["F_ANALYTICSTABLEHOOK",c.a.t("Analytics Table Hook")],["F_ATTRIBUTE",c.a.t("Attribute")],["F_CATEGORY_COMBO",c.a.t("Category Combo")],["F_CATEGORY",c.a.t("Category")],["F_CATEGORY_OPTION",c.a.t("Category Option")],["F_CATEGORY_OPTION_GROUP",c.a.t("Category Option Group")],["F_CATEGORY_OPTION_GROUP_SET",c.a.t("Category Option Group Set")],["F_COLOR_SET",c.a.t("Color Set")],["F_CONSTANT",c.a.t("Constant")],["F_DASHBOARD",c.a.t("Dashboard")],["F_DATAELEMENTGROUPSET",c.a.t("Data Element Group Sets")],["F_DATAELEMENTGROUP",c.a.t("Data Element Groups")],["F_DATAELEMENT",c.a.t("Data Element")],["F_DATAELEMENT_MINMAX",c.a.t("Min/max rule")],["F_DATASET",c.a.t("Data Set")],["F_DATAVALUE",c.a.t("Data Value")],["F_DOCUMENT",c.a.t("Document")],["F_EVENTCHART",c.a.t("Event Chart")],["F_EVENTREPORT",c.a.t("Event Report")],["F_EXTERNAL_MAP_LAYER",c.a.t("External Map Layer")],["F_INDICATORGROUPSET",c.a.t("Indicator Group Sets")],["F_INDICATORGROUP",c.a.t("Indicator Group")],["F_INDICATORTYPE",c.a.t("Indicator Type")],["F_INDICATOR",c.a.t("Indicator")],["F_LEGEND_SET",c.a.t("Legend Set")],["F_MAP",c.a.t("Map")],["F_MINMAX_DATAELEMENT",c.a.t("Min-Max Data Element")],["F_OPTIONGROUPSET",c.a.t("Option Group Set")],["F_OPTIONGROUP",c.a.t("Option Group")],["F_OPTIONSET",c.a.t("Option Set")],["F_ORGANISATIONUNIT",c.a.t("Organisation Unit")],["F_ORGUNITGROUPSET",c.a.t("Organisation Unit Group Set")],["F_ORGUNITGROUP",c.a.t("Organisation Unit Group")],["F_PREDICTOR",c.a.t("Predictor")],["F_PROGRAMSTAGE",c.a.t("Program Stage")],["F_PROGRAM",c.a.t("Program")],["F_PROGRAM_INDICATOR",c.a.t("Program Indicator")],["F_PROGRAM_INDICATOR_GROUP",c.a.t("Program Indicator Group")],["F_PROGRAM_RULE",c.a.t("Program Rule")],["F_PROGRAM_TRACKED_ENTITY_ATTRIBUTE_GROUP",c.a.t("Program Tracked Entity Attribute Group")],["F_PUSH_ANALYSIS",c.a.t("Push Analysis")],["F_RELATIONSHIPTYPE",c.a.t("Relationship Type")],["F_REPORT",c.a.t("Report")],["F_SECTION",c.a.t("Section")],["F_SQLVIEW",c.a.t("SQL View")],["F_TRACKED_ENTITY",c.a.t("Tracked Entity")],["F_TRACKED_ENTITY_ATTRIBUTE",c.a.t("Tracked Entity Attribute")],["F_TRACKED_ENTITY_DATAVALUE",c.a.t("Tracked Entity Data Value")],["F_TRACKED_ENTITY_INSTANCE",c.a.t("Tracked Entity Instance")],["F_USERGROUP",c.a.t("User Group")],["F_USERROLE",c.a.t("User Role")],["F_USER",c.a.t("User")],["F_VALIDATIONRULEGROUP",c.a.t("Validation Rule Group")],["F_VALIDATIONRULE",c.a.t("Validation Rule")],["F_PREDICTORGROUP",c.a.t("Data predictor group")],["F_SKIP_DATA_IMPORT_AUDIT",c.a.t("Skip data import audit")],["F_VISUALIZATION",c.a.t("Visualization")]])),e)})();const ze=(()=>{let e=null;return()=>(e||(e={metadata:{name:"Metadata",items:null,headers:["Name","Add/Update Public","Add/Update Private","Delete","External access"]},apps:{name:c.a.t("Apps"),items:null,headers:["Name"]},tracker:{name:c.a.t("Tracker"),items:null,headers:["Name"]},importExport:{name:c.a.t("Import-Export"),items:null,headers:["Name"]},system:{name:c.a.t("System"),items:null,headers:["Name"]}}),e)})(),Ke=["_PUBLIC_ADD","_PRIVATE_ADD","_ADD","_DELETE","_EXTERNAL"],Xe={id:null,empty:!0},$e={implicit:!0},Je=new Set(["F_DASHBOARD_PUBLIC_ADD","F_EVENTCHART_PUBLIC_ADD","F_EVENTREPORT_PUBLIC_ADD","F_MAP_PUBLIC_ADD","F_VISUALIZATION_PUBLIC_ADD"]),Ze={tracker:new Set(["F_PROGRAM_DASHBOARD_CONFIG_ADMIN","F_PROGRAM_ENROLLMENT","F_PROGRAM_ENROLLMENT_READ","F_PROGRAM_UNENROLLMENT","F_TEI_CASCADE_DELETE","F_TRACKED_ENTITY_DATAVALUE_READ","F_TRACKED_ENTITY_INSTANCE_SEARCH","F_TRACKED_ENTITY_INSTANCE_SEARCH_IN_ALL_ORGUNITS","F_TRACKED_ENTITY_UPDATE","F_UNCOMPLETE_EVENT","F_VIEW_EVENT_ANALYTICS","F_PROGRAM_RULE_MANAGEMENT","F_ENROLLMENT_CASCADE_DELETE"]),importExport:new Set(["F_EXPORT_DATA","F_EXPORT_EVENTS","F_IMPORT_DATA","F_IMPORT_EVENTS","F_IMPORT_GML","F_METADATA_EXPORT","F_METADATA_IMPORT","F_METADATA_MANAGE","F_SKIP_DATA_IMPORT_AUDIT"]),system:new Set(["ALL","F_APPROVE_DATA","F_APPROVE_DATA_LOWER_LEVELS","F_ACCEPT_DATA_LOWER_LEVELS","F_VIEW_UNAPPROVED_DATA","F_ORGANISATIONUNIT_MOVE","F_ORGANISATIONUNITLEVEL_UPDATE","F_RUN_VALIDATION","F_REPLICATE_USER","F_USER_VIEW","F_USERGROUP_MANAGING_RELATIONSHIPS_ADD","F_USERGROUP_MANAGING_RELATIONSHIPS_VIEW","F_PERFORM_MAINTENANCE","F_SCHEDULING_ADMIN","F_GENERATE_MIN_MAX_VALUES","F_PREDICTOR_RUN","F_INSERT_CUSTOM_JS_CSS","F_SYSTEM_SETTING","F_SEND_EMAIL","F_MOBILE_SETTINGS","F_MOBILE_SENDSMS","F_OAUTH2_CLIENT_MANAGE"])},et=e=>(Object.keys(e).forEach(t=>{const a=e[t];a.items=Qe()(a.items,"name")}),e),tt=e=>!Ke.some(t=>ke()(e.id,t)),at=(e,t)=>{if(!t.get(e.id))return null;const a=Ke.find(t=>ke()(e.id,t)),r=e.id.replace(a,""),s=t.get(r+"_ADD"),n=t.get(r+"_EXTERNAL"),i=Je.has(r+"_PUBLIC_ADD"),o=s||t.get(r+"_PUBLIC_ADD"),l=s?Xe:i?$e:t.get(r+"_PRIVATE_ADD"),c=i?$e:t.get(r+"_DELETE"),d=n||Xe;return o&&l&&c?(Ke.forEach(e=>t.delete(r+e)),{name:Ye().get(r)||r,items:[o,l,c,d]}):null},rt=(e,t,a)=>{const r=Object.keys(Ze).find(t=>Ze[t].has(e.id))||"system";"ALL"===e.id&&(e.name=Ye().get(e.id)),t[r].items.push(e),a.delete(e.id)};var st=e=>{const t=e.reduce((e,t)=>(e.set(t.id,t),e),new Map),a=Object.keys(ze()).reduce((e,t)=>(e[t]={...ze()[t],items:[]},e),{}),r=e.reduce((e,a)=>{if(qe()(a.id,"M_"))e.apps.items.push(a),t.delete(a.id);else if(tt(a))rt(a,e,t);else{const r=at(a,t);r?e.metadata.items.push(r):t.get(a.id)&&rt(a,e,t)}return e},a);return et(r)};class nt extends s.Component{constructor(...e){super(...e),this.onAuthGroupChanged=(e,t)=>{this.context.onAuthChange(e,t),this.isPublicAdd(e)&&this.forceUpdate()}}isPublicAdd(e){return ke()(e,"_PUBLIC_ADD")}isPrivateAdd(e){return ke()(e,"_PRIVATE_ADD")}render(){const{name:e,items:t}=this.props,{shouldSelect:a,searchChunks:r}=this.context;let s;return t.reduce((e,t,r)=>{const i=this.isPublicAdd(t.id),o=this.isPrivateAdd(t.id),l=Boolean(s&&o),c=a(t.id)||l;return i&&(s=c),e.push(n.a.createElement(je,{key:"authitem-".concat(r),authSubject:t,withLabel:!1,selected:c,disabled:l,onCheckedCallBack:this.onAuthGroupChanged})),e},[n.a.createElement("td",{key:"group-label"},n.a.createElement(Be,{text:e,searchChunks:r}))])}}nt.contextTypes={shouldSelect:Ne.a.func.isRequired,onAuthChange:Ne.a.func.isRequired,searchChunks:Ne.a.array};var it=nt;class ot extends s.Component{constructor(...e){super(...e),this.onTableHeadCheck=(e,t)=>{const a=this.props.authSection.items.map(({id:e})=>e);this.context.onAuthChange(a,t)},this.renderAuthRow=(e,t)=>{const{shouldSelect:a,onAuthChange:r}=this.context;return n.a.createElement("tr",{key:"row-".concat(t)},e.items?n.a.createElement(it,{items:e.items,name:e.name}):n.a.createElement(je,{authSubject:e,withLabel:!0,selected:a(e.id),onCheckedCallBack:r}))}}renderLoaderRow(){return n.a.createElement("tr",null,n.a.createElement("td",{className:"authority-editor__placeholder-cell"},n.a.createElement(xe.CircularProgress,{size:24})))}renderInfoRow(e){let t="authority-editor__placeholder-cell",a=c.a.t("No matches found");return e&&(t+="--error",a=e),n.a.createElement("tr",null,n.a.createElement("td",{className:t},a))}renderContent(e){return e.items?"string"===typeof e.items?this.renderInfoRow(e.items):0===e.items.length?this.renderInfoRow():e.items.map(this.renderAuthRow):this.renderLoaderRow()}renderTableHead({headers:e,name:t,items:a}){const r="Metadata"!==t&&Array.isArray(a)&&a.length>0&&a.every(({id:e})=>this.context.shouldSelect(e));return n.a.createElement("thead",null,n.a.createElement("tr",null,e.map((e,a)=>n.a.createElement("th",{key:"header-".concat(a)},"Metadata"!==t&&0===a?n.a.createElement(xe.Checkbox,{className:"authority-editor__auth-checkbox",label:e,onCheck:this.onTableHeadCheck,checked:r}):e))))}render(){const{sectionKey:e,authSection:t}=this.props;let a="authority-editor__auth-group ".concat(e);t.items&&t.items.length>11&&(a+=" scrollable");let r="authority-editor__auth-group-table";return r+=" columns-".concat(t.headers.length),n.a.createElement(xe.Paper,{className:a},n.a.createElement(ee.Heading,{level:6,className:"authority-editor__auth-group-header"},t.name),n.a.createElement("table",{className:r},this.renderTableHead(t),n.a.createElement("tbody",null,this.renderContent(t))))}}ot.contextTypes={shouldSelect:Ne.a.func.isRequired,onAuthChange:Ne.a.func.isRequired};var lt=ot;class ct extends s.Component{constructor(e){super(e),this.state={filteredAuthorities:e.allGroupedAuthorities,searchChunks:null},this.updateFilter=Ee()(this.updateFilter,375)}getChildContext(){return{searchChunks:this.state.searchChunks}}componentWillReceiveProps(e){this.updateFilteredAuthorities(e.allGroupedAuthorities,null,null)}updateFilter(e,t){const{allGroupedAuthorities:a}=this.props;this.updateFilteredAuthorities(a,e,t)}updateFilteredAuthorities(e,t,a){const{selectedItemsLookup:r}=this.context,s=t?t.toLowerCase().split(" "):null;this.setState({filteredAuthorities:Le(e,r,s,a),searchChunks:s})}render(){const{filteredAuthorities:e}=this.state;return n.a.createElement("div",{className:"authority-editor__auth-group-wrap"},Object.keys(e).map(t=>n.a.createElement(lt,{key:t,sectionKey:t,authSection:e[t]})))}}ct.contextTypes={shouldSelect:Ne.a.func.isRequired,onAuthChange:Ne.a.func.isRequired,selectedItemsLookup:Ne.a.object.isRequired},ct.childContextTypes={searchChunks:Ne.a.array};var dt=ct;class ut extends s.Component{constructor(e){super(e),this.onFilterChange=(e,t)=>{this.filteredAuthSections.updateFilter(e,t)},this.onAuthChange=(e,t)=>{const{reduxFormOnChange:a}=this.props,r=[];e.forEach(e=>{this.selectedItemsLookup.set(e,t)}),this.selectedItemsLookup.forEach((e,t)=>{e&&r.push(t)}),a&&a(r)},this.shouldSelect=e=>Boolean(this.selectedItemsLookup.get(e)),this.state={allGroupedAuthorities:ze()},this.selectedItemsLookup=e.initiallySelected.reduce((e,t)=>e.set(t,!0),new Map),this.groupedAuthoritiesPromise=null}getChildContext(){return{shouldSelect:this.shouldSelect,onAuthChange:this.onAuthChange,selectedItemsLookup:this.selectedItemsLookup}}async componentDidMount(){this.groupedAuthoritiesPromise=ge()(xa.getGroupedAuthorities());try{const e=await this.groupedAuthoritiesPromise;this.setState({allGroupedAuthorities:e})}catch(e){this.handleAuthorityFetchError(e)}}componentWillUnmount(){this.groupedAuthoritiesPromise.trash()}handleAuthorityFetchError(e){const t=re(e,c.a.t("There was a problem retreiving the available authorities.")),a=Object.keys(ze()).reduce((e,a)=>(e[a]={...ze()[a],items:t},e),{});this.setState({allGroupedAuthorities:a})}render(){const{allGroupedAuthorities:e}=this.state;return n.a.createElement("div",{className:"authority-editor"},n.a.createElement(ee.Heading,{level:4,className:"authority-editor__header"},c.a.t("Authorities")),n.a.createElement(De,{onFilterChange:this.onFilterChange}),n.a.createElement(dt,{ref:e=>{this.filteredAuthSections=e},allGroupedAuthorities:e}))}}ut.defaultProps={initiallySelected:[]},ut.childContextTypes={shouldSelect:Ne.a.func.isRequired,onAuthChange:Ne.a.func.isRequired,selectedItemsLookup:Ne.a.object.isRequired};var pt=ut;const ht={checkbox:{marginTop:"32px",fontSize:"16px"},warning:{color:B.orange500}},mt=({input:e,label:t,meta:{touched:a,error:r,asyncValidating:s},...i})=>{const o=s?c.a.t("Validating..."):a&&r;return s&&(i.errorStyle=ht.warning),n.a.createElement(Q.a,Object.assign({floatingLabelText:t,hintText:t,fullWidth:!0,errorText:o},i,e))},gt=({input:e})=>{const t=""===e.value?[]:e.value;return n.a.createElement(pt,{initiallySelected:t,reduxFormOnChange:e.onChange,reduxFormOnBlur:e.onBlur})},yt=({input:e,label:t})=>n.a.createElement(z.a,Object.assign({checked:Boolean(e.value),onCheck:e.onChange,label:t},e,{style:ht.checkbox})),Et=({input:e,label:t,meta:{touched:a,error:r,asyncValidating:s},options:i,style:o})=>{const l=s?c.a.t("Validating..."):a&&r,d=s?ht.warning:void 0;return n.a.createElement(X.a,{floatingLabelText:t,fullWidth:!0,value:e.value,name:e.name,onChange:(t,a,r)=>{e.onChange(r),setTimeout(()=>e.onBlur(r),1)},style:o,errorText:l,errorStyle:d},i.map(({id:e,label:t},a)=>n.a.createElement(J.a,{key:"option_".concat(a),value:e,primaryText:t})))},bt=({input:e,meta:{touched:t,error:a},availableItemsQuery:r,availableItemsLabel:s,assignedItemsLabel:i,initialValues:o,...l})=>n.a.createElement(ie,Object.assign({initiallyAssignedItems:o,onChange:e.onChange,onBlur:e.onBlur,availableItemsQuery:r,availableItemsHeader:s,assignedItemsHeader:i,errorText:t&&a},l)),ft=({input:e,meta:{touched:t,error:a},label:r,wrapperStyle:s,initialValues:i,orgUnitType:o})=>n.a.createElement(Oe,{selectedOrgUnits:i,onChange:e.onChange,wrapperStyle:s,headerText:r,orgUnitType:o,errorText:t&&a,onBlur:e.onBlur}),At=({name:e,label:t,style:a})=>n.a.createElement("p",{key:e,style:a},t),Tt="name",_t="code",Rt={loaderWrap:{paddingTop:"2rem",textAlign:"center"}},St=()=>[{name:Tt,label:c.a.t("Name"),fieldRenderer:mt,isRequiredField:!0},{name:_t,label:c.a.t("Code"),fieldRenderer:mt},{name:"users",fieldRenderer:bt,isRequiredField:!0,initialItemsSelector:e=>V(e.users),availableItemsQuery:"getManagedUsers",availableItemsLabel:c.a.t("Available users"),assignedItemsLabel:c.a.t("Group members")},{name:"managedGroups",fieldRenderer:bt,initialItemsSelector:e=>V(e.managedGroups),availableItemsQuery:"getAvailableUserGroups",availableItemsLabel:c.a.t("Available user groups"),assignedItemsLabel:c.a.t("Managed user groups")}],Ct=q()(e=>{if(null===e)return e;const{total:t,pageCount:a,page:r,query:{pageSize:s}}=e,n=t-(t-(a-(a-r))*s),i=1+n-s,o=n;return e.currentlyShown="".concat(i," - ").concat(o>t?t:o),e}),It=(e,t)=>{if(!e||"string"===typeof e)return e;const a=e.modelDefinition.name;return e.toArray().map(e=>vt[a](e,t))},vt={user:e=>(e.userName=e.userCredentials.username,e.disabled=e.userCredentials.disabled,e.lastLogin=e.userCredentials.lastLogin,e),userRole:e=>e,userGroup:(e,t)=>(e.currentUserIsMember=Boolean(t.get(e.id)),e)},wt=q()(e=>e.length<3?e.map(e=>e.displayName).join(", "):c.a.t("{{count}} selected",{count:e.length})),Ot=(e,t,a)=>{a===Wt?t[a]=[...e.catDimensionConstraints,...e.cogsDimensionConstraints]:e[a]&&!m()(e[a].size)||Array.isArray(e[a])?t[a]=V(e[a]).map(({id:e})=>e):t[a]=e[a]},Ut=q()((e,t,a)=>{const r={[Mt]:zt};return e.id&&(Qt.forEach(t=>{Ot(e,r,t)}),Yt.forEach(t=>{Ot(e.userCredentials,r,t)}),a.forEach(e=>r[e.name]=e.value)),r[jt]=t.ui.selected||"en",r[Ht]=t.db.selected,r}),Nt=q()((e,t)=>{const a={};return St().forEach(t=>{Ot(e,a,t.name)}),t.forEach(e=>a[e.name]=e.value),a}),xt=q()(e=>[...V(j("userCredentials.catDimensionConstraints",e)),...V(j("userCredentials.cogsDimensionConstraints",e))]),Ft=q()((e,t)=>t&&e?t.get(e):null),Dt=(e,t)=>{const a=t.systemOrganisationUnitRoots,r=t[e],s=t[qt];let n=null;return t.authorities.has("ALL")?n=a:(0===r.size||s.size>0)&&(n=s.toArray()),n},Lt=e=>{const t=e&&e.registeredFields,a=e&&e.values;return(Boolean(t&&t[Mt])&&a&&a[Mt])===Kt},Pt={loaderWrap:{paddingTop:"2rem",textAlign:"center"},toggler:{color:B.blue600},orgUnitTree:{width:"calc(50% - 60px)",float:"left",minHeight:"100px",maxHeight:"1200px"},togglerWrap:{clear:"both",paddingTop:"1.2rem",marginBottom:"1.5rem"},additionalFieldsWrap:{clear:"both",paddingTop:"1.5rem"}},kt="username",Mt="inviteUser",Gt="externalAuth",Bt="openId",Vt="ldapId",jt="interfaceLanguage",Ht="databaseLanguage",qt="organisationUnits",Wt="catCogsDimensionConstraints",Qt=["surname","firstName","email","phoneNumber","whatsApp","facebookMessenger","skype","telegram","twitter",qt,"dataViewOrganisationUnits","userGroups","teiSearchOrganisationUnits"],Yt=[kt,Gt,"password",Bt,Vt,"userRoles",Wt],zt="SET_PASSWORD",Kt="INVITE_USER",Xt=()=>({label:c.a.t("Selecting an organisation unit provides access to all units in the sub-hierarchy"),fieldRenderer:At,style:{clear:"both",paddingTop:"0.8rem",fontStyle:"italic",fontSize:"0.9rem"}}),$t="user",Jt=/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/,Zt=/^\+(?:[0-9].?){4,14}[0-9]$/,ea=/[0-9]{4}-[0-9]{2}-[0-9]{2}/,ta=/^(?=.*[a-z]).+$/,aa=/^(?=.*[A-Z]).+$/,ra=/^(?=.*[0-9]).+$/,sa=/[^a-zA-Z0-9]/;function na(e){if(fa(e)&&e.length>50)return c.a.t("Exceeds maximum character limit of 50")}function ia(e){if(fa(e)&&!ea.test(e))return c.a.t("Please enter a valid date with the following format yyyy-mm-dd")}function oa(e){if(fa(e)&&!Jt.test(e.toLowerCase()))return c.a.t("Please provide a valid email address")}function la(e){if(fa(e)&&!ba(e))return c.a.t("Value should be an integer")}function ca(e){if(fa(e)&&(!ba(e)||parseInt(e,10)>=0))return c.a.t("Value should be a nagative integer")}function da(e){if(fa(e)&&isNaN(e))return c.a.t("Value should be a number")}function ua(e,t,a){if(!function(e,t){if(t.inviteUser)return!1;const a=Boolean(t.user.id);return!(a&&!e.password&&!e.repeatPassword)}(t,a))return;const r=function(e){if(!fa(e))return c.a.t("This field is required");if(e.length<8)return c.a.t("Password should be at least 8 characters long");if(e.length>35)return c.a.t("Password should be no longer than 34 characters");if(!ta.test(e))return c.a.t("Password should contain at least one lowercase letter");if(!aa.test(e))return c.a.t("Password should contain at least one UPPERCASE letter");if(!ra.test(e))return c.a.t("Password should contain at least one number");if(!sa.test(e))return c.a.t("Password should have at least one special character");return null}(t.password);return r||void 0}function pa(e){if(fa(e)&&(!ba(e)||parseInt(e,10)<=0))return c.a.t("Value should be a positive integer")}function ha(e,t){if(t.repeatPassword!==t.password)return c.a.t("Passwords do not match")}function ma(e){return fa(e)?void 0:c.a.t("This field is required")}function ga(e){if(!(Array.isArray(e)&&e.length>0))return c.a.t("This field is required. Please select at least one")}function ya(e){return fa(e)&&e.length<2?c.a.t("A username should be at least 2 characters long"):fa(e)&&e.length>140?c.a.t("Username may not exceed 140 characters"):void 0}function Ea(e){if(fa(e)&&!Zt.test(e))return c.a.t("Please provide a valid international phone number (+0123456789)")}function ba(e){if(isNaN(e))return!1;const t=parseFloat(e);return(0|t)===t}function fa(e){return"undefined"!==typeof e&&null!==e&&""!==e}let Aa;function Ta(){if("undefined"!==typeof Aa)return Aa;let e=document.createElement("input");return e.setAttribute("type","date"),e.setAttribute("value","not-a-date"),Aa="not-a-date"!==e.value,e=null,Aa}function _a(e,t){return e.map(e=>function({id:e,valueType:t,displayName:a,mandatory:r,unique:s,optionSet:n},i){const o=i&&i.find(t=>t.attribute.id===e),l=function(e,t,a){const r=Ca(),s=t?{...r.OPTION_SET,props:{options:t.options.map(e=>({id:e.id,label:e.displayName}))}}:r[e]||r.TEXT;s.fieldRenderer!==Et||a||"no_value"===s.props.options[0].id||(s.props.options=[{id:"no_value",label:c.a.t("<No value>")},...s.props.options]);return s}(t,n,r);return{name:"userAttibute_"+e,isAttributeField:!0,label:a,isRequiredField:r,shouldBeUnique:s,attributeId:e,value:o&&o.value||null,valueType:t,...l}}(e,t))}function Ra(e,t){e.forEach(({shouldBeUnique:e,name:a})=>{e&&t.push(a)})}function Sa(e,t){const a=t.reduce((e,{attributeId:t,valueType:a})=>(e[t]=a,e),{});return Object.keys(e).reduce((t,r)=>{if(-1!==r.indexOf("userAttibute_")){const s=r.replace("userAttibute_",""),n=e[r],i="no_value"===n;"TRUE_ONLY"===a[s]&&!n||i||t.push({value:n,attribute:{id:s}})}return t},[])}const Ca=(()=>{let e=null;return()=>(e||(e={OPTION_SET:{fieldRenderer:Et},TEXT:{fieldRenderer:mt},LONG_TEXT:{fieldRenderer:mt,props:{multiLine:!0,rows:3,rowsMax:6}},DATE:{fieldRenderer:mt,props:{type:"date",floatingLabelFixed:Ta(),hintText:null},fieldValidators:[ia]},BOOLEAN:{fieldRenderer:Et,props:{options:[{id:"true",label:c.a.t("Yes")},{id:"false",label:c.a.t("No")}]}},TRUE_ONLY:{fieldRenderer:yt},NUMBER:{fieldRenderer:mt,fieldValidators:[da]},INTEGER:{fieldRenderer:mt,fieldValidators:[la]},INTEGER_POSITIVE:{fieldRenderer:mt,fieldValidators:[pa]},INTEGER_NEGATIVE:{fieldRenderer:mt,fieldValidators:[ca]}}),e)})();const Ia=(e,t)=>{const a=p()(e).toUpperCase(),r="".concat(a,t?"_DETAILS":"_LIST");return G[r]},va=({authorities:e})=>e.has("ALL"),wa=(e,t,a)=>{m()(t)||(e[a]=Array.isArray(t)?t.map(e=>({id:e})):t)},Oa=(e,t,a)=>"/userSettings/key".concat(e,"Locale?user=").concat(t,"&value=").concat(a),Ua=({locale:e,name:t})=>({id:e,label:t}),Na=e=>(e.forEach(e=>{e.displayName+=" (".concat(e.userCredentials.username,")")}),e);var xa=new class{constructor(){this.getD2=()=>this.d2,this.getContextPath=()=>this.d2.system.systemInfo.contextPath,this.getList=(e,t,a)=>{const r=((e=1,t,a,r,s)=>{const{query:n,inactiveMonths:i,selfRegistered:o,invitationStatus:l,organisationUnits:c}=t,d={pageSize:50,fields:a,page:e,order:r===$t?["firstName:asc","surname:asc"]:"name:asc"};if(r!==$t||va(s)||(d.userOrgUnits=!0,d.includeChildren=!0),n&&(d.query=n),i&&(d.inactiveMonths=i),o&&(d.selfRegistered=o),l&&(d.invitationStatus=l),c.length){const e=c.map(e=>e.id).join();d.filter="organisationUnits.id:in:[".concat(e,"]")}return d})(t,a,Ia(e),e,this.getCurrentUser());return this.d2.models[e].list(r)},this.getItem=(e,t)=>{const a={fields:Ia(e,!0)};return this.d2.models[e].get(t,a)},this.genericFind=(e,t,a)=>this.d2.models[e].filter().on(t).equals(a).list({fields:["id"]}),this.replicateUser=(e,t,a)=>{const r="/users/".concat(e,"/replica"),s={username:t,password:a};return this.d2Api.post(r,s)},this.queryOrgUnits=(e,t)=>{const a={...M,query:e};return this.d2.models.organisationUnits.list(a).then(e=>((e,t)=>{const{currentUser:a}=D.getState();if(a.authorities.has("ALL"))return e.toArray();const r=a[t].size>0?a[t]:a[qt];return e.toArray().filter(e=>{const t=Boolean(r.get(e.id)),a=!t&&e.ancestors.toArray().some(e=>Boolean(r.get(e.id)));return t||a})})(e,t))},this.getAvailableUserRoles=()=>this.d2.models.userRoles.list({canIssue:!0,fields:["id","displayName"],paging:!1}),this.getAvailableDataAnalyticsDimensionRestrictions=()=>this.d2Api.get("/dimensions/constraints",{fields:["id","name","dimensionType"],paging:!1}).then(({dimensions:e})=>e),this.updateDisabledState=(e,t)=>{const a="/users/".concat(e),r={userCredentials:{disabled:t}};return this.d2Api.patch(a,r)},this.disable2FA=e=>{const t="/users/".concat(e);return this.d2Api.patch(t,{userCredentials:{twoFA:!1}})},this.getSelectedAndAvailableLocales=e=>{e=e?encodeURIComponent(e):null;const t={id:"use_db_locale",label:c.a.t("Use database locale / no translation")},a=this.d2Api.get("/locales/db"),r=this.d2Api.get("/locales/ui"),s=e?this.d2Api.get("/userSettings/keyUiLocale?user=".concat(e)):this.d2.system.settings.get("keyUiLocale"),n=e?this.d2Api.get("/userSettings/keyDbLocale?user=".concat(e)):Promise.resolve("use_db_locale");return Promise.all([a,r,n,s]).then(([e,a,r,s])=>({db:{available:[t,...e.map(Ua)],selected:r||"use_db_locale"},ui:{available:a.map(Ua),selected:s}}))},this.saveOrInviteUser=(e,t,a,r,s,n)=>{const i=((e,t,a,r)=>{const s=!t.id,n=t.id||Object(d.generateUid)(),i=t.userCredentials&&t.userCredentials.id||Object(d.generateUid)(),o=t.modelDefinition.getOwnedPropertyNames(),l={id:n,userCredentials:{id:i,userInfo:{id:n},cogsDimensionConstraints:[],catDimensionConstraints:[]}},c=l.userCredentials;if(Array.isArray(e.catCogsDimensionConstraints)&&e.catCogsDimensionConstraints.forEach(e=>{"CATEGORY_OPTION_GROUP_SET"===e.dimensionType?c.cogsDimensionConstraints.push({id:e.id}):c.catDimensionConstraints.push({id:e.id})}),Qt.forEach(t=>wa(l,e[t],t)),Yt.forEach(t=>wa(c,e[t],t)),l.attributeValues=Sa(e,r),delete c[Wt],(a||e[Gt])&&(delete c.password,delete c.repeatPassword),!s)for(const d of o)t[d]&&!(d in l)&&(l[d]=t[d]);return l})(e,t,a,n),o=a?"/users/invite":"/users";return(t.id?this.d2Api.update("/users/".concat(t.id),i):this.d2Api.post(o,i)).then(t=>{if("ERROR"===t.status)return Promise.reject((e=>{const t=[];for(const a of e.typeReports)for(const e of a.objectReports)for(const a of e.errorReports)t.push({message:a.message});return{messages:t}})(t));const a=[],n=encodeURIComponent(e.username),i=e[jt];i!==r&&a.push(this.d2Api.post(Oa("Ui",n,i)));const o=e[Ht];if(o!==s){const e="use_db_locale"===o?this.d2Api.delete("/userSettings/keyDbLocale?user=".concat(n)):this.d2Api.post(Oa("Db",n,o));a.push(e)}return 0===a.length&&a.push(Promise.resolve("No locale changes detected")),Promise.all(a)})},this.getManagedUsers=()=>this.d2.models.user.list({fields:["id","displayName","userCredentials[username]"],paging:!1}).then(Na),this.getAvailableUserGroups=()=>this.d2.models.userGroups.list({fields:["id","displayName"],paging:!1}),this.getGroupedAuthorities=()=>{if(this.groupedAuths)return Promise.resolve(this.groupedAuths);const e="".concat(this.getContextPath(),"/dhis-web-commons/security/getSystemAuthorities.action");return this.d2Api.request("GET",e).then(({systemAuthorities:e})=>this.groupedAuths=st(e))},this.getCurrentUser=()=>this.d2.currentUser,this.initCurrentUser=()=>Promise.all([this.d2.currentUser.getUserGroups(),this.d2.currentUser.getUserRoles(),this.getCurrentUserOrgUnits(),this.getSystemOrgUnitRoots()]).then(([e,t,{organisationUnits:a,dataViewOrganisationUnits:r,teiSearchOrganisationUnits:s},n])=>Object.assign(this.d2.currentUser,{userGroups:e,userRoles:t,organisationUnits:a,dataViewOrganisationUnits:r,teiSearchOrganisationUnits:s,systemOrganisationUnitRoots:n})),this.refreshCurrentUser=()=>{const e=Object.getPrototypeOf(this.d2.currentUser).constructor,t=this.d2.models;return Promise.all([this.d2Api.get("me",{fields:[":all","organisationUnits[id]","userGroups[id]","userCredentials[:all,!user,userRoles[id]"]}),this.d2Api.get("me/authorization"),this.d2Api.get("userSettings")]).then(([a,r,s])=>(this.d2.currentUser=e.create(a,r,t,s),this.initCurrentUser()))},this.getCurrentUserOrgUnits=()=>this.d2.models.users.get(this.d2.currentUser.id,k),this.getSystemOrgUnitRoots=()=>this.d2.models.organisationUnits.list({paging:!1,level:1,fields:"id,path,displayName,children::isNotEmpty"}).then(e=>e.toArray()),this.updateCurrentUserGroupMembership=(e,t)=>{const a=t?"delete":"post",r="/users/".concat(this.d2.currentUser.id,"/userGroups/").concat(e);return this.d2Api[a](r)}}init(e){this.d2=e,this.d2Api=e.Api.getApi()}getAttributes(e){return this.d2Api.get("attributes",{fields:["id","displayName","mandatory","unique","valueType","optionSet[options[id,displayName]]"],filter:"".concat(e,"Attribute:eq:true"),paging:!1}).then(e=>e.attributes)}isAttributeUnique(e,t,a,r){return this.d2.models[e].filter().on("id").notEqual(t).filter().on("attributeValues.attribute.id").equals(a).filter().on("attributeValues.value").equals(r).list({paging:!1,fields:["id","attributeValues[value, attribute[id]]"]}).then(e=>{if(0===e.size)return!0;return 0===((e,t,a)=>e.toArray().reduce((e,r)=>e.concat(r.attributeValues.filter(e=>t===e.value&&a===e.attribute.id)),[]))(e,r,a).length})}saveRole(e){return e.id?this.d2Api.update("/userRoles/".concat(e.id),e):this.d2Api.post("/userRoles/",e)}},Fa=a(383),Da=a(519),La=Object(Da.b)();const Pa=(e,t)=>({type:e,payload:t}),ka=async(e,t,a,r)=>{r||e(Pa("LIST_REQUESTED",a));try{const r=await t;e(Pa("LIST_RECEIVED",{type:a,items:r}))}catch(s){e(Pa("LIST_ERRORED",{type:a,error:s}))}},Ma=(e,t)=>(a,r)=>{const{filter:s,pager:n}=r(),i=n?n.page:1,o=xa.getList(e,i,s);ka(a,o,e,t)},Ga=async(e,t,a)=>{a(Pa(e.requested));try{const r=await t;a(Pa(e.received,r))}catch(r){a(Pa(e.errored,r))}},Ba=(e,t)=>a=>{Ga({requested:"ITEM_REQUESTED",received:"ITEM_RECEIVED",errored:"ITEM_ERRORED"},xa.getItem(e,t),a)},Va={requested:"CURRENT_USER_REQUESTED",received:"CURRENT_USER_RECEIVED",errored:"CURRENT_USER_ERRORED"},ja=()=>e=>{Ga(Va,xa.refreshCurrentUser(),e)},Ha=()=>Pa("CLEAR_ITEM"),qa=(e,t)=>Pa("FILTER_UPDATED",{updateKey:e,updateValue:t}),Wa=e=>Pa("SHOW_SNACKBAR",e),Qa=()=>Pa("HIDE_SNACKBAR"),Ya=(e,t)=>Pa("SHOW_DIALOG",{content:e,props:t}),za=()=>Pa("HIDE_DIALOG");var Ka=a(365),Xa=a.n(Ka),$a=a(773),Ja=a.n($a),Za=a(1632),er=a.n(Za);var tr=e=>{La.push(e)},ar=a(594),rr=a.n(ar),sr=a(801);Object(sr.addValueRenderer)(({value:e})=>"boolean"===typeof e,({value:e})=>e?n.a.createElement("div",{style:{width:"40px"}},n.a.createElement(rr.a,null)):null);a(1659),a(1660);const nr={dataTableWrap:{flex:1,marginBottom:"4rem"},clearBoth:{clear:"both"},filterBar:{display:"table",marginBottom:"1rem",width:"100%"},headerBarPagination:{float:"right",marginTop:"14px"},headerBarFilterWrap:{display:"table",marginRight:"230px"},pagination:{userSelect:"none"}};class ir extends s.Component{constructor(...e){super(...e),this.executeEditIfAllowed=e=>{const{isContextActionAllowed:t,primaryAction:a,showSnackbar:r,hideSnackbar:s}=this.props;t(e,"edit")?a(e):r({message:"".concat(c.a.t("You are not allowed to edit")," ").concat(e.displayName),action:c.a.t("Confirm"),autoHideDuration:null,onActionClick:s})}}componentDidMount(){const{items:e,getList:t,resetFilter:a,resetPager:r,entityType:s,listType:n}=this.props;null!==e&&n===s||(n!==s&&(a(),r()),t(s))}getPagerConfig(e){return e||{page:null,pageCount:null,total:null,currentlyShown:null}}renderPagination(){const{pager:e,items:t,incrementPage:a,decrementPage:r}=this.props,{page:s,pageCount:i,total:o,currentlyShown:l}=this.getPagerConfig(e),c=!t||0===t.length||"string"===typeof t?{...nr.pagination,visibility:"hidden"}:nr.pagination,d={hasNextPage:()=>s&&t&&t.length&&s<i,hasPreviousPage:()=>s&&t&&t.length&&s>1,onNextPageClick:()=>{a(e)},onPreviousPageClick:()=>{r(e)},total:o,currentlyShown:l,style:c};return n.a.createElement("div",{style:c},n.a.createElement(ee.Pagination,d))}renderHeaderBar(){const{filterComponent:e,entityType:t}=this.props;return n.a.createElement("div",{className:"data-table__filter-bar",style:nr.filterBar},n.a.createElement("div",{style:nr.headerBarPagination},this.renderPagination()),n.a.createElement("div",{style:nr.headerBarFilterWrap},n.a.createElement(e,{entityType:t})))}renderDataTable(){const{items:e,columns:t,contextMenuActions:a,contextMenuIcons:r,isContextActionAllowed:s}=this.props;if("string"===typeof e){const t=c.a.t("There was an error fetching the list");return n.a.createElement(ae,{introText:t,errorMessage:e})}return null===e?n.a.createElement(ee.LoadingMask,null):0===e.length?n.a.createElement("div",{style:nr.clearBoth},"No results found."):n.a.createElement(er.a,{rows:e,columns:t,primaryAction:this.executeEditIfAllowed,contextMenuActions:a,contextMenuIcons:r,isContextActionAllowed:s})}render(){const{sectionName:e,newItemPath:t,className:a}=this.props;return n.a.createElement("div",{style:nr.dataTableWrap,className:a},n.a.createElement(ee.Heading,null,e),this.renderHeaderBar(),this.renderDataTable(),this.renderPagination(),n.a.createElement(Xa.a,{className:"entity-list__add-new-entity",onClick:()=>tr(t)},n.a.createElement(Ja.a,null)))}}ir.defaultProps={className:"paged-filterable-data-table"};var or=Object(o.b)(e=>({listType:e.list.type,items:It(e.list.items,e.currentUser.userGroups),pager:Ct(e.pager)}),{getList:Ma,resetFilter:()=>Pa("FILTER_RESET"),resetPager:()=>Pa("PAGER_RESET"),incrementPage:e=>(t,a)=>{const{list:{type:r}}=a();ka(t,e.getNextPage(),r)},decrementPage:e=>(t,a)=>{const{list:{type:r}}=a();ka(t,e.getPreviousPage(),r)},showSnackbar:Wa,hideSnackbar:Qa})(ir);const lr=()=>{D.dispatch(ja())},cr=()=>{const e=xa.getContextPath()+"/dhis-web-commons-security/logout.action";window.location.assign(e)};var dr=(e,t)=>{const{currentUser:a}=D.getState(),r=e.modelDefinition.name;r===$t&&e.id===a.id&&(t?cr():lr()),"userRole"===r&&a.userRoles.get(e.id)&&lr(),"userGroup"===r&&a.userGroups.get(e.id)&&lr()};const ur=({model:e,entityType:t})=>{const a={type:e.modelDefinition.displayName,displayName:e.displayName},r=c.a.t('Are you sure you want to remove the {{type}} "{{displayName}}"?',a),s=c.a.t('{{type}} "{{displayName}}" removed successfully',a),n=c.a.t('There was a problem removing {{type}} "{{displayName}}"?',a),i={message:r,action:c.a.t("Confirm"),autoHideDuration:null,onActionClick:()=>pr(e,s,n,t)};D.dispatch(Wa(i))},pr=async(e,t,a,r)=>{D.dispatch(Qa());try{await e.delete(),D.dispatch(Wa({message:t})),D.dispatch(Ma(r)),dr(e)}catch(s){const e=re(s,a);D.dispatch(Wa({message:e}))}},hr=({data:e})=>{var t,a;D.dispatch((t=e.id,a=e.modelDefinition.name,Pa("SHOW_SHARING_DIALOG",{id:t,type:a})))};var mr=a(1785),gr=a(1784),yr=a(508),Er=a.n(yr);async function br(e,t,a,r){const s=a.asyncErrors;if(!r&&!s)return Promise.resolve();let n;n="userForm"===a.form&&r===kt?await Ar(e,a):"groupForm"!==a.form||r!==_t&&r!==Tt?await async function(e,t,a){const r=e[a];if(!r)return Promise.resolve();const s="userForm"===t.form?$t:"userGroup",n=s===$t?t.user.id||"_":t.group.id||"_",i=a.replace("userAttibute_","");try{if(!await xa.isAttributeUnique(s,n,i,r))return{[a]:c.a.t("Attribute value needs to be unique, value already taken.")}}catch(o){return{[a]:c.a.t("There was a problem checking if this attribute value is unique")}}}(e,a,r):await Tr(e,a,r);const i=s||n?{...s,...n}:void 0;if(i)throw i;return Promise.resolve()}async function fr(e,t,a,r){if(!a)return Promise.resolve();const s=await r(e,t,a);if(s)throw s;return Promise.resolve()}async function Ar(e,t){const a=e[kt],r=t.form!==_r&&t.user&&t.user.id;if(!a||r)return Promise.resolve();try{if((await xa.genericFind("users","userCredentials.username",a)).size>0)return{[kt]:c.a.t("Username already taken")}}catch(s){return{[kt]:c.a.t("There was a problem whilst checking the availability of this username")}}}async function Tr(e,t,a){const{group:r,role:s}=t,n=s||r,i=n.modelDefinition.name,o=e[a],l=Er()(a);if(!o)return Promise.resolve();try{const e=await xa.genericFind(i,a,o);if(e.size>0){if(e.values().next().value.id!==n.id)return{[a]:c.a.t("{{fieldDisplayName}} is already taken",{fieldDisplayName:l})}}}catch(d){const e=c.a.t("Could not verify if this {{fieldDisplayName}} is unique",{fieldDisplayName:l});return{[a]:re(d,e)}}}const _r="replicateUserForm";class Rr extends s.Component{constructor(...e){super(...e),this.replicateUser=async e=>{const{user:t,hideDialog:a}=this.props,{username:r,password:s}=e;try{await xa.replicateUser(t.id,r,s),this.replicateSuccesHandler(t.displayName)}catch(n){this.replicateErrorHandler(n)}a()},this.replicateSuccesHandler=e=>{const{getList:t,showSnackbar:a}=this.props;a({message:c.a.t('User "{{displayName}}" replicated successfuly',{displayName:e})}),t($t,!0)},this.replicateErrorHandler=e=>{const{showSnackbar:t}=this.props;t({message:re(e,c.a.t("There was a problem replicating the user"))})}}render(){const{submitting:e,pristine:t,valid:a,handleSubmit:r,hideDialog:s,asyncValidating:i}=this.props,o=Boolean(e||i||t||!a);return n.a.createElement("form",{autoComplete:"off",onSubmit:r(this.replicateUser)},n.a.createElement(mr.a,{name:kt,component:mt,label:c.a.t("Username"),hintText:c.a.t("Username for new user"),validate:[ya],autoComplete:"new-password"}),n.a.createElement(mr.a,{name:"password",component:mt,label:c.a.t("Password"),hintText:c.a.t("Password for new user"),validate:[ua],type:"password",autoComplete:"new-password"}),n.a.createElement("div",{style:{marginTop:16}},n.a.createElement(xe.RaisedButton,{label:c.a.t("Replicate"),type:"submit",disabled:o,primary:!0}),n.a.createElement(xe.RaisedButton,{label:c.a.t("Cancel"),onClick:s,style:{marginLeft:8}})))}}const Sr=Object(gr.a)({form:_r,asyncValidate:async function(e,t,a,r){return fr(e,a,r,Ar)},asyncBlurFields:[kt]})(Rr);var Cr=Object(o.b)(e=>({formState:e.form[_r]}),{getList:Ma,hideDialog:za,showSnackbar:Wa,hideSnackbar:Qa})(Sr);const Ir=(e,t)=>{const{currentUser:a}=D.getState();if(!e)return!1;const{access:r,userCredentials:{disabled:s,twoFA:n}}=e;switch(t){case"profile":return r.read;case"edit":return r.update;case"remove":return a.id!==e.id&&r.delete;case"replicate":return r.update&&a.authorities.has("F_REPLICATE_USER");case"disable":return r.update&&!s;case"enable":return r.update&&s;case"disable_2fa":return r.update&&n;default:return!0}},vr={profile:"account_circle",edit:"edit",remove:"delete",replicate:"content_copy",disable:"block",enable:"playlist_add_check",disable_2fa:"phonelink_erase"},wr=ee.Action.createActionsFromNames(["profile","edit","remove","replicate","disable","enable","disable_2fa"]);wr.profile.subscribe(({data:{id:e}})=>{tr("/users/view/".concat(e))}),wr.edit.subscribe(({data:{id:e}})=>{tr("/users/edit/".concat(e))}),wr.remove.subscribe(({data:e})=>{ur({model:e,entityType:$t})}),wr.replicate.subscribe(({data:e})=>{const t=n.a.createElement(Cr,{user:e}),a={onRequestClose:()=>D.dispatch(za()),title:c.a.t("Replicate user")};D.dispatch(Ya(t,a))}),wr.disable.subscribe(({data:e})=>{Nr(e,!0)}),wr.enable.subscribe(({data:e})=>{Nr(e,!1)}),wr.disable_2fa.subscribe(({data:e})=>{Or(e)});const Or=e=>{const t=c.a.t("Are you sure you want to disable two factor authentication for"),a={message:"".concat(t," ").concat(e.displayName),action:c.a.t("Confirm"),autoHideDuration:null,onActionClick:()=>Ur(e)};D.dispatch(Wa(a))},Ur=async e=>{D.dispatch(Qa());const{displayName:t,id:a}=e;try{await xa.disable2FA(a);const e=c.a.t("Succesfully disabled two factor authentication for");D.dispatch(Wa({message:"".concat(e," ").concat(t)})),D.dispatch(Ma($t))}catch(r){D.dispatch(Wa({message:re(r,c.a.t("There was a problem updating two factor authentication"))}))}},Nr=(e,t)=>{const a=t?c.a.t("Are you sure you want to disable"):c.a.t("Are you sure you want to enable"),r={message:"".concat(a," ").concat(e.displayName),action:c.a.t("Confirm"),autoHideDuration:null,onActionClick:()=>xr(e,t)};D.dispatch(Wa(r))},xr=async(e,t)=>{D.dispatch(Qa());const{displayName:a,id:r}=e;try{await xa.updateDisabledState(r,t);const s=t?c.a.t("sucessfully disabled"):c.a.t("successfully enabled");D.dispatch(Wa({message:"".concat(a," ").concat(s)})),D.dispatch(Ma($t)),t&&dr(e,!0)}catch(s){D.dispatch(Wa({message:re(s,c.a.t("There was a problem updating the enabled state"))}))}};var Fr=a(226),Dr=a.n(Fr),Lr=a(1664),Pr=a.n(Lr),kr=a(1665),Mr=a.n(kr);class Gr extends s.Component{constructor(...e){super(...e),this.applyFilter=e=>{const{updateFilter:t,hideDialog:a,getList:r,selectedOrgUnits:s}=this.props;Mr()(e,s)||(t("organisationUnits",e),r($t)),a()}}render(){const{selectedOrgUnits:e,hideDialog:t}=this.props;return n.a.createElement(Oe,{orgUnitType:"teiSearchOrganisationUnits",selectedOrgUnits:e,confirmSelection:this.applyFilter,cancel:t})}}var Br=Object(o.b)(e=>({selectedOrgUnits:e.filter.organisationUnits}),{updateFilter:qa,hideDialog:za,getList:Ma})(Gr);const Vr={wrap:{position:"relative",lineHeight:"24px",height:"72px",cursor:"pointer",float:"left",marginRight:"1rem"},icon:{position:"absolute",right:0,top:38,width:20,height:20,color:"rgba(0, 0, 0, 0.3)",cursor:"pointer"},textField:{cursor:"pointer",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",width:"152px"},input:{width:"calc(100% - 20px)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}};class jr extends s.Component{constructor(...e){super(...e),this.inputRef=n.a.createRef(),this.focusOrgUnitInput=()=>{this.inputRef.current.orgUnitInput.focus()},this.showOrgTreeInDialog=()=>{const{showDialog:e,hideDialog:t}=this.props;e(n.a.createElement(Br,null),{onRequestClose:t,title:c.a.t("Select an organisation unit"),contentStyle:{minHeight:"100vh"}})}}render(){const{organisationUnits:e}=this.props;return n.a.createElement("div",{style:Vr.wrap,onClick:this.focusOrgUnitInput},n.a.createElement(Pr.a,{style:Vr.icon}),n.a.createElement(Dr.a,{ref:this.inputRef,style:Vr.textField,floatingLabelText:c.a.t("Organisation unit"),onFocus:this.showOrgTreeInDialog,value:e,inputStyle:Vr.input}))}}var Hr=Object(o.b)(e=>({organisationUnits:wt(e.filter.organisationUnits)}),{showDialog:Ya,hideDialog:za})(jr);const qr={float:"left",marginRight:"1rem",width:"236px"};class Wr extends s.Component{constructor(e){super(e),this.updateSearchFilter=e=>{const{getList:t,entityType:a,updateFilter:r}=this.props;r("query",e),t(a)},this.onQueryStrChange=e=>{const t=e.target.value;this.setState({localQueryStr:t}),this.updateSearchFilter(t)},this.state={localQueryStr:e.filter.query},this.updateSearchFilter=Ee()(this.updateSearchFilter,375)}render(){const{localQueryStr:e}=this.state;return n.a.createElement(Q.a,{className:"search-input",floatingLabelText:c.a.t("Search by name"),style:qr,hintText:"",value:e,type:"search",onChange:this.onQueryStrChange})}}var Qr=Object(o.b)(e=>({filter:e.filter}),{getList:Ma,updateFilter:qa})(Wr);const Yr={float:"left",marginRight:"1rem"},zr={...Yr,display:"inline-block",float:"left",width:"182px",paddingTop:"37px",height:"35px"};class Kr extends s.Component{constructor(...e){super(...e),this.onFilterChange=(e,t)=>{const{getList:a,entityType:r,updateFilter:s,filter:n}=this.props;n[e]!==t&&(s(e,t),a(r))}}createInactiveMonthsOptions(){const e=c.a.t("month"),t=c.a.t("months");return Array(12).fill().map((a,r)=>{const s=r+1;return{id:s,displayName:1===s?"".concat(s," ").concat(e):"".concat(s," ").concat(t)}})}renderDropDown(e){const t={...e,includeEmpty:!0,emptyLabel:c.a.t("<No value>")};return n.a.createElement(ee.DropDown,t)}renderInactiveMonthsFilter(){const e={menuItems:this.createInactiveMonthsOptions(),floatingLabelText:c.a.t("Inactivity"),value:this.props.filter.inactiveMonths,onChange:e=>this.onFilterChange("inactiveMonths",e.target.value),style:{...Yr,width:"132px"}};return this.renderDropDown(e)}renderInvitationStatusFilter(){const e={menuItems:[{id:"all",displayName:c.a.t("All invitations")},{id:"expired",displayName:c.a.t("Expired invitations")}],floatingLabelText:c.a.t("Invitations"),value:this.props.filter.invitationStatus,onChange:e=>this.onFilterChange("invitationStatus",e.target.value),style:{...Yr,width:"172px"}};return this.renderDropDown(e)}renderSelfRegisteredFilter(){const e=this.props.filter.selfRegistered,t="".concat("data-table__filter-bar__checkbox","--checked");return n.a.createElement(xe.Checkbox,{value:e,onCheck:(e,t)=>this.onFilterChange("selfRegistered",t),label:c.a.t("Self registrations"),className:e?t:"data-table__filter-bar__checkbox",style:zr})}render(){const{entityType:e}=this.props;return n.a.createElement("div",null,n.a.createElement(Qr,{entityType:e}),n.a.createElement(Hr,null),this.renderInactiveMonthsFilter(),this.renderInvitationStatusFilter(),this.renderSelfRegisteredFilter())}}var Xr=Object(o.b)(e=>({filter:e.filter}),{updateFilter:qa,getList:Ma})(Kr);var $r=()=>n.a.createElement(or,{entityType:$t,columns:["displayName","userName","lastLogin","disabled"],filterComponent:Xr,primaryAction:wr.edit,contextMenuActions:wr,contextMenuIcons:vr,isContextActionAllowed:Ir,sectionName:c.a.t("User Management"),newItemPath:"/users/new",className:"user-list"}),Jr=a(321),Zr=a(235),es=a.n(Zr);var ts=({to:e,tooltip:t,icon:a})=>{const r=n.a.createElement(es.a,{iconClassName:"material-icons",tooltip:t},a);return e?n.a.createElement(Jr.a,{to:e},r):r},as=a(804),rs=a.n(as);class ss extends s.Component{constructor(...e){super(...e),this.fields=[{name:"name",label:c.a.t("Name"),fieldRenderer:mt,isRequiredField:!0},{name:"description",label:c.a.t("Description"),fieldRenderer:mt},{name:"authorities",label:c.a.t("Authorities"),fieldRenderer:gt}],this.saveRole=async(e,t,a)=>{const{role:r,showSnackbar:s,clearItem:n,getList:i}=a,o={...r.toJSON(),name:e.name,description:e.description,authorities:e.authorities};try{await xa.saveRole(o);s({message:c.a.t('User role "{{displayName}}" saved successfully',{displayName:o.name})}),n(),i("userRole"),this.backToList(),dr(r)}catch(l){s({message:re(l,c.a.t("There was a problem saving the user role."))})}},this.backToList=()=>{tr("/user-roles")},this.render=()=>{const{handleSubmit:e,submitting:t,asyncValidating:a,pristine:r,valid:s}=this.props,i=Boolean(t||a||r||!s);return n.a.createElement("main",null,n.a.createElement("form",{autoComplete:"off",onSubmit:e(this.saveRole)},this.renderFields(),n.a.createElement("div",{style:{marginTop:"2rem"}},n.a.createElement(Se.a,{label:c.a.t("Save"),type:"submit",primary:!0,disabled:i,style:{marginRight:"8px"}}),n.a.createElement(Se.a,{label:c.a.t("Cancel"),onClick:this.backToList}))))}}renderFields(){return this.fields.map(e=>{const{name:t,fieldRenderer:a,label:r,isRequiredField:s,...i}=e,o=r+(s?" *":""),l="name"===t?[ma]:[];return n.a.createElement(mr.a,Object.assign({name:t,key:t,component:a,label:o,validate:l},i))})}}const ns=Object(gr.a)({form:"roleForm",asyncValidate:async function(e,t,a,r){return fr(e,a,r,Tr)},asyncBlurFields:["name"]})(ss);var is=Object(o.b)(e=>({role:e.currentItem,initialValues:{name:e.currentItem.name,description:e.currentItem.description,authorities:e.currentItem.authorities||[]}}),{clearItem:Ha,showSnackbar:Wa,getList:Ma})(ns);class os extends s.Component{constructor(e){super(e),this.saveGroup=async(e,t,a)=>{const{group:r,showSnackbar:s,clearItem:n,getList:i}=a;r[Tt]=e[Tt],r[_t]=e[_t],r.users=e.users.map(this.createIdValueObject),r.managedGroups=e.managedGroups.map(this.createIdValueObject),r.attributeValues=Sa(e,this.state.attributeFields);try{await r.save();s({message:c.a.t('User group "{{displayName}}" saved successfully',{displayName:r.name})}),n(),i("userGroup"),this.backToList(),dr(r)}catch(o){s({message:re(o,c.a.t("There was a problem saving the user group."))})}},this.backToList=()=>{tr("/user-groups")},this.state={attributeFields:null},this.trashableAttributesPromise=null,this.fields=St()}async componentDidMount(){const{group:e,showSnackbar:t,initialize:a}=this.props;this.trashableAttributesPromise=ge()(xa.getAttributes("userGroup"));try{const t=_a(await this.trashableAttributesPromise,e.attributeValues);Ra(t,this.props.asyncBlurFields),this.setState({attributeFields:t}),a(Nt(e,t))}catch(r){console.error(r),t({message:re(r,c.a.t("Could not load the user group data. Please refresh the page."))})}}createIdValueObject(e){return{id:"string"===typeof e?e:e.id}}renderFields(e){const{group:t}=this.props;return e.map(e=>{const{name:a,fieldRenderer:r,label:s,isRequiredField:i,isAttributeField:o,fieldValidators:l,...c}=e,d=s+(i?" *":"");return r===bt&&(c.availableItemsQuery=xa[c.availableItemsQuery],i&&(c.assignedItemsLabel+=" *"),c.initialValues=e.initialItemsSelector(t)),c.validate=function(e,t,a,r,s){const n=[],i=r&&a;return t===Tt&&n.push(ma),"users"===t&&n.push(ga),t===_t&&n.push(na),i&&n.push(ma),r&&s&&n.push(...s),n}(this.props,a,i,o,l),n.a.createElement(mr.a,Object.assign({name:a,key:a,component:r,label:d,validate:[]},c))})}render(){const{handleSubmit:e,submitting:t,asyncValidating:a,pristine:r,valid:s}=this.props,{attributeFields:i}=this.state,o=Boolean(t||a||r||!s);return i?n.a.createElement("main",null,n.a.createElement("form",{autoComplete:"off",onSubmit:e(this.saveGroup)},this.renderFields(this.fields),this.renderFields(i),n.a.createElement("div",{style:{marginTop:"2rem"}},n.a.createElement(Se.a,{label:c.a.t("Save"),type:"submit",primary:!0,disabled:o,style:{marginRight:"8px"}}),n.a.createElement(Se.a,{label:c.a.t("Cancel"),onClick:this.backToList})))):n.a.createElement("div",{style:Rt.loaderWrap},n.a.createElement(ue.a,null))}}const ls=Object(gr.a)({form:"groupForm",asyncValidate:br,asyncBlurFields:[Tt,_t]})(os);var cs=Object(o.b)(e=>({group:e.currentItem}),{clearItem:Ha,showSnackbar:Wa,getList:Ma})(ls),ds=a(1787),us=a(253),ps=a.n(us),hs=a(743),ms=a.n(hs),gs=a(744),ys=a.n(gs);const Es={...r,userRoles:ga,organisationUnits:ga},bs=new Set([kt,"password","repeatPassword","surname","firstName"]),fs=new Set(["email","surname","firstName"]),As=new Set(["surname","firstName"]);class Ts extends s.Component{constructor(e){super(e),this.toggleShowMore=()=>{this.setState({showMore:!this.state.showMore})},this.handleSubmit=async(e,t,a)=>{const{user:r,inviteUser:s,showSnackbar:n,clearItem:i,getList:o}=a,l=this.state.locales.ui.selected,d=this.state.locales.db.selected;try{await xa.saveOrInviteUser(e,r,s,l,d,this.state.attributeFields);n({message:c.a.t('User "{{displayName}}" saved successfully',{displayName:"".concat(e.firstName," ").concat(e.surname)})}),i(),o($t),this.backToList(),dr(r)}catch(u){console.error(u),n({message:re(u,c.a.t("There was a problem saving the user."))})}},this.backToList=()=>{tr("/users")},this.state={showMore:!1,locales:null,attributeFields:null},this.trashableAttributesPromise=null,this.trashableLocalePromise=null,this.inviteFields=[{name:Mt,label:c.a.t("Create account or email invitation"),fieldRenderer:Et,options:[{id:zt,label:c.a.t("Create account with user details")},{id:Kt,label:c.a.t("Email invitation to create account")}],props:{style:{}}}],this.baseFields=[{name:kt,label:c.a.t("Username"),fieldRenderer:mt,isRequiredField:"CREATE_REQUIRED"},{name:"email",label:c.a.t("E-mail"),fieldRenderer:mt,isRequiredField:"INVITE_REQUIRED"},{name:Gt,label:c.a.t("External authentication only (OpenID or LDAP)"),fieldRenderer:yt},{name:"password",label:c.a.t("Password"),fieldRenderer:mt,isRequiredField:"CREATE_REQUIRED",props:{type:"password",autoComplete:"new-password"}},{name:"repeatPassword",label:c.a.t("Retype password"),fieldRenderer:mt,isRequiredField:"CREATE_REQUIRED",props:{type:"password",autoComplete:"new-password"}},{name:"surname",label:c.a.t("Surname"),isRequiredField:"ALWAYS_REQUIRED",fieldRenderer:mt},{name:"firstName",label:c.a.t("First name"),isRequiredField:"ALWAYS_REQUIRED",fieldRenderer:mt},{name:Bt,label:c.a.t("OpenID"),fieldRenderer:mt},{name:Vt,label:c.a.t("LDAP identifier"),fieldRenderer:mt},{name:"phoneNumber",label:c.a.t("Mobile phone number"),fieldRenderer:mt},{name:"whatsApp",label:c.a.t("WhatsApp"),fieldRenderer:mt},{name:"facebookMessenger",label:c.a.t("Facebook Messenger"),fieldRenderer:mt},{name:"skype",label:c.a.t("Skype"),fieldRenderer:mt},{name:"telegram",label:c.a.t("Telegram"),fieldRenderer:mt},{name:"twitter",label:c.a.t("Twitter"),fieldRenderer:mt},{name:jt,label:c.a.t("Interface language"),fieldRenderer:Et,optionsSelector:"locales.ui.available",isRequiredField:"ALWAYS_REQUIRED"},{name:Ht,label:c.a.t("Database language"),fieldRenderer:Et,optionsSelector:"locales.db.available",isRequiredField:"ALWAYS_REQUIRED"},{name:"userRoles",fieldRenderer:bt,isRequiredField:"ALWAYS_REQUIRED",initialItemsSelector:e=>V(j("userCredentials.userRoles",e)||[]),availableItemsQuery:"getAvailableUserRoles",availableItemsLabel:c.a.t("Available roles"),assignedItemsLabel:c.a.t("Selected roles")},{name:qt,label:c.a.t("Data capture and maintenance organisation units"),isRequiredField:"ALWAYS_REQUIRED",orgUnitType:qt,fieldRenderer:ft,wrapperStyle:{...Pt.orgUnitTree,paddingRight:"60px"}},{name:"dataViewOrganisationUnits",label:c.a.t("Data output and analytic organisation units"),orgUnitType:"dataViewOrganisationUnits",fieldRenderer:ft,wrapperStyle:{...Pt.orgUnitTree,paddingLeft:"60px"}},{...Xt(),name:"org_unit_info_1"}],this.additionalFields=[{name:"teiSearchOrganisationUnits",label:c.a.t("Search Organisation Units"),orgUnitType:"teiSearchOrganisationUnits",fieldRenderer:ft,wrapperStyle:{...Pt.orgUnitTree,paddingRight:"60px"}},{...Xt(),name:"org_unit_info_2"},{name:"userGroups",fieldRenderer:bt,initialItemsSelector:e=>V(e.userGroups)||[],availableItemsQuery:"getAvailableUserGroups",availableItemsLabel:c.a.t("Available user groups"),assignedItemsLabel:c.a.t("Selected user groups")},{name:Wt,fieldRenderer:bt,initialItemsSelector:e=>xt(e),availableItemsQuery:"getAvailableDataAnalyticsDimensionRestrictions",availableItemsLabel:c.a.t("Available dimension restrictions for data analytics"),assignedItemsLabel:c.a.t("Selected dimension restrictions for data analytics"),returnModelsOnUpdate:!0}]}async componentDidMount(){const{user:e,showSnackbar:t,initialize:a}=this.props,r=e.id?e.userCredentials.username:null;this.trashableLocalePromise=ge()(xa.getSelectedAndAvailableLocales(r)),this.trashableAttributesPromise=ge()(xa.getAttributes($t));try{const t=await this.trashableLocalePromise,r=_a(await this.trashableAttributesPromise,e.attributeValues);Ra(r,this.props.asyncBlurFields),this.setState({locales:t,attributeFields:r}),a(Ut(e,t,r))}catch(s){console.error(s),t({message:re(s,c.a.t("Could not load the user data. Please refresh the page."))})}}componentWillUnmount(){this.trashableLocalePromise.trash(),this.trashableAttributesPromise.trash()}getLabelText(e,t,a){const{inviteUser:r}=this.props;return"ALWAYS_REQUIRED"===a||r&&"INVITE_REQUIRED"===a||"CREATE_REQUIRED"===a&&!t.id&&!r||"boolean"===typeof a&&a?"".concat(e," *"):e}prepareGroupEditor(e,t,a,r){e.assignedItemsLabel=this.getLabelText(e.assignedItemsLabel,a,r),e.availableItemsQuery=xa[e.availableItemsQuery],e.initialValues=t.initialItemsSelector(a)}exludeField(e){const{user:t,inviteUser:a,externalAuthOnly:r}=this.props;return!(this.context.d2.system.systemInfo.emailConfigured&&!t.id||e!==Mt)||(!(!a&&!r||"password"!==e&&"repeatPassword"!==e)||!(!a||![Gt,Bt,Vt].includes(e)))}renderFields(e){const{user:t}=this.props;return e.reduce((e,a)=>{const{name:r,fieldRenderer:s,label:i,isRequiredField:o,isAttributeField:l,fieldValidators:c,...d}=a,u=this.getLabelText(i,t,o);if(this.exludeField(r))return e;if(s===At)return e.push(At(a)),e;switch(s){case mt:d.hintText||(d.hintText=i),d.disabled=Boolean(r===kt&&t.id);break;case ft:d.initialValues=V(t[a.name]);break;case bt:this.prepareGroupEditor(d,a,t,o);break;case Et:d.options=a.optionsSelector?j(a.optionsSelector,this.state):a.options}return d.validate=function(e,t,a,r,s){const n=[],i=Boolean(e.user.id),o=r&&a,l=Es[t],c=!r&&i?As.has(t):e.inviteUser?fs.has(t):bs.has(t);return l&&n.push(l),(o||c)&&n.push(ma),r&&s&&n.push(...s),n}(this.props,r,o,l,c),e.push(n.a.createElement(mr.a,Object.assign({name:r,key:r,component:s,label:u},d))),e},[])}renderCreateOrInviteField(){return this.renderFields(this.inviteFields)}renderAttributeFields(){return this.renderFields(this.state.attributeFields)}renderBaseFields(){return this.renderFields(this.baseFields)}renderAdditionalFields(e){return e?n.a.createElement("div",{style:Pt.additionalFieldsWrap},this.renderFields(this.additionalFields)):null}renderToggler(e){const t=e?c.a.t("Show fewer options"):c.a.t("Show more options"),a=e?n.a.createElement(ms.a,null):n.a.createElement(ys.a,null);return n.a.createElement("div",{style:Pt.togglerWrap},n.a.createElement(ps.a,{onClick:this.toggleShowMore,label:t,style:Pt.toggler,icon:a}))}render(){const{handleSubmit:e,submitting:t,asyncValidating:a,pristine:r,valid:s,inviteUser:i}=this.props,{showMore:o,locales:l}=this.state,d=Boolean(t||a||r||!s),u=!0===i?c.a.t("Send invite"):c.a.t("Save");return l?n.a.createElement("main",null,n.a.createElement("form",{autoComplete:"off",onSubmit:e(this.handleSubmit)},this.renderCreateOrInviteField(),this.renderBaseFields(),this.renderAttributeFields(),this.renderAdditionalFields(o),this.renderToggler(o),n.a.createElement("div",null,n.a.createElement(Se.a,{label:u,type:"submit",primary:!0,disabled:d,style:{marginRight:"8px"}}),n.a.createElement(Se.a,{label:c.a.t("Cancel"),onClick:this.backToList})))):n.a.createElement("div",{style:Pt.loaderWrap},n.a.createElement(ue.a,null))}}Ts.contextTypes={d2:Ne.a.object.isRequired};const _s=Object(ds.a)("userForm"),Rs=Object(gr.a)({form:"userForm",asyncValidate:br,asyncBlurFields:[kt]})(Ts);var Ss=Object(o.b)(e=>({user:e.currentItem,fallbackOrgUnits:e.currentUser[qt],inviteUser:Lt(e.form.userForm),externalAuthOnly:Boolean(_s(e,Gt))}),{clearItem:Ha,showSnackbar:Wa,getList:Ma})(Rs);const Cs={main:{width:"100%",paddingLeft:"2rem"},heading:{paddingBottom:"1rem"},paper:{padding:"2rem 5rem 4rem"}};class Is extends s.Component{componentDidMount(){const{match:{params:{id:e}},item:t,getItem:a,initNewItem:r,entityType:s}=this.props;!e||t&&t.id===e?e||r(s):a(s,e),this.formNotFoundErrorMsg=c.a.t("There was an error getting the form:")}renderForm(){const{entityType:e}=this.props;switch(e){case $t:return n.a.createElement(Ss,null);case"userRole":return n.a.createElement(is,null);case"userGroup":return n.a.createElement(cs,null);default:return n.a.createElement(ae,{introText:this.formNotFoundErrorMsg,errorMessage:""})}}renderHeader(){const{match:{params:{id:e}},item:t,shortItem:a,entityType:r}=this.props,s=t&&t.id===e?t:a,i=s?s.modelDefinition.displayName:Er()(r),o=s?s.displayName:"",l="".concat(c.a.t("Update")," ").concat(i,": ").concat(o),d="".concat(c.a.t("Create new")," ").concat(i),u=e?l:d,p=s?"/".concat(rs()(s.modelDefinition.plural)):null,h="".concat(c.a.t("Back to")," ").concat(i,"s");return n.a.createElement(ee.Heading,{style:Cs.heading},n.a.createElement(ts,{to:p,tooltip:h,disabled:Boolean(p),icon:"arrow_back"}),u)}renderContent(){const{match:{params:{id:e}},item:t}=this.props;return"string"===typeof t?n.a.createElement(ae,{introText:this.formNotFoundErrorMsg,errorMessage:t}):!t||t&&t.id!==e?n.a.createElement("div",{style:{textAlign:"center",paddingTop:"2rem"}},n.a.createElement(xe.CircularProgress,null)):this.renderForm()}render(){return n.a.createElement("main",{style:Cs.main},this.renderHeader(),n.a.createElement(xe.Paper,{style:Cs.paper},this.renderContent()))}}var vs=Object(o.b)((e,t)=>({item:e.currentItem,shortItem:Ft(t.match.params.id,e.list.items)}),{getItem:Ba,initNewItem:e=>{const t=xa.getD2().models[e].create();return Pa("INIT_NEW_ITEM",t)}})(Is);var ws=(e,t)=>{const a=xa.getD2().currentUser.userSettings.settings.keyUiLocale,r=new Date(e),s={day:"numeric",month:"long",year:"numeric"},n=t?{...s,hour:"2-digit",minute:"2-digit"}:s;return new Intl.DateTimeFormat(a,n).format(r)},Os=a(1674),Us=a.n(Os),Ns=a(1675),xs=a.n(Ns);const Fs={main:{width:"100%",paddingLeft:"2rem"},heading:{paddingBottom:"1rem"},raisedButton:{height:"36px",transform:"translateY(10px)",float:"right",marginLeft:"1rem"},paper:{padding:"1.4rem"},cell:{fontSize:"1rem",padding:"0.8rem",verticalAlign:"top"},valueCell:{textAlign:"right",color:"#757575"}};class Ds extends s.Component{componentDidMount(){const{baseName:e,routeId:t,getItem:a}=this.props;a(e,t)}getLabelForEntity(e){switch(e){case $t:return c.a.t("Edit user");case"userGroup":return c.a.t("Edit user group");case"userRole":return c.a.t("Edit user role");default:return""}}renderSendMessageBtn(e){const t="".concat(xa.getContextPath(),"/dhis-web-messaging/#/PRIVATE/create/").concat(e);return n.a.createElement(Se.a,{style:Fs.raisedButton,label:c.a.t("Send message"),secondary:!0,containerElement:n.a.createElement("a",{href:t}," "),icon:n.a.createElement(xs.a,null)})}renderPropertyFields(){const{summaryObject:e,config:t}=this.props,a={...Fs.cell,...Fs.valueCell};return t.map((t,r)=>{const{key:s,removeText:i,parseDate:o,parseDateTime:l,nestedPropselector:d,parseArrayAsCommaDelimitedString:u,count:p}=t;let{label:h}=t;h=c.a.t(h);let m=e[s];return"undefined"===typeof m?m="":(d&&d.forEach(e=>{m=m[e]}),u&&("function"===typeof m.toArray&&(m=m.toArray()),m=m.map(e=>e[u]).join(", ")),i&&(m=Er()(m.replace(i,""))),(o||l)&&"string"===typeof m&&(m=ws(m,l)),p&&("number"===typeof m.size?m=m.size:"number"===typeof m.length&&(m=m.length))),n.a.createElement("tr",{key:r},n.a.createElement("td",{style:a},h),n.a.createElement("td",{style:Fs.cell},m))})}render(){const{summaryObject:e,baseName:t}=this.props;if(null===e)return n.a.createElement(ee.LoadingMask,null);if("string"===typeof e){const a=c.a.t("There was an error fetching the ".concat(t));return n.a.createElement(ae,{introText:a,errorMessage:e})}const{id:a,displayName:r,access:s}=e,i="".concat(t,"s"),o="/".concat(rs()(i)),l=c.a.t("Back to ".concat(i)),d="".concat(o,"/edit/").concat(a),u=this.getLabelForEntity(t);return n.a.createElement("main",{style:Fs.main},n.a.createElement(ee.Heading,{style:Fs.heading},n.a.createElement(ts,{to:o,tooltip:l,icon:"arrow_back"}),r,s.update?n.a.createElement(Se.a,{style:Fs.raisedButton,label:u,primary:!0,containerElement:n.a.createElement(Jr.a,{to:d}),icon:n.a.createElement(Us.a,null)}):null,t===$t?this.renderSendMessageBtn(a):null),n.a.createElement(xe.Paper,{style:Fs.paper},n.a.createElement("table",null,n.a.createElement("tbody",null,this.renderPropertyFields()))))}}var Ls=Object(o.b)(e=>({summaryObject:e.currentItem}),{getItem:Ba})(Ds);const Ps=()=>[{key:"displayName",label:c.a.t("Display name")},{key:"id",label:c.a.t("ID")}];var ks=({match:{params:{id:e}}})=>n.a.createElement(Ls,{routeId:e,config:[...Ps(),{key:"userCredentials",nestedPropselector:["lastLogin"],label:c.a.t("Last login"),parseDateTime:!0},{key:"created",label:c.a.t("Created"),parseDate:!0},{key:"surname",label:c.a.t("Surname")},{key:"firstName",label:c.a.t("First name")},{key:"introduction",label:c.a.t("Introduction")},{key:"jobTitle",label:c.a.t("Job title")},{key:"employer",label:c.a.t("Works at")},{key:"education",label:c.a.t("Education")},{key:"interests",label:c.a.t("Interests")},{key:"nationality",label:c.a.t("Nationality")},{key:"birthday",label:c.a.t("Birthday"),parseDate:!0},{key:"gender",label:c.a.t("Gender"),removeText:"gender_"},{key:"languages",label:c.a.t("Speaks")},{key:"email",label:c.a.t("E-mail")},{key:"phoneNumber",label:c.a.t("Mobile phone number")},{key:"organisationUnits",label:c.a.t("Organisations units"),parseArrayAsCommaDelimitedString:"displayName"},{key:"userCredentials",label:c.a.t("User roles"),nestedPropselector:["userRoles"],parseArrayAsCommaDelimitedString:"displayName"}],baseName:$t});const Ms={width:"100%",textAlign:"center",padding:"1.5rem 1.5rem 1rem"};var Gs=({location:e})=>n.a.createElement("div",{style:Ms},n.a.createElement("h1",null,c.a.t("Page not found.")),n.a.createElement("h3",null,c.a.t("No match for"),n.a.createElement("code",null," ",e.pathname)),n.a.createElement(Jr.a,{to:"/"}," ",c.a.t("Go back home"))),Bs=a(741),Vs=a.n(Bs),js=a(368),Hs=a.n(js),qs=a(369),Ws=a.n(qs),Qs=a(370),Ys=a.n(Qs),zs=a(437),Ks=a.n(zs);const Xs={padding:"0",margin:".5rem",marginTop:"1rem",float:"left",width:"230px"},$s={padding:"1rem",height:"auto",borderBottom:"1px solid #ddd",cursor:"pointer",fontWeight:"bold"},Js={height:"85px",padding:".5rem 1rem"},Zs={textAlign:"right"};class en extends s.Component{constructor(...e){super(...e),this.renderCard=(e,t)=>{const{currentUser:a,models:r}=this.context.d2,s=a.canCreate(r[e.entityType]),i=a.canDelete(r[e.entityType]),o=s||i;return o?n.a.createElement(Vs.a,{key:"card-".concat(t),style:Xs},n.a.createElement(Hs.a,{onClick:()=>tr(e.path),style:$s,title:e.label}),n.a.createElement(Ws.a,{style:Js},e.description),n.a.createElement(Ys.a,{style:Zs},this.renderActionButtons(e,o,s))):null}}renderActionButtons(e,t,a){const r=[],s="".concat(e.path,"/new");return a&&r.push(n.a.createElement(Ks.a,{key:"add",iconClassName:"material-icons",tooltip:c.a.t("Add"),tooltipPosition:"top-center",onClick:()=>tr(s)},"\ue145")),t&&r.push(n.a.createElement(Ks.a,{key:"list",iconClassName:"material-icons",tooltip:c.a.t("list"),tooltipPosition:"top-center",onClick:()=>tr(e.path)},"\ue8ef")),r}render(){const e=bn().map(this.renderCard);return 0===e.length?n.a.createElement("div",null,c.a.t("You do not have access to any section of the DHIS 2 User Management App")):e}}en.contextTypes={d2:Ne.a.object};var tn=en;const an=(e,t)=>{if(!e)return!1;const{access:a}=e;switch(t){case"show_details":return a.read;case"sharing_settings":return a.manage;case"edit":return a.update;case"remove":return a.delete;default:return!0}},rn={show_details:"info",sharing_settings:"share",edit:"edit",remove:"delete"},sn=ee.Action.createActionsFromNames([["show_details"],["sharing_settings"],["edit"],["remove"]]);sn.show_details.subscribe(({data:{id:e}})=>{tr("/user-roles/view/".concat(e))}),sn.sharing_settings.subscribe(hr),sn.edit.subscribe(({data:{id:e}})=>{tr("/user-roles/edit/".concat(e))}),sn.remove.subscribe(({data:e})=>{ur({model:e,entityType:"userRole"})});var nn=()=>n.a.createElement(or,{entityType:"userRole",filterComponent:Qr,columns:["displayName","description"],primaryAction:sn.edit,contextMenuActions:sn,contextMenuIcons:rn,isContextActionAllowed:an,sectionName:c.a.t("User Role Management"),newItemPath:"/user-roles/new",className:"role-list"});var on=({match:{params:{id:e}}})=>n.a.createElement(Ls,{routeId:e,config:[...Ps(),{key:"users",label:c.a.t("Members"),count:!0}],baseName:"userRole"});const ln=(e,t)=>{if(!e)return!1;const{access:a}=e;switch(t){case"show_details":return a.read;case"sharing_settings":return a.manage;case"edit":return a.update;case"join_group":return a.update&&!e.currentUserIsMember;case"leave_group":return a.update&&e.currentUserIsMember;case"remove":return a.delete;default:return!0}},cn={show_details:"info",sharing_settings:"share",edit:"edit",join_group:"group_add",leave_group:"exit_to_app",remove:"delete"},dn=ee.Action.createActionsFromNames(["show_details","sharing_settings","edit","join_group","leave_group","remove"]),un=async({displayName:e,id:t},a)=>{try{await xa.updateCurrentUserGroupMembership(t,a);const r=a?c.a.t("You left group"):c.a.t("You joined group");D.dispatch(Wa({message:"".concat(r," ").concat(e)})),D.dispatch(ja())}catch(r){D.dispatch(Wa({message:re(r,c.a.t("There was a problem updating your group membership"))}))}};dn.show_details.subscribe(({data:{id:e}})=>{tr("/user-groups/view/".concat(e))}),dn.sharing_settings.subscribe(hr),dn.edit.subscribe(({data:{id:e}})=>{tr("/user-groups/edit/".concat(e))}),dn.join_group.subscribe(({data:e})=>{un(e,!1)}),dn.leave_group.subscribe(({data:e})=>{un(e,!0)}),dn.remove.subscribe(({data:e})=>{ur({model:e,entityType:"userGroup"})});class pn extends s.Component{render(){return n.a.createElement(or,{entityType:"userGroup",filterComponent:Qr,columns:["displayName","currentUserIsMember"],primaryAction:dn.edit,contextMenuActions:dn,contextMenuIcons:cn,isContextActionAllowed:ln,sectionName:c.a.t("User Group Management"),newItemPath:"/user-groups/new",className:"group-list"})}}var hn=Object(o.b)(e=>({groupMemberships:e.currentUser.userGroups}))(pn);var mn=({match:{params:{id:e}}})=>n.a.createElement(Ls,{routeId:e,config:[...Ps(),{key:"users",label:c.a.t("Number of users"),count:!0}],baseName:"userGroup"});const gn=()=>({key:"user_section",label:c.a.t("User"),icon:"person",path:"/users",description:c.a.t("Create, modify, view and delete Users"),component:$r,entityType:$t}),yn=()=>({key:"user_role_section",label:c.a.t("User role"),icon:"folder_shared",path:"/user-roles",description:c.a.t("Create, modify, view and delete User Roles"),component:nn,entityType:"userRole"}),En=()=>({key:"user_group_section",label:c.a.t("User group"),icon:"group",path:"/user-groups",description:c.a.t("Create, modify, view and delete User Groups"),component:hn,entityType:"userGroup"}),bn=(()=>{let e=null;return()=>(e||(e=[gn(),yn(),En()]),e)})();var fn=(()=>{let e=null;return()=>(e||(e=[{key:"user_new_view",path:"/users/new",render:e=>n.a.createElement(vs,Object.assign({entityType:$t},e)),entityType:$t},{key:"user_edit_view",path:"/users/edit/:id",render:e=>n.a.createElement(vs,Object.assign({entityType:$t},e)),entityType:$t},{key:"user_profile_view",path:"/users/view/:id",component:ks,entityType:$t},gn(),{key:"user_role_new_view",path:"/user-roles/new",render:e=>n.a.createElement(vs,Object.assign({entityType:"userRole"},e)),entityType:"userRole"},{key:"user_role_edit_view",path:"/user-roles/edit/:id",render:e=>n.a.createElement(vs,Object.assign({entityType:"userRole"},e)),entityType:"userRole"},{key:"user_role_details_view",path:"/user-roles/view/:id",component:on,entityType:"userRole"},yn(),{key:"user_group_new_view",path:"/user-groups/new",render:e=>n.a.createElement(vs,Object.assign({entityType:"userGroup"},e)),entityType:"userGroup"},{key:"user_group_edit_view",path:"/user-groups/edit/:id",render:e=>n.a.createElement(vs,Object.assign({entityType:"userGroup"},e)),entityType:"userGroup"},{key:"user_group_details_view",path:"/user-groups/view/:id",component:mn,entityType:"userGroup"},En(),{key:"landing_page",path:"/",component:tn},{key:"not_found",component:Gs}]),e)})();const An={display:"flex",flex:"0 0 320px"};class Tn extends s.Component{constructor(...e){super(...e),this.changeSectionHandler=e=>{const{sections:t,history:a}=this.props,r=t.find(t=>t.key===e);a.push(r.path)}}render(){const{sections:e,location:{pathname:t}}=this.props,a=e.find(e=>e.path===t),r="/"===t,s=a?a.key:null;return a||r?n.a.createElement("div",{style:An},n.a.createElement(ee.Sidebar,{sections:e,onChangeSection:this.changeSectionHandler,currentSection:s})):null}}var _n=Object(Fa.e)(Tn);const Rn={display:"flex",flex:"1 1 0%",paddingRight:"2rem",paddingTop:"1rem"};class Sn extends s.Component{componentDidMount(){const{initCurrentUser:e,currentUser:t}=this.props;t?this.setRouteConfig(t):e()}componentWillReceiveProps({currentUser:e,location:{pathname:t}}){this.setRouteConfig(e),e&&e!==this.props.currentUser&&"/"!==t&&!this.pathHasAvailableSection(t)&&tr("/")}pathHasAvailableSection(e){if(!this.routeConfig)return!1;const{sections:t}=this.routeConfig;return Boolean(t&&t.find(t=>e.includes(t.path.split(":")[0])))}setRouteConfig(e){this.routeConfig=e?fn().reduce((t,a)=>{const{routes:r,sections:s}=t;return this.userHasAuthorities(a,e)&&(r.push(a),a.label&&s.push(a)),t},{routes:[],sections:[]}):null}userHasAuthorities({entityType:e},t){if(!e)return!0;const{models:a}=this.context.d2,r=t.canCreate(a[e]),s=t.canDelete(a[e]);return r||s}renderRoutes(e){return e.map(e=>n.a.createElement(Fa.a,Object.assign({key:e.key,exact:!0,strict:!0},e)))}renderContent(){const{currentUser:e}=this.props;if(!e)return n.a.createElement(ee.LoadingMask,null);if("string"===typeof e){const t=c.a.t("There was an error loading the current user");return n.a.createElement(ae,{introText:t,errorMessage:e})}const{routes:t,sections:a}=this.routeConfig;if(a&&0===a.length){const e=c.a.t("You do not have authorities to see users, user roles or user groups");return n.a.createElement(ae,{introText:e,errorMessage:""})}return[n.a.createElement(_n,{key:"sidenav",sections:a}),n.a.createElement(Fa.c,{key:"routeswitch"},this.renderRoutes(t))]}render(){return n.a.createElement("main",{style:Rn},this.renderContent())}}Sn.contextTypes={d2:Ne.a.object};var Cn=Object(Fa.e)(Object(o.b)(({currentUser:e})=>({currentUser:e}),{initCurrentUser:()=>e=>{Ga(Va,xa.initCurrentUser(),e)}})(Sn)),In=a(486),vn=a.n(In);var wn=Object(o.b)(e=>({open:e.popups.snackbar.show,snackbarProps:e.popups.snackbar.props}),{hideSnackbar:Qa})(({open:e,snackbarProps:t,hideSnackbar:a})=>{const r={...{autoHideDuration:6e3,onRequestClose:a,style:{whiteSpace:"nowrap"},bodyStyle:{maxWidth:"100%"},contentStyle:{display:"flex"}},...t};return n.a.createElement(vn.a,Object.assign({open:e},r))}),On=a(312),Un=a.n(On);var Nn=Object(o.b)(e=>({open:e.popups.dialog.show,dialogProps:e.popups.dialog.props,content:e.popups.dialog.content}))(({open:e,dialogProps:t,content:a})=>n.a.createElement(Un.a,Object.assign({key:"dialog",open:e},t),a)),xn=a(1676),Fn=a.n(xn);var Dn=Object(o.b)(e=>({open:e.popups.sharing.show,id:e.popups.sharing.id,type:e.popups.sharing.type}),{hideSharingDialog:()=>Pa("HIDE_SHARING_DIALOG")})(({open:e,id:t,type:a,hideSharingDialog:r})=>n.a.createElement(Fn.a,{open:e,id:t,type:a,onRequestClose:r,d2:xa.getD2()}));var Ln=()=>n.a.createElement("div",null,n.a.createElement(Fa.b,{history:La,hashType:"noslash"},n.a.createElement(Cn,null)),n.a.createElement(wn,null),n.a.createElement(Nn,null),n.a.createElement(Dn,null)),Pn=a(346),kn=a.n(Pn),Mn=a(439),Gn=a.n(Mn),Bn=a(345),Vn=a.n(Bn),jn=a(227);const Hn={spacing:Gn.a,fontFamily:"Roboto, sans-serif",palette:{primary1Color:B.blue500,primary2Color:B.blue700,primary3Color:B.blue100,accent1Color:B.orange500,accent2Color:B.grey100,accent3Color:B.orangeA200,textColor:B.darkBlack,alternateTextColor:B.white,canvasColor:B.white,borderColor:B.grey400,disabledColor:Object(jn.fade)(B.darkBlack,.3)}},qn=Vn()(Hn);var Wn=Object.assign({},qn,{forms:{minWidth:350,maxWidth:750},formInput:{fontWeight:100}});class Qn extends s.Component{constructor(...e){super(...e),this.getChildContext=()=>({d2:this.props.d2}),this.render=()=>n.a.createElement(kn.a,{muiTheme:Wn},this.props.children)}}Qn.childContextTypes={d2:Ne.a.object};var Yn=Qn;a(1778),a(1779);t.default=()=>{const{d2:e}=Object(i.a)({d2Config:{schemas:["userRole","user","userGroup","userCredentials","organisationUnit"]},i18nRoot:"./d2i18n",onInitialized:e=>{xa.init(e)}});return e?n.a.createElement(o.a,{store:D},n.a.createElement(Yn,{d2:e},n.a.createElement(Ln,null))):null}}}]);
//# sourceMappingURL=app.6637b648.chunk.js.map